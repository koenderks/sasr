<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Koen Derks">
<title>Statistical Audit Sampling with R - 4&nbsp; Planning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<link href="./chap-selection.html" rel="next">
<link href="./chap-workflow.html" rel="prev">
<link href="./front-page.png" rel="icon" type="image/png">
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
<meta property="og:title" content="Statistical Audit Sampling with R - 4&nbsp; Planning">
<meta property="og:description" content="">
<meta property="og:image" content="https://koenderks.github.io/sasr/img/book_puzzle.png">
<meta property="og:site-name" content="Statistical Audit Sampling with R">
<meta property="og:image:height" content="1024">
<meta property="og:image:width" content="1536">
<meta name="twitter:title" content="Statistical Audit Sampling with R - 4&nbsp; Planning">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://koenderks.github.io/sasr/front-page.svg">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chap-workflow.html">Application</a></li><li class="breadcrumb-item"><a href="./chap-planning.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Planning</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistical Audit Sampling with R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/koenderks/sasr/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Statistical-Audit-Sampling-with-R.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Statistical-Audit-Sampling-with-R.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Statistics and Auditing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistical Inference</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Application</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Sampling Workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-planning.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Planning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Selection</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Evaluation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-stratified-evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Stratified Evaluation</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Software</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-jasp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">JASP for Audit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">R Packages</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix: R Tutorial</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#required-information" id="toc-required-information" class="nav-link active" data-scroll-target="#required-information"><span class="header-section-number">4.1</span> Required Information</a></li>
  <li>
<a href="#the-hypergeometric-likelihood" id="toc-the-hypergeometric-likelihood" class="nav-link" data-scroll-target="#the-hypergeometric-likelihood"><span class="header-section-number">4.2</span> The Hypergeometric Likelihood</a>
  <ul class="collapse">
<li><a href="#classical-planning" id="toc-classical-planning" class="nav-link" data-scroll-target="#classical-planning"><span class="header-section-number">4.2.1</span> Classical planning</a></li>
  <li><a href="#bayesian-planning" id="toc-bayesian-planning" class="nav-link" data-scroll-target="#bayesian-planning"><span class="header-section-number">4.2.2</span> Bayesian Planning</a></li>
  </ul>
</li>
  <li>
<a href="#the-binomial-likelihood" id="toc-the-binomial-likelihood" class="nav-link" data-scroll-target="#the-binomial-likelihood"><span class="header-section-number">4.3</span> The Binomial Likelihood</a>
  <ul class="collapse">
<li><a href="#classical-planning-1" id="toc-classical-planning-1" class="nav-link" data-scroll-target="#classical-planning-1"><span class="header-section-number">4.3.1</span> Classical Planning</a></li>
  <li><a href="#bayesian-planning-1" id="toc-bayesian-planning-1" class="nav-link" data-scroll-target="#bayesian-planning-1"><span class="header-section-number">4.3.2</span> Bayesian Planning</a></li>
  </ul>
</li>
  <li>
<a href="#the-poisson-likelihood" id="toc-the-poisson-likelihood" class="nav-link" data-scroll-target="#the-poisson-likelihood"><span class="header-section-number">4.4</span> The Poisson Likelihood</a>
  <ul class="collapse">
<li><a href="#classical-planning-2" id="toc-classical-planning-2" class="nav-link" data-scroll-target="#classical-planning-2"><span class="header-section-number">4.4.1</span> Classical planning</a></li>
  <li><a href="#bayesian-planning-2" id="toc-bayesian-planning-2" class="nav-link" data-scroll-target="#bayesian-planning-2"><span class="header-section-number">4.4.2</span> Bayesian Planning</a></li>
  </ul>
</li>
  <li>
<a href="#prior-distributions" id="toc-prior-distributions" class="nav-link" data-scroll-target="#prior-distributions"><span class="header-section-number">4.5</span> Prior Distributions</a>
  <ul class="collapse">
<li><a href="#default-prior" id="toc-default-prior" class="nav-link" data-scroll-target="#default-prior"><span class="header-section-number">4.5.1</span> Default Prior</a></li>
  <li><a href="#parametric-prior" id="toc-parametric-prior" class="nav-link" data-scroll-target="#parametric-prior"><span class="header-section-number">4.5.2</span> Parametric Prior</a></li>
  <li><a href="#improper-prior" id="toc-improper-prior" class="nav-link" data-scroll-target="#improper-prior"><span class="header-section-number">4.5.3</span> Improper Prior</a></li>
  <li><a href="#impartial-prior" id="toc-impartial-prior" class="nav-link" data-scroll-target="#impartial-prior"><span class="header-section-number">4.5.4</span> Impartial Prior</a></li>
  <li><a href="#probability-of-tolerable-misstatement" id="toc-probability-of-tolerable-misstatement" class="nav-link" data-scroll-target="#probability-of-tolerable-misstatement"><span class="header-section-number">4.5.5</span> Probability of Tolerable Misstatement</a></li>
  <li><a href="#audit-risk-model" id="toc-audit-risk-model" class="nav-link" data-scroll-target="#audit-risk-model"><span class="header-section-number">4.5.6</span> Audit Risk Model</a></li>
  <li><a href="#bayesian-risk-assessment-model" id="toc-bayesian-risk-assessment-model" class="nav-link" data-scroll-target="#bayesian-risk-assessment-model"><span class="header-section-number">4.5.7</span> Bayesian Risk Assessment Model</a></li>
  <li><a href="#earlier-sample" id="toc-earlier-sample" class="nav-link" data-scroll-target="#earlier-sample"><span class="header-section-number">4.5.8</span> Earlier Sample</a></li>
  <li><a href="#weighted-earlier-sample" id="toc-weighted-earlier-sample" class="nav-link" data-scroll-target="#weighted-earlier-sample"><span class="header-section-number">4.5.9</span> Weighted Earlier Sample</a></li>
  <li><a href="#nonparametric-prior" id="toc-nonparametric-prior" class="nav-link" data-scroll-target="#nonparametric-prior"><span class="header-section-number">4.5.10</span> Nonparametric Prior</a></li>
  </ul>
</li>
  <li>
<a href="#practical-examples" id="toc-practical-examples" class="nav-link" data-scroll-target="#practical-examples"><span class="header-section-number">4.6</span> Practical Examples</a>
  <ul class="collapse">
<li><a href="#audit-risk-model-1" id="toc-audit-risk-model-1" class="nav-link" data-scroll-target="#audit-risk-model-1"><span class="header-section-number">4.6.1</span> Audit Risk Model</a></li>
  <li><a href="#benchmark-analysis" id="toc-benchmark-analysis" class="nav-link" data-scroll-target="#benchmark-analysis"><span class="header-section-number">4.6.2</span> Benchmark Analysis</a></li>
  <li><a href="#predictive-modeling" id="toc-predictive-modeling" class="nav-link" data-scroll-target="#predictive-modeling"><span class="header-section-number">4.6.3</span> Predictive Modeling</a></li>
  </ul>
</li>
  <li><a href="#practical-exercises" id="toc-practical-exercises" class="nav-link" data-scroll-target="#practical-exercises"><span class="header-section-number">4.7</span> Practical Exercises</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/koenderks/sasr/edit/master/chap-planning.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/koenderks/sasr/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="chap-planning" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Planning</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>One of the key considerations in audit sampling is determining the appropriate sample size to reduce the sampling risk to an appropriately low level, while minimizing audit effort. To quantify the sampling risk, it is necessary to specify the statistical model that connects the data to the population misstatement, referred to as the likelihood. This chapter will delve into three standard likelihoods commonly employed in audit sampling: the hypergeometric likelihood, the binomial likelihood, and the Poisson likelihood.</p>
<p>Note that planning is a game of optimization that could be avoided. If you are using the Bayesian approach to audit sampling, it is not required to plan a specific sample size in advance <span class="citation" data-cites="Derks2022">(<a href="references.html#ref-Derks2022" role="doc-biblioref">Derks et al., 2022b</a>)</span>. That is because in Bayesian inference, the posterior distribution after seeing each item is used as the prior distribution for the next item. That means that you can simply start sampling and monitor the evidence in the data over time. However, to get an idea of how many samples are required to reduce the sampling risk to an level, planning a sample using a Bayesian approach can still be good practice.</p>
<section id="required-information" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="required-information">
<span class="header-section-number">4.1</span> Required Information</h2>
<p>First, planning a minimum sample requires knowledge of the conditions that lead to acceptance or rejection of the population (i.e., the sampling objectives). Typically, sampling objectives can be classified into one or both of the following:</p>
<ul>
<li>
<strong>Hypothesis testing</strong>: The goal of the sample is to obtain evidence for or against the claim that the misstatement in the population is lower than a given value (i.e., the performance materiality).</li>
<li>
<strong>Estimation</strong>: The goal of the sample is to obtain an accurate estimate of the misstatement in the population with a certain precision.</li>
</ul>
<p>Second, it is advised to specify the expected (or tolerable) misstatements in the sample. The expected misstatements are the misstatements that you allow in the sample, while still retaining the desired amount of assurance about the population. It is strongly recommended to set the value for the expected misstatements in the sample conservatively to minimize the chance of the observed misstatements in the sample exceeding the expected misstatements, which would imply that insufficient work has been done in the end to reduce the sampling risk to an appropriately low level.</p>
<p>Finally, next to determining the sampling objective(s) and the expected misstatements, it is important to determine the statistical distribution linking the sample outcomes to the population misstatement. This distribution is called the likelihood (i.e., <code>poisson</code>, <code>binomial</code>, or <code>hypergeometric</code>). All three aforementioned likelihoods are commonly used in an audit sampling context, however, <code>poisson</code> is the default likelihood in <strong>jfa</strong> because it is the most conservative of the three. In the subsections below, we elaborate on the three standard likelihoods for audit sampling and demonstrate how they can be used to obtain a minimum sample size.</p>
<p>In <strong>jfa</strong>, determining an appropriate sample size is achieved via the <code>planning()</code> function.</p>
<div id="fig-planning-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="img/book_puzzle.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;4.1: When the sampling objectives, the expected misstatements and the likelihood are set, there exists only one sample size that minimizes the amount of audit effort. Image available under a <a href="https://creativecommons.org/licenses/by-nc/4.0/legalcode">CC-BY-NC 4.0</a> license.</figcaption></figure>
</div>
</section><section id="the-hypergeometric-likelihood" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="the-hypergeometric-likelihood">
<span class="header-section-number">4.2</span> The Hypergeometric Likelihood</h2>
<p>The hypergeometric distribution is a discrete probability distribution that is commonly used to model the number of events occurring in a fixed number of trials when the population size is known. It assumes that samples are drawn from the population without replacement, and is therefore the likelihood that most closely resembles the audit practice. For our purpose, we can use the hypergeometric distribution as a likelihood to model the number of misstatements that are expected to be found in the sample.</p>
<p>The probability mass function (PMF) of the hypergeometric distribution is given by:</p>
<p><span class="math display">\[\begin{equation}
  p(X = k) = \frac{\binom{K}{k} \binom{N-K}{n-k}}{\binom{N}{n}},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(k\)</span> is the number of misstatements in the sample, <span class="math inline">\(n\)</span> is the sample size, <span class="math inline">\(N\)</span> is the population size and <span class="math inline">\(K\)</span> is the total number of misstatements assumed in the population. The assumed misstatements <span class="math inline">\(K\)</span> is a whole number, that is, a linear extrapolation of the maximum tolerable misstatement rate (i.e., the performance materiality) <span class="math inline">\(\theta_{max}\)</span> to the total population of size <span class="math inline">\(N\)</span>. In the equation below, <span class="math inline">\(\lceil...\rceil\)</span> is the ceiling function, which means that <span class="math inline">\(\lceil1.2\rceil = 2\)</span>.</p>
<p><span class="math display">\[\begin{equation}
  K = \lceil \theta_{max} N \rceil.
\end{equation}\]</span></p>
<p>Let’s consider how to use the hypergeometric likelihood to calculate the minimum sample size needed to reduce the sampling risk to an appropriately low level.</p>
<section id="classical-planning" class="level3" data-number="4.2.1"><h3 data-number="4.2.1" class="anchored" data-anchor-id="classical-planning">
<span class="header-section-number">4.2.1</span> Classical planning</h3>
<p>In classical planning using the hypergeometric likelihood, the following statistical model is specified:</p>
<p><span class="math display">\[\begin{equation}
  k \sim \text{Hypergeometric}(n, N, K)
\end{equation}\]</span></p>
<p>Given the performance materiality <span class="math inline">\(\theta_{max}\)</span>, we can compute <span class="math inline">\(K\)</span> and solve for the minimum sample size <span class="math inline">\(n\)</span> needed to reduce the sampling risk to an appropriately low level. This sample size is also dependent on the number of misstatements that the auditor expects, or tolerates, in the sample.</p>
<section id="no-expected-misstatements" class="level4" data-number="4.2.1.1"><h4 data-number="4.2.1.1" class="anchored" data-anchor-id="no-expected-misstatements">
<span class="header-section-number">4.2.1.1</span> No Expected Misstatements</h4>
<p>If the auditor does not expect any misstatements in the sample, they can set <span class="math inline">\(k = 0\)</span>, which consequently determines how the sample size can be calculated. For example, if we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span> in a population of <span class="math inline">\(N = 1000\)</span> items, then <span class="math inline">\(K = \lceil 0.03 \cdot 1000 \rceil = 30\)</span> and the minimum sample size under the assumption of no expected misstatements in the sample is <span class="math inline">\(n = 94\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">0</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"hypergeometric"</span>, N.units <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">plan</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 94 </span></span>
<span><span class="co">#&gt; sample size obtained in 95 iterations via method 'hypergeometric'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The sample size of 94 can be confirmed by checking that 94 is the minimum integer that results in less than 5 percent probability of finding 0 misstatements, given the assumption that the population misstatement is truly 3 percent. The <code><a href="https://rdrr.io/r/stats/Hypergeometric.html">dhyper()</a></code> function calculates the probability of observing <span class="math inline">\(k\)</span> missatements in a sample of <span class="math inline">\(n\)</span> items given the assumed hypergeometric distribution with <span class="math inline">\(N\)</span> items and <span class="math inline">\(K\)</span> assumed misstatements in the population. By calculating this probability for <span class="math inline">\(n = 93\)</span>, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fl">0.03</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Hypergeometric.html">dhyper</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, m <span class="op">=</span> <span class="va">K</span>, n <span class="op">=</span> <span class="fl">1000</span> <span class="op">-</span> <span class="va">K</span>, k <span class="op">=</span> <span class="fl">93</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, for <span class="math inline">\(n = 94\)</span> the relevant probability is lower than the sampling risk <span class="math inline">\(\alpha\)</span> and thus the sample size is considered to be sufficient.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Hypergeometric.html">dhyper</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, m <span class="op">=</span> <span class="va">K</span>, n <span class="op">=</span> <span class="fl">1000</span> <span class="op">-</span> <span class="va">K</span>, k <span class="op">=</span> <span class="fl">94</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can make this sample size visually intuitive by showing the hypergeometric(<span class="math inline">\(k\)</span> | 94, 1000, 30) distribution and highlighting the probability for <span class="math inline">\(k = 0\)</span>, see <a href="#fig-planning-hyper-nomis">Figure&nbsp;<span>4.2</span></a>. This probability is lower than the required sampling risk <span class="math inline">\(\alpha = 0.05\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-hyper-nomis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-hyper-nomis-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.2: The hypergeometric(<span class="math inline">\(k\)</span> | 94, 1000, 30) distribution showing the probability for <span class="math inline">\(k = 0\)</span> misstatements as a red bar.</figcaption></figure>
</div>
</div>
</div>
<p>The <code>planning()</code> function has two additional arguments that are not shown in the call above: <code>by</code> and <code>max</code>. The argument <code>by</code> sets the increment between possible sample sizes for consideration. For example, <code>by = 5</code> considers only samples of size 10, 20, 30, etc:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">0</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"hypergeometric"</span>, N.units <span class="op">=</span> <span class="fl">1000</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 100 </span></span>
<span><span class="co">#&gt; sample size obtained in 11 iterations via method 'hypergeometric'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The argument <code>max</code> sets the sample size at which the algorithm terminates. This can be used to avoid too many iterations of the algorithm at very low values of the performance materiality. For instance, <code>max = 50</code> throws an error if more than 100 samples are required.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">0</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"hypergeometric"</span>, N.units <span class="op">=</span> <span class="fl">1000</span>, max <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in planning(materiality = 0.03, expected = 0, conf.level = 0.95, : the sample size is larger than 'max'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="expected-misstatements" class="level4" data-number="4.2.1.2"><h4 data-number="4.2.1.2" class="anchored" data-anchor-id="expected-misstatements">
<span class="header-section-number">4.2.1.2</span> Expected Misstatements</h4>
<p>If the auditor expects misstatements in the sample, they can set <span class="math inline">\(k\)</span> to any integer value, which consequently determines how the sample size can be calculated. As another example, if we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span> in a population of <span class="math inline">\(N = 1000\)</span> items, then the required sample size under the assumption of one expected misstatement in the sample is <span class="math inline">\(n = 147\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">1</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"hypergeometric"</span>, N.units <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">plan</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 147 </span></span>
<span><span class="co">#&gt; sample size obtained in 146 iterations via method 'hypergeometric'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once again, the sample size of 147 can be confirmed by checking that 147 is the minimum integer that results in less than 5 percent probability of finding 0 or 1 misstatements, given the assumption that that the population misstatement is truly 3 percent. By calculating this probability for <span class="math inline">\(n = 146\)</span>, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Hypergeometric.html">dhyper</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, m <span class="op">=</span> <span class="va">K</span>, n <span class="op">=</span> <span class="fl">1000</span> <span class="op">-</span> <span class="va">K</span>, k <span class="op">=</span> <span class="fl">146</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, for <span class="math inline">\(n = 147\)</span> the relevant probability is lower than the sampling risk <span class="math inline">\(\alpha\)</span> and thus the sample size is considered to be sufficient.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Hypergeometric.html">dhyper</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, m <span class="op">=</span> <span class="va">K</span>, n <span class="op">=</span> <span class="fl">1000</span> <span class="op">-</span> <span class="va">K</span>, k <span class="op">=</span> <span class="fl">147</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Like before, we can make this sample size visually intuitive by showing the hypergeometric(<span class="math inline">\(k\)</span> | 147, 1000, 30) distribution and highlighting the probabilities for <span class="math inline">\(k = 0\)</span> and <span class="math inline">\(k = 1\)</span>, see <a href="#fig-planning-hyper-mis">Figure&nbsp;<span>4.3</span></a>. The sum of these probabilities is lower than the required sampling risk <span class="math inline">\(\alpha = 0.05\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-hyper-mis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-hyper-mis-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.3: The hypergeometric(<span class="math inline">\(k\)</span> | 147, 1000, 30) distribution showing the probability for <span class="math inline">\(k = 0\)</span> and <span class="math inline">\(k = 1\)</span> misstatements as a red bar.</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="bayesian-planning" class="level3" data-number="4.2.2"><h3 data-number="4.2.2" class="anchored" data-anchor-id="bayesian-planning">
<span class="header-section-number">4.2.2</span> Bayesian Planning</h3>
<p>Performing Bayesian planning with the hypergeometric likelihood <span class="citation" data-cites="Dyer1993">(<a href="references.html#ref-Dyer1993" role="doc-biblioref">Dyer &amp; Pierce, 1993</a>)</span> requires that you specify a prior distribution for the total misstatements <span class="math inline">\(K\)</span>. Practically, this means that you should provide an input for the <code>prior</code> argument in the <code>planning()</code> function.</p>
<p>Setting <code>prior = TRUE</code> performs Bayesian planning using a default prior conjugate to the specified <code>likelihood</code> (i.e., a beta-binomial prior). Because this is a Bayesian analysis, the following statistical model is specified:</p>
<p><span class="math display">\[\begin{align}
  k &amp;\sim \text{Hypergeometric}(n, N, K) \\
  K &amp;\sim \text{Beta-binomial}(N, \alpha, \beta)
\end{align}\]</span></p>
<p>The beta-binomial prior distribution is the conjugate prior for to the hypergeometric likelihood (see this <a href="https://en.wikipedia.org/wiki/Conjugate_prior#Table_of_conjugate_distributions">list</a> of conjugate priors), which means that the posterior distribution of <span class="math inline">\(K\)</span> can be determined analytically. For example, if the prior distribution for <span class="math inline">\(K\)</span> is:</p>
<p><span class="math display">\[\begin{equation}
  K \sim \text{Beta-binomial}(N, \alpha, \beta) \,\,\,\,\,\,\,\,\,\, K = 0, \ldots, N
\end{equation}\]</span></p>
<p>and the auditor has observed a sample of <span class="math inline">\(n\)</span> items containing <span class="math inline">\(k\)</span> misstatements, then the posterior distribution for <span class="math inline">\(K\)</span> is:</p>
<p><span class="math display">\[\begin{equation}
  K \sim \text{Beta-binomial}(N - n, \alpha + k, \beta + k - n) \,\,\,\,\,\,\,\,\,\, K = k, k + 1, \ldots, N - n + k.
\end{equation}\]</span></p>
<section id="no-expected-misstatements-1" class="level4" data-number="4.2.2.1"><h4 data-number="4.2.2.1" class="anchored" data-anchor-id="no-expected-misstatements-1">
<span class="header-section-number">4.2.2.1</span> No Expected Misstatements</h4>
<p>Planning for no expected misstatements in the sample can be done by setting the value for the <code>expected</code> argument to zero. If we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.1\)</span> in a population of <span class="math inline">\(N = 20\)</span> items, then the required sample size under the assumption of zero expected misstatements in the sample is <span class="math inline">\(n = 15\)</span>. The command below uses a default beta-binomial(<span class="math inline">\(N\)</span>, 1, 1) prior distribution to plan this sample, since <code>planning()</code> is given the hypergeometric likelihood.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.1</span>, expected <span class="op">=</span> <span class="fl">0</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"hypergeometric"</span>, N.units <span class="op">=</span> <span class="fl">20</span>, prior <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function can be used to obatain relevant information about the planning.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Bayesian Audit Sample Planning Summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Options:</span></span>
<span><span class="co">#&gt;   Confidence level:              0.95 </span></span>
<span><span class="co">#&gt;   Population size:               20 </span></span>
<span><span class="co">#&gt;   Materiality:                   0.1 </span></span>
<span><span class="co">#&gt;   Hypotheses:                    H₀: Θ &gt; 0.1 vs. H₁: Θ &lt; 0.1 </span></span>
<span><span class="co">#&gt;   Expected:                      0 </span></span>
<span><span class="co">#&gt;   Likelihood:                    hypergeometric </span></span>
<span><span class="co">#&gt;   Prior distribution:            beta-binomial(N = 20, α = 1, β = 1) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt;   Minimum sample size:           15 </span></span>
<span><span class="co">#&gt;   Tolerable errors:              0 </span></span>
<span><span class="co">#&gt;   Posterior distribution:        beta-binomial(N = 5, α = 1, β = 16) </span></span>
<span><span class="co">#&gt;   Expected most likely error:    0 </span></span>
<span><span class="co">#&gt;   Expected upper bound:          0.05 </span></span>
<span><span class="co">#&gt;   Expected precision:            0.05 </span></span>
<span><span class="co">#&gt;   Expected BF₁₀:                 190</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can inspect how the prior distribution compares to the expected posterior distribution by using the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function, see <a href="#fig-planning-bbinom-nomis">Figure&nbsp;<span>4.4</span></a>. The expected posterior distribution is the posterior distribution that would occur if you actually observed the planned sample containing the expected misstatements. Note that the posterior distribution is only defined in the range [<span class="math inline">\(k\)</span>; <span class="math inline">\(N - n + k\)</span>], since a part of the population has already been seen.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-bbinom-nomis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-bbinom-nomis-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.4: The beta-binomial prior and posterior distribution on the range [<span class="math inline">\(k\)</span>; <span class="math inline">\(N - n + k\)</span>] after seeing no misstatements in the sample.</figcaption></figure>
</div>
</div>
</div>
</section><section id="expected-misstatements-1" class="level4" data-number="4.2.2.2"><h4 data-number="4.2.2.2" class="anchored" data-anchor-id="expected-misstatements-1">
<span class="header-section-number">4.2.2.2</span> Expected Misstatements</h4>
<p>Planning for expected misstatements in the sample can be done by setting the value for the <code>expected</code> argument to a different value than zero. For example, the code below calculates the minimum sample size to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.1\)</span> in a population of <span class="math inline">\(N = 50\)</span> items, given one expected misstatement in the sample. This sample size is <span class="math inline">\(n = 32\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.1</span>, expected <span class="op">=</span> <span class="fl">1</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"hypergeometric"</span>, N.units <span class="op">=</span> <span class="fl">50</span>, prior <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">plan</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 32 </span></span>
<span><span class="co">#&gt; sample size obtained in 31 iterations via method 'hypergeometric' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Like before, you can inspect how the prior distribution compares to the expected posterior distribution by using the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function, see <a href="#fig-planning-bbinom-mis">Figure&nbsp;<span>4.5</span></a> below for the output of this call.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-bbinom-mis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-bbinom-mis-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.5: The beta-binomial prior and posterior distribution on the range [<span class="math inline">\(k\)</span>; <span class="math inline">\(N - n + k\)</span>] after seeing one misstatement in the sample.</figcaption></figure>
</div>
</div>
</div>
</section></section></section><section id="the-binomial-likelihood" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="the-binomial-likelihood">
<span class="header-section-number">4.3</span> The Binomial Likelihood</h2>
<p>The binomial distribution is a discrete probability distribution that is commonly used to model the number of events occurring in a fixed number of trials. It is similar to the hypergeometric distribution, however, it assumes that samples are drawn from the population with replacement. For our purpose, we can use the binomial distribution as a likelihood to model the number of misstatements that are expected to be found in the sample.</p>
<p>In audit sampling, the binomial likelihood is often used to approximate the hypergeometric likelihood since it is easier to work with (i.e., it only has two parameters: <span class="math inline">\(\theta\)</span> and <span class="math inline">\(n\)</span>, while the hypergeometric has three: <span class="math inline">\(n\)</span>, <span class="math inline">\(N\)</span>, and <span class="math inline">\(K\)</span>). However, the binomial likelihood is more conservative than the hypergeometric likelihood, meaning that resulting sample sizes will be higher.</p>
<p>The probability mass function (PMF) of the binomial distribution is given by:</p>
<p><span class="math display">\[\begin{equation}
  p(k; n, \theta) = \binom{n}{k} \theta^{k} (1-\theta)^{n - k},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(k\)</span> is the number of misstatements in the sample, <span class="math inline">\(n\)</span> is the sample size and <span class="math inline">\(\theta\)</span> is the probability of misstatement in the population. Let’s consider how to use the binomial likelihood to calculate the minimum sample size needed to reduce the sampling risk to an appropriately low level.</p>
<section id="classical-planning-1" class="level3" data-number="4.3.1"><h3 data-number="4.3.1" class="anchored" data-anchor-id="classical-planning-1">
<span class="header-section-number">4.3.1</span> Classical Planning</h3>
<p>In classical planning using the binomial likelihood, the following statistical model is specified:</p>
<p><span class="math display">\[\begin{equation}
  k \sim \text{Binomial}(n, \theta_{max})
\end{equation}\]</span></p>
<section id="no-expected-misstatements-2" class="level4" data-number="4.3.1.1"><h4 data-number="4.3.1.1" class="anchored" data-anchor-id="no-expected-misstatements-2">
<span class="header-section-number">4.3.1.1</span> No Expected Misstatements</h4>
<p>If the auditor does not expect any misstatements in the sample, they can set <span class="math inline">\(k = 0\)</span>, which consequently determines how the sample size can be calculated. Given a performance materiality <span class="math inline">\(\theta_{max}\)</span>, we can solve for the minimum sample size <span class="math inline">\(n\)</span> needed to reduce the sampling risk to an appropriately low level. A useful trick to utilize is that, if we do not expect any misstatements in the sample, the formula for the minimum required sample size reduces to:</p>
<p><span class="math display">\[\begin{equation}
  n = \lceil\frac{\ln(\alpha)}{\ln(1 - \theta_{max})}\rceil.
\end{equation}\]</span></p>
<p>For example, if we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha=0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span>, then the required sample size under the assumption of zero expected misstatements in the sample is <span class="math inline">\(n = 99\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">0.03</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 99</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In <strong>jfa</strong>, this sample size can be replicated using the following code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">0</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="va">plan</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 99 </span></span>
<span><span class="co">#&gt; sample size obtained in 100 iterations via method 'binomial'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The sample size of 99 can be confirmed by checking that 99 is the minimum integer that results in less than 5 percent probability of finding 0 misstatements, given the assumption that the population misstatement is truly 3 percent. The <code><a href="https://rdrr.io/r/stats/Binomial.html">dbinom()</a></code> function calculates the probability of observing <span class="math inline">\(k\)</span> missatements in a sample of <span class="math inline">\(n\)</span> items given an assumed misstatement probability <span class="math inline">\(\theta_{max}\)</span>. By calculating this probability for <span class="math inline">\(n = 98\)</span>, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">dbinom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">98</span>, prob <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, for <span class="math inline">\(n = 99\)</span> the relevant probability is lower than the sampling risk <span class="math inline">\(\alpha\)</span> and thus the sample size is considered to be sufficient.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">dbinom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">99</span>, prob <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can make this sample size visually intuitive by showing the binomial(<span class="math inline">\(k\)</span> | 99, 0.03) distribution and highlighting the probability for <span class="math inline">\(k = 0\)</span>, see <a href="#fig-planning-binom-nomis">Figure&nbsp;<span>4.6</span></a>. This probability is lower than the required sampling risk <span class="math inline">\(\alpha = 0.05\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-binom-nomis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-binom-nomis-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.6: The binomial(<span class="math inline">\(k\)</span> | 99, 0.03) distribution showing the probability for <span class="math inline">\(k = 0\)</span> misstatement as a red bar.</figcaption></figure>
</div>
</div>
</div>
</section><section id="expected-misstatementss" class="level4" data-number="4.3.1.2"><h4 data-number="4.3.1.2" class="anchored" data-anchor-id="expected-misstatementss">
<span class="header-section-number">4.3.1.2</span> Expected Misstatementss</h4>
<p>However, if the number of expected misstatements in the sample is non-zero, it becomes more difficult to solve the formula for <span class="math inline">\(n\)</span>. Hence, they will need to set <span class="math inline">\(k\)</span> to a different integer value, which consequently determines how the sample size is calculated. Here, we can iteratively try every value of <span class="math inline">\(n\)</span> and return the smallest integer that satisfies the sampling objectives.</p>
<p>In <strong>jfa</strong>, this can be done by adjusting the <code>expected</code> argument in the <code>planning()</code> function. For example, if we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span>, then the required sample size under the assumption of one expected misstatement in the sample is <span class="math inline">\(n = 157\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">1</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once again, the sample size of 157 can be confirmed by checking that 157 is the minimum integer that results in less than 5 percent probability of finding 0 or 1 misstatements, given the assumption that the population misstatement is truly 3 percent. By calculating this probability for <span class="math inline">\(n = 156\)</span>, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">dbinom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">156</span>, prob <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, for <span class="math inline">\(n = 157\)</span> the relevant probability is lower than the sampling risk <span class="math inline">\(\alpha\)</span> and thus the sample size is considered to be sufficient.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">dbinom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">157</span>, prob <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Like before, we can make this sample size visually intuitive by showing the binomial(<span class="math inline">\(k\)</span> | 157, 0.03) distribution and highlighting the probabilities for <span class="math inline">\(k = 0\)</span> and <span class="math inline">\(k = 1\)</span>, see <a href="#fig-planning-binom-mis">Figure&nbsp;<span>4.7</span></a>. The sum of these probabilities is lower than the required sampling risk <span class="math inline">\(\alpha = 0.05\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-binom-mis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-binom-mis-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.7: The binomial(<span class="math inline">\(k\)</span> | 157, 0.03) distribution showing the probability for <span class="math inline">\(k = 0\)</span> and <span class="math inline">\(k=1\)</span> misstatements as a red bar.</figcaption></figure>
</div>
</div>
</div>
</section><section id="expected-misstatement-rate" class="level4" data-number="4.3.1.3"><h4 data-number="4.3.1.3" class="anchored" data-anchor-id="expected-misstatement-rate">
<span class="header-section-number">4.3.1.3</span> Expected Misstatement Rate</h4>
<p>When the expected misstatement rate in the sample <span class="math inline">\(\theta_{exp}\)</span> is assessed, the value for <span class="math inline">\(k\)</span> can be determined as <span class="math inline">\(k = n\theta_{exp}\)</span>, which consequently determines how the sample size can be calculated.</p>
<p>To account for the fact that <span class="math inline">\(k\)</span> can have non-integer values in this case, we can use a well-known similarity between the binomial distribution and the beta distribution to plan the sample size. The upper bound for any binomial(<span class="math inline">\(k\)</span>; <span class="math inline">\(n\)</span>, <span class="math inline">\(\theta\)</span>) distributed variable can also be obtained via percentiles of the beta(<span class="math inline">\(1 + k\)</span>, <span class="math inline">\(n - k\)</span>) distribution.</p>
<p>For example, the upper bound for a sample of <span class="math inline">\(n = 10\)</span> items containing <span class="math inline">\(k = 2\)</span> misstatements, when calculated via the traditional <code><a href="https://rdrr.io/r/stats/binom.test.html">binom.test()</a></code> is:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ub_binom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html">binom.test</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2</span>, n <span class="op">=</span> <span class="fl">10</span>, p <span class="op">=</span> <span class="fl">0.03</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, alternative <span class="op">=</span> <span class="st">"less"</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">ub_binom</span></span>
<span><span class="co">#&gt; [1] 0.5069013</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When calculated via the beta relationship, the upper bound is:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ub_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">qbeta</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.95</span>, shape1 <span class="op">=</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">2</span>, shape2 <span class="op">=</span> <span class="fl">10</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">ub_beta</span></span>
<span><span class="co">#&gt; [1] 0.5069013</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It can be validated that the two approaches result in the same upper bound via:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ub_binom</span> <span class="op">==</span> <span class="va">ub_beta</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This relationship between the binomial likelihood and the beta distribution is deliberately <strong>not</strong> used in <strong>jfa</strong>. That is because, in the case of the binomial distribution, the auditing standards round the tolerable misstatements upwards to a whole number. For example, if we try to call the <code>planning()</code> function with the argument <code>expected = 1.5</code>, <strong>jfa</strong> will internally convert this to <code>expected = 2</code> and base the sample size on this in order to stay compliant with <span class="citation" data-cites="AICPA-A">American Institute of Certified Public Accountants (AICPA) (<a href="references.html#ref-AICPA-A" role="doc-biblioref">2016</a>)</span>. The resulting sample size is <span class="math inline">\(n = 208\)</span> in this case.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">1.5</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using 'expected = 2' since 'expected' must be a single integer &gt;= 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 208 </span></span>
<span><span class="co">#&gt; sample size obtained in 206 iterations via method 'binomial'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="bayesian-planning-1" class="level3" data-number="4.3.2"><h3 data-number="4.3.2" class="anchored" data-anchor-id="bayesian-planning-1">
<span class="header-section-number">4.3.2</span> Bayesian Planning</h3>
<p>Performing Bayesian planning using the binomial likelihood requires that you specify a prior distribution for the parameter <span class="math inline">\(\theta\)</span>. Practically, this means that you should provide an input for the <code>prior</code> argument in the <code>planning()</code> function.</p>
<p>Setting <code>prior = TRUE</code> performs Bayesian planning using a default prior conjugate to the specified <code>likelihood</code> (i.e., a beta prior). Because this is a Bayesian analysis, the following statistical model is specified:</p>
<p><span class="math display">\[\begin{align}
  k &amp;\sim \text{Binomial}(n, \theta) \\
  \theta &amp;\sim \text{Beta}(\alpha, \beta)
\end{align}\]</span></p>
<p>The beta prior distribution is the conjugate prior for the binomial likelihood (see this <a href="https://en.wikipedia.org/wiki/Conjugate_prior#Table_of_conjugate_distributions">list</a> of conjugate priors), which means that the posterior distribution of <span class="math inline">\(\theta\)</span> can be determined analytically. For example, if the prior distribution for <span class="math inline">\(\theta\)</span> is:</p>
<p><span class="math display">\[\begin{equation}
  \theta \sim \text{Beta}(\alpha, \beta) \,\,\,\,\,\,\,\,\,\, \theta \in [0, 1]
\end{equation}\]</span></p>
<p>and the auditor has observed a sample of <span class="math inline">\(n\)</span> items containing <span class="math inline">\(k\)</span> misstatements, then the posterior distribution for <span class="math inline">\(\theta\)</span> is:</p>
<p><span class="math display">\[\begin{equation}
  \theta \sim \text{Beta}(\alpha + k, \beta + n - k) \,\,\,\,\,\,\,\,\,\, \theta \in [0, 1].
\end{equation}\]</span></p>
<p>For example, the command below uses a default beta(<span class="math inline">\(\alpha=1\)</span>, <span class="math inline">\(\beta=1\)</span>) prior distribution to plan the sample, since <code>planning()</code> is given the binomial likelihood. If we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha=0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span>, then the required sample size under the assumption of zero expected misstatements in the sample is <span class="math inline">\(n = 98\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">0</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, prior <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function can be used to obatain relevant information about the planning.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Bayesian Audit Sample Planning Summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Options:</span></span>
<span><span class="co">#&gt;   Confidence level:              0.95 </span></span>
<span><span class="co">#&gt;   Materiality:                   0.03 </span></span>
<span><span class="co">#&gt;   Hypotheses:                    H₀: Θ &gt; 0.03 vs. H₁: Θ &lt; 0.03 </span></span>
<span><span class="co">#&gt;   Expected:                      0 </span></span>
<span><span class="co">#&gt;   Likelihood:                    binomial </span></span>
<span><span class="co">#&gt;   Prior distribution:            beta(α = 1, β = 1) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt;   Minimum sample size:           98 </span></span>
<span><span class="co">#&gt;   Tolerable errors:              0 </span></span>
<span><span class="co">#&gt;   Posterior distribution:        beta(α = 1, β = 99) </span></span>
<span><span class="co">#&gt;   Expected most likely error:    0 </span></span>
<span><span class="co">#&gt;   Expected upper bound:          0.029807 </span></span>
<span><span class="co">#&gt;   Expected precision:            0.029807 </span></span>
<span><span class="co">#&gt;   Expected BF₁₀:                 627.22</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can inspect how the prior distribution compares to the expected posterior distribution by using the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function, see <a href="#fig-planning-beta-nomis">Figure&nbsp;<span>4.8</span></a>. The expected posterior distribution is the posterior distribution that would occur if you actually observed the planned sample containing the expected misstatements.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-beta-nomis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-beta-nomis-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.8: The beta prior and posterior distribution on the range [0; 1] after seeing no misstatements in the sample of 98 units.</figcaption></figure>
</div>
</div>
</div>
<p>The input for the <code>prior</code> argument can also be an object created by the <code>auditPrior</code> function. If <code>planning()</code> receives a prior for which there is no conjugate likelihood available, it will numerically derive the posterior distribution. For example, the command below uses a Normal(0, 0.05) prior distribution to plan the sample using the binomial likelihood. Because this is a Bayesian analysis, the following statistical model is specified:</p>
<p><span class="math display">\[\begin{align}
  k &amp;\sim \text{Binomial}(n, \theta) \\
  \theta &amp;\sim \text{Normal}(\mu = 0, \sigma = 0.05)
\end{align}\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"param"</span>, likelihood <span class="op">=</span> <span class="st">"normal"</span>, alpha <span class="op">=</span> <span class="fl">0</span>, beta <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">0</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"poisson"</span>, prior <span class="op">=</span> <span class="va">prior</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function can be used to obatain relevant information about the planning.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Bayesian Audit Sample Planning Summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Options:</span></span>
<span><span class="co">#&gt;   Confidence level:              0.95 </span></span>
<span><span class="co">#&gt;   Materiality:                   0.03 </span></span>
<span><span class="co">#&gt;   Hypotheses:                    H₀: Θ &gt; 0.03 vs. H₁: Θ &lt; 0.03 </span></span>
<span><span class="co">#&gt;   Expected:                      0 </span></span>
<span><span class="co">#&gt;   Likelihood:                    poisson </span></span>
<span><span class="co">#&gt;   Prior distribution:            normal(μ = 0, σ = 0.05)T[0,1] </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt;   Minimum sample size:           91 </span></span>
<span><span class="co">#&gt;   Tolerable errors:              0 </span></span>
<span><span class="co">#&gt;   Posterior distribution:        Nonparametric </span></span>
<span><span class="co">#&gt;   Expected most likely error:    0 </span></span>
<span><span class="co">#&gt;   Expected upper bound:          0.029 </span></span>
<span><span class="co">#&gt;   Expected precision:            0.029 </span></span>
<span><span class="co">#&gt;   Expected BF₁₀:                 26.749</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting sample size under this prior is <span class="math inline">\(n = 90\)</span>, a reduction of 8 samples when compared to the default beta(1, 1) prior distribution. <a href="#fig-planning-beta-nomis2">Figure&nbsp;<span>4.9</span></a> shows this prior and posterior distribution.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-beta-nomis2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-beta-nomis2-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.9: The beta prior distributions in this example contains risk-reducing information. The posterior distribution has roughly the same upper bound as the one in the previous exxample and occurs after seeing no misstatements in the sample of 90 units.</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="the-poisson-likelihood" class="level2" data-number="4.4"><h2 data-number="4.4" class="anchored" data-anchor-id="the-poisson-likelihood">
<span class="header-section-number">4.4</span> The Poisson Likelihood</h2>
<p>The Poisson distribution is a discrete probability distribution that is commonly used to model the number of events occurring in a fixed time or space. We can use the Poisson distribution as a likelihood to model the number of misstatements that are expected to be found in the sample.</p>
<p>In audit sampling, the Poisson likelihood is often used to approximate the binomial likelihood since it is easier to work with (i.e., it only has one parameter: <span class="math inline">\(\lambda\)</span>, while the binomial has two parameters: <span class="math inline">\(\theta\)</span> and <span class="math inline">\(n\)</span>). However, the Poisson likelihood is more conservative than the binomial likelihood, meaning that resulting sample sizes will be higher.</p>
<p>The probability mass function (PMF) of the Poisson distribution is given by:</p>
<p><span class="math display">\[\begin{equation}
  p(k; \lambda) = \frac{\lambda^k e^{-\lambda}}{k!},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(k\)</span> is the number of misstatements in the sample, and <span class="math inline">\(\lambda\)</span> is the average number of misstatements expected in the sample. The average number of misstatements is related to the misstatement rate in the population, denoted by <span class="math inline">\(\theta\)</span>, and the sample size, <span class="math inline">\(n\)</span>, by the following equation:</p>
<p><span class="math display">\[\begin{equation}
  \lambda = n \theta.
\end{equation}\]</span></p>
<p>Let’s consider how to use the Poisson likelihood to calculate the minimum sample size needed to reduce the sampling risk to an appropriately low level.</p>
<section id="classical-planning-2" class="level3" data-number="4.4.1"><h3 data-number="4.4.1" class="anchored" data-anchor-id="classical-planning-2">
<span class="header-section-number">4.4.1</span> Classical planning</h3>
<p>In classical planning using the Poisson likelihood, the following statistical model is specified:</p>
<p><span class="math display">\[\begin{equation}
  k \sim \text{Poisson}(n \theta_{max})
\end{equation}\]</span></p>
<section id="no-expected-misstatements-3" class="level4" data-number="4.4.1.1"><h4 data-number="4.4.1.1" class="anchored" data-anchor-id="no-expected-misstatements-3">
<span class="header-section-number">4.4.1.1</span> No Expected Misstatements</h4>
<p>Given the performance materiality <span class="math inline">\(\theta_{max}\)</span> and the Poisson likelihood, we can solve for the minimum sample size <span class="math inline">\(n\)</span> needed to reduce the sampling risk to an appropriately low level. A useful trick to utilize is that, if we do not expect any misstatements in the sample, the formula for the required sample size reduces to:</p>
<p><span class="math display">\[\begin{equation}
  n = \lceil-\frac{\ln(\alpha)}{\theta_{max}}\rceil.
\end{equation}\]</span></p>
<p>For example, if we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span>, then the required sample size under the assumption of zero expected misstatements in the sample is <span class="math inline">\(n = 100\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">/</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In <strong>jfa</strong>, this sample size can be replicated using the following code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">0</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The sample size of 100 can be confirmed by checking that 100 is the minimum integer that results in less than 5 percent probability of finding 0 misstatements, given the assumption that the population misstatement is truly 3 percent. The <code><a href="https://rdrr.io/r/stats/Poisson.html">dpois()</a></code> function calculates the probability of observing <span class="math inline">\(k\)</span> missatements in a sample of <span class="math inline">\(n\)</span> items given an assumed misstatement probability <span class="math inline">\(\theta_{max}\)</span>. By calculating this probability for <span class="math inline">\(n = 99\)</span>, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">dpois</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, lambda <span class="op">=</span> <span class="fl">99</span> <span class="op">*</span> <span class="fl">0.03</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, for <span class="math inline">\(n = 100\)</span> the relevant probability is lower than the sampling risk <span class="math inline">\(\alpha\)</span> and thus the sample size is considered to be sufficient.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">dpois</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, lambda <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="fl">0.03</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can make this visually intuitive by showing the Poisson(<span class="math inline">\(k\)</span> | 100 <span class="math inline">\(\times\)</span> 0.03) distribution and highlighting the probability for <span class="math inline">\(k = 0\)</span>, see <a href="#fig-planning-pois-nomis">Figure&nbsp;<span>4.10</span></a>. This probability is lower than the required sampling risk <span class="math inline">\(\alpha = 0.05\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-pois-nomis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-pois-nomis-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.10: The Poisson(<span class="math inline">\(k\)</span> | 100 $ imes$ 0.03) distribution showing the probability for <span class="math inline">\(k = 0\)</span> misstatement as a red bar.</figcaption></figure>
</div>
</div>
</div>
</section><section id="expected-misstatements-2" class="level4" data-number="4.4.1.2"><h4 data-number="4.4.1.2" class="anchored" data-anchor-id="expected-misstatements-2">
<span class="header-section-number">4.4.1.2</span> Expected Misstatements</h4>
<p>However, if the number of expected misstatements in the sample is non-zero, it becomes more difficult to solve the formula for <span class="math inline">\(n\)</span> algebraically. Hence, they will need to set <span class="math inline">\(k\)</span> to a different integer value. Next, we can iteratively try every value of <span class="math inline">\(n\)</span> and return the smallest integer that satisfies the sampling objectives.</p>
<p>For example, if we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span>, then the required sample size under the assumption of one expected misstatement in the sample is <span class="math inline">\(n = 159\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">1</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once again, the sample size of 159 can be confirmed by checking that 159 is the minimum integer that results in less than 5 percent probability of finding 0 or 1 misstatements, given the assumption that the population misstatement is truly 3 percent. By calculating this probability for <span class="math inline">\(n = 158\)</span>, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">dpois</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, lambda <span class="op">=</span> <span class="fl">158</span> <span class="op">*</span> <span class="fl">0.03</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, for <span class="math inline">\(n = 159\)</span> the relevant probability is lower than the sampling risk <span class="math inline">\(\alpha\)</span> and thus the sample size is considered to be sufficient.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">dpois</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, lambda <span class="op">=</span> <span class="fl">159</span> <span class="op">*</span> <span class="fl">0.03</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Like before, we can make this visually intuitive by showing the Poisson(<span class="math inline">\(k\)</span> | 159 <span class="math inline">\(\times\)</span> 0.03) distribution and highlighting the probabilities for <span class="math inline">\(k = 0\)</span> and <span class="math inline">\(k = 1\)</span>, see <a href="#fig-planning-pois-mis">Figure&nbsp;<span>4.11</span></a>. The sum of these probabilities is lower than the required sampling risk <span class="math inline">\(\alpha = 0.05\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-pois-mis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-pois-mis-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.11: The Poisson(<span class="math inline">\(k\)</span> | 159 $ imes$ 0.03) distribution showing the probability for <span class="math inline">\(k = 0\)</span> and <span class="math inline">\(k=1\)</span> misstatements as a red bar.</figcaption></figure>
</div>
</div>
</div>
</section><section id="expected-misstatement-rate-1" class="level4" data-number="4.4.1.3"><h4 data-number="4.4.1.3" class="anchored" data-anchor-id="expected-misstatement-rate-1">
<span class="header-section-number">4.4.1.3</span> Expected Misstatement Rate</h4>
<p>When the expected misstatements in the sample <span class="math inline">\(\theta_{exp}\)</span> is assessed, the value for <span class="math inline">\(k\)</span> can be determined as <span class="math inline">\(k = n\theta_{exp}\)</span>, which consequently determines how the sample size can be calculated.</p>
<p>To account for the fact that <span class="math inline">\(k\)</span> can have non-integer values in this case, we use a well-known similarity between the Poisson distribution and the gamma distribution to plan the sample size. The upper bound for any Poisson(<span class="math inline">\(k\)</span>; <span class="math inline">\(n \theta\)</span>) distributed variable can also be obtained via percentiles of the gamma(<span class="math inline">\(1 + k\)</span>, <span class="math inline">\(n\)</span>) distribution.</p>
<p>For example, the upper bound for a sample of <span class="math inline">\(n = 10\)</span> items containing <span class="math inline">\(k = 2\)</span> misstatements, when calculated via the traditional <code><a href="https://rdrr.io/r/stats/poisson.test.html">poisson.test()</a></code> is:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ub_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/poisson.test.html">poisson.test</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2</span>, T <span class="op">=</span> <span class="fl">10</span>, r <span class="op">=</span> <span class="fl">0.03</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, alternative <span class="op">=</span> <span class="st">"less"</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">ub_pois</span></span>
<span><span class="co">#&gt; [1] 0.6295794</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When calculated via the relationship with the gamma distribution, the upper bound is:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ub_gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">qgamma</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.95</span>, shape <span class="op">=</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">ub_gamma</span></span>
<span><span class="co">#&gt; [1] 0.6295794</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It can be validated that the two approaches result in the same upper bound via:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ub_pois</span> <span class="op">==</span> <span class="va">ub_gamma</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This relationship between the Poisson likelihood and the gamma distribution is used under the hood in <strong>jfa</strong>. For example, if we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span>, then the required sample size under the assumption of 1.5 expected misstatements in the sample is <span class="math inline">\(n = 185\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">1.5</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 185 </span></span>
<span><span class="co">#&gt; sample size obtained in 184 iterations via method 'poisson'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The sample size of 185 can be confirmed by checking that 185 is the minimum integer that results in less than 5 percent probability of finding a misstatement rate in the population equal to, or higher than, 3 percent. By calculating this probability for <span class="math inline">\(n = 184\)</span>, we can show that this sample size is insufficient as the relevant upper bound is higher than the performance materiality <span class="math inline">\(\theta_{max}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">qgamma</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.95</span>, shape <span class="op">=</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">1.5</span>, rate <span class="op">=</span> <span class="fl">184</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.03</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, for <span class="math inline">\(n = 185\)</span> the relevant upper bound is lower than the performance materiality <span class="math inline">\(\theta_{max}\)</span> and thus the sample size is sufficient.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">qgamma</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.95</span>, shape <span class="op">=</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">1.5</span>, rate <span class="op">=</span> <span class="fl">185</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.03</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="bayesian-planning-2" class="level3" data-number="4.4.2"><h3 data-number="4.4.2" class="anchored" data-anchor-id="bayesian-planning-2">
<span class="header-section-number">4.4.2</span> Bayesian Planning</h3>
<p>Performing Bayesian planning with the Poisson likelihood requires that you specify a prior distribution for the parameter <span class="math inline">\(\theta\)</span>. Practically, this means that you should provide an input for the <code>prior</code> argument in the <code>planning()</code> function.</p>
<p>Setting <code>prior = TRUE</code> performs Bayesian planning using a default prior conjugate to the specified <code>likelihood</code> (i.e., a gamma prior). Because this is a Bayesian analysis, the following statistical model is specified:</p>
<p><span class="math display">\[\begin{align}
  k &amp;\sim \text{Poisson}(n\theta) \\
  \theta &amp;\sim \text{Gamma}(\alpha, \beta)
\end{align}\]</span></p>
<p>The gamma prior distribution is the conjugate prior for the Poisson likelihood (see this <a href="https://en.wikipedia.org/wiki/Conjugate_prior#Table_of_conjugate_distributions">list</a> of conjugate priors), which means that the posterior distribution of <span class="math inline">\(\theta\)</span> can be determined analytically. For example, if the prior distribution for <span class="math inline">\(\theta\)</span> is:</p>
<p><span class="math display">\[\begin{equation}
  \theta \sim \text{Gamma}(\alpha, \beta) \,\,\,\,\,\,\,\,\,\, \theta \in [0, \infty]
\end{equation}\]</span></p>
<p>and the auditor has observed a sample of <span class="math inline">\(n\)</span> items containing <span class="math inline">\(k\)</span> misstatements, then the posterior distribution for <span class="math inline">\(\theta\)</span> is:</p>
<p><span class="math display">\[\begin{equation}
  \theta \sim \text{Gamma}(\alpha + k, \beta + n) \,\,\,\,\,\,\,\,\,\, \theta \in [0, \infty].
\end{equation}\]</span></p>
<p>For example, the command below uses a default gamma(<span class="math inline">\(\alpha=1\)</span>, <span class="math inline">\(\beta=1\)</span>) prior distribution to plan the sample, since <code>planning()</code> is given the Poisson likelihood. If we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha=0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span>, then the required sample size under the assumption of zero expected misstatements in the sample is <span class="math inline">\(n = 99\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">0</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"poisson"</span>, prior <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function can be used to obatain relevant information about the planning.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Bayesian Audit Sample Planning Summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Options:</span></span>
<span><span class="co">#&gt;   Confidence level:              0.95 </span></span>
<span><span class="co">#&gt;   Materiality:                   0.03 </span></span>
<span><span class="co">#&gt;   Hypotheses:                    H₀: Θ &gt; 0.03 vs. H₁: Θ &lt; 0.03 </span></span>
<span><span class="co">#&gt;   Expected:                      0 </span></span>
<span><span class="co">#&gt;   Likelihood:                    poisson </span></span>
<span><span class="co">#&gt;   Prior distribution:            gamma(α = 1, β = 1) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt;   Minimum sample size:           99 </span></span>
<span><span class="co">#&gt;   Tolerable errors:              0 </span></span>
<span><span class="co">#&gt;   Posterior distribution:        gamma(α = 1, β = 100) </span></span>
<span><span class="co">#&gt;   Expected most likely error:    0 </span></span>
<span><span class="co">#&gt;   Expected upper bound:          0.029957 </span></span>
<span><span class="co">#&gt;   Expected precision:            0.029957 </span></span>
<span><span class="co">#&gt;   Expected BF₁₀:                 626.69</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can inspect how the prior distribution compares to the expected posterior distribution by using the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function, see <a href="#fig-planning-gamma-nomis">Figure&nbsp;<span>4.12</span></a>. The expected posterior distribution is the posterior distribution that would occur if you actually observed the planned sample containing the expected misstatements.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-gamma-nomis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-gamma-nomis-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.12: The gamma prior and posterior distribution on the range [0; <span class="math inline">\(\infty\)</span>] after seeing no misstatements in the sample of 99 units.</figcaption></figure>
</div>
</div>
</div>
<p>The input for the <code>prior</code> argument can also be an object created by the <code>auditPrior</code> function. If <code>planning()</code> receives a prior for which there is no conjugate likelihood available, it will numerically derive the posterior distribution. For example, the command below uses a Normal(0, 0.05) prior distribution to plan the sample using the Poisson likelihood. Concretely, this means that the following statistical model is specified:</p>
<p><span class="math display">\[\begin{align}
  k &amp;\sim \text{Poisson}(n\theta) \\
  \theta &amp;\sim \text{Normal}(\mu = 0, \sigma = 0.05)
\end{align}\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"param"</span>, likelihood <span class="op">=</span> <span class="st">"normal"</span>, alpha <span class="op">=</span> <span class="fl">0</span>, beta <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">0</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"poisson"</span>, prior <span class="op">=</span> <span class="va">prior</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function can be used to obatain relevant information about the planning.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Bayesian Audit Sample Planning Summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Options:</span></span>
<span><span class="co">#&gt;   Confidence level:              0.95 </span></span>
<span><span class="co">#&gt;   Materiality:                   0.03 </span></span>
<span><span class="co">#&gt;   Hypotheses:                    H₀: Θ &gt; 0.03 vs. H₁: Θ &lt; 0.03 </span></span>
<span><span class="co">#&gt;   Expected:                      0 </span></span>
<span><span class="co">#&gt;   Likelihood:                    poisson </span></span>
<span><span class="co">#&gt;   Prior distribution:            normal(μ = 0, σ = 0.05)T[0,1] </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt;   Minimum sample size:           91 </span></span>
<span><span class="co">#&gt;   Tolerable errors:              0 </span></span>
<span><span class="co">#&gt;   Posterior distribution:        Nonparametric </span></span>
<span><span class="co">#&gt;   Expected most likely error:    0 </span></span>
<span><span class="co">#&gt;   Expected upper bound:          0.029 </span></span>
<span><span class="co">#&gt;   Expected precision:            0.029 </span></span>
<span><span class="co">#&gt;   Expected BF₁₀:                 26.063</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting sample size under this prior is <span class="math inline">\(n = 91\)</span>, a reduction of 8 samples when compared to the default gamma(1, 1) prior. <a href="#fig-planning-gamma-nomis2">Figure&nbsp;<span>4.13</span></a> shows this prior and posterior distribution.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-gamma-nomis2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-gamma-nomis2-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.13: The gamma prior distributions in this example contains risk-reducing information. The posterior distribution has roughly the same upper bound as the one in the previous exxample and occurs after seeing no misstatements in the sample of 91 units.</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="prior-distributions" class="level2" data-number="4.5"><h2 data-number="4.5" class="anchored" data-anchor-id="prior-distributions">
<span class="header-section-number">4.5</span> Prior Distributions</h2>
<p>In principle, any distribution that covers the range of <span class="math inline">\(\theta\)</span> can be used as a prior distribution. However, some distributions are more suitable than others. For instance, the beta-binomial, beta and gamma distributions are all commonly used because they are so-called conjugate distributions, that is, they stay in the same family when updated by the data. The <strong>jfa</strong> package provides the ability to construct a prior distribution for audit sampling. More specifically, the <code>auditPrior()</code> function is used to specify a prior distribution that can be used as input for the <code>prior</code> argument in the <code>planning()</code> (and <code>evaluation()</code>) function. Below is an enumeration of the several ways that a prior distribution can be constructed using the <code>auditPrior</code> function.</p>
<section id="default-prior" class="level3" data-number="4.5.1"><h3 data-number="4.5.1" class="anchored" data-anchor-id="default-prior">
<span class="header-section-number">4.5.1</span> Default Prior</h3>
<p>The default prior distributions are created using <code>method = 'default'</code>. There are no explicit rules for what constitutes a default prior. However, <strong>jfa</strong>’s default priors satisfy two criteria: 1) they contain relatively little information about the population misstatement and 2) they are proper (i.e., they integrate to 1). For completeness, all default priors in <strong>jfa</strong> are provided in the following list.</p>
<ul>
<li>
<code>likelihood = 'poisson'</code>: gamma(<span class="math inline">\(\alpha\)</span> = 1, <span class="math inline">\(\beta\)</span> = 1)</li>
<li>
<code>likelihood = 'binomial'</code>: beta(<span class="math inline">\(\alpha\)</span> = 1, <span class="math inline">\(\beta\)</span> = 1)</li>
<li>
<code>likelihood = 'hypergeometric'</code>: beta-binomial(N, <span class="math inline">\(\alpha\)</span> = 1, <span class="math inline">\(\beta\)</span> = 1)</li>
<li>
<code>likelihood = 'normal'</code>: normal(<span class="math inline">\(\mu\)</span> = 0, <span class="math inline">\(\sigma\)</span> = 1000)</li>
<li>
<code>likelihood = 'uniform'</code>: uniform(min = 0, max = 1)</li>
<li>
<code>likelihood = 'cauchy'</code>: Cauchy(<span class="math inline">\(x_0\)</span> = 0, <span class="math inline">\(\gamma\)</span> = 1000)</li>
<li>
<code>likelihood = 't'</code>: Student-t(df = 1)</li>
<li>
<code>likelihood = 'chisq'</code>: chi-squared(df = 1)</li>
<li>
<code>likelihood = 'exponential'</code>: exponential(<span class="math inline">\(\lambda\)</span> = 1)</li>
</ul>
<p>For instance, to create a default prior distribution using the binomial likelihood (i.e., a beta(1, 1) prior), you can use the following code that creates a prior distribution and stores it in the <code>prior</code> object. You can then use the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function to obtain relevant information about the prior distribution.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"default"</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">prior</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Prior Distribution Summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Options:</span></span>
<span><span class="co">#&gt;   Likelihood:                    binomial </span></span>
<span><span class="co">#&gt;   Specifics:                     default prior </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt;   Functional form:               beta(α = 1, β = 1) </span></span>
<span><span class="co">#&gt;   Mode:                          NaN </span></span>
<span><span class="co">#&gt;   Mean:                          0.5 </span></span>
<span><span class="co">#&gt;   Median:                        0.5 </span></span>
<span><span class="co">#&gt;   Variance:                      0.083333 </span></span>
<span><span class="co">#&gt;   Skewness:                      0 </span></span>
<span><span class="co">#&gt;   Information entropy (nat):     0 </span></span>
<span><span class="co">#&gt;   95 percent upper bound:        0.95 </span></span>
<span><span class="co">#&gt;   Precision:                     NaN</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All prior distributions can be visually inspected via the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function, see <a href="#fig-planning-prior-default">Figure&nbsp;<span>4.14</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">prior</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-prior-default" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-prior-default-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.14: The default beta(1, 1) prior distribution.</figcaption></figure>
</div>
</div>
</div>
<p>Furthermore, the <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function produces the predictions of the prior distribution on the data level for a sample of <code>n</code> items. For example, the command below requests the prediction of the default beta(1, 1) prior for a hypothetical sample of 6 items.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">prior</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="co">#&gt;       x=0       x=1       x=2       x=3       x=4       x=5       x=6 </span></span>
<span><span class="co">#&gt; 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The predictions of the prior distribution can be visualized using the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function, see <a href="#fig-planning-prior-predict">Figure&nbsp;<span>4.15</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">prior</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-prior-predict" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-prior-predict-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.15: The predictions of the beta(1, 1) prior distribution concerming the possible misstatements in an an intended sample of <span class="math inline">\(n=6\)</span>.</figcaption></figure>
</div>
</div>
</div>
</section><section id="parametric-prior" class="level3" data-number="4.5.2"><h3 data-number="4.5.2" class="anchored" data-anchor-id="parametric-prior">
<span class="header-section-number">4.5.2</span> Parametric Prior</h3>
<p>You can manually specify the parameters of the prior distribution with <code>method = 'param'</code> and the <code>alpha</code> and <code>beta</code> arguments, which correspond to the first and (optionally) second parameter of the prior as described above. For example, the commands below create a beta(2, 10) prior distribution, a normal(0.025, 0.05) prior distribution and a Student-t(0.01) prior distribution.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"param"</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, alpha <span class="op">=</span> <span class="fl">2</span>, beta <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; functional form: beta(α = 2, β = 10) </span></span>
<span><span class="co">#&gt; parameters obtained via method 'param'</span></span>
<span><span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"param"</span>, likelihood <span class="op">=</span> <span class="st">"normal"</span>, alpha <span class="op">=</span> <span class="fl">0.025</span>, beta <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; functional form: normal(μ = 0.025, σ = 0.05)T[0,1] </span></span>
<span><span class="co">#&gt; parameters obtained via method 'param'</span></span>
<span><span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"param"</span>, likelihood <span class="op">=</span> <span class="st">"t"</span>, alpha <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; functional form: Student-t(df = 0.01)T[0,1] </span></span>
<span><span class="co">#&gt; parameters obtained via method 'param'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="improper-prior" class="level3" data-number="4.5.3"><h3 data-number="4.5.3" class="anchored" data-anchor-id="improper-prior">
<span class="header-section-number">4.5.3</span> Improper Prior</h3>
<p>You can construct an improper prior distribution with classical properties using <code>method = 'strict'</code>. The posterior distribution of from this prior yields the same results as the classical methodology with respect to sample sizes and upper limits, but is only proper once a single non-misstated unit is present in the sample <span class="citation" data-cites="Derks2022b">(<a href="references.html#ref-Derks2022b" role="doc-biblioref">Derks et al., 2022a</a>)</span>. For example, the command below creates an improper beta(1, 0) prior distribution. This method requires the <code>poisson</code>, <code>binomial</code> or <code>hypergeometric</code> likelihood.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"strict"</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; functional form: beta(α = 1, β = 0) </span></span>
<span><span class="co">#&gt; parameters obtained via method 'strict'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="impartial-prior" class="level3" data-number="4.5.4"><h3 data-number="4.5.4" class="anchored" data-anchor-id="impartial-prior">
<span class="header-section-number">4.5.4</span> Impartial Prior</h3>
<p>You can incorporate the assumption that tolerable misstatement is equally likely as intolerable misstatement <span class="citation" data-cites="Derks2022b">(<a href="references.html#ref-Derks2022b" role="doc-biblioref">Derks et al., 2022a</a>)</span> using <code>method = 'impartial'</code>. For example, the command below creates an impartial beta prior distribution for a performance materiality of 5 percent. This method requires that you specify a value for the <code>materiality</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"impartial"</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, materiality <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; functional form: beta(α = 1, β = 13.513) </span></span>
<span><span class="co">#&gt; parameters obtained via method 'impartial'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="probability-of-tolerable-misstatement" class="level3" data-number="4.5.5"><h3 data-number="4.5.5" class="anchored" data-anchor-id="probability-of-tolerable-misstatement">
<span class="header-section-number">4.5.5</span> Probability of Tolerable Misstatement</h3>
<p>You can manually assign prior probabilities to the hypothesis of tolerable misstatement and the hypotheses of intolerable misstatement <span class="citation" data-cites="Derks2021">(<a href="references.html#ref-Derks2021" role="doc-biblioref">Derks et al., 2021</a>)</span> with <code>method = 'hyp'</code> in combination with <code>p.hmin</code>. For example, the command below incorporates the information that the hypothesis of tolerable misstatement has a probability of 60 percent into a beta prior distribution. This method requires that you specify a value for the <code>materiality</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"hyp"</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, materiality <span class="op">=</span> <span class="fl">0.05</span>, p.hmin <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; functional form: beta(α = 1, β = 17.864) </span></span>
<span><span class="co">#&gt; parameters obtained via method 'hyp'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="audit-risk-model" class="level3" data-number="4.5.6"><h3 data-number="4.5.6" class="anchored" data-anchor-id="audit-risk-model">
<span class="header-section-number">4.5.6</span> Audit Risk Model</h3>
<p>You can translate risk assessments from the Audit Risk Model (inherent risk and internal control risk) into a prior distribution <span class="citation" data-cites="Derks2021">(<a href="references.html#ref-Derks2021" role="doc-biblioref">Derks et al., 2021</a>)</span> using <code>method = 'arm'</code> in combination with the <code>ir</code> and <code>cr</code> arguments. For example, the command below incorporates the information that the inherent risk is equal to 90 percent and internal control risk is equal to 60 percent into a beta prior distribution. This method requires the <code>poisson</code>, <code>binomial</code> or <code>hypergeometric</code> likelihood.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"arm"</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, materiality <span class="op">=</span> <span class="fl">0.05</span>, ir <span class="op">=</span> <span class="fl">0.9</span>, cr <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; functional form: beta(α = 1, β = 12) </span></span>
<span><span class="co">#&gt; parameters obtained via method 'arm'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="bayesian-risk-assessment-model" class="level3" data-number="4.5.7"><h3 data-number="4.5.7" class="anchored" data-anchor-id="bayesian-risk-assessment-model">
<span class="header-section-number">4.5.7</span> Bayesian Risk Assessment Model</h3>
<p>You can incorporate information about the mode and the upper bound of the prior distribution using <code>method = 'bram'</code>. For example, the code below incorporates the information that the mode of the prior distribution is 1 percent and the upper bound is 60 percent into a beta prior distribution. This method requires the <code>poisson</code>, <code>binomial</code> or <code>hypergeometric</code> likelihood.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"bram"</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, materiality <span class="op">=</span> <span class="fl">0.05</span>, expected <span class="op">=</span> <span class="fl">0.01</span>, ub <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; functional form: beta(α = 1.023, β = 3.317) </span></span>
<span><span class="co">#&gt; parameters obtained via method 'bram'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="earlier-sample" class="level3" data-number="4.5.8"><h3 data-number="4.5.8" class="anchored" data-anchor-id="earlier-sample">
<span class="header-section-number">4.5.8</span> Earlier Sample</h3>
<p>You can incorporate information from an earlier sample into the prior distribution <span class="citation" data-cites="Derks2021">(<a href="references.html#ref-Derks2021" role="doc-biblioref">Derks et al., 2021</a>)</span> using <code>method = 'sample'</code> in combination with <code>x</code> and <code>n</code>. For example, the command below incorporates the information from an earlier sample of 30 items in which 0 misstatements were found into a beta prior distribution. This method requires the <code>poisson</code>, <code>binomial</code> or <code>hypergeometric</code> likelihood.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"sample"</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, x <span class="op">=</span> <span class="fl">0</span>, n <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; functional form: beta(α = 1, β = 30) </span></span>
<span><span class="co">#&gt; parameters obtained via method 'sample'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="weighted-earlier-sample" class="level3" data-number="4.5.9"><h3 data-number="4.5.9" class="anchored" data-anchor-id="weighted-earlier-sample">
<span class="header-section-number">4.5.9</span> Weighted Earlier Sample</h3>
<p>You can incorporate information from last years results, weighted by a factor <span class="citation" data-cites="Derks2021">(<a href="references.html#ref-Derks2021" role="doc-biblioref">Derks et al., 2021</a>)</span>, into the prior distribution using <code>method = 'factor'</code> in combination with <code>x</code> and <code>n</code>. For example, the command below incorporates the information from a last years results (a sample of 58 items in which 0 misstatements were found), weighted by a factor 0.7, into a beta prior distribution. This method requires the <code>poisson</code>, <code>binomial</code> or <code>hypergeometric</code> likelihood.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"factor"</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, x <span class="op">=</span> <span class="fl">0</span>, n <span class="op">=</span> <span class="fl">58</span>, factor <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; functional form: beta(α = 1, β = 40.6) </span></span>
<span><span class="co">#&gt; parameters obtained via method 'factor'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="nonparametric-prior" class="level3" data-number="4.5.10"><h3 data-number="4.5.10" class="anchored" data-anchor-id="nonparametric-prior">
<span class="header-section-number">4.5.10</span> Nonparametric Prior</h3>
<p>You can base the prior on samples of the prior distribution using <code>method = 'nonparam'</code> in combination with <code>samples</code>. For example, the command below creates a prior on 1000 samples of a beta(1, 10) distribution. The <code>likelihood</code> argument is not required and will be ignored in this method.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"nonparam"</span>, samples <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; functional form: Nonparametric </span></span>
<span><span class="co">#&gt; parameters obtained via method 'nonparam'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="practical-examples" class="level2" data-number="4.6"><h2 data-number="4.6" class="anchored" data-anchor-id="practical-examples">
<span class="header-section-number">4.6</span> Practical Examples</h2>
<p>This section contains practical examples of how to conduct the planning of statistical audit samples and demonstrates how to set up a prior distribution based on various types of relevant audit information.</p>
<section id="audit-risk-model-1" class="level3" data-number="4.6.1"><h3 data-number="4.6.1" class="anchored" data-anchor-id="audit-risk-model-1">
<span class="header-section-number">4.6.1</span> Audit Risk Model</h3>
<p>In our first example, an auditor is performing tests of details on a population of the auditee. For instance, let’s say an auditor is performing an audit on a company’s accounts payable transactions. The company has a total of <span class="math inline">\(N\)</span> = 1000 accounts payable transactions for the year. Rather than testing all 1000 transactions, the auditor can choose to test a sample of the transactions. The performance materiality for the payable transactions account is set to <span class="math inline">\(\theta_{max}\)</span> = 3 percent, and the audit risk is set to <span class="math inline">\(\alpha = 0.05\)</span>, or 5 percent. Based on the results of last years audit, where the most likely estimate of the misstatement was 1 percent, the auditor wants to tolerate 1 percent misstatements in the sample before giving an unqualified opinion on the population.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ar</span> <span class="op">&lt;-</span> <span class="fl">0.05</span> <span class="co"># Audit risk</span></span>
<span><span class="va">materiality</span> <span class="op">&lt;-</span> <span class="fl">0.03</span> <span class="co"># Performance materiality</span></span>
<span><span class="va">expected</span> <span class="op">&lt;-</span> <span class="fl">0.01</span> <span class="co"># Tolerable deviation rate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before tests of details, the auditor has assessed risk of material misstatement via the audit risk model. In this example, the auditor has assessed the effectiveness of the company’s internal controls, such as its segregation of duties and its risk management processes, and has determined that they are sufficient to prevent or detect material misstatements. Because the internal control systems were effective, the auditor assesses the control risk as medium. The auditor’s firm defines the risk categories low, medium, and high respectively as 50 percent, 60 percent, and 100 percent. According to the Audit Risk Model, the detection risk can be calculated as a function of the audit risk, the inherent risk and the control risk.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ir</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># Inherent risk</span></span>
<span><span class="va">cr</span> <span class="op">&lt;-</span> <span class="fl">0.6</span> <span class="co"># Control risk</span></span>
<span><span class="va">dr</span> <span class="op">&lt;-</span> <span class="va">ar</span> <span class="op">/</span> <span class="op">(</span><span class="va">ir</span> <span class="op">*</span> <span class="va">cr</span><span class="op">)</span> <span class="co"># Detection risk</span></span>
<span><span class="va">dr</span></span>
<span><span class="co">#&gt; [1] 0.08333333</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By using the detection risk of 8.33 percent as the sampling risk for this population, the auditor can plan for a sample while taking into account the risk-reducing information. The required minimum sample size is 174 in this case.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="va">expected</span>, conf.level <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">dr</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 174 </span></span>
<span><span class="co">#&gt; sample size obtained in 175 iterations via method 'poisson'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The example above is a frequentist one. However, the auditor is free to apply a Bayesian philosophy in planning the sample. For example, the risk assessments from the ARM can be incorporated into a prior distribution. This can be done using <code>method = "arm"</code> in the <code>auditPrior()</code> function, which takes the values of the inherent risk probability <code>ir</code> and the control risk probability <code>cr</code>. Hence, the prior distribution in this example can be constructed using the following command:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"arm"</span>, materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="va">expected</span>, ir <span class="op">=</span> <span class="va">ir</span>, cr <span class="op">=</span> <span class="va">cr</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function can be used to obtain relevant information about the prior distribution.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">prior</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Prior Distribution Summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Options:</span></span>
<span><span class="co">#&gt;   Likelihood:                    poisson </span></span>
<span><span class="co">#&gt;   Specifics:                     ir = 1; cr = 0.6; dr = 0.0833333 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt;   Functional form:               gamma(α = 1.46, β = 46) </span></span>
<span><span class="co">#&gt;   Mode:                          0.01 </span></span>
<span><span class="co">#&gt;   Mean:                          0.031739 </span></span>
<span><span class="co">#&gt;   Median:                        0.024859 </span></span>
<span><span class="co">#&gt;   Variance:                      0.00069 </span></span>
<span><span class="co">#&gt;   Skewness:                      1.6552 </span></span>
<span><span class="co">#&gt;   Information entropy (nat):     -2.4894 </span></span>
<span><span class="co">#&gt;   95 percent upper bound:        0.08343 </span></span>
<span><span class="co">#&gt;   Precision:                     0.07343</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Furthermore, the prior distribution can be visualized with a call to the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function, see <a href="#fig-planning-prior-example1">Figure&nbsp;<span>4.16</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">prior</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-prior-example1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-prior-example1-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.16: The prior distribution constructed on the basis of the assessments of inherent risk and control risk.</figcaption></figure>
</div>
</div>
</div>
<p>By using the prior distribution to incorporate the assessments of the inherent risk and the control risk, the auditor can plan a sample while taking into account the risk-reducing information. The required minimum sample size is also 174 in this case.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="va">expected</span>, conf.level <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">ar</span>, prior <span class="op">=</span> <span class="va">prior</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 174 </span></span>
<span><span class="co">#&gt; sample size obtained in 175 iterations via method 'poisson' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="benchmark-analysis" class="level3" data-number="4.6.2"><h3 data-number="4.6.2" class="anchored" data-anchor-id="benchmark-analysis">
<span class="header-section-number">4.6.2</span> Benchmark Analysis</h3>
<p>The auditor may incorporate information obtained through analytical procedures <span class="citation" data-cites="Derks2021">(<a href="references.html#ref-Derks2021" role="doc-biblioref">Derks et al., 2021</a>)</span>, such as a benchmark analysis, into the prior distribution for <span class="math inline">\(\theta\)</span>. While we have previously discussed methods for constructing a prior distribution based on existing knowledge, there is no set procedure for incorporating information obtained through analytical procedures, as these procedures can vary significantly depending on the type of information being incorporated into the prior distribution. Therefore, it is important to thoroughly substantiate the data and assumptions used in this approach and to carefully consider how these assumptions are incorporated into the prior distribution.</p>
<p>One way to construct a prior distribution on the basis of data is through the use of regression models, such as benchmarking the relationship between sales and costs of sales within the auditee’s specific industry sector. The <strong>jfa</strong> package includes a data set <code>benchmark</code> that can be used for this example.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">benchmark</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">benchmark</span><span class="op">)</span></span>
<span><span class="co">#&gt;       sales costofsales</span></span>
<span><span class="co">#&gt; 1 186273256   140755372</span></span>
<span><span class="co">#&gt; 2 336491541   248675452</span></span>
<span><span class="co">#&gt; 3 222693077   164299866</span></span>
<span><span class="co">#&gt; 4 364905221   285768790</span></span>
<span><span class="co">#&gt; 5 382140185   280187371</span></span>
<span><span class="co">#&gt; 6 113666950   101552955</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The auditee’s the sum of the sales is $298,112,312 and the sum of the booked costs of sales is $223,994,405, respectively. This is indicated by a blue dot in <a href="#fig-planning-scatter-1">Figure&nbsp;<span>4.17</span></a> below, which visualizes the industry sales versus the cost of sales.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">C_real</span> <span class="op">&lt;-</span> <span class="fl">223994405</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-planning-scatter-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-scatter-1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.17: Scatter plot of the industry sales versus the cost of sales.</figcaption></figure>
</div>
</div>
</div>
<p>The relationship between the sales <span class="math inline">\(S\)</span> and the cost of sales <span class="math inline">\(C\)</span> can be modelled by a linear equation:</p>
<p><span class="math display">\[\begin{equation}
  C = \beta_0 + \beta_1 \cdot S + \epsilon.
\end{equation}\]</span></p>
<p>In practice, this relationship is often more complex than is presented above, and the auditor must carefully construct and evaluate the applied regression model. However, for ease of understanding we will continue our example with this toy model. The auditor can estimate the regression model using the following command:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">costofsales</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">sales</span>, data <span class="op">=</span> <span class="va">benchmark</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = costofsales ~ 1 + sales, data = benchmark)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;       Min        1Q    Median        3Q       Max </span></span>
<span><span class="co">#&gt; -25736696  -7052141   -226945   6857840  25498106 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 2.413e+05  3.455e+06    0.07    0.944    </span></span>
<span><span class="co">#&gt; sales       7.366e-01  1.310e-02   56.21   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 11150000 on 98 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.9699, Adjusted R-squared:  0.9696 </span></span>
<span><span class="co">#&gt; F-statistic:  3160 on 1 and 98 DF,  p-value: &lt; 2.2e-16</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The predicted cost of sales for the auditee, based on the industry benchmark, can be computed as follows:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">C_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>sales <span class="op">=</span> <span class="fl">298112312</span><span class="op">)</span>, interval <span class="op">=</span> <span class="st">"prediction"</span>, level <span class="op">=</span> <span class="fl">0.90</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">C_pred</span></span>
<span><span class="co">#&gt; [1] 219817866</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The fitted regression line and the predicted cost of sales (red dot) are visualized in <a href="#fig-planning-scatter-2">Figure&nbsp;<span>4.18</span></a> below.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-planning-scatter-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-scatter-2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.18: Scatter plot of the industry sales versus the cost of sales including the regression line and the auditee’s (predicted) cost of sales.</figcaption></figure>
</div>
</div>
</div>
<p>The prior distribution can be justified by the data and the auditee’s numerical prediction of the cost of sales. In this analytical procedure, the prior distribution on <span class="math inline">\(\theta\)</span> can utilize the relative error distribution from the linear regression. This relative error distribution, which is a Normal(<span class="math inline">\(\mu\)</span>, <span class="math inline">\(\sigma\)</span>) distribution, captures the uncertainty of the prediction of the cost of sales through the use of linear regression, scaled to be a percentage of the total cost of sales. The mean <span class="math inline">\(\mu\)</span> of the prior distribution is determined by the relative deviation of the auditee’s booked cost of sales when compared to the predicted cost of sales according to the benchmark data <span class="math inline">\(\frac{C - \hat{C}}{C}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">C_real</span> <span class="op">-</span> <span class="va">C_pred</span><span class="op">)</span> <span class="op">/</span> <span class="va">C_real</span></span>
<span><span class="va">mu</span></span>
<span><span class="co">#&gt; [1] 0.01864573</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The standard deviation of the prior distribution is expressed through the standard deviation of the distribution of <span class="math inline">\(\epsilon\)</span>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">stdev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span> <span class="op">/</span> <span class="va">C_real</span></span>
<span><span class="va">stdev</span></span>
<span><span class="co">#&gt; [1] 0.04951199</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The Normal(0.019, 0.05) prior distribution can be constructed through a call to <code>auditPrior()</code>, where the likelihood of the prior is specified as <code>normal</code>. We call the function with <code>method = "param"</code> to manually specify the parameters of the prior distribution.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"param"</span>, likelihood <span class="op">=</span> <span class="st">"normal"</span>, alpha <span class="op">=</span> <span class="va">mu</span>, beta <span class="op">=</span> <span class="va">stdev</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">prior</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Prior Distribution Summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Options:</span></span>
<span><span class="co">#&gt;   Likelihood:                    normal </span></span>
<span><span class="co">#&gt;   Specifics:                     α = 0.0186457; β = 0.049512 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt;   Functional form:               normal(μ = 0.019, σ = 0.05)T[0,1] </span></span>
<span><span class="co">#&gt;   Mode:                          0.018646 </span></span>
<span><span class="co">#&gt;   Mean:                          0.047096 </span></span>
<span><span class="co">#&gt;   Median:                        0.041335 </span></span>
<span><span class="co">#&gt;   Variance:                      0.0011116 </span></span>
<span><span class="co">#&gt;   Skewness:                      NA </span></span>
<span><span class="co">#&gt;   Information entropy (nat):     -2.1306 </span></span>
<span><span class="co">#&gt;   95 percent upper bound:        0.11012 </span></span>
<span><span class="co">#&gt;   Precision:                     0.091473</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The specified prior distribution can be visualized using the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function, see <a href="#fig-planning-prior-example2">Figure&nbsp;<span>4.19</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">prior</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-prior-example2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-prior-example2-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.19: The prior distribution constructed on the basis of the benchmark analysis.</figcaption></figure>
</div>
</div>
</div>
<p>The performance materiality for this example is set to <span class="math inline">\(\theta_{max}\)</span> = 5 percent, and the audit risk is set to <span class="math inline">\(\alpha = 0.05\)</span>, or 5 percent. By using this prior distribution, the required minimum sample size is 50.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.05</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, prior <span class="op">=</span> <span class="va">prior</span><span class="op">)</span></span>
<span><span class="va">plan</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 50 </span></span>
<span><span class="co">#&gt; sample size obtained in 51 iterations via method 'binomial' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can inspect how the prior distribution compares to the expected posterior distribution by using the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function, see <a href="#fig-planning-prior-posterior-example2">Figure&nbsp;<span>4.20</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-prior-posterior-example2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-prior-posterior-example2-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.20: The prior and expected posterior distribution for this example after seeing a sample of <span class="math inline">\(n=50\)</span> containing no misstatements.</figcaption></figure>
</div>
</div>
</div>
<p>By using a frequentist approach, the required minimum sample size is 59. Thus, by performing the analytical procedure and incorporating this information into the prior distribution, the auditor has achieved a reduction in sample size of 9 items.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.05</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="va">plan</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 59 </span></span>
<span><span class="co">#&gt; sample size obtained in 60 iterations via method 'binomial'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="predictive-modeling" class="level3" data-number="4.6.3"><h3 data-number="4.6.3" class="anchored" data-anchor-id="predictive-modeling">
<span class="header-section-number">4.6.3</span> Predictive Modeling</h3>
<p>As a final example, we consider an example wehre the auditor incorporates information about the probability of misstatement obtained through a predictive analysis into the prior distribution for <span class="math inline">\(\theta\)</span>. In this example, the auditor is conducting an audit on a long-term client that they have been working with for fifteen years. Hence, the auditor has access to a historycal data set called <code>history</code>, which contains the samples from all of the previous audits that have been conducted on this auditee over the past fifteen years.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">history</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://github.com/koenderks/sasr/raw/master/data/ch3_history.csv"</span>, colClasses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"factor"</span>, <span class="st">"numeric"</span>, <span class="st">"numeric"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">history</span><span class="op">)</span></span>
<span><span class="co">#&gt;   k  ftes days</span></span>
<span><span class="co">#&gt; 1 0  2.09 1.83</span></span>
<span><span class="co">#&gt; 2 0 17.51 5.02</span></span>
<span><span class="co">#&gt; 3 0 17.29 8.47</span></span>
<span><span class="co">#&gt; 4 0 23.88 8.31</span></span>
<span><span class="co">#&gt; 5 0 15.31 8.25</span></span>
<span><span class="co">#&gt; 6 0 18.28 4.47</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It should be noted that for all historical sample items, there are three known characteristics: whether they contained a misstatement (designated as <code>k</code>), the number of full-time equivalent employees (FTEs) who had access to that item within the internal computer systems of the auditee (designated as <code>ftes</code>), and the number of days that the item was outstanding (designated as <code>days</code>). Additionally, the <code>ftes</code> and <code>days</code> characteristics are also known for all items in the current year’s population. Of course, it is unknown if any misstatements exist within the population of the current year.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">population</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://github.com/koenderks/sasr/raw/master/data/ch3_population.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span></span>
<span><span class="co">#&gt;      ID bookValue ftes days</span></span>
<span><span class="co">#&gt; 1 82884    242.61   14    4</span></span>
<span><span class="co">#&gt; 2 25064    642.99   11    4</span></span>
<span><span class="co">#&gt; 3 81235    628.53    8    3</span></span>
<span><span class="co">#&gt; 4 71769    431.87   11    3</span></span>
<span><span class="co">#&gt; 5 55080    620.88   12    3</span></span>
<span><span class="co">#&gt; 6 93224    501.76   12    5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The objective of this analytical procedure is to forecast potential misstatements within the population of the current year. In order for the information obtained through this procedure to serve as prior knowledge in a Bayesian analysis, the procedure must yield a distribution of the probability of misstatement. Therefore, the auditor employs a machine learning technique known as Random Forest <span class="citation" data-cites="Hastie2009">(<a href="references.html#ref-Hastie2009" role="doc-biblioref">Hastie et al., 2009</a>)</span> to learn the relationship between misstatements, the number of full-time equivalent employees, and the number of outstanding days in the historical data set.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">k</span> <span class="op">~</span> <span class="va">ftes</span> <span class="op">+</span> <span class="va">days</span>, data <span class="op">=</span> <span class="va">history</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The auditor specifically uses the random forest technique due to its ability to provide a distribution of the misstatement probabilities. The probabilistic predictions for the unseen misstatements in the <code>population</code> data can be obtained by calling the <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function with the argument <code>type = "prob"</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">population</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These predictions come in a probabilistic format, which means that for each item in the population of the current year there is a predicted probability that that item is misstated. These probabilities are stored in the second column of the <code>predictions</code> data frame.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">predictions</span><span class="op">)</span></span>
<span><span class="co">#&gt;       0     1</span></span>
<span><span class="co">#&gt; 1 0.974 0.026</span></span>
<span><span class="co">#&gt; 2 0.966 0.034</span></span>
<span><span class="co">#&gt; 3 0.992 0.008</span></span>
<span><span class="co">#&gt; 4 0.928 0.072</span></span>
<span><span class="co">#&gt; 5 0.776 0.224</span></span>
<span><span class="co">#&gt; 6 0.982 0.018</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The prior distribution for <span class="math inline">\(\theta\)</span> will be based on the distribution of probabilities that each item in the population is misstated. In contrast to the previous example, this distribution is not a parametric distribution, which means we are unable to utilize any parametric priors from <strong>jfa</strong>. However, by providing samples of the prior distribution, <strong>jfa</strong> is able to construct a nonparametric prior distribution internally via the density of the samples.</p>
<p>The nonparametric prior distribution can be constructed through a call to <code>auditPrior()</code>, where the method to construct of the prior is specified as <code>nonparam</code>. The samples of the prior distribution can be provided through the <code>samples</code> argument. We use the second column of the the <code>predictions</code> object for this.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"nonparam"</span>, samples <span class="op">=</span> <span class="va">predictions</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The nonparametric prior distribution can be visualized using the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function, see <a href="#fig-planning-prior-example3">Figure&nbsp;<span>4.21</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">prior</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-prior-example3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-prior-example3-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.21: The prior distribution constructed on the basis of the predictive model.</figcaption></figure>
</div>
</div>
</div>
<p>The performance materiality for this example is set to <span class="math inline">\(\theta_{max}\)</span> = 1 percent, and the audit risk is set to <span class="math inline">\(\alpha = 0.05\)</span>, or 5 percent. The minimum sample size can be calculated with the command below and is 108.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.01</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, prior <span class="op">=</span> <span class="va">prior</span><span class="op">)</span></span>
<span><span class="va">plan</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 108 </span></span>
<span><span class="co">#&gt; sample size obtained in 109 iterations via method 'binomial' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can inspect how the prior distribution compares to the expected posterior distribution by using the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function, see <a href="#fig-planning-prior-posterior-example3">Figure&nbsp;<span>4.22</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-planning-prior-posterior-example3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="chap-planning_files/figure-html/fig-planning-prior-posterior-example3-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;4.22: The prior and expected posterior distribution for this example after seeing a sample of <span class="math inline">\(n=108\)</span> units containing no misstatements.</figcaption></figure>
</div>
</div>
</div>
<p>By using a frequentist approach, the required minimum sample size is 299. Thus, by performing the analytical procedure and incorporating this information into the prior distribution, the auditor has achieved a reduction in sample size of 299 - 108 = 191 items.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.01</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="va">plan</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 299 </span></span>
<span><span class="co">#&gt; sample size obtained in 300 iterations via method 'binomial'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="practical-exercises" class="level2" data-number="4.7"><h2 data-number="4.7" class="anchored" data-anchor-id="practical-exercises">
<span class="header-section-number">4.7</span> Practical Exercises</h2>
<ol type="1">
<li>Use the classical approach with the hypergeometric likelihood to compute the minimum required sample size for a population of <span class="math inline">\(N = 100\)</span> when applying a performance materiality of 3 percent and a sampling risk of 5 percent. Tolerate no misstatements in the sample.</li>
</ol>
<details><summary>
Click to reveal answer
</summary><p>This sample size can be computed using the <code>planning()</code> function with the arguments <code>likelihood = "hypergeometric"</code> and <code>N.units = 100</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, likelihood <span class="op">=</span> <span class="st">"hypergeometric"</span>, N.units <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 63 </span></span>
<span><span class="co">#&gt; sample size obtained in 64 iterations via method 'hypergeometric'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details><ol start="2" type="1">
<li>Recompute the previous sample size with the Bayesian approach using a default prior.</li>
</ol>
<details><summary>
Click to reveal answer
</summary><p>The previous sample size can be recomputed using a default prior by adding <code>prior = TRUE</code> to the call.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, likelihood <span class="op">=</span> <span class="st">"hypergeometric"</span>, N.units <span class="op">=</span> <span class="fl">100</span>, prior <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 63 </span></span>
<span><span class="co">#&gt; sample size obtained in 64 iterations via method 'hypergeometric' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details><ol start="3" type="1">
<li>Use the classical approach with the binomial likelihood to compute the minimum required sample size for a performance materiality of 4.4 percent and a sampling risk of 5 percent. Tolerate one misstatement in the sample.</li>
</ol>
<details><summary>
Click to reveal answer
</summary><p>This sample size can be computed using the <code>planning()</code> function with the arguments <code>likelihood = "binomial"</code> and <code>expected = 1</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.044</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, expected <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 106 </span></span>
<span><span class="co">#&gt; sample size obtained in 105 iterations via method 'binomial'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details><ol start="4" type="1">
<li>Recompute the previous sample size with the Bayesian approach using a default prior.</li>
</ol>
<details><summary>
Click to reveal answer
</summary><p>The previous sample size can be recomputed using a default prior by adding <code>prior = TRUE</code> to the call.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.044</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, expected <span class="op">=</span> <span class="fl">1</span>, prior <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 105 </span></span>
<span><span class="co">#&gt; sample size obtained in 104 iterations via method 'binomial' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details><ol start="5" type="1">
<li>Use the classical approach with the Poisson likelihood to compute the minimum required sample size for a performance materiality of 2 percent and a sampling risk of 5 percent. Use an expected misstatement rate of 0.5 percent.</li>
</ol>
<details><summary>
Click to reveal answer
</summary><p>This sample size can be computed using the <code>planning()</code> function with the argument <code>expected = 0.005</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.02</span>, expected <span class="op">=</span> <span class="fl">0.005</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 262 </span></span>
<span><span class="co">#&gt; sample size obtained in 263 iterations via method 'poisson'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details><ol start="6" type="1">
<li>Recompute the previous sample size with the Bayesian approach using a default prior.</li>
</ol>
<details><summary>
Click to reveal answer
</summary><p>The previous sample size can be recomputed using a default prior by adding <code>prior = TRUE</code> to the call.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.02</span>, expected <span class="op">=</span> <span class="fl">0.005</span>, prior <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 261 </span></span>
<span><span class="co">#&gt; sample size obtained in 262 iterations via method 'poisson' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details><ol start="7" type="1">
<li>Compute the sampling risk according to the Audit Risk Model for an audit risk percentage of 5 percent, an inherent risk percentage of 50 percent and an internal control risk percentage of 80 percent. Next, use the classical approach with the binomial likelihood to compute the minimum sample size for a performance materiality of 5 percent and the new sampling risk. Tolerate no misstatements in the sample.</li>
</ol>
<details><summary>
Click to reveal answer
</summary><p>This sample size can be computed by using an adjusted confidence level via the <code>conf.level</code> argument.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dr</span> <span class="op">&lt;-</span> <span class="fl">0.05</span> <span class="op">/</span> <span class="op">(</span><span class="fl">0.5</span> <span class="op">*</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.05</span>, conf.level <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">dr</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 42 </span></span>
<span><span class="co">#&gt; sample size obtained in 43 iterations via method 'poisson'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details><ol start="8" type="1">
<li>Construct a prior distribution on the basis of the information in exercise 7. Use this prior distribution to recompute the previous sample size with the Bayesian approach.</li>
</ol>
<details><summary>
Click to reveal answer
</summary><p>The information in exercise 7 can be incorporated into the prior distribution by using the <code>auditPrior()</code> function in combination with <code>method = "arm"</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"arm"</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, materiality <span class="op">=</span> <span class="fl">0.05</span>, ir <span class="op">=</span> <span class="fl">0.5</span>, cr <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu">planning</span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.05</span>, prior <span class="op">=</span> <span class="va">prior</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; minimum sample size = 41 </span></span>
<span><span class="co">#&gt; sample size obtained in 42 iterations via method 'binomial' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details><ol start="9" type="1">
<li>Construct a prior distribution on the basis of the assumption that tolerable misstatement is equally likely as intolerable misstatement before seeing the sample data. Use the binomial likelihood and assume a performance materiality of 2.5 percent.</li>
</ol>
<details><summary>
Click to reveal answer
</summary><p>This prior distribution can be constructed using the <code>auditPrior()</code> function in combination with <code>method = "impartial"</code>, while providing a value for the <code>materiality</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">auditPrior</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"impartial"</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, materiality <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; functional form: beta(α = 1, β = 13.513) </span></span>
<span><span class="co">#&gt; parameters obtained via method 'impartial'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>

<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="list" style="display: none">
<div id="ref-AICPA-A" class="csl-entry" role="listitem">
American Institute of Certified Public Accountants (AICPA). (2016). Appendix <span>A</span>: Attributes statistical sampling tables. In <em>Audit guide: Audit sampling</em>. <a href="https://doi.org/10.1002/9781119448617.app1">https://doi.org/10.1002/9781119448617.app1</a>
</div>
<div id="ref-Derks2021" class="csl-entry" role="listitem">
Derks, K., de Swart, J., van Batenburg, P., Wagenmakers, E., &amp; Wetzels, R. (2021). Priors in a <span>B</span>ayesian audit: How integration of existing information into the prior distribution can improve audit transparency and efficiency. <em>International Journal of Auditing</em>, <em>25</em>(3), 621–636. <a href="https://doi.org/10.1111/ijau.12240">https://doi.org/10.1111/ijau.12240</a>
</div>
<div id="ref-Derks2022b" class="csl-entry" role="listitem">
Derks, K., de Swart, J., Wagenmakers, E., &amp; Wetzels, R. (2022a). An impartial <span>B</span>ayesian hypothesis test for audit sampling. <em>PsyArXiv</em>. <a href="https://doi.org/10.31234/osf.io/8nf3e">https://doi.org/10.31234/osf.io/8nf3e</a>
</div>
<div id="ref-Derks2022" class="csl-entry" role="listitem">
Derks, K., de Swart, J., Wagenmakers, E., &amp; Wetzels, R. (2022b). The <span>B</span>ayesian approach to audit evidence: Quantifying statistical evidence using the <span>B</span>ayes factor. <em>PsyArXiv</em>. <a href="https://doi.org/10.31234/osf.io/kzqp5">https://doi.org/10.31234/osf.io/kzqp5</a>
</div>
<div id="ref-Dyer1993" class="csl-entry" role="listitem">
Dyer, D., &amp; Pierce, R. L. (1993). On the choice of the prior distribution in hypergeometric sampling. <em>Communications in Statistics - Theory and Methods</em>, <em>22</em>(8), 2125–2146. <a href="https://doi.org/10.1080/03610929308831139">https://doi.org/10.1080/03610929308831139</a>
</div>
<div id="ref-Hastie2009" class="csl-entry" role="listitem">
Hastie, T., Tibshirani, R., &amp; Friedman, J. H. (2009). <em>The elements of statistical learning: Data mining, inference, and prediction</em> (Vol. 2). Springer.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./chap-workflow.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Sampling Workflow</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chap-selection.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Selection</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb106" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, cache = FALSE}</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"utils.R"</span>, <span class="at">local =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="fu"># Planning {#chap-planning}</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>One of the key considerations in audit sampling is determining the appropriate sample size to reduce the sampling risk to an appropriately low level, while minimizing audit effort. To quantify the sampling risk, it is necessary to specify the statistical model that connects the data to the population misstatement, referred to as the likelihood. This chapter will delve into three standard likelihoods commonly employed in audit sampling: the hypergeometric likelihood, the binomial likelihood, and the Poisson likelihood.</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>Note that planning is a game of optimization that could be avoided. If you are using the Bayesian approach to audit sampling, it is not required to plan a specific sample size in advance <span class="co">[</span><span class="ot">@Derks2022</span><span class="co">]</span>. That is because in Bayesian inference, the posterior distribution after seeing each item is used as the prior distribution for the next item. That means that you can simply start sampling and monitor the evidence in the data over time. However, to get an idea of how many samples are required to reduce the sampling risk to an level, planning a sample using a Bayesian approach can still be good practice.</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a><span class="fu">## Required Information</span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>First, planning a minimum sample requires knowledge of the conditions that lead  to acceptance or rejection of the population (i.e., the sampling objectives). Typically, sampling objectives can be classified into one or both of the following:</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Hypothesis testing**: The goal of the sample is to obtain evidence for or against the claim that the misstatement in the population is lower than a given value (i.e., the performance materiality).</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Estimation**: The goal of the sample is to obtain an accurate estimate of the misstatement in the population with a certain precision.</span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>Second, it is advised to specify the expected (or tolerable) misstatements in the sample. The expected misstatements are the misstatements that you allow in the sample, while still retaining the desired amount of assurance about the  population. It is strongly recommended to set the value for the expected misstatements in the sample conservatively to minimize the chance of the observed misstatements in the sample exceeding the expected misstatements, which would imply that insufficient work has been done in the end to reduce the sampling risk to an appropriately low level.</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>Finally, next to determining the sampling objective(s) and the expected misstatements, it is important to determine the statistical distribution linking the sample outcomes to the population misstatement. This distribution is called the likelihood (i.e., <span class="in">`poisson`</span>, <span class="in">`binomial`</span>, or <span class="in">`hypergeometric`</span>). All three aforementioned likelihoods are commonly used in an audit sampling context, however, <span class="in">`poisson`</span> is the default likelihood in **jfa** because it is the most conservative of the three. In the subsections below, we elaborate on the three standard likelihoods for audit sampling and demonstrate how they can be used to obtain a minimum sample size.</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>In **jfa**, determining an appropriate sample size is achieved via the <span class="in">`planning()`</span> function.</span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">When the sampling objectives, the expected misstatements and the likelihood are set, there exists only one sample size that minimizes the amount of audit effort. Image available under a [CC-BY-NC 4.0](https://creativecommons.org/licenses/by-nc/4.0/legalcode) license.</span><span class="co">](img/book_puzzle.png)</span>{#fig-planning-1 fig-align="center" width=65%}</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Hypergeometric Likelihood</span></span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>The hypergeometric distribution is a discrete probability distribution that is commonly used to model the number of events occurring in a fixed number of trials when the population size is known. It assumes that samples are drawn from the population without replacement, and is therefore the likelihood that most closely resembles the audit practice. For our purpose, we can use the hypergeometric distribution as a likelihood to model the number of misstatements that are expected to be found in the sample.</span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>The probability mass function (PMF) of the hypergeometric distribution is given by:</span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a>  p(X = k) = \frac{\binom{K}{k} \binom{N-K}{n-k}}{\binom{N}{n}},</span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a>where $k$ is the number of misstatements in the sample, $n$ is the sample size, $N$ is the population size and $K$ is the total number of misstatements assumed in the population. The assumed misstatements $K$ is a whole number, that is, a linear extrapolation of the maximum tolerable misstatement rate (i.e., the performance materiality) $\theta_{max}$ to the total population of size $N$. In the equation below, $\lceil...\rceil$ is the ceiling function, which means that $\lceil1.2\rceil = 2$.</span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-38"><a href="#cb106-38" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-39"><a href="#cb106-39" aria-hidden="true" tabindex="-1"></a>  K = \lceil \theta_{max} N \rceil.</span>
<span id="cb106-40"><a href="#cb106-40" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-41"><a href="#cb106-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-42"><a href="#cb106-42" aria-hidden="true" tabindex="-1"></a>Let's consider how to use the hypergeometric likelihood to calculate the minimum sample size needed to reduce the sampling risk to an appropriately low level.</span>
<span id="cb106-43"><a href="#cb106-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-44"><a href="#cb106-44" aria-hidden="true" tabindex="-1"></a><span class="fu">### Classical planning</span></span>
<span id="cb106-45"><a href="#cb106-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-46"><a href="#cb106-46" aria-hidden="true" tabindex="-1"></a>In classical planning using the hypergeometric likelihood, the following statistical model is specified:</span>
<span id="cb106-47"><a href="#cb106-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-48"><a href="#cb106-48" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-49"><a href="#cb106-49" aria-hidden="true" tabindex="-1"></a>  k \sim \text{Hypergeometric}(n, N, K)</span>
<span id="cb106-50"><a href="#cb106-50" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-51"><a href="#cb106-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-52"><a href="#cb106-52" aria-hidden="true" tabindex="-1"></a>Given the performance materiality $\theta_{max}$, we can compute $K$ and solve for the minimum sample size $n$ needed to reduce the sampling risk to an appropriately low level. This sample size is also dependent on the number of misstatements that the auditor expects, or tolerates, in the sample.</span>
<span id="cb106-53"><a href="#cb106-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-54"><a href="#cb106-54" aria-hidden="true" tabindex="-1"></a><span class="fu">#### No Expected Misstatements</span></span>
<span id="cb106-55"><a href="#cb106-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-56"><a href="#cb106-56" aria-hidden="true" tabindex="-1"></a>If the auditor does not expect any misstatements in the sample, they can set $k = 0$, which consequently determines how the sample size can be calculated. For example, if we want to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.03$ in a population of $N = 1000$ items, then $K = \lceil 0.03 \cdot 1000 \rceil = 30$ and the minimum sample size under the assumption of no expected misstatements in the sample is $n = 94$.</span>
<span id="cb106-57"><a href="#cb106-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-60"><a href="#cb106-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-61"><a href="#cb106-61" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">1000</span>)</span>
<span id="cb106-62"><a href="#cb106-62" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb106-63"><a href="#cb106-63" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-64"><a href="#cb106-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-65"><a href="#cb106-65" aria-hidden="true" tabindex="-1"></a>The sample size of 94 can be confirmed by checking that 94 is the minimum integer that results in less than 5 percent probability of finding 0 misstatements, given the assumption that the population misstatement is truly 3 percent. The <span class="in">`dhyper()`</span> function calculates the probability of observing $k$ missatements in a sample of $n$ items given the assumed hypergeometric distribution with $N$ items and $K$ assumed misstatements in the population. By calculating this probability for $n = 93$, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk $\alpha$.</span>
<span id="cb106-66"><a href="#cb106-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-69"><a href="#cb106-69" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-70"><a href="#cb106-70" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fl">0.03</span> <span class="sc">*</span> <span class="dv">1000</span>)</span>
<span id="cb106-71"><a href="#cb106-71" aria-hidden="true" tabindex="-1"></a><span class="fu">dhyper</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">m =</span> K, <span class="at">n =</span> <span class="dv">1000</span> <span class="sc">-</span> K, <span class="at">k =</span> <span class="dv">93</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb106-72"><a href="#cb106-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-73"><a href="#cb106-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-74"><a href="#cb106-74" aria-hidden="true" tabindex="-1"></a>However, for $n = 94$ the relevant probability is lower than the sampling risk $\alpha$ and thus the sample size is considered to be sufficient.</span>
<span id="cb106-75"><a href="#cb106-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-78"><a href="#cb106-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-79"><a href="#cb106-79" aria-hidden="true" tabindex="-1"></a><span class="fu">dhyper</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">m =</span> K, <span class="at">n =</span> <span class="dv">1000</span> <span class="sc">-</span> K, <span class="at">k =</span> <span class="dv">94</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb106-80"><a href="#cb106-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-81"><a href="#cb106-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-82"><a href="#cb106-82" aria-hidden="true" tabindex="-1"></a>We can make this sample size visually intuitive by showing the hypergeometric($k$ | 94, 1000, 30) distribution and highlighting the probability for $k = 0$, see @fig-planning-hyper-nomis. This probability is lower than the required sampling risk $\alpha = 0.05$.</span>
<span id="cb106-83"><a href="#cb106-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-84"><a href="#cb106-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-hyper-nomis", fig.cap="The hypergeometric($k$ | 94, 1000, 30) distribution showing the probability for $k = 0$ misstatements as a red bar."}</span></span>
<span id="cb106-85"><a href="#cb106-85" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb106-86"><a href="#cb106-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-87"><a href="#cb106-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-88"><a href="#cb106-88" aria-hidden="true" tabindex="-1"></a>The <span class="in">`planning()`</span> function has two additional arguments that are not shown in the call above: <span class="in">`by`</span> and <span class="in">`max`</span>. The argument <span class="in">`by`</span> sets the increment between possible sample sizes for consideration. For example, <span class="in">`by = 5`</span> considers only samples of size 10, 20, 30, etc:</span>
<span id="cb106-89"><a href="#cb106-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-92"><a href="#cb106-92" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-93"><a href="#cb106-93" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">1000</span>, <span class="at">by =</span> <span class="dv">10</span>)</span>
<span id="cb106-94"><a href="#cb106-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-95"><a href="#cb106-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-96"><a href="#cb106-96" aria-hidden="true" tabindex="-1"></a>The argument <span class="in">`max`</span> sets the sample size at which the algorithm terminates. This can be used to avoid too many iterations of the algorithm at very low values of the performance materiality. For instance, <span class="in">`max = 50`</span> throws an error if more than 100 samples are required.</span>
<span id="cb106-97"><a href="#cb106-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-98"><a href="#cb106-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{r error=TRUE}</span></span>
<span id="cb106-99"><a href="#cb106-99" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">1000</span>, <span class="at">max =</span> <span class="dv">50</span>)</span>
<span id="cb106-100"><a href="#cb106-100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-101"><a href="#cb106-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-102"><a href="#cb106-102" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Expected Misstatements</span></span>
<span id="cb106-103"><a href="#cb106-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-104"><a href="#cb106-104" aria-hidden="true" tabindex="-1"></a>If the auditor expects misstatements in the sample, they can set $k$ to any integer value, which consequently determines how the sample size can be calculated. As another example, if we want to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.03$ in a population of $N = 1000$ items, then the required sample size under the assumption of one expected misstatement in the sample is $n = 147$.</span>
<span id="cb106-105"><a href="#cb106-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-108"><a href="#cb106-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-109"><a href="#cb106-109" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">1000</span>)</span>
<span id="cb106-110"><a href="#cb106-110" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb106-111"><a href="#cb106-111" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-112"><a href="#cb106-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-113"><a href="#cb106-113" aria-hidden="true" tabindex="-1"></a>Once again, the sample size of 147 can be confirmed by checking that 147 is the minimum integer that results in less than 5 percent probability of finding 0 or 1 misstatements, given the assumption that that the population misstatement is truly 3 percent. By calculating this probability for $n = 146$, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk $\alpha$.</span>
<span id="cb106-114"><a href="#cb106-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-117"><a href="#cb106-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-118"><a href="#cb106-118" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dhyper</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">m =</span> K, <span class="at">n =</span> <span class="dv">1000</span> <span class="sc">-</span> K, <span class="at">k =</span> <span class="dv">146</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb106-119"><a href="#cb106-119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-120"><a href="#cb106-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-121"><a href="#cb106-121" aria-hidden="true" tabindex="-1"></a>However, for $n = 147$ the relevant probability is lower than the sampling risk $\alpha$ and thus the sample size is considered to be sufficient.</span>
<span id="cb106-122"><a href="#cb106-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-125"><a href="#cb106-125" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-126"><a href="#cb106-126" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dhyper</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">m =</span> K, <span class="at">n =</span> <span class="dv">1000</span> <span class="sc">-</span> K, <span class="at">k =</span> <span class="dv">147</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb106-127"><a href="#cb106-127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-128"><a href="#cb106-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-129"><a href="#cb106-129" aria-hidden="true" tabindex="-1"></a>Like before, we can make this sample size visually intuitive by showing the hypergeometric($k$ | 147, 1000, 30) distribution and highlighting the probabilities for $k = 0$ and $k = 1$, see @fig-planning-hyper-mis. The sum of these probabilities is lower than the required sampling risk $\alpha = 0.05$.</span>
<span id="cb106-130"><a href="#cb106-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-131"><a href="#cb106-131" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-hyper-mis", fig.cap="The hypergeometric($k$ | 147, 1000, 30) distribution showing the probability for $k = 0$ and $k = 1$ misstatements as a red bar."}</span></span>
<span id="cb106-132"><a href="#cb106-132" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb106-133"><a href="#cb106-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-134"><a href="#cb106-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-135"><a href="#cb106-135" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayesian Planning</span></span>
<span id="cb106-136"><a href="#cb106-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-137"><a href="#cb106-137" aria-hidden="true" tabindex="-1"></a>Performing Bayesian planning with the hypergeometric likelihood <span class="co">[</span><span class="ot">@Dyer1993</span><span class="co">]</span> requires that you specify a prior distribution for the total misstatements $K$. Practically, this means that you should provide an input for the <span class="in">`prior`</span> argument in the <span class="in">`planning()`</span> function.</span>
<span id="cb106-138"><a href="#cb106-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-139"><a href="#cb106-139" aria-hidden="true" tabindex="-1"></a>Setting <span class="in">`prior = TRUE`</span> performs Bayesian planning using a default prior conjugate to the specified <span class="in">`likelihood`</span> (i.e., a beta-binomial prior). Because this is a Bayesian analysis, the following statistical model is specified:</span>
<span id="cb106-140"><a href="#cb106-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-141"><a href="#cb106-141" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb106-142"><a href="#cb106-142" aria-hidden="true" tabindex="-1"></a>  k &amp;\sim \text{Hypergeometric}(n, N, K) <span class="sc">\\</span></span>
<span id="cb106-143"><a href="#cb106-143" aria-hidden="true" tabindex="-1"></a>  K &amp;\sim \text{Beta-binomial}(N, \alpha, \beta)</span>
<span id="cb106-144"><a href="#cb106-144" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb106-145"><a href="#cb106-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-146"><a href="#cb106-146" aria-hidden="true" tabindex="-1"></a>The beta-binomial prior distribution is the conjugate prior for to the hypergeometric likelihood (see this <span class="co">[</span><span class="ot">list</span><span class="co">](https://en.wikipedia.org/wiki/Conjugate_prior#Table_of_conjugate_distributions)</span> of conjugate priors), which means that the posterior distribution of $K$ can be determined analytically. For example, if the prior distribution for $K$ is:</span>
<span id="cb106-147"><a href="#cb106-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-148"><a href="#cb106-148" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-149"><a href="#cb106-149" aria-hidden="true" tabindex="-1"></a>  K \sim \text{Beta-binomial}(N, \alpha, \beta) \,\,\,\,\,\,\,\,\,\, K = 0, \ldots, N</span>
<span id="cb106-150"><a href="#cb106-150" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-151"><a href="#cb106-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-152"><a href="#cb106-152" aria-hidden="true" tabindex="-1"></a>and the auditor has observed a sample of $n$ items containing $k$ misstatements, then the posterior distribution for $K$ is:</span>
<span id="cb106-153"><a href="#cb106-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-154"><a href="#cb106-154" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-155"><a href="#cb106-155" aria-hidden="true" tabindex="-1"></a>  K \sim \text{Beta-binomial}(N - n, \alpha + k, \beta + k - n) \,\,\,\,\,\,\,\,\,\, K = k, k + 1, \ldots, N - n + k.</span>
<span id="cb106-156"><a href="#cb106-156" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-157"><a href="#cb106-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-158"><a href="#cb106-158" aria-hidden="true" tabindex="-1"></a><span class="fu">#### No Expected Misstatements</span></span>
<span id="cb106-159"><a href="#cb106-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-160"><a href="#cb106-160" aria-hidden="true" tabindex="-1"></a>Planning for no expected misstatements in the sample can be done by setting the value for the <span class="in">`expected`</span> argument to zero. If we want to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.1$ in a population of $N = 20$ items, then the required sample size under the assumption of zero expected misstatements in the sample is $n = 15$. The command below uses a default beta-binomial($N$, 1, 1) prior distribution to plan this sample, since <span class="in">`planning()`</span> is given the hypergeometric likelihood.</span>
<span id="cb106-161"><a href="#cb106-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-164"><a href="#cb106-164" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-165"><a href="#cb106-165" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.1</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">20</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-166"><a href="#cb106-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-167"><a href="#cb106-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-168"><a href="#cb106-168" aria-hidden="true" tabindex="-1"></a>The <span class="in">`summary()`</span> function can be used to obatain relevant information about the planning.</span>
<span id="cb106-169"><a href="#cb106-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-172"><a href="#cb106-172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-173"><a href="#cb106-173" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span>
<span id="cb106-174"><a href="#cb106-174" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-175"><a href="#cb106-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-176"><a href="#cb106-176" aria-hidden="true" tabindex="-1"></a>You can inspect how the prior distribution compares to the expected posterior distribution by using the <span class="in">`plot()`</span> function, see @fig-planning-bbinom-nomis. The expected posterior distribution is the posterior distribution that would occur if you actually observed the planned sample containing the expected misstatements. Note that the posterior distribution is only defined in the range <span class="co">[</span><span class="ot">$k$; $N - n + k$</span><span class="co">]</span>, since a part of the population has already been seen.</span>
<span id="cb106-177"><a href="#cb106-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-178"><a href="#cb106-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-bbinom-nomis", fig.cap="The beta-binomial prior and posterior distribution on the range [$k$; $N - n + k$] after seeing no misstatements in the sample."}</span></span>
<span id="cb106-179"><a href="#cb106-179" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb106-180"><a href="#cb106-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-181"><a href="#cb106-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-182"><a href="#cb106-182" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Expected Misstatements</span></span>
<span id="cb106-183"><a href="#cb106-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-184"><a href="#cb106-184" aria-hidden="true" tabindex="-1"></a>Planning for expected misstatements in the sample can be done by setting the value for the <span class="in">`expected`</span> argument to a different value than zero. For example, the code below calculates the minimum sample size to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.1$ in a population of $N = 50$ items, given one expected misstatement in the sample. This sample size is $n = 32$.</span>
<span id="cb106-185"><a href="#cb106-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-188"><a href="#cb106-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-189"><a href="#cb106-189" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.1</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">50</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-190"><a href="#cb106-190" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb106-191"><a href="#cb106-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-192"><a href="#cb106-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-193"><a href="#cb106-193" aria-hidden="true" tabindex="-1"></a>Like before, you can inspect how the prior distribution compares to the expected posterior distribution by using the <span class="in">`plot()`</span> function, see @fig-planning-bbinom-mis below for the output of this call.</span>
<span id="cb106-194"><a href="#cb106-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-195"><a href="#cb106-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-bbinom-mis", fig.cap="The beta-binomial prior and posterior distribution on the range [$k$; $N - n + k$] after seeing one misstatement in the sample."}</span></span>
<span id="cb106-196"><a href="#cb106-196" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb106-197"><a href="#cb106-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-198"><a href="#cb106-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-199"><a href="#cb106-199" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Binomial Likelihood</span></span>
<span id="cb106-200"><a href="#cb106-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-201"><a href="#cb106-201" aria-hidden="true" tabindex="-1"></a>The binomial distribution is a discrete probability distribution that is commonly used to model the number of events occurring in a fixed number of trials. It is similar to the hypergeometric distribution, however, it assumes that samples are drawn from the population with replacement. For our purpose, we can use the binomial distribution as a likelihood to model the number of misstatements that are expected to be found in the sample. </span>
<span id="cb106-202"><a href="#cb106-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-203"><a href="#cb106-203" aria-hidden="true" tabindex="-1"></a>In audit sampling, the binomial likelihood is often used to approximate the hypergeometric likelihood since it is easier to work with (i.e., it only has two parameters: $\theta$ and $n$, while the hypergeometric has three: $n$, $N$, and $K$). However, the binomial likelihood is more conservative than the hypergeometric likelihood, meaning that resulting sample sizes will be higher.</span>
<span id="cb106-204"><a href="#cb106-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-205"><a href="#cb106-205" aria-hidden="true" tabindex="-1"></a>The probability mass function (PMF) of the binomial distribution is given by:</span>
<span id="cb106-206"><a href="#cb106-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-207"><a href="#cb106-207" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-208"><a href="#cb106-208" aria-hidden="true" tabindex="-1"></a>  p(k; n, \theta) = \binom{n}{k} \theta^{k} (1-\theta)^{n - k},</span>
<span id="cb106-209"><a href="#cb106-209" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-210"><a href="#cb106-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-211"><a href="#cb106-211" aria-hidden="true" tabindex="-1"></a>where $k$ is the number of misstatements in the sample, $n$ is the sample size and $\theta$ is the probability of misstatement in the population. Let's consider how to use the binomial likelihood to calculate the minimum sample size needed to reduce the sampling risk to an appropriately low level.</span>
<span id="cb106-212"><a href="#cb106-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-213"><a href="#cb106-213" aria-hidden="true" tabindex="-1"></a><span class="fu">### Classical Planning</span></span>
<span id="cb106-214"><a href="#cb106-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-215"><a href="#cb106-215" aria-hidden="true" tabindex="-1"></a>In classical planning using the binomial likelihood, the following statistical model is specified:</span>
<span id="cb106-216"><a href="#cb106-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-217"><a href="#cb106-217" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-218"><a href="#cb106-218" aria-hidden="true" tabindex="-1"></a>  k \sim \text{Binomial}(n, \theta_{max})</span>
<span id="cb106-219"><a href="#cb106-219" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-220"><a href="#cb106-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-221"><a href="#cb106-221" aria-hidden="true" tabindex="-1"></a><span class="fu">#### No Expected Misstatements</span></span>
<span id="cb106-222"><a href="#cb106-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-223"><a href="#cb106-223" aria-hidden="true" tabindex="-1"></a>If the auditor does not expect any misstatements in the sample, they can set $k = 0$, which consequently determines how the sample size can be calculated. Given a performance materiality $\theta_{max}$, we can solve for the minimum sample size $n$ needed to reduce the sampling risk to an appropriately low level. A useful trick to utilize is that, if we do not expect any misstatements in the sample, the formula for the minimum required sample size reduces to:</span>
<span id="cb106-224"><a href="#cb106-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-225"><a href="#cb106-225" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-226"><a href="#cb106-226" aria-hidden="true" tabindex="-1"></a>  n = \lceil\frac{\ln(\alpha)}{\ln(1 - \theta_{max})}\rceil.</span>
<span id="cb106-227"><a href="#cb106-227" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-228"><a href="#cb106-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-229"><a href="#cb106-229" aria-hidden="true" tabindex="-1"></a>For example, if we want to achieve an assurance level of 95 percent ($\alpha=0.05$) for a performance materiality of $\theta_{max} = 0.03$, then the required sample size under the assumption of zero expected misstatements in the sample is $n = 99$.</span>
<span id="cb106-230"><a href="#cb106-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-233"><a href="#cb106-233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-234"><a href="#cb106-234" aria-hidden="true" tabindex="-1"></a><span class="fu">ceiling</span>(<span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.95</span>) <span class="sc">/</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.03</span>))</span>
<span id="cb106-235"><a href="#cb106-235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-236"><a href="#cb106-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-237"><a href="#cb106-237" aria-hidden="true" tabindex="-1"></a>In **jfa**, this sample size can be replicated using the following code:</span>
<span id="cb106-238"><a href="#cb106-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-241"><a href="#cb106-241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-242"><a href="#cb106-242" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb106-243"><a href="#cb106-243" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb106-244"><a href="#cb106-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-245"><a href="#cb106-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-246"><a href="#cb106-246" aria-hidden="true" tabindex="-1"></a>The sample size of 99 can be confirmed by checking that 99 is the minimum integer that results in less than 5 percent probability of finding 0 misstatements, given the assumption that the population misstatement is truly 3 percent. The <span class="in">`dbinom()`</span> function calculates the probability of observing $k$ missatements in a sample of $n$ items given an assumed misstatement probability $\theta_{max}$. By calculating this probability for $n = 98$, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk $\alpha$.</span>
<span id="cb106-247"><a href="#cb106-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-250"><a href="#cb106-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-251"><a href="#cb106-251" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">98</span>, <span class="at">prob =</span> <span class="fl">0.03</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb106-252"><a href="#cb106-252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-253"><a href="#cb106-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-254"><a href="#cb106-254" aria-hidden="true" tabindex="-1"></a>However, for $n = 99$ the relevant probability is lower than the sampling risk $\alpha$ and thus the sample size is considered to be sufficient.</span>
<span id="cb106-255"><a href="#cb106-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-258"><a href="#cb106-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-259"><a href="#cb106-259" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">99</span>, <span class="at">prob =</span> <span class="fl">0.03</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb106-260"><a href="#cb106-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-261"><a href="#cb106-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-262"><a href="#cb106-262" aria-hidden="true" tabindex="-1"></a>We can make this sample size visually intuitive by showing the binomial($k$ | 99, 0.03) distribution and highlighting the probability for $k = 0$, see @fig-planning-binom-nomis. This probability is lower than the required sampling risk $\alpha = 0.05$.</span>
<span id="cb106-263"><a href="#cb106-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-264"><a href="#cb106-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-binom-nomis", fig.cap="The binomial($k$ | 99, 0.03) distribution showing the probability for $k = 0$ misstatement as a red bar."}</span></span>
<span id="cb106-265"><a href="#cb106-265" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb106-266"><a href="#cb106-266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-267"><a href="#cb106-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-268"><a href="#cb106-268" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Expected Misstatementss</span></span>
<span id="cb106-269"><a href="#cb106-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-270"><a href="#cb106-270" aria-hidden="true" tabindex="-1"></a>However, if the number of expected misstatements in the sample is non-zero, it becomes more difficult to solve the formula for $n$. Hence, they will need to set $k$ to a different integer value, which consequently determines how the sample size is calculated. Here, we can iteratively try every value of $n$ and return the smallest integer that satisfies the sampling objectives.</span>
<span id="cb106-271"><a href="#cb106-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-272"><a href="#cb106-272" aria-hidden="true" tabindex="-1"></a>In **jfa**, this can be done by adjusting the <span class="in">`expected`</span> argument in the <span class="in">`planning()`</span> function. For example, if we want to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.03$, then the required sample size under the assumption of one expected misstatement in the sample is $n = 157$.</span>
<span id="cb106-273"><a href="#cb106-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-276"><a href="#cb106-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-277"><a href="#cb106-277" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb106-278"><a href="#cb106-278" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-279"><a href="#cb106-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-280"><a href="#cb106-280" aria-hidden="true" tabindex="-1"></a>Once again, the sample size of 157 can be confirmed by checking that 157 is the minimum integer that results in less than 5 percent probability of finding 0 or 1 misstatements, given the assumption that the population misstatement is truly 3 percent. By calculating this probability for $n = 156$, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk $\alpha$.</span>
<span id="cb106-281"><a href="#cb106-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-284"><a href="#cb106-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-285"><a href="#cb106-285" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dbinom</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">156</span>, <span class="at">prob =</span> <span class="fl">0.03</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb106-286"><a href="#cb106-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-287"><a href="#cb106-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-288"><a href="#cb106-288" aria-hidden="true" tabindex="-1"></a>However, for $n = 157$ the relevant probability is lower than the sampling risk $\alpha$ and thus the sample size is considered to be sufficient.</span>
<span id="cb106-289"><a href="#cb106-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-292"><a href="#cb106-292" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-293"><a href="#cb106-293" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dbinom</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">157</span>, <span class="at">prob =</span> <span class="fl">0.03</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb106-294"><a href="#cb106-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-295"><a href="#cb106-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-296"><a href="#cb106-296" aria-hidden="true" tabindex="-1"></a>Like before, we can make this sample size visually intuitive by showing the binomial($k$ | 157, 0.03) distribution and highlighting the probabilities for $k = 0$ and $k = 1$, see @fig-planning-binom-mis. The sum of these probabilities is lower than the required sampling risk $\alpha = 0.05$.</span>
<span id="cb106-297"><a href="#cb106-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-298"><a href="#cb106-298" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-binom-mis", fig.cap="The binomial($k$ | 157, 0.03) distribution showing the probability for $k = 0$ and $k=1$ misstatements as a red bar."}</span></span>
<span id="cb106-299"><a href="#cb106-299" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb106-300"><a href="#cb106-300" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-301"><a href="#cb106-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-302"><a href="#cb106-302" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Expected Misstatement Rate</span></span>
<span id="cb106-303"><a href="#cb106-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-304"><a href="#cb106-304" aria-hidden="true" tabindex="-1"></a>When the expected misstatement rate in the sample $\theta_{exp}$ is assessed, the value for $k$ can be determined as $k = n\theta_{exp}$, which consequently determines how the sample size can be calculated.</span>
<span id="cb106-305"><a href="#cb106-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-306"><a href="#cb106-306" aria-hidden="true" tabindex="-1"></a>To account for the fact that $k$ can have non-integer values in this case, we can use a well-known similarity between the binomial distribution and the beta distribution to plan the sample size. The upper bound for any binomial($k$; $n$, $\theta$) distributed variable can also be obtained via percentiles of the beta($1 + k$, $n - k$) distribution. </span>
<span id="cb106-307"><a href="#cb106-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-308"><a href="#cb106-308" aria-hidden="true" tabindex="-1"></a>For example, the upper bound for a sample of $n = 10$ items containing $k = 2$ misstatements, when calculated via the traditional <span class="in">`binom.test()`</span> is:</span>
<span id="cb106-309"><a href="#cb106-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-312"><a href="#cb106-312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-313"><a href="#cb106-313" aria-hidden="true" tabindex="-1"></a>ub_binom <span class="ot">&lt;-</span> <span class="fu">binom.test</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">p =</span> <span class="fl">0.03</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">alternative =</span> <span class="st">"less"</span>)<span class="sc">$</span>conf.int[<span class="dv">2</span>]</span>
<span id="cb106-314"><a href="#cb106-314" aria-hidden="true" tabindex="-1"></a>ub_binom</span>
<span id="cb106-315"><a href="#cb106-315" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-316"><a href="#cb106-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-317"><a href="#cb106-317" aria-hidden="true" tabindex="-1"></a>When calculated via the beta relationship, the upper bound is:</span>
<span id="cb106-318"><a href="#cb106-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-321"><a href="#cb106-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-322"><a href="#cb106-322" aria-hidden="true" tabindex="-1"></a>ub_beta <span class="ot">&lt;-</span> <span class="fu">qbeta</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">shape1 =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span>, <span class="at">shape2 =</span> <span class="dv">10</span> <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb106-323"><a href="#cb106-323" aria-hidden="true" tabindex="-1"></a>ub_beta</span>
<span id="cb106-324"><a href="#cb106-324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-325"><a href="#cb106-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-326"><a href="#cb106-326" aria-hidden="true" tabindex="-1"></a>It can be validated that the two approaches result in the same upper bound via:</span>
<span id="cb106-327"><a href="#cb106-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-330"><a href="#cb106-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-331"><a href="#cb106-331" aria-hidden="true" tabindex="-1"></a>ub_binom <span class="sc">==</span> ub_beta</span>
<span id="cb106-332"><a href="#cb106-332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-333"><a href="#cb106-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-334"><a href="#cb106-334" aria-hidden="true" tabindex="-1"></a>This relationship between the binomial likelihood and the beta distribution is deliberately **not** used in **jfa**. That is because, in the case of the binomial distribution, the auditing standards round the tolerable misstatements upwards to a whole number. For example, if we try to call the `planning()` function with the argument `expected = 1.5`, **jfa** will internally convert this to <span class="in">`expected = 2`</span> and base the sample size on this in order to stay compliant with @AICPA-A. The resulting sample size is $n = 208$ in this case.</span>
<span id="cb106-335"><a href="#cb106-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-338"><a href="#cb106-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-339"><a href="#cb106-339" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="fl">1.5</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb106-340"><a href="#cb106-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-341"><a href="#cb106-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-342"><a href="#cb106-342" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayesian Planning</span></span>
<span id="cb106-343"><a href="#cb106-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-344"><a href="#cb106-344" aria-hidden="true" tabindex="-1"></a>Performing Bayesian planning using the binomial likelihood requires that you specify a prior distribution for the parameter $\theta$. Practically, this means that you should provide an input for the <span class="in">`prior`</span> argument in the <span class="in">`planning()`</span> function.</span>
<span id="cb106-345"><a href="#cb106-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-346"><a href="#cb106-346" aria-hidden="true" tabindex="-1"></a>Setting <span class="in">`prior = TRUE`</span> performs Bayesian planning using a default prior conjugate to the specified <span class="in">`likelihood`</span> (i.e., a beta prior). Because this is a Bayesian analysis, the following statistical model is specified:</span>
<span id="cb106-347"><a href="#cb106-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-348"><a href="#cb106-348" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb106-349"><a href="#cb106-349" aria-hidden="true" tabindex="-1"></a>  k &amp;\sim \text{Binomial}(n, \theta) <span class="sc">\\</span></span>
<span id="cb106-350"><a href="#cb106-350" aria-hidden="true" tabindex="-1"></a>  \theta &amp;\sim \text{Beta}(\alpha, \beta)</span>
<span id="cb106-351"><a href="#cb106-351" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb106-352"><a href="#cb106-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-353"><a href="#cb106-353" aria-hidden="true" tabindex="-1"></a>The beta prior distribution is the conjugate prior for the binomial likelihood (see this <span class="co">[</span><span class="ot">list</span><span class="co">](https://en.wikipedia.org/wiki/Conjugate_prior#Table_of_conjugate_distributions)</span> of conjugate priors), which means that the posterior distribution of $\theta$ can be determined analytically. For example, if the prior distribution for $\theta$ is:</span>
<span id="cb106-354"><a href="#cb106-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-355"><a href="#cb106-355" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-356"><a href="#cb106-356" aria-hidden="true" tabindex="-1"></a>  \theta \sim \text{Beta}(\alpha, \beta) \,\,\,\,\,\,\,\,\,\, \theta \in <span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span></span>
<span id="cb106-357"><a href="#cb106-357" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-358"><a href="#cb106-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-359"><a href="#cb106-359" aria-hidden="true" tabindex="-1"></a>and the auditor has observed a sample of $n$ items containing $k$ misstatements, then the posterior distribution for $\theta$ is:</span>
<span id="cb106-360"><a href="#cb106-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-361"><a href="#cb106-361" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-362"><a href="#cb106-362" aria-hidden="true" tabindex="-1"></a>  \theta \sim \text{Beta}(\alpha + k, \beta + n - k) \,\,\,\,\,\,\,\,\,\, \theta \in <span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span>.</span>
<span id="cb106-363"><a href="#cb106-363" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-364"><a href="#cb106-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-365"><a href="#cb106-365" aria-hidden="true" tabindex="-1"></a>For example, the command below uses a default beta($\alpha=1$, $\beta=1$) prior distribution to plan the sample, since <span class="in">`planning()`</span> is given the binomial likelihood. If we want to achieve an assurance level of 95 percent ($\alpha=0.05$) for a performance materiality of $\theta_{max} = 0.03$, then the required sample size under the assumption of zero expected misstatements in the sample is $n = 98$.</span>
<span id="cb106-366"><a href="#cb106-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-369"><a href="#cb106-369" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-370"><a href="#cb106-370" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-371"><a href="#cb106-371" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-372"><a href="#cb106-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-373"><a href="#cb106-373" aria-hidden="true" tabindex="-1"></a>The <span class="in">`summary()`</span> function can be used to obatain relevant information about the planning.</span>
<span id="cb106-374"><a href="#cb106-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-377"><a href="#cb106-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-378"><a href="#cb106-378" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span>
<span id="cb106-379"><a href="#cb106-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-380"><a href="#cb106-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-381"><a href="#cb106-381" aria-hidden="true" tabindex="-1"></a>You can inspect how the prior distribution compares to the expected posterior distribution by using the <span class="in">`plot()`</span> function, see @fig-planning-beta-nomis. The expected posterior distribution is the posterior distribution that would occur if you actually observed the planned sample containing the expected misstatements.</span>
<span id="cb106-382"><a href="#cb106-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-383"><a href="#cb106-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-beta-nomis", fig.cap="The beta prior and posterior distribution on the range [0; 1] after seeing no misstatements in the sample of 98 units."}</span></span>
<span id="cb106-384"><a href="#cb106-384" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb106-385"><a href="#cb106-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-386"><a href="#cb106-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-387"><a href="#cb106-387" aria-hidden="true" tabindex="-1"></a>The input for the <span class="in">`prior`</span> argument can also be an object created by the <span class="in">`auditPrior`</span> function. If <span class="in">`planning()`</span> receives a prior for which there is no conjugate likelihood available, it will numerically derive the posterior distribution. For example, the command below uses a Normal(0, 0.05) prior distribution to plan the sample using the binomial likelihood. Because this is a Bayesian analysis, the following statistical model is specified:</span>
<span id="cb106-388"><a href="#cb106-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-389"><a href="#cb106-389" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb106-390"><a href="#cb106-390" aria-hidden="true" tabindex="-1"></a>  k &amp;\sim \text{Binomial}(n, \theta) <span class="sc">\\</span></span>
<span id="cb106-391"><a href="#cb106-391" aria-hidden="true" tabindex="-1"></a>  \theta &amp;\sim \text{Normal}(\mu = 0, \sigma = 0.05)</span>
<span id="cb106-392"><a href="#cb106-392" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb106-393"><a href="#cb106-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-396"><a href="#cb106-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-397"><a href="#cb106-397" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"normal"</span>, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">beta =</span> <span class="fl">0.05</span>)</span>
<span id="cb106-398"><a href="#cb106-398" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>, <span class="at">prior =</span> prior)</span>
<span id="cb106-399"><a href="#cb106-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-400"><a href="#cb106-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-401"><a href="#cb106-401" aria-hidden="true" tabindex="-1"></a>The <span class="in">`summary()`</span> function can be used to obatain relevant information about the planning.</span>
<span id="cb106-402"><a href="#cb106-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-405"><a href="#cb106-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-406"><a href="#cb106-406" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span>
<span id="cb106-407"><a href="#cb106-407" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-408"><a href="#cb106-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-409"><a href="#cb106-409" aria-hidden="true" tabindex="-1"></a>The resulting sample size under this prior is $n = 90$, a reduction of 8 samples when compared to the default beta(1, 1) prior distribution. @fig-planning-beta-nomis2 shows this prior and posterior distribution.</span>
<span id="cb106-410"><a href="#cb106-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-411"><a href="#cb106-411" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-beta-nomis2", fig.cap="The beta prior distributions in this example contains risk-reducing information. The posterior distribution has roughly the same upper bound as the one in the previous exxample and occurs after seeing no misstatements in the sample of 90 units."}</span></span>
<span id="cb106-412"><a href="#cb106-412" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb106-413"><a href="#cb106-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-414"><a href="#cb106-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-415"><a href="#cb106-415" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Poisson Likelihood</span></span>
<span id="cb106-416"><a href="#cb106-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-417"><a href="#cb106-417" aria-hidden="true" tabindex="-1"></a>The Poisson distribution is a discrete probability distribution that is commonly used to model the number of events occurring in a fixed time or space. We can use the Poisson distribution as a likelihood to model the number of misstatements that are expected to be found in the sample.</span>
<span id="cb106-418"><a href="#cb106-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-419"><a href="#cb106-419" aria-hidden="true" tabindex="-1"></a>In audit sampling, the Poisson likelihood is often used to approximate the binomial likelihood since it is easier to work with (i.e., it only has one parameter: $\lambda$, while the binomial has two parameters: $\theta$ and $n$). However, the Poisson likelihood is more conservative than the binomial likelihood, meaning that resulting sample sizes will be higher.</span>
<span id="cb106-420"><a href="#cb106-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-421"><a href="#cb106-421" aria-hidden="true" tabindex="-1"></a>The probability mass function (PMF) of the Poisson distribution is given by:</span>
<span id="cb106-422"><a href="#cb106-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-423"><a href="#cb106-423" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-424"><a href="#cb106-424" aria-hidden="true" tabindex="-1"></a>  p(k; \lambda) = \frac{\lambda^k e^{-\lambda}}{k!},</span>
<span id="cb106-425"><a href="#cb106-425" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-426"><a href="#cb106-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-427"><a href="#cb106-427" aria-hidden="true" tabindex="-1"></a>where $k$ is the number of misstatements in the sample, and $\lambda$ is the average number of misstatements expected in the sample. The average number of misstatements is related to the misstatement rate in the population, denoted by $\theta$, and the sample size, $n$, by the following equation:</span>
<span id="cb106-428"><a href="#cb106-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-429"><a href="#cb106-429" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-430"><a href="#cb106-430" aria-hidden="true" tabindex="-1"></a>  \lambda = n \theta.</span>
<span id="cb106-431"><a href="#cb106-431" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-432"><a href="#cb106-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-433"><a href="#cb106-433" aria-hidden="true" tabindex="-1"></a>Let's consider how to use the Poisson likelihood to calculate the minimum sample size needed to reduce the sampling risk to an appropriately low level.</span>
<span id="cb106-434"><a href="#cb106-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-435"><a href="#cb106-435" aria-hidden="true" tabindex="-1"></a><span class="fu">### Classical planning</span></span>
<span id="cb106-436"><a href="#cb106-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-437"><a href="#cb106-437" aria-hidden="true" tabindex="-1"></a>In classical planning using the Poisson likelihood, the following statistical model is specified:</span>
<span id="cb106-438"><a href="#cb106-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-439"><a href="#cb106-439" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-440"><a href="#cb106-440" aria-hidden="true" tabindex="-1"></a>  k \sim \text{Poisson}(n \theta_{max})</span>
<span id="cb106-441"><a href="#cb106-441" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-442"><a href="#cb106-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-443"><a href="#cb106-443" aria-hidden="true" tabindex="-1"></a><span class="fu">#### No Expected Misstatements</span></span>
<span id="cb106-444"><a href="#cb106-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-445"><a href="#cb106-445" aria-hidden="true" tabindex="-1"></a>Given the performance materiality $\theta_{max}$ and the Poisson likelihood, we can solve for the minimum sample size $n$ needed to reduce the sampling risk to an appropriately low level. A useful trick to utilize is that, if we do not expect any misstatements in the sample, the formula for the required sample size reduces to:</span>
<span id="cb106-446"><a href="#cb106-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-447"><a href="#cb106-447" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-448"><a href="#cb106-448" aria-hidden="true" tabindex="-1"></a>  n = \lceil-\frac{\ln(\alpha)}{\theta_{max}}\rceil.</span>
<span id="cb106-449"><a href="#cb106-449" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-450"><a href="#cb106-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-451"><a href="#cb106-451" aria-hidden="true" tabindex="-1"></a>For example, if we want to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.03$, then the required sample size under the assumption of zero expected misstatements in the sample is $n = 100$.</span>
<span id="cb106-452"><a href="#cb106-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-455"><a href="#cb106-455" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-456"><a href="#cb106-456" aria-hidden="true" tabindex="-1"></a><span class="fu">ceiling</span>(<span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.95</span>) <span class="sc">/</span> <span class="fl">0.03</span>)</span>
<span id="cb106-457"><a href="#cb106-457" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-458"><a href="#cb106-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-459"><a href="#cb106-459" aria-hidden="true" tabindex="-1"></a>In **jfa**, this sample size can be replicated using the following code:</span>
<span id="cb106-460"><a href="#cb106-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-463"><a href="#cb106-463" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-464"><a href="#cb106-464" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>)</span>
<span id="cb106-465"><a href="#cb106-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-466"><a href="#cb106-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-467"><a href="#cb106-467" aria-hidden="true" tabindex="-1"></a>The sample size of 100 can be confirmed by checking that 100 is the minimum integer that results in less than 5 percent probability of finding 0 misstatements, given the assumption that the population misstatement is truly 3 percent. The <span class="in">`dpois()`</span> function calculates the probability of observing $k$ missatements in a sample of $n$ items given an assumed misstatement probability $\theta_{max}$. By calculating this probability for $n = 99$, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk $\alpha$.</span>
<span id="cb106-468"><a href="#cb106-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-471"><a href="#cb106-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-472"><a href="#cb106-472" aria-hidden="true" tabindex="-1"></a><span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">lambda =</span> <span class="dv">99</span> <span class="sc">*</span> <span class="fl">0.03</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb106-473"><a href="#cb106-473" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-474"><a href="#cb106-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-475"><a href="#cb106-475" aria-hidden="true" tabindex="-1"></a>However, for $n = 100$ the relevant probability is lower than the sampling risk $\alpha$ and thus the sample size is considered to be sufficient.</span>
<span id="cb106-476"><a href="#cb106-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-479"><a href="#cb106-479" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-480"><a href="#cb106-480" aria-hidden="true" tabindex="-1"></a><span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">lambda =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fl">0.03</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb106-481"><a href="#cb106-481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-482"><a href="#cb106-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-483"><a href="#cb106-483" aria-hidden="true" tabindex="-1"></a>We can make this visually intuitive by showing the Poisson($k$ | 100 $\times$ 0.03) distribution and highlighting the probability for $k = 0$, see @fig-planning-pois-nomis. This probability is lower than the required sampling risk $\alpha = 0.05$.</span>
<span id="cb106-484"><a href="#cb106-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-485"><a href="#cb106-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-pois-nomis", fig.cap="The Poisson($k$ | 100 $\times$ 0.03) distribution showing the probability for $k = 0$ misstatement as a red bar."}</span></span>
<span id="cb106-486"><a href="#cb106-486" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb106-487"><a href="#cb106-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-488"><a href="#cb106-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-489"><a href="#cb106-489" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Expected Misstatements</span></span>
<span id="cb106-490"><a href="#cb106-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-491"><a href="#cb106-491" aria-hidden="true" tabindex="-1"></a>However, if the number of expected misstatements in the sample is non-zero, it becomes more difficult to solve the formula for $n$ algebraically. Hence, they will need to set $k$ to a different integer value. Next, we can iteratively try every value of $n$ and return the smallest integer that satisfies the sampling objectives.</span>
<span id="cb106-492"><a href="#cb106-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-493"><a href="#cb106-493" aria-hidden="true" tabindex="-1"></a>For example, if we want to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.03$, then the required sample size under the assumption of one expected misstatement in the sample is $n = 159$.</span>
<span id="cb106-494"><a href="#cb106-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-497"><a href="#cb106-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-498"><a href="#cb106-498" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>)</span>
<span id="cb106-499"><a href="#cb106-499" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-500"><a href="#cb106-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-501"><a href="#cb106-501" aria-hidden="true" tabindex="-1"></a>Once again, the sample size of 159 can be confirmed by checking that 159 is the minimum integer that results in less than 5 percent probability of finding 0 or 1 misstatements, given the assumption that the population misstatement is truly 3 percent. By calculating this probability for $n = 158$, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk $\alpha$.</span>
<span id="cb106-502"><a href="#cb106-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-505"><a href="#cb106-505" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-506"><a href="#cb106-506" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">lambda =</span> <span class="dv">158</span> <span class="sc">*</span> <span class="fl">0.03</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb106-507"><a href="#cb106-507" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-508"><a href="#cb106-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-509"><a href="#cb106-509" aria-hidden="true" tabindex="-1"></a>However, for $n = 159$ the relevant probability is lower than the sampling risk $\alpha$ and thus the sample size is considered to be sufficient.</span>
<span id="cb106-510"><a href="#cb106-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-513"><a href="#cb106-513" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-514"><a href="#cb106-514" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">lambda =</span> <span class="dv">159</span> <span class="sc">*</span> <span class="fl">0.03</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb106-515"><a href="#cb106-515" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-516"><a href="#cb106-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-517"><a href="#cb106-517" aria-hidden="true" tabindex="-1"></a>Like before, we can make this visually intuitive by showing the Poisson($k$ | 159 $\times$ 0.03) distribution and highlighting the probabilities for $k = 0$ and $k = 1$, see @fig-planning-pois-mis. The sum of these probabilities is lower than the required sampling risk $\alpha = 0.05$.</span>
<span id="cb106-518"><a href="#cb106-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-519"><a href="#cb106-519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-pois-mis", fig.cap="The Poisson($k$ | 159 $\times$ 0.03) distribution showing the probability for $k = 0$ and $k=1$ misstatements as a red bar."}</span></span>
<span id="cb106-520"><a href="#cb106-520" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb106-521"><a href="#cb106-521" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-522"><a href="#cb106-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-523"><a href="#cb106-523" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Expected Misstatement Rate</span></span>
<span id="cb106-524"><a href="#cb106-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-525"><a href="#cb106-525" aria-hidden="true" tabindex="-1"></a>When the expected misstatements in the sample $\theta_{exp}$ is assessed, the value for $k$ can be determined as $k = n\theta_{exp}$, which consequently determines how the sample size can be calculated.</span>
<span id="cb106-526"><a href="#cb106-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-527"><a href="#cb106-527" aria-hidden="true" tabindex="-1"></a>To account for the fact that $k$ can have non-integer values in this case, we use a well-known similarity between the Poisson distribution and the gamma distribution to plan the sample size. The upper bound for any Poisson($k$; $n \theta$) distributed variable can also be obtained via percentiles of the gamma($1 + k$, $n$) distribution. </span>
<span id="cb106-528"><a href="#cb106-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-529"><a href="#cb106-529" aria-hidden="true" tabindex="-1"></a>For example, the upper bound for a sample of $n = 10$ items containing $k = 2$</span>
<span id="cb106-530"><a href="#cb106-530" aria-hidden="true" tabindex="-1"></a>misstatements, when calculated via the traditional <span class="in">`poisson.test()`</span> is:</span>
<span id="cb106-531"><a href="#cb106-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-534"><a href="#cb106-534" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-535"><a href="#cb106-535" aria-hidden="true" tabindex="-1"></a>ub_pois <span class="ot">&lt;-</span> <span class="fu">poisson.test</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">T =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="fl">0.03</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">alternative =</span> <span class="st">"less"</span>)<span class="sc">$</span>conf.int[<span class="dv">2</span>]</span>
<span id="cb106-536"><a href="#cb106-536" aria-hidden="true" tabindex="-1"></a>ub_pois</span>
<span id="cb106-537"><a href="#cb106-537" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-538"><a href="#cb106-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-539"><a href="#cb106-539" aria-hidden="true" tabindex="-1"></a>When calculated via the relationship with the gamma distribution, the upper bound is:</span>
<span id="cb106-540"><a href="#cb106-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-543"><a href="#cb106-543" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-544"><a href="#cb106-544" aria-hidden="true" tabindex="-1"></a>ub_gamma <span class="ot">&lt;-</span> <span class="fu">qgamma</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">shape =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span>, <span class="at">rate =</span> <span class="dv">10</span>)</span>
<span id="cb106-545"><a href="#cb106-545" aria-hidden="true" tabindex="-1"></a>ub_gamma</span>
<span id="cb106-546"><a href="#cb106-546" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-547"><a href="#cb106-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-548"><a href="#cb106-548" aria-hidden="true" tabindex="-1"></a>It can be validated that the two approaches result in the same upper bound via:</span>
<span id="cb106-549"><a href="#cb106-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-552"><a href="#cb106-552" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-553"><a href="#cb106-553" aria-hidden="true" tabindex="-1"></a>ub_pois <span class="sc">==</span> ub_gamma</span>
<span id="cb106-554"><a href="#cb106-554" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-555"><a href="#cb106-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-556"><a href="#cb106-556" aria-hidden="true" tabindex="-1"></a>This relationship between the Poisson likelihood and the gamma distribution is used under the hood in **jfa**. For example, if we want to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.03$, then the required sample size under the assumption of 1.5 expected misstatements in the sample is $n = 185$.</span>
<span id="cb106-557"><a href="#cb106-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-560"><a href="#cb106-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-561"><a href="#cb106-561" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="fl">1.5</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>)</span>
<span id="cb106-562"><a href="#cb106-562" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-563"><a href="#cb106-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-564"><a href="#cb106-564" aria-hidden="true" tabindex="-1"></a>The sample size of 185 can be confirmed by checking that 185 is the minimum integer that results in less than 5 percent probability of finding a misstatement rate in the population equal to, or higher than, 3 percent. By calculating this probability for $n = 184$, we can show that this sample size is insufficient as the relevant upper bound is higher than the performance materiality $\theta_{max}$.</span>
<span id="cb106-565"><a href="#cb106-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-568"><a href="#cb106-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-569"><a href="#cb106-569" aria-hidden="true" tabindex="-1"></a><span class="fu">qgamma</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">shape =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fl">1.5</span>, <span class="at">rate =</span> <span class="dv">184</span>) <span class="sc">&lt;</span> <span class="fl">0.03</span></span>
<span id="cb106-570"><a href="#cb106-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-571"><a href="#cb106-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-572"><a href="#cb106-572" aria-hidden="true" tabindex="-1"></a>However, for $n = 185$ the relevant upper bound is lower than the performance materiality $\theta_{max}$ and thus the sample size is sufficient.</span>
<span id="cb106-573"><a href="#cb106-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-576"><a href="#cb106-576" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-577"><a href="#cb106-577" aria-hidden="true" tabindex="-1"></a><span class="fu">qgamma</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">shape =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fl">1.5</span>, <span class="at">rate =</span> <span class="dv">185</span>) <span class="sc">&lt;</span> <span class="fl">0.03</span></span>
<span id="cb106-578"><a href="#cb106-578" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-579"><a href="#cb106-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-580"><a href="#cb106-580" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayesian Planning</span></span>
<span id="cb106-581"><a href="#cb106-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-582"><a href="#cb106-582" aria-hidden="true" tabindex="-1"></a>Performing Bayesian planning with the Poisson likelihood requires that you specify a prior distribution for the parameter $\theta$. Practically, this means that you should provide an input for the <span class="in">`prior`</span> argument in the <span class="in">`planning()`</span> function.</span>
<span id="cb106-583"><a href="#cb106-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-584"><a href="#cb106-584" aria-hidden="true" tabindex="-1"></a>Setting <span class="in">`prior = TRUE`</span> performs Bayesian planning using a default prior conjugate to the specified <span class="in">`likelihood`</span> (i.e., a gamma prior). Because this is a Bayesian analysis, the following statistical model is specified:</span>
<span id="cb106-585"><a href="#cb106-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-586"><a href="#cb106-586" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb106-587"><a href="#cb106-587" aria-hidden="true" tabindex="-1"></a>  k &amp;\sim \text{Poisson}(n\theta) <span class="sc">\\</span></span>
<span id="cb106-588"><a href="#cb106-588" aria-hidden="true" tabindex="-1"></a>  \theta &amp;\sim \text{Gamma}(\alpha, \beta)</span>
<span id="cb106-589"><a href="#cb106-589" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb106-590"><a href="#cb106-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-591"><a href="#cb106-591" aria-hidden="true" tabindex="-1"></a>The gamma prior distribution is the conjugate prior for the Poisson likelihood (see this <span class="co">[</span><span class="ot">list</span><span class="co">](https://en.wikipedia.org/wiki/Conjugate_prior#Table_of_conjugate_distributions)</span> of conjugate priors), which means that the posterior distribution of $\theta$ can be determined analytically. For example, if the prior distribution for $\theta$ is:</span>
<span id="cb106-592"><a href="#cb106-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-593"><a href="#cb106-593" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-594"><a href="#cb106-594" aria-hidden="true" tabindex="-1"></a>  \theta \sim \text{Gamma}(\alpha, \beta) \,\,\,\,\,\,\,\,\,\, \theta \in <span class="co">[</span><span class="ot">0, \infty</span><span class="co">]</span></span>
<span id="cb106-595"><a href="#cb106-595" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-596"><a href="#cb106-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-597"><a href="#cb106-597" aria-hidden="true" tabindex="-1"></a>and the auditor has observed a sample of $n$ items containing $k$ misstatements, then the posterior distribution for $\theta$ is:</span>
<span id="cb106-598"><a href="#cb106-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-599"><a href="#cb106-599" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-600"><a href="#cb106-600" aria-hidden="true" tabindex="-1"></a>  \theta \sim \text{Gamma}(\alpha + k, \beta + n) \,\,\,\,\,\,\,\,\,\, \theta \in <span class="co">[</span><span class="ot">0, \infty</span><span class="co">]</span>.</span>
<span id="cb106-601"><a href="#cb106-601" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-602"><a href="#cb106-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-603"><a href="#cb106-603" aria-hidden="true" tabindex="-1"></a>For example, the command below uses a default gamma($\alpha=1$, $\beta=1$) prior distribution to plan the sample, since <span class="in">`planning()`</span> is given the Poisson likelihood. If we want to achieve an assurance level of 95 percent ($\alpha=0.05$) for a performance materiality of $\theta_{max} = 0.03$, then the required sample size under the assumption of zero expected misstatements in the sample is $n = 99$.</span>
<span id="cb106-604"><a href="#cb106-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-607"><a href="#cb106-607" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-608"><a href="#cb106-608" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-609"><a href="#cb106-609" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-610"><a href="#cb106-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-611"><a href="#cb106-611" aria-hidden="true" tabindex="-1"></a>The <span class="in">`summary()`</span> function can be used to obatain relevant information about the planning.</span>
<span id="cb106-612"><a href="#cb106-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-615"><a href="#cb106-615" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-616"><a href="#cb106-616" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span>
<span id="cb106-617"><a href="#cb106-617" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-618"><a href="#cb106-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-619"><a href="#cb106-619" aria-hidden="true" tabindex="-1"></a>You can inspect how the prior distribution compares to the expected posterior distribution by using the <span class="in">`plot()`</span> function, see @fig-planning-gamma-nomis. The expected posterior distribution is the posterior distribution that would occur if you actually observed the planned sample containing the expected misstatements.</span>
<span id="cb106-620"><a href="#cb106-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-621"><a href="#cb106-621" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-gamma-nomis", fig.cap="The gamma prior and posterior distribution on the range [0; $\\infty$] after seeing no misstatements in the sample of 99 units."}</span></span>
<span id="cb106-622"><a href="#cb106-622" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb106-623"><a href="#cb106-623" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-624"><a href="#cb106-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-625"><a href="#cb106-625" aria-hidden="true" tabindex="-1"></a>The input for the <span class="in">`prior`</span> argument can also be an object created by the <span class="in">`auditPrior`</span> function. If <span class="in">`planning()`</span> receives a prior for which there is no conjugate likelihood available, it will numerically derive the posterior distribution. For example, the command below uses a Normal(0, 0.05) prior distribution to plan the sample using the Poisson likelihood. Concretely, this means that the following statistical model is specified:</span>
<span id="cb106-626"><a href="#cb106-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-627"><a href="#cb106-627" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb106-628"><a href="#cb106-628" aria-hidden="true" tabindex="-1"></a>  k &amp;\sim \text{Poisson}(n\theta) <span class="sc">\\</span></span>
<span id="cb106-629"><a href="#cb106-629" aria-hidden="true" tabindex="-1"></a>  \theta &amp;\sim \text{Normal}(\mu = 0, \sigma = 0.05)</span>
<span id="cb106-630"><a href="#cb106-630" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb106-631"><a href="#cb106-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-634"><a href="#cb106-634" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-635"><a href="#cb106-635" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"normal"</span>, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">beta =</span> <span class="fl">0.05</span>)</span>
<span id="cb106-636"><a href="#cb106-636" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>, <span class="at">prior =</span> prior)</span>
<span id="cb106-637"><a href="#cb106-637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-638"><a href="#cb106-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-639"><a href="#cb106-639" aria-hidden="true" tabindex="-1"></a>The <span class="in">`summary()`</span> function can be used to obatain relevant information about the planning.</span>
<span id="cb106-640"><a href="#cb106-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-643"><a href="#cb106-643" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-644"><a href="#cb106-644" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span>
<span id="cb106-645"><a href="#cb106-645" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-646"><a href="#cb106-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-647"><a href="#cb106-647" aria-hidden="true" tabindex="-1"></a>The resulting sample size under this prior is $n = 91$, a reduction of 8 samples when compared to the default gamma(1, 1) prior. @fig-planning-gamma-nomis2 shows this prior and posterior distribution.</span>
<span id="cb106-648"><a href="#cb106-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-649"><a href="#cb106-649" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-gamma-nomis2", fig.cap="The gamma prior distributions in this example contains risk-reducing information. The posterior distribution has roughly the same upper bound as the one in the previous exxample and occurs after seeing no misstatements in the sample of 91 units."}</span></span>
<span id="cb106-650"><a href="#cb106-650" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb106-651"><a href="#cb106-651" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-652"><a href="#cb106-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-653"><a href="#cb106-653" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prior Distributions</span></span>
<span id="cb106-654"><a href="#cb106-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-655"><a href="#cb106-655" aria-hidden="true" tabindex="-1"></a>In principle, any distribution that covers the range of $\theta$ can be used as a prior distribution. However, some distributions are more suitable than others. For instance, the beta-binomial, beta and gamma distributions are all commonly used because they are so-called conjugate distributions, that is, they stay in the same family when updated by the data. The **jfa** package provides the ability to construct a prior distribution for audit sampling. More specifically, the <span class="in">`auditPrior()`</span> function is used to specify a prior distribution that can be used as input for the <span class="in">`prior`</span> argument in the <span class="in">`planning()`</span> (and <span class="in">`evaluation()`</span>) function. Below is an enumeration of the several ways that a prior distribution can be constructed using the <span class="in">`auditPrior`</span> function.</span>
<span id="cb106-656"><a href="#cb106-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-657"><a href="#cb106-657" aria-hidden="true" tabindex="-1"></a><span class="fu">### Default Prior</span></span>
<span id="cb106-658"><a href="#cb106-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-659"><a href="#cb106-659" aria-hidden="true" tabindex="-1"></a>The default prior distributions are created using <span class="in">`method = 'default'`</span>. There are no explicit rules for what constitutes a default prior. However, **jfa**'s default priors satisfy two criteria: 1) they contain relatively little information about the population misstatement and 2) they are proper (i.e., they integrate to 1). For completeness, all default priors in **jfa** are provided in the following list.</span>
<span id="cb106-660"><a href="#cb106-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-661"><a href="#cb106-661" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'poisson'`</span>: gamma($\alpha$ = 1, $\beta$ = 1)</span>
<span id="cb106-662"><a href="#cb106-662" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'binomial'`</span>: beta($\alpha$ = 1, $\beta$ = 1)</span>
<span id="cb106-663"><a href="#cb106-663" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'hypergeometric'`</span>: beta-binomial(N, $\alpha$ = 1, $\beta$ = 1)</span>
<span id="cb106-664"><a href="#cb106-664" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'normal'`</span>: normal($\mu$ = 0, $\sigma$ = 1000)</span>
<span id="cb106-665"><a href="#cb106-665" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'uniform'`</span>: uniform(min = 0, max = 1) </span>
<span id="cb106-666"><a href="#cb106-666" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'cauchy'`</span>: Cauchy($x_0$ = 0, $\gamma$ = 1000)</span>
<span id="cb106-667"><a href="#cb106-667" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 't'`</span>: Student-t(df = 1)</span>
<span id="cb106-668"><a href="#cb106-668" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'chisq'`</span>: chi-squared(df = 1)</span>
<span id="cb106-669"><a href="#cb106-669" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'exponential'`</span>: exponential($\lambda$ = 1)</span>
<span id="cb106-670"><a href="#cb106-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-671"><a href="#cb106-671" aria-hidden="true" tabindex="-1"></a>For instance, to create a default prior distribution using the binomial likelihood (i.e., a beta(1, 1) prior), you can use the following code that creates a prior distribution and stores it in the <span class="in">`prior`</span> object. You can then use the <span class="in">`summary()`</span> function to obtain relevant information about the prior distribution.</span>
<span id="cb106-672"><a href="#cb106-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-675"><a href="#cb106-675" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-676"><a href="#cb106-676" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"default"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb106-677"><a href="#cb106-677" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(prior)</span>
<span id="cb106-678"><a href="#cb106-678" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-679"><a href="#cb106-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-680"><a href="#cb106-680" aria-hidden="true" tabindex="-1"></a>All prior distributions can be visually inspected via the <span class="in">`plot()`</span> function, see @fig-planning-prior-default.</span>
<span id="cb106-681"><a href="#cb106-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-682"><a href="#cb106-682" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-prior-default", fig.cap="The default beta(1, 1) prior distribution."}</span></span>
<span id="cb106-683"><a href="#cb106-683" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span>
<span id="cb106-684"><a href="#cb106-684" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-685"><a href="#cb106-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-686"><a href="#cb106-686" aria-hidden="true" tabindex="-1"></a>Furthermore, the <span class="in">`predict()`</span> function produces the predictions of the prior distribution on the data level for a sample of <span class="in">`n`</span> items. For example, the command below requests the prediction of the default beta(1, 1) prior for a hypothetical sample of 6 items.</span>
<span id="cb106-687"><a href="#cb106-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-690"><a href="#cb106-690" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-691"><a href="#cb106-691" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(prior, <span class="at">n =</span> <span class="dv">6</span>)</span>
<span id="cb106-692"><a href="#cb106-692" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-693"><a href="#cb106-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-694"><a href="#cb106-694" aria-hidden="true" tabindex="-1"></a>The predictions of the prior distribution can be visualized using the <span class="in">`plot()`</span> function, see @fig-planning-prior-predict.</span>
<span id="cb106-695"><a href="#cb106-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-696"><a href="#cb106-696" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-prior-predict", fig.cap="The predictions of the beta(1, 1) prior distribution concerming the possible misstatements in an an intended sample of $n=6$."}</span></span>
<span id="cb106-697"><a href="#cb106-697" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predict</span>(prior, <span class="at">n =</span> <span class="dv">10</span>))</span>
<span id="cb106-698"><a href="#cb106-698" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-699"><a href="#cb106-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-700"><a href="#cb106-700" aria-hidden="true" tabindex="-1"></a><span class="fu">### Parametric Prior</span></span>
<span id="cb106-701"><a href="#cb106-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-702"><a href="#cb106-702" aria-hidden="true" tabindex="-1"></a>You can manually specify the parameters of the prior distribution with <span class="in">`method = 'param'`</span> and the <span class="in">`alpha`</span> and <span class="in">`beta`</span> arguments, which correspond to the first and (optionally) second parameter of the prior as described above. For example, the commands below create a beta(2, 10) prior distribution, a normal(0.025, 0.05) prior distribution and a Student-t(0.01) prior distribution.</span>
<span id="cb106-703"><a href="#cb106-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-706"><a href="#cb106-706" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-707"><a href="#cb106-707" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">alpha =</span> <span class="dv">2</span>, <span class="at">beta =</span> <span class="dv">10</span>)</span>
<span id="cb106-708"><a href="#cb106-708" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"normal"</span>, <span class="at">alpha =</span> <span class="fl">0.025</span>, <span class="at">beta =</span> <span class="fl">0.05</span>)</span>
<span id="cb106-709"><a href="#cb106-709" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"t"</span>, <span class="at">alpha =</span> <span class="fl">0.01</span>)</span>
<span id="cb106-710"><a href="#cb106-710" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-711"><a href="#cb106-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-712"><a href="#cb106-712" aria-hidden="true" tabindex="-1"></a><span class="fu">### Improper Prior</span></span>
<span id="cb106-713"><a href="#cb106-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-714"><a href="#cb106-714" aria-hidden="true" tabindex="-1"></a>You can construct an improper prior distribution with classical properties using <span class="in">`method = 'strict'`</span>. The posterior distribution of from this prior yields the same results as the classical methodology with respect to sample sizes and upper limits, but is only proper once a single non-misstated unit is present in the  sample <span class="co">[</span><span class="ot">@Derks2022b</span><span class="co">]</span>. For example, the command below creates an improper beta(1, 0) prior distribution. This method requires the <span class="in">`poisson`</span>, <span class="in">`binomial`</span> or <span class="in">`hypergeometric`</span> likelihood.</span>
<span id="cb106-715"><a href="#cb106-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-718"><a href="#cb106-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-719"><a href="#cb106-719" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"strict"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb106-720"><a href="#cb106-720" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-721"><a href="#cb106-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-722"><a href="#cb106-722" aria-hidden="true" tabindex="-1"></a><span class="fu">### Impartial Prior</span></span>
<span id="cb106-723"><a href="#cb106-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-724"><a href="#cb106-724" aria-hidden="true" tabindex="-1"></a>You can incorporate the assumption that tolerable misstatement is equally likely as intolerable misstatement <span class="co">[</span><span class="ot">@Derks2022b</span><span class="co">]</span> using <span class="in">`method = 'impartial'`</span>. For example, the command below creates an impartial beta prior distribution for a performance materiality of 5 percent. This method requires that you specify a value for the <span class="in">`materiality`</span>.</span>
<span id="cb106-725"><a href="#cb106-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-728"><a href="#cb106-728" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-729"><a href="#cb106-729" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"impartial"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>)</span>
<span id="cb106-730"><a href="#cb106-730" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-731"><a href="#cb106-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-732"><a href="#cb106-732" aria-hidden="true" tabindex="-1"></a><span class="fu">### Probability of Tolerable Misstatement</span></span>
<span id="cb106-733"><a href="#cb106-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-734"><a href="#cb106-734" aria-hidden="true" tabindex="-1"></a>You can manually assign prior probabilities to the hypothesis of tolerable  misstatement and the hypotheses of intolerable misstatement <span class="co">[</span><span class="ot">@Derks2021</span><span class="co">]</span> with <span class="in">`method = 'hyp'`</span> in combination with <span class="in">`p.hmin`</span>. For example, the command below incorporates the information that the hypothesis of tolerable misstatement  has a probability of 60 percent into a beta prior distribution. This method requires that you specify a value for the <span class="in">`materiality`</span>.</span>
<span id="cb106-735"><a href="#cb106-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-738"><a href="#cb106-738" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-739"><a href="#cb106-739" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"hyp"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">p.hmin =</span> <span class="fl">0.6</span>)</span>
<span id="cb106-740"><a href="#cb106-740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-741"><a href="#cb106-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-742"><a href="#cb106-742" aria-hidden="true" tabindex="-1"></a><span class="fu">### Audit Risk Model</span></span>
<span id="cb106-743"><a href="#cb106-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-744"><a href="#cb106-744" aria-hidden="true" tabindex="-1"></a>You can translate risk assessments from the Audit Risk Model (inherent risk and internal control risk) into a prior distribution <span class="co">[</span><span class="ot">@Derks2021</span><span class="co">]</span> using <span class="in">`method = 'arm'`</span> in combination with the <span class="in">`ir`</span> and <span class="in">`cr`</span> arguments. For example, the command below incorporates the information that the inherent risk is equal to 90 percent and internal control risk is equal to 60 percent into a beta prior distribution. This method requires the <span class="in">`poisson`</span>, <span class="in">`binomial`</span> or <span class="in">`hypergeometric`</span> likelihood.</span>
<span id="cb106-745"><a href="#cb106-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-748"><a href="#cb106-748" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-749"><a href="#cb106-749" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"arm"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">ir =</span> <span class="fl">0.9</span>, <span class="at">cr =</span> <span class="fl">0.6</span>)</span>
<span id="cb106-750"><a href="#cb106-750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-751"><a href="#cb106-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-752"><a href="#cb106-752" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayesian Risk Assessment Model</span></span>
<span id="cb106-753"><a href="#cb106-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-754"><a href="#cb106-754" aria-hidden="true" tabindex="-1"></a>You can incorporate information about the mode and the upper bound of the prior distribution using <span class="in">`method = 'bram'`</span>. For example, the code below incorporates the information that the mode of the prior distribution is 1 percent and the upper bound is 60 percent into a beta prior distribution. This method requires the <span class="in">`poisson`</span>, <span class="in">`binomial`</span> or <span class="in">`hypergeometric`</span> likelihood.</span>
<span id="cb106-755"><a href="#cb106-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-758"><a href="#cb106-758" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-759"><a href="#cb106-759" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"bram"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">expected =</span> <span class="fl">0.01</span>, <span class="at">ub =</span> <span class="fl">0.6</span>)</span>
<span id="cb106-760"><a href="#cb106-760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-761"><a href="#cb106-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-762"><a href="#cb106-762" aria-hidden="true" tabindex="-1"></a><span class="fu">### Earlier Sample</span></span>
<span id="cb106-763"><a href="#cb106-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-764"><a href="#cb106-764" aria-hidden="true" tabindex="-1"></a>You can incorporate information from an earlier sample into the prior distribution <span class="co">[</span><span class="ot">@Derks2021</span><span class="co">]</span> using <span class="in">`method = 'sample'`</span> in combination with <span class="in">`x`</span> and <span class="in">`n`</span>. For example, the command below incorporates the information from an earlier sample of 30 items in which 0 misstatements were found into a beta prior distribution. This method requires the <span class="in">`poisson`</span>, <span class="in">`binomial`</span> or <span class="in">`hypergeometric`</span> likelihood.</span>
<span id="cb106-765"><a href="#cb106-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-768"><a href="#cb106-768" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-769"><a href="#cb106-769" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"sample"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">n =</span> <span class="dv">30</span>)</span>
<span id="cb106-770"><a href="#cb106-770" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-771"><a href="#cb106-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-772"><a href="#cb106-772" aria-hidden="true" tabindex="-1"></a><span class="fu">### Weighted Earlier Sample</span></span>
<span id="cb106-773"><a href="#cb106-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-774"><a href="#cb106-774" aria-hidden="true" tabindex="-1"></a>You can incorporate information from last years results, weighted by a factor <span class="co">[</span><span class="ot">@Derks2021</span><span class="co">]</span>, into the prior distribution using <span class="in">`method = 'factor'`</span> in combination with <span class="in">`x`</span> and <span class="in">`n`</span>. For example, the command below incorporates the information from a last years results (a sample of 58 items in which 0 misstatements were found), weighted by a factor 0.7, into a beta prior distribution. This method requires the <span class="in">`poisson`</span>, <span class="in">`binomial`</span> or <span class="in">`hypergeometric`</span> likelihood.</span>
<span id="cb106-775"><a href="#cb106-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-778"><a href="#cb106-778" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-779"><a href="#cb106-779" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"factor"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">n =</span> <span class="dv">58</span>, <span class="at">factor =</span> <span class="fl">0.7</span>)</span>
<span id="cb106-780"><a href="#cb106-780" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-781"><a href="#cb106-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-782"><a href="#cb106-782" aria-hidden="true" tabindex="-1"></a><span class="fu">### Nonparametric Prior</span></span>
<span id="cb106-783"><a href="#cb106-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-784"><a href="#cb106-784" aria-hidden="true" tabindex="-1"></a>You can base the prior on samples of the prior distribution using  <span class="in">`method = 'nonparam'`</span> in combination with <span class="in">`samples`</span>. For example, the command below creates a prior on 1000 samples of a beta(1, 10) distribution. The <span class="in">`likelihood`</span> argument is not required and will be ignored in this method.</span>
<span id="cb106-785"><a href="#cb106-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-788"><a href="#cb106-788" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-789"><a href="#cb106-789" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"nonparam"</span>, <span class="at">samples =</span> stats<span class="sc">::</span><span class="fu">rbeta</span>(<span class="dv">1000</span>, <span class="dv">1</span>, <span class="dv">10</span>))</span>
<span id="cb106-790"><a href="#cb106-790" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-791"><a href="#cb106-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-792"><a href="#cb106-792" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practical Examples</span></span>
<span id="cb106-793"><a href="#cb106-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-794"><a href="#cb106-794" aria-hidden="true" tabindex="-1"></a>This section contains practical examples of how to conduct the planning of statistical audit samples and demonstrates how to set up a prior distribution based on various types of relevant audit information.</span>
<span id="cb106-795"><a href="#cb106-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-796"><a href="#cb106-796" aria-hidden="true" tabindex="-1"></a><span class="fu">### Audit Risk Model</span></span>
<span id="cb106-797"><a href="#cb106-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-798"><a href="#cb106-798" aria-hidden="true" tabindex="-1"></a>In our first example, an auditor is performing tests of details on a population of the auditee. For instance, let's say an auditor is performing an audit on a company's accounts payable transactions. The company has a total of $N$ = 1000 accounts payable transactions for the year. Rather than testing all 1000 transactions, the auditor can choose to test a sample of the transactions. The performance materiality for the payable transactions account is set to $\theta_{max}$ = 3 percent, and the audit risk is set to $\alpha = 0.05$, or 5 percent. Based on the results of last years audit, where the most likely estimate of the misstatement was 1 percent, the auditor wants to tolerate 1 percent misstatements in the sample before giving an unqualified opinion on the population.</span>
<span id="cb106-799"><a href="#cb106-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-802"><a href="#cb106-802" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-803"><a href="#cb106-803" aria-hidden="true" tabindex="-1"></a>ar <span class="ot">&lt;-</span> <span class="fl">0.05</span> <span class="co"># Audit risk</span></span>
<span id="cb106-804"><a href="#cb106-804" aria-hidden="true" tabindex="-1"></a>materiality <span class="ot">&lt;-</span> <span class="fl">0.03</span> <span class="co"># Performance materiality</span></span>
<span id="cb106-805"><a href="#cb106-805" aria-hidden="true" tabindex="-1"></a>expected <span class="ot">&lt;-</span> <span class="fl">0.01</span> <span class="co"># Tolerable deviation rate</span></span>
<span id="cb106-806"><a href="#cb106-806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-807"><a href="#cb106-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-808"><a href="#cb106-808" aria-hidden="true" tabindex="-1"></a>Before tests of details, the auditor has assessed risk of material misstatement via the audit risk model. In this example, the auditor has assessed the effectiveness of the company's internal controls, such as its segregation of duties and its risk management processes, and has determined that they are sufficient to prevent or detect material misstatements. Because the internal control systems were effective, the auditor assesses the control risk as medium. The auditor's firm defines the risk categories low, medium, and high respectively as 50 percent, 60 percent, and 100 percent. According to the Audit Risk Model, the detection risk can be calculated as a function of the audit risk, the inherent risk and the control risk.</span>
<span id="cb106-809"><a href="#cb106-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-812"><a href="#cb106-812" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-813"><a href="#cb106-813" aria-hidden="true" tabindex="-1"></a>ir <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Inherent risk</span></span>
<span id="cb106-814"><a href="#cb106-814" aria-hidden="true" tabindex="-1"></a>cr <span class="ot">&lt;-</span> <span class="fl">0.6</span> <span class="co"># Control risk</span></span>
<span id="cb106-815"><a href="#cb106-815" aria-hidden="true" tabindex="-1"></a>dr <span class="ot">&lt;-</span> ar <span class="sc">/</span> (ir <span class="sc">*</span> cr) <span class="co"># Detection risk</span></span>
<span id="cb106-816"><a href="#cb106-816" aria-hidden="true" tabindex="-1"></a>dr</span>
<span id="cb106-817"><a href="#cb106-817" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-818"><a href="#cb106-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-819"><a href="#cb106-819" aria-hidden="true" tabindex="-1"></a>By using the detection risk of 8.33 percent as the sampling risk for this population, the auditor can plan for a sample while taking into account the risk-reducing information. The required minimum sample size is 174 in this case.</span>
<span id="cb106-820"><a href="#cb106-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-823"><a href="#cb106-823" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-824"><a href="#cb106-824" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> expected, <span class="at">conf.level =</span> <span class="dv">1</span> <span class="sc">-</span> dr)</span>
<span id="cb106-825"><a href="#cb106-825" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-826"><a href="#cb106-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-827"><a href="#cb106-827" aria-hidden="true" tabindex="-1"></a>The example above is a frequentist one. However, the auditor is free to apply a Bayesian philosophy in planning the sample. For example, the risk assessments from the ARM can be incorporated into a prior distribution. This can be done using <span class="in">`method = "arm"`</span> in the <span class="in">`auditPrior()`</span> function, which takes the values of the inherent risk probability <span class="in">`ir`</span> and the control risk probability <span class="in">`cr`</span>. Hence, the prior distribution in this example can be constructed using the following command:</span>
<span id="cb106-828"><a href="#cb106-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-831"><a href="#cb106-831" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-832"><a href="#cb106-832" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"arm"</span>, <span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> expected, <span class="at">ir =</span> ir, <span class="at">cr =</span> cr)</span>
<span id="cb106-833"><a href="#cb106-833" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-834"><a href="#cb106-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-835"><a href="#cb106-835" aria-hidden="true" tabindex="-1"></a>The <span class="in">`summary()`</span> function can be used to obtain relevant information about the prior distribution.</span>
<span id="cb106-836"><a href="#cb106-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-839"><a href="#cb106-839" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-840"><a href="#cb106-840" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(prior)</span>
<span id="cb106-841"><a href="#cb106-841" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-842"><a href="#cb106-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-843"><a href="#cb106-843" aria-hidden="true" tabindex="-1"></a>Furthermore, the prior distribution can be visualized with a call to the <span class="in">`plot()`</span> function, see @fig-planning-prior-example1.</span>
<span id="cb106-844"><a href="#cb106-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-845"><a href="#cb106-845" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-prior-example1", fig.cap="The prior distribution constructed on the basis of the assessments of inherent risk and control risk."}</span></span>
<span id="cb106-846"><a href="#cb106-846" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span>
<span id="cb106-847"><a href="#cb106-847" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-848"><a href="#cb106-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-849"><a href="#cb106-849" aria-hidden="true" tabindex="-1"></a>By using the prior distribution to incorporate the assessments of the inherent risk and the control risk, the auditor can plan a sample while taking into account the risk-reducing information. The required minimum sample size is also 174 in this case.</span>
<span id="cb106-850"><a href="#cb106-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-853"><a href="#cb106-853" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-854"><a href="#cb106-854" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> expected, <span class="at">conf.level =</span> <span class="dv">1</span> <span class="sc">-</span> ar, <span class="at">prior =</span> prior)</span>
<span id="cb106-855"><a href="#cb106-855" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-856"><a href="#cb106-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-857"><a href="#cb106-857" aria-hidden="true" tabindex="-1"></a><span class="fu">### Benchmark Analysis</span></span>
<span id="cb106-858"><a href="#cb106-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-859"><a href="#cb106-859" aria-hidden="true" tabindex="-1"></a>The auditor may incorporate information obtained through analytical procedures <span class="co">[</span><span class="ot">@Derks2021</span><span class="co">]</span>, such as a benchmark analysis, into the prior distribution for $\theta$. While we have previously discussed methods for constructing a prior distribution based on existing knowledge, there is no set procedure for incorporating information obtained through analytical procedures, as these procedures can vary significantly depending on the type of information being incorporated into the prior distribution. Therefore, it is important to thoroughly substantiate the data and assumptions used in this approach and to carefully consider how these assumptions are incorporated into the prior distribution.</span>
<span id="cb106-860"><a href="#cb106-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-861"><a href="#cb106-861" aria-hidden="true" tabindex="-1"></a>One way to construct a prior distribution on the basis of data is through the use of regression models, such as benchmarking the relationship between sales and costs of sales within the auditee's specific industry sector. The **jfa** package includes a data set <span class="in">`benchmark`</span> that can be used for this example.</span>
<span id="cb106-862"><a href="#cb106-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-865"><a href="#cb106-865" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-866"><a href="#cb106-866" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(benchmark)</span>
<span id="cb106-867"><a href="#cb106-867" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(benchmark)</span>
<span id="cb106-868"><a href="#cb106-868" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-869"><a href="#cb106-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-870"><a href="#cb106-870" aria-hidden="true" tabindex="-1"></a>The auditee's the sum of the sales is $298,112,312 and the sum of the booked costs of sales is $223,994,405, respectively. This is indicated by a blue dot in @fig-planning-scatter-1 below, which visualizes the industry sales versus the cost of sales.</span>
<span id="cb106-871"><a href="#cb106-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-874"><a href="#cb106-874" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-875"><a href="#cb106-875" aria-hidden="true" tabindex="-1"></a>C_real <span class="ot">&lt;-</span> <span class="dv">223994405</span></span>
<span id="cb106-876"><a href="#cb106-876" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-877"><a href="#cb106-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-878"><a href="#cb106-878" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-scatter-1", fig.cap="Scatter plot of the industry sales versus the cost of sales.", echo = FALSE, fig.width = 7, fig.height = 6, fig.align = "center"}</span></span>
<span id="cb106-879"><a href="#cb106-879" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">pretty</span>(<span class="fu">c</span>(benchmark<span class="sc">$</span>sales, benchmark<span class="sc">$</span>costofsales))</span>
<span id="cb106-880"><a href="#cb106-880" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"$"</span>, <span class="fu">format</span>(breaks <span class="sc">/</span> <span class="dv">1000000</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>), <span class="st">"M"</span>)</span>
<span id="cb106-881"><a href="#cb106-881" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> benchmark, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> sales, <span class="at">y =</span> costofsales)) <span class="sc">+</span></span>
<span id="cb106-882"><a href="#cb106-882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"darkgray"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb106-883"><a href="#cb106-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb106-884"><a href="#cb106-884" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">298112312</span>, <span class="at">y =</span> C_real), <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb106-885"><a href="#cb106-885" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">fill =</span> <span class="st">"dodgerblue"</span>, <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb106-886"><a href="#cb106-886" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb106-887"><a href="#cb106-887" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-888"><a href="#cb106-888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb106-889"><a href="#cb106-889" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Sales"</span>, <span class="at">breaks =</span> breaks,</span>
<span id="cb106-890"><a href="#cb106-890" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">range</span>(breaks), <span class="at">labels =</span> labels</span>
<span id="cb106-891"><a href="#cb106-891" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-892"><a href="#cb106-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb106-893"><a href="#cb106-893" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Cost of sales"</span>, <span class="at">breaks =</span> breaks,</span>
<span id="cb106-894"><a href="#cb106-894" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">range</span>(breaks), <span class="at">labels =</span> labels</span>
<span id="cb106-895"><a href="#cb106-895" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-896"><a href="#cb106-896" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xend =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="fu">min</span>(breaks), <span class="at">yend =</span> <span class="fu">max</span>(breaks)) <span class="sc">+</span></span>
<span id="cb106-897"><a href="#cb106-897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="fu">min</span>(breaks), <span class="at">xend =</span> <span class="fu">max</span>(breaks), <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">yend =</span> <span class="sc">-</span><span class="cn">Inf</span>)</span>
<span id="cb106-898"><a href="#cb106-898" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> jfa<span class="sc">:::</span><span class="fu">.theme_jfa</span>(p)</span>
<span id="cb106-899"><a href="#cb106-899" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb106-900"><a href="#cb106-900" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-901"><a href="#cb106-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-902"><a href="#cb106-902" aria-hidden="true" tabindex="-1"></a>The relationship between the sales $S$ and the cost of sales $C$ can be modelled by a linear equation:</span>
<span id="cb106-903"><a href="#cb106-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-904"><a href="#cb106-904" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb106-905"><a href="#cb106-905" aria-hidden="true" tabindex="-1"></a>  C = \beta_0 + \beta_1 \cdot S + \epsilon.</span>
<span id="cb106-906"><a href="#cb106-906" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb106-907"><a href="#cb106-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-908"><a href="#cb106-908" aria-hidden="true" tabindex="-1"></a>In practice, this relationship is often more complex than is presented above, and the auditor must carefully construct and evaluate the applied regression model. However, for ease of understanding we will continue our example with this toy model. The auditor can estimate the regression model using the following command:</span>
<span id="cb106-909"><a href="#cb106-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-912"><a href="#cb106-912" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-913"><a href="#cb106-913" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(costofsales <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> sales, <span class="at">data =</span> benchmark)</span>
<span id="cb106-914"><a href="#cb106-914" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb106-915"><a href="#cb106-915" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-916"><a href="#cb106-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-917"><a href="#cb106-917" aria-hidden="true" tabindex="-1"></a>The predicted cost of sales for the auditee, based on the industry benchmark, can be computed as follows:</span>
<span id="cb106-918"><a href="#cb106-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-921"><a href="#cb106-921" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-922"><a href="#cb106-922" aria-hidden="true" tabindex="-1"></a>C_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">sales =</span> <span class="dv">298112312</span>), <span class="at">interval =</span> <span class="st">"prediction"</span>, <span class="at">level =</span> <span class="fl">0.90</span>)[<span class="dv">1</span>]</span>
<span id="cb106-923"><a href="#cb106-923" aria-hidden="true" tabindex="-1"></a>C_pred</span>
<span id="cb106-924"><a href="#cb106-924" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-925"><a href="#cb106-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-926"><a href="#cb106-926" aria-hidden="true" tabindex="-1"></a>The fitted regression line and the predicted cost of sales (red dot) are visualized in @fig-planning-scatter-2 below.</span>
<span id="cb106-927"><a href="#cb106-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-928"><a href="#cb106-928" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-scatter-2", fig.cap="Scatter plot of the industry sales versus the cost of sales including the regression line and the auditee's (predicted) cost of sales.", echo = FALSE, fig.width = 7, fig.height = 6, fig.align = "center"}</span></span>
<span id="cb106-929"><a href="#cb106-929" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">pretty</span>(<span class="fu">c</span>(benchmark<span class="sc">$</span>sales, benchmark<span class="sc">$</span>costofsales))</span>
<span id="cb106-930"><a href="#cb106-930" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"$"</span>, <span class="fu">format</span>(breaks <span class="sc">/</span> <span class="dv">1000000</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>), <span class="st">"M"</span>)</span>
<span id="cb106-931"><a href="#cb106-931" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> benchmark, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> sales, <span class="at">y =</span> costofsales)) <span class="sc">+</span></span>
<span id="cb106-932"><a href="#cb106-932" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb106-933"><a href="#cb106-933" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">"smooth"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb106-934"><a href="#cb106-934" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span></span>
<span id="cb106-935"><a href="#cb106-935" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-936"><a href="#cb106-936" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"darkgray"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb106-937"><a href="#cb106-937" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb106-938"><a href="#cb106-938" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">298112312</span>, <span class="at">y =</span> C_real), <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb106-939"><a href="#cb106-939" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">fill =</span> <span class="st">"dodgerblue"</span>, <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb106-940"><a href="#cb106-940" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb106-941"><a href="#cb106-941" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-942"><a href="#cb106-942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb106-943"><a href="#cb106-943" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">298112312</span>, <span class="at">y =</span> C_pred), <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb106-944"><a href="#cb106-944" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">fill =</span> <span class="st">"firebrick"</span>, <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb106-945"><a href="#cb106-945" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb106-946"><a href="#cb106-946" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-947"><a href="#cb106-947" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb106-948"><a href="#cb106-948" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Sales"</span>, <span class="at">breaks =</span> breaks,</span>
<span id="cb106-949"><a href="#cb106-949" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">range</span>(breaks), <span class="at">labels =</span> labels</span>
<span id="cb106-950"><a href="#cb106-950" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-951"><a href="#cb106-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb106-952"><a href="#cb106-952" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Cost of sales"</span>, <span class="at">breaks =</span> breaks,</span>
<span id="cb106-953"><a href="#cb106-953" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">range</span>(breaks), <span class="at">labels =</span> labels</span>
<span id="cb106-954"><a href="#cb106-954" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-955"><a href="#cb106-955" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xend =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="fu">min</span>(breaks), <span class="at">yend =</span> <span class="fu">max</span>(breaks)) <span class="sc">+</span></span>
<span id="cb106-956"><a href="#cb106-956" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="fu">min</span>(breaks), <span class="at">xend =</span> <span class="fu">max</span>(breaks), <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">yend =</span> <span class="sc">-</span><span class="cn">Inf</span>)</span>
<span id="cb106-957"><a href="#cb106-957" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> jfa<span class="sc">:::</span><span class="fu">.theme_jfa</span>(p)</span>
<span id="cb106-958"><a href="#cb106-958" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb106-959"><a href="#cb106-959" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-960"><a href="#cb106-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-961"><a href="#cb106-961" aria-hidden="true" tabindex="-1"></a>The prior distribution can be justified by the data and the auditee's numerical prediction of the cost of sales. In this analytical procedure, the prior distribution on $\theta$ can utilize the relative error distribution from the linear regression. This relative error distribution, which is a Normal($\mu$, $\sigma$) distribution, captures the uncertainty of the prediction of the cost of sales through the use of linear regression, scaled to be a percentage of the total cost of sales. The mean $\mu$ of the prior distribution is determined by the relative deviation of the auditee's booked cost of sales when compared to the predicted cost of sales according to the benchmark data $\frac{C - \hat{C}}{C}$.</span>
<span id="cb106-962"><a href="#cb106-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-965"><a href="#cb106-965" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-966"><a href="#cb106-966" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> (C_real <span class="sc">-</span> C_pred) <span class="sc">/</span> C_real</span>
<span id="cb106-967"><a href="#cb106-967" aria-hidden="true" tabindex="-1"></a>mu</span>
<span id="cb106-968"><a href="#cb106-968" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-969"><a href="#cb106-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-970"><a href="#cb106-970" aria-hidden="true" tabindex="-1"></a>The standard deviation of the prior distribution is expressed through the standard deviation of the distribution of $\epsilon$:</span>
<span id="cb106-971"><a href="#cb106-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-974"><a href="#cb106-974" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-975"><a href="#cb106-975" aria-hidden="true" tabindex="-1"></a>stdev <span class="ot">&lt;-</span> <span class="fu">sd</span>(fit<span class="sc">$</span>residuals) <span class="sc">/</span> C_real</span>
<span id="cb106-976"><a href="#cb106-976" aria-hidden="true" tabindex="-1"></a>stdev</span>
<span id="cb106-977"><a href="#cb106-977" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-978"><a href="#cb106-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-979"><a href="#cb106-979" aria-hidden="true" tabindex="-1"></a>The Normal(0.019, 0.05) prior distribution can be constructed through a call to <span class="in">`auditPrior()`</span>, where the likelihood of the prior is specified as <span class="in">`normal`</span>. We call the function with <span class="in">`method = "param"`</span> to manually specify the parameters of the prior distribution.</span>
<span id="cb106-980"><a href="#cb106-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-983"><a href="#cb106-983" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-984"><a href="#cb106-984" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"normal"</span>, <span class="at">alpha =</span> mu, <span class="at">beta =</span> stdev)</span>
<span id="cb106-985"><a href="#cb106-985" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(prior)</span>
<span id="cb106-986"><a href="#cb106-986" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-987"><a href="#cb106-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-988"><a href="#cb106-988" aria-hidden="true" tabindex="-1"></a>The specified prior distribution can be visualized using the <span class="in">`plot()`</span> function, see @fig-planning-prior-example2.</span>
<span id="cb106-989"><a href="#cb106-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-990"><a href="#cb106-990" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-prior-example2", fig.cap="The prior distribution constructed on the basis of the benchmark analysis."}</span></span>
<span id="cb106-991"><a href="#cb106-991" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span>
<span id="cb106-992"><a href="#cb106-992" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-993"><a href="#cb106-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-994"><a href="#cb106-994" aria-hidden="true" tabindex="-1"></a>The performance materiality for this example is set to $\theta_{max}$ = 5 percent, and the audit risk is set to $\alpha = 0.05$, or 5 percent. By using this prior distribution, the required minimum sample size is 50.</span>
<span id="cb106-995"><a href="#cb106-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-998"><a href="#cb106-998" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-999"><a href="#cb106-999" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">prior =</span> prior)</span>
<span id="cb106-1000"><a href="#cb106-1000" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb106-1001"><a href="#cb106-1001" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1002"><a href="#cb106-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1003"><a href="#cb106-1003" aria-hidden="true" tabindex="-1"></a>You can inspect how the prior distribution compares to the expected posterior distribution by using the <span class="in">`plot()`</span> function, see @fig-planning-prior-posterior-example2.</span>
<span id="cb106-1004"><a href="#cb106-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1005"><a href="#cb106-1005" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-prior-posterior-example2", fig.cap="The prior and expected posterior distribution for this example after seeing a sample of $n=50$ containing no misstatements."}</span></span>
<span id="cb106-1006"><a href="#cb106-1006" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb106-1007"><a href="#cb106-1007" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1008"><a href="#cb106-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1009"><a href="#cb106-1009" aria-hidden="true" tabindex="-1"></a>By using a frequentist approach, the required minimum sample size is 59. Thus, by performing the analytical procedure and incorporating this information into the prior distribution, the auditor has achieved a reduction in sample size of 9 items.</span>
<span id="cb106-1010"><a href="#cb106-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1013"><a href="#cb106-1013" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1014"><a href="#cb106-1014" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb106-1015"><a href="#cb106-1015" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb106-1016"><a href="#cb106-1016" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1017"><a href="#cb106-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1018"><a href="#cb106-1018" aria-hidden="true" tabindex="-1"></a><span class="fu">### Predictive Modeling</span></span>
<span id="cb106-1019"><a href="#cb106-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1020"><a href="#cb106-1020" aria-hidden="true" tabindex="-1"></a>As a final example, we consider an example wehre the auditor incorporates information about the probability of misstatement obtained through a predictive analysis into the prior distribution for $\theta$. In this example, the auditor is conducting an audit on a long-term client that they have been working with for fifteen years. Hence, the auditor has access to a historycal data set called <span class="in">`history`</span>, which contains the samples from all of the previous audits that have been conducted on this auditee over the past fifteen years.</span>
<span id="cb106-1021"><a href="#cb106-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1024"><a href="#cb106-1024" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1025"><a href="#cb106-1025" aria-hidden="true" tabindex="-1"></a>history <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://github.com/koenderks/sasr/raw/master/data/ch3_history.csv"</span>, <span class="at">colClasses =</span> <span class="fu">c</span>(<span class="st">"factor"</span>, <span class="st">"numeric"</span>, <span class="st">"numeric"</span>))</span>
<span id="cb106-1026"><a href="#cb106-1026" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(history)</span>
<span id="cb106-1027"><a href="#cb106-1027" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1028"><a href="#cb106-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1029"><a href="#cb106-1029" aria-hidden="true" tabindex="-1"></a>It should be noted that for all historical sample items, there are three known characteristics: whether they contained a misstatement (designated as <span class="in">`k`</span>), the number of full-time equivalent employees (FTEs) who had access to that item within the internal computer systems of the auditee (designated as <span class="in">`ftes`</span>), and the number of days that the item was outstanding (designated as <span class="in">`days`</span>). Additionally, the <span class="in">`ftes`</span> and <span class="in">`days`</span> characteristics are also known for all items in the current year's population. Of course, it is unknown if any misstatements exist within the population of the current year.</span>
<span id="cb106-1030"><a href="#cb106-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1033"><a href="#cb106-1033" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1034"><a href="#cb106-1034" aria-hidden="true" tabindex="-1"></a>population <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://github.com/koenderks/sasr/raw/master/data/ch3_population.csv"</span>)</span>
<span id="cb106-1035"><a href="#cb106-1035" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(population)</span>
<span id="cb106-1036"><a href="#cb106-1036" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1037"><a href="#cb106-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1038"><a href="#cb106-1038" aria-hidden="true" tabindex="-1"></a>The objective of this analytical procedure is to forecast potential misstatements within the population of the current year. In order for the information obtained through this procedure to serve as prior knowledge in a Bayesian analysis, the procedure must yield a distribution of the probability of misstatement. Therefore, the auditor employs a machine learning technique known as Random Forest <span class="co">[</span><span class="ot">@Hastie2009</span><span class="co">]</span> to learn the relationship between misstatements, the number of full-time equivalent employees, and the number of outstanding days in the historical data set.</span>
<span id="cb106-1039"><a href="#cb106-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1042"><a href="#cb106-1042" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1043"><a href="#cb106-1043" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb106-1044"><a href="#cb106-1044" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> randomForest<span class="sc">::</span><span class="fu">randomForest</span>(<span class="at">formula =</span> k <span class="sc">~</span> ftes <span class="sc">+</span> days, <span class="at">data =</span> history)</span>
<span id="cb106-1045"><a href="#cb106-1045" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1046"><a href="#cb106-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1047"><a href="#cb106-1047" aria-hidden="true" tabindex="-1"></a>The auditor specifically uses the random forest technique due to its ability to provide a distribution of the misstatement probabilities. The probabilistic predictions for the unseen misstatements in the <span class="in">`population`</span> data can be obtained by calling the <span class="in">`predict()`</span> function with the argument <span class="in">`type = "prob"`</span>.</span>
<span id="cb106-1048"><a href="#cb106-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1051"><a href="#cb106-1051" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1052"><a href="#cb106-1052" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> fit, <span class="at">newdata =</span> population, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb106-1053"><a href="#cb106-1053" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1054"><a href="#cb106-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1055"><a href="#cb106-1055" aria-hidden="true" tabindex="-1"></a>These predictions come in a probabilistic format, which means that for each item in the population of the current year there is a predicted probability that that item is misstated. These probabilities are stored in the second column of the <span class="in">`predictions`</span> data frame.</span>
<span id="cb106-1056"><a href="#cb106-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1059"><a href="#cb106-1059" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1060"><a href="#cb106-1060" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predictions)</span>
<span id="cb106-1061"><a href="#cb106-1061" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1062"><a href="#cb106-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1063"><a href="#cb106-1063" aria-hidden="true" tabindex="-1"></a>The prior distribution for $\theta$ will be based on the distribution of probabilities that each item in the population is misstated. In contrast to the previous example, this distribution is not a parametric distribution, which means we are unable to utilize any parametric priors from **jfa**. However, by providing samples of the prior distribution, **jfa** is able to construct a nonparametric prior distribution internally via the density of the samples.</span>
<span id="cb106-1064"><a href="#cb106-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1065"><a href="#cb106-1065" aria-hidden="true" tabindex="-1"></a>The nonparametric prior distribution can be constructed through a call to <span class="in">`auditPrior()`</span>, where the method to construct of the prior is specified as <span class="in">`nonparam`</span>. The samples of the prior distribution can be provided through the <span class="in">`samples`</span> argument. We use the second column of the the <span class="in">`predictions`</span> object for this.</span>
<span id="cb106-1066"><a href="#cb106-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1069"><a href="#cb106-1069" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1070"><a href="#cb106-1070" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"nonparam"</span>, <span class="at">samples =</span> predictions[, <span class="dv">2</span>])</span>
<span id="cb106-1071"><a href="#cb106-1071" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1072"><a href="#cb106-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1073"><a href="#cb106-1073" aria-hidden="true" tabindex="-1"></a>The nonparametric prior distribution can be visualized using the <span class="in">`plot()`</span> function, see @fig-planning-prior-example3.</span>
<span id="cb106-1074"><a href="#cb106-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1075"><a href="#cb106-1075" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-prior-example3", fig.cap="The prior distribution constructed on the basis of the predictive model."}</span></span>
<span id="cb106-1076"><a href="#cb106-1076" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span>
<span id="cb106-1077"><a href="#cb106-1077" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1078"><a href="#cb106-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1079"><a href="#cb106-1079" aria-hidden="true" tabindex="-1"></a>The performance materiality for this example is set to $\theta_{max}$ = 1 percent, and the audit risk is set to $\alpha = 0.05$, or 5 percent. The minimum sample size can be calculated with the command below and is 108.</span>
<span id="cb106-1080"><a href="#cb106-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1083"><a href="#cb106-1083" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1084"><a href="#cb106-1084" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.01</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">prior =</span> prior)</span>
<span id="cb106-1085"><a href="#cb106-1085" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb106-1086"><a href="#cb106-1086" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1087"><a href="#cb106-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1088"><a href="#cb106-1088" aria-hidden="true" tabindex="-1"></a>You can inspect how the prior distribution compares to the expected posterior distribution by using the <span class="in">`plot()`</span> function, see @fig-planning-prior-posterior-example3.</span>
<span id="cb106-1089"><a href="#cb106-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1090"><a href="#cb106-1090" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label="fig-planning-prior-posterior-example3", fig.cap="The prior and expected posterior distribution for this example after seeing a sample of $n=108$ units containing no misstatements."}</span></span>
<span id="cb106-1091"><a href="#cb106-1091" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb106-1092"><a href="#cb106-1092" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1093"><a href="#cb106-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1094"><a href="#cb106-1094" aria-hidden="true" tabindex="-1"></a>By using a frequentist approach, the required minimum sample size is 299. Thus, by performing the analytical procedure and incorporating this information into the prior distribution, the auditor has achieved a reduction in sample size of 299 - 108 = 191 items.</span>
<span id="cb106-1095"><a href="#cb106-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1098"><a href="#cb106-1098" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1099"><a href="#cb106-1099" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.01</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb106-1100"><a href="#cb106-1100" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb106-1101"><a href="#cb106-1101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1102"><a href="#cb106-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1103"><a href="#cb106-1103" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practical Exercises</span></span>
<span id="cb106-1104"><a href="#cb106-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1105"><a href="#cb106-1105" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Use the classical approach with the hypergeometric likelihood to compute the minimum required sample size for a population of $N = 100$ when applying a performance materiality of 3 percent and a sampling risk of 5 percent. Tolerate no misstatements in the sample.</span>
<span id="cb106-1106"><a href="#cb106-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1107"><a href="#cb106-1107" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb106-1108"><a href="#cb106-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1109"><a href="#cb106-1109" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb106-1110"><a href="#cb106-1110" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb106-1111"><a href="#cb106-1111" aria-hidden="true" tabindex="-1"></a>This sample size can be computed using the <span class="in">`planning()`</span> function with the arguments <span class="in">`likelihood = "hypergeometric"`</span> and <span class="in">`N.units = 100`</span>.</span>
<span id="cb106-1114"><a href="#cb106-1114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1115"><a href="#cb106-1115" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">100</span>)</span>
<span id="cb106-1116"><a href="#cb106-1116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1117"><a href="#cb106-1117" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb106-1118"><a href="#cb106-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1119"><a href="#cb106-1119" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb106-1120"><a href="#cb106-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1121"><a href="#cb106-1121" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Recompute the previous sample size with the Bayesian approach using a default prior.</span>
<span id="cb106-1122"><a href="#cb106-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1123"><a href="#cb106-1123" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb106-1124"><a href="#cb106-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1125"><a href="#cb106-1125" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb106-1126"><a href="#cb106-1126" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb106-1127"><a href="#cb106-1127" aria-hidden="true" tabindex="-1"></a>The previous sample size can be recomputed using a default prior by adding <span class="in">`prior = TRUE`</span> to the call.</span>
<span id="cb106-1130"><a href="#cb106-1130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1131"><a href="#cb106-1131" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">100</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-1132"><a href="#cb106-1132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1133"><a href="#cb106-1133" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb106-1134"><a href="#cb106-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1135"><a href="#cb106-1135" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb106-1136"><a href="#cb106-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1137"><a href="#cb106-1137" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Use the classical approach with the binomial likelihood to compute the minimum required sample size for a performance materiality of 4.4 percent and a sampling risk of 5 percent. Tolerate one misstatement in the sample.</span>
<span id="cb106-1138"><a href="#cb106-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1139"><a href="#cb106-1139" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb106-1140"><a href="#cb106-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1141"><a href="#cb106-1141" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb106-1142"><a href="#cb106-1142" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb106-1143"><a href="#cb106-1143" aria-hidden="true" tabindex="-1"></a>This sample size can be computed using the <span class="in">`planning()`</span> function with the arguments <span class="in">`likelihood = "binomial"`</span> and <span class="in">`expected = 1`</span>.</span>
<span id="cb106-1146"><a href="#cb106-1146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1147"><a href="#cb106-1147" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.044</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">expected =</span> <span class="dv">1</span>)</span>
<span id="cb106-1148"><a href="#cb106-1148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1149"><a href="#cb106-1149" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb106-1150"><a href="#cb106-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1151"><a href="#cb106-1151" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb106-1152"><a href="#cb106-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1153"><a href="#cb106-1153" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Recompute the previous sample size with the Bayesian approach using a default prior.</span>
<span id="cb106-1154"><a href="#cb106-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1155"><a href="#cb106-1155" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb106-1156"><a href="#cb106-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1157"><a href="#cb106-1157" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb106-1158"><a href="#cb106-1158" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb106-1159"><a href="#cb106-1159" aria-hidden="true" tabindex="-1"></a>The previous sample size can be recomputed using a default prior by adding <span class="in">`prior = TRUE`</span> to the call.</span>
<span id="cb106-1162"><a href="#cb106-1162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1163"><a href="#cb106-1163" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.044</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-1164"><a href="#cb106-1164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1165"><a href="#cb106-1165" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb106-1166"><a href="#cb106-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1167"><a href="#cb106-1167" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb106-1168"><a href="#cb106-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1169"><a href="#cb106-1169" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Use the classical approach with the Poisson likelihood to compute the minimum required sample size for a performance materiality of 2 percent and a sampling risk of 5 percent. Use an expected misstatement rate of 0.5 percent.</span>
<span id="cb106-1170"><a href="#cb106-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1171"><a href="#cb106-1171" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb106-1172"><a href="#cb106-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1173"><a href="#cb106-1173" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb106-1174"><a href="#cb106-1174" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb106-1175"><a href="#cb106-1175" aria-hidden="true" tabindex="-1"></a>This sample size can be computed using the <span class="in">`planning()`</span> function with the argument <span class="in">`expected = 0.005`</span>.</span>
<span id="cb106-1178"><a href="#cb106-1178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1179"><a href="#cb106-1179" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.02</span>, <span class="at">expected =</span> <span class="fl">0.005</span>)</span>
<span id="cb106-1180"><a href="#cb106-1180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1181"><a href="#cb106-1181" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb106-1182"><a href="#cb106-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1183"><a href="#cb106-1183" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb106-1184"><a href="#cb106-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1185"><a href="#cb106-1185" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Recompute the previous sample size with the Bayesian approach using a default prior.</span>
<span id="cb106-1186"><a href="#cb106-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1187"><a href="#cb106-1187" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb106-1188"><a href="#cb106-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1189"><a href="#cb106-1189" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb106-1190"><a href="#cb106-1190" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb106-1191"><a href="#cb106-1191" aria-hidden="true" tabindex="-1"></a>The previous sample size can be recomputed using a default prior by adding <span class="in">`prior = TRUE`</span> to the call.</span>
<span id="cb106-1194"><a href="#cb106-1194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1195"><a href="#cb106-1195" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.02</span>, <span class="at">expected =</span> <span class="fl">0.005</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-1196"><a href="#cb106-1196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1197"><a href="#cb106-1197" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb106-1198"><a href="#cb106-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1199"><a href="#cb106-1199" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb106-1200"><a href="#cb106-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1201"><a href="#cb106-1201" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Compute the sampling risk according to the Audit Risk Model for an audit risk percentage of 5 percent, an inherent risk percentage of 50 percent and an internal control risk percentage of 80 percent. Next, use the classical approach with the binomial likelihood to compute the minimum sample size for a performance materiality of 5 percent and the new sampling risk. Tolerate no misstatements in the sample.</span>
<span id="cb106-1202"><a href="#cb106-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1203"><a href="#cb106-1203" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb106-1204"><a href="#cb106-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1205"><a href="#cb106-1205" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb106-1206"><a href="#cb106-1206" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb106-1207"><a href="#cb106-1207" aria-hidden="true" tabindex="-1"></a>This sample size can be computed by using an adjusted confidence level via the <span class="in">`conf.level`</span> argument.</span>
<span id="cb106-1210"><a href="#cb106-1210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1211"><a href="#cb106-1211" aria-hidden="true" tabindex="-1"></a>dr <span class="ot">&lt;-</span> <span class="fl">0.05</span> <span class="sc">/</span> (<span class="fl">0.5</span> <span class="sc">*</span> <span class="fl">0.8</span>)</span>
<span id="cb106-1212"><a href="#cb106-1212" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">conf.level =</span> <span class="dv">1</span> <span class="sc">-</span> dr)</span>
<span id="cb106-1213"><a href="#cb106-1213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1214"><a href="#cb106-1214" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb106-1215"><a href="#cb106-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1216"><a href="#cb106-1216" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb106-1217"><a href="#cb106-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1218"><a href="#cb106-1218" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>Construct a prior distribution on the basis of the information in exercise 7. Use this prior distribution to recompute the previous sample size with the Bayesian approach.</span>
<span id="cb106-1219"><a href="#cb106-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1220"><a href="#cb106-1220" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb106-1221"><a href="#cb106-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1222"><a href="#cb106-1222" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb106-1223"><a href="#cb106-1223" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb106-1224"><a href="#cb106-1224" aria-hidden="true" tabindex="-1"></a>The information in exercise 7 can be incorporated into the prior distribution by using the <span class="in">`auditPrior()`</span> function in combination with <span class="in">`method = "arm"`</span>.</span>
<span id="cb106-1227"><a href="#cb106-1227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1228"><a href="#cb106-1228" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"arm"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">ir =</span> <span class="fl">0.5</span>, <span class="at">cr =</span> <span class="fl">0.8</span>)</span>
<span id="cb106-1229"><a href="#cb106-1229" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">prior =</span> prior)</span>
<span id="cb106-1230"><a href="#cb106-1230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1231"><a href="#cb106-1231" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb106-1232"><a href="#cb106-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1233"><a href="#cb106-1233" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb106-1234"><a href="#cb106-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1235"><a href="#cb106-1235" aria-hidden="true" tabindex="-1"></a><span class="ss">9. </span>Construct a prior distribution on the basis of the assumption that tolerable misstatement is equally likely as intolerable misstatement before seeing the sample data. Use the binomial likelihood and assume a performance materiality of 2.5 percent.</span>
<span id="cb106-1236"><a href="#cb106-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1237"><a href="#cb106-1237" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb106-1238"><a href="#cb106-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1239"><a href="#cb106-1239" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb106-1240"><a href="#cb106-1240" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb106-1241"><a href="#cb106-1241" aria-hidden="true" tabindex="-1"></a>This prior distribution can be constructed using the <span class="in">`auditPrior()`</span> function in combination with <span class="in">`method = "impartial"`</span>, while providing a value for the <span class="in">`materiality`</span>.</span>
<span id="cb106-1244"><a href="#cb106-1244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1245"><a href="#cb106-1245" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"impartial"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>)</span>
<span id="cb106-1246"><a href="#cb106-1246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1247"><a href="#cb106-1247" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb106-1248"><a href="#cb106-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1249"><a href="#cb106-1249" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb106-1250"><a href="#cb106-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1251"><a href="#cb106-1251" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb106-1252"><a href="#cb106-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1253"><a href="#cb106-1253" aria-hidden="true" tabindex="-1"></a>\clearpage</span>
<span id="cb106-1254"><a href="#cb106-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1255"><a href="#cb106-1255" aria-hidden="true" tabindex="-1"></a><span class="fu">## Answers to the Exercises</span></span>
<span id="cb106-1256"><a href="#cb106-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1257"><a href="#cb106-1257" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>This sample size can be computed using the <span class="in">`planning()`</span> function with the arguments <span class="in">`likelihood = "hypergeometric"`</span> and <span class="in">`N.units = 100`</span>.</span>
<span id="cb106-1258"><a href="#cb106-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1261"><a href="#cb106-1261" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1262"><a href="#cb106-1262" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">100</span>)</span>
<span id="cb106-1263"><a href="#cb106-1263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1264"><a href="#cb106-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1265"><a href="#cb106-1265" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>The previous sample size can be recomputed using a default prior by adding <span class="in">`prior = TRUE`</span> to the call.</span>
<span id="cb106-1266"><a href="#cb106-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1269"><a href="#cb106-1269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1270"><a href="#cb106-1270" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">100</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-1271"><a href="#cb106-1271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1272"><a href="#cb106-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1273"><a href="#cb106-1273" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>This sample size can be computed using the <span class="in">`planning()`</span> function with the arguments <span class="in">`likelihood = "binomial"`</span> and <span class="in">`expected = 1`</span>.</span>
<span id="cb106-1274"><a href="#cb106-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1277"><a href="#cb106-1277" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1278"><a href="#cb106-1278" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.044</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">expected =</span> <span class="dv">1</span>)</span>
<span id="cb106-1279"><a href="#cb106-1279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1280"><a href="#cb106-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1281"><a href="#cb106-1281" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>The previous sample size can be recomputed using a default prior by adding <span class="in">`prior = TRUE`</span> to the call.</span>
<span id="cb106-1282"><a href="#cb106-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1285"><a href="#cb106-1285" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1286"><a href="#cb106-1286" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.044</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-1287"><a href="#cb106-1287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1288"><a href="#cb106-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1289"><a href="#cb106-1289" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>This sample size can be computed using the <span class="in">`planning()`</span> function with the argument <span class="in">`expected = 0.005`</span>.</span>
<span id="cb106-1290"><a href="#cb106-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1293"><a href="#cb106-1293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1294"><a href="#cb106-1294" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.02</span>, <span class="at">expected =</span> <span class="fl">0.005</span>)</span>
<span id="cb106-1295"><a href="#cb106-1295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1296"><a href="#cb106-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1297"><a href="#cb106-1297" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>The previous sample size can be recomputed using a default prior by adding <span class="in">`prior = TRUE`</span> to the call.</span>
<span id="cb106-1298"><a href="#cb106-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1301"><a href="#cb106-1301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1302"><a href="#cb106-1302" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.02</span>, <span class="at">expected =</span> <span class="fl">0.005</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-1303"><a href="#cb106-1303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1304"><a href="#cb106-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1305"><a href="#cb106-1305" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>This sample size can be computed by using an adjusted confidence level via the <span class="in">`conf.level`</span> argument.</span>
<span id="cb106-1306"><a href="#cb106-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1309"><a href="#cb106-1309" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1310"><a href="#cb106-1310" aria-hidden="true" tabindex="-1"></a>dr <span class="ot">&lt;-</span> <span class="fl">0.05</span> <span class="sc">/</span> (<span class="fl">0.5</span> <span class="sc">*</span> <span class="fl">0.8</span>)</span>
<span id="cb106-1311"><a href="#cb106-1311" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">conf.level =</span> <span class="dv">1</span> <span class="sc">-</span> dr)</span>
<span id="cb106-1312"><a href="#cb106-1312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1313"><a href="#cb106-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1314"><a href="#cb106-1314" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>The information in exercise 7 can be incorporated into the prior distribution by using the <span class="in">`auditPrior()`</span> function in combination with <span class="in">`method = "arm"`</span>.</span>
<span id="cb106-1315"><a href="#cb106-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1318"><a href="#cb106-1318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1319"><a href="#cb106-1319" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"arm"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">ir =</span> <span class="fl">0.5</span>, <span class="at">cr =</span> <span class="fl">0.8</span>)</span>
<span id="cb106-1320"><a href="#cb106-1320" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">prior =</span> prior)</span>
<span id="cb106-1321"><a href="#cb106-1321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1322"><a href="#cb106-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1323"><a href="#cb106-1323" aria-hidden="true" tabindex="-1"></a><span class="ss">9. </span>This prior distribution can be constructed using the <span class="in">`auditPrior()`</span> function in combination with <span class="in">`method = "impartial"`</span>, while providing a value for the <span class="in">`materiality`</span>.</span>
<span id="cb106-1324"><a href="#cb106-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1327"><a href="#cb106-1327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb106-1328"><a href="#cb106-1328" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"impartial"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>)</span>
<span id="cb106-1329"><a href="#cb106-1329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb106-1330"><a href="#cb106-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-1331"><a href="#cb106-1331" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>