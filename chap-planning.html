<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Koen Derks">

<title>Statistical Audit Sampling with R - 4&nbsp; Planning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chap-selection.html" rel="next">
<link href="./chap-inference.html" rel="prev">
<link href="./cover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": true,
  "collapse-after": 2,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta property="og:title" content="Statistical Audit Sampling with R - 4&nbsp; Planning">
<meta property="og:description" content="One of the key considerations in audit sampling is determining the appropriate sample size to reduce the sampling risk to an appropriately low level, while minimizing audit effort.">
<meta property="og:site-name" content="Statistical Audit Sampling with R">
<meta name="twitter:title" content="Statistical Audit Sampling with R - 4&nbsp; Planning">
<meta name="twitter:description" content="One of the key considerations in audit sampling is determining the appropriate sample size to reduce the sampling risk to an appropriately low level, while minimizing audit effort.">
<meta name="twitter:image" content="https://koenderks.github.io/sasr/cover.svg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Planning</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistical Audit Sampling with R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/koenderks/sasr/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Download" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-download"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="./Statistical-Audit-Sampling-with-R.pdf">
            <i class="bi bi-bi-file-pdf pe-1"></i>
          Download PDF
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="./Statistical-Audit-Sampling-with-R.epub">
            <i class="bi bi-bi-journal pe-1"></i>
          Download ePub
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">The Basics</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-foundations.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Foundations of Auditing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-inference.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Statistical Inference</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Workflow</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-planning.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Planning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-selection.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Selection</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-evaluation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Evaluation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-stratified-evaluation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Stratified Evaluation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Software</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-jasp.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">JASP for Audit</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chap-packages.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">R Packages</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.html" class="sidebar-item-text sidebar-link">R Tutorial</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#required-information" id="toc-required-information" class="nav-link active" data-scroll-target="#required-information"><span class="toc-section-number">4.1</span>  Required Information</a></li>
  <li><a href="#the-hypergeometric-likelihood" id="toc-the-hypergeometric-likelihood" class="nav-link" data-scroll-target="#the-hypergeometric-likelihood"><span class="toc-section-number">4.2</span>  The Hypergeometric Likelihood</a>
  <ul class="collapse">
  <li><a href="#classical-planning" id="toc-classical-planning" class="nav-link" data-scroll-target="#classical-planning"><span class="toc-section-number">4.2.1</span>  Classical planning</a></li>
  <li><a href="#bayesian-planning" id="toc-bayesian-planning" class="nav-link" data-scroll-target="#bayesian-planning"><span class="toc-section-number">4.2.2</span>  Bayesian Planning</a></li>
  </ul></li>
  <li><a href="#the-binomial-likelihood" id="toc-the-binomial-likelihood" class="nav-link" data-scroll-target="#the-binomial-likelihood"><span class="toc-section-number">4.3</span>  The Binomial Likelihood</a>
  <ul class="collapse">
  <li><a href="#classical-planning-1" id="toc-classical-planning-1" class="nav-link" data-scroll-target="#classical-planning-1"><span class="toc-section-number">4.3.1</span>  Classical Planning</a></li>
  <li><a href="#bayesian-planning-1" id="toc-bayesian-planning-1" class="nav-link" data-scroll-target="#bayesian-planning-1"><span class="toc-section-number">4.3.2</span>  Bayesian Planning</a></li>
  </ul></li>
  <li><a href="#the-poisson-likelihood" id="toc-the-poisson-likelihood" class="nav-link" data-scroll-target="#the-poisson-likelihood"><span class="toc-section-number">4.4</span>  The Poisson Likelihood</a>
  <ul class="collapse">
  <li><a href="#classical-planning-2" id="toc-classical-planning-2" class="nav-link" data-scroll-target="#classical-planning-2"><span class="toc-section-number">4.4.1</span>  Classical planning</a></li>
  <li><a href="#bayesian-planning-2" id="toc-bayesian-planning-2" class="nav-link" data-scroll-target="#bayesian-planning-2"><span class="toc-section-number">4.4.2</span>  Bayesian Planning</a></li>
  </ul></li>
  <li><a href="#prior-distributions" id="toc-prior-distributions" class="nav-link" data-scroll-target="#prior-distributions"><span class="toc-section-number">4.5</span>  Prior Distributions</a>
  <ul class="collapse">
  <li><a href="#default-prior" id="toc-default-prior" class="nav-link" data-scroll-target="#default-prior"><span class="toc-section-number">4.5.1</span>  Default Prior</a></li>
  <li><a href="#parametric-prior" id="toc-parametric-prior" class="nav-link" data-scroll-target="#parametric-prior"><span class="toc-section-number">4.5.2</span>  Parametric Prior</a></li>
  <li><a href="#improper-prior" id="toc-improper-prior" class="nav-link" data-scroll-target="#improper-prior"><span class="toc-section-number">4.5.3</span>  Improper Prior</a></li>
  <li><a href="#impartial-prior" id="toc-impartial-prior" class="nav-link" data-scroll-target="#impartial-prior"><span class="toc-section-number">4.5.4</span>  Impartial Prior</a></li>
  <li><a href="#probability-of-tolerable-misstatement" id="toc-probability-of-tolerable-misstatement" class="nav-link" data-scroll-target="#probability-of-tolerable-misstatement"><span class="toc-section-number">4.5.5</span>  Probability of Tolerable Misstatement</a></li>
  <li><a href="#audit-risk-model" id="toc-audit-risk-model" class="nav-link" data-scroll-target="#audit-risk-model"><span class="toc-section-number">4.5.6</span>  Audit Risk Model</a></li>
  <li><a href="#bayesian-risk-assessment-model" id="toc-bayesian-risk-assessment-model" class="nav-link" data-scroll-target="#bayesian-risk-assessment-model"><span class="toc-section-number">4.5.7</span>  Bayesian Risk Assessment Model</a></li>
  <li><a href="#earlier-sample" id="toc-earlier-sample" class="nav-link" data-scroll-target="#earlier-sample"><span class="toc-section-number">4.5.8</span>  Earlier Sample</a></li>
  <li><a href="#weighted-earlier-sample" id="toc-weighted-earlier-sample" class="nav-link" data-scroll-target="#weighted-earlier-sample"><span class="toc-section-number">4.5.9</span>  Weighted Earlier Sample</a></li>
  <li><a href="#nonparametric-prior" id="toc-nonparametric-prior" class="nav-link" data-scroll-target="#nonparametric-prior"><span class="toc-section-number">4.5.10</span>  Nonparametric Prior</a></li>
  </ul></li>
  <li><a href="#practical-examples" id="toc-practical-examples" class="nav-link" data-scroll-target="#practical-examples"><span class="toc-section-number">4.6</span>  Practical Examples</a>
  <ul class="collapse">
  <li><a href="#audit-risk-model-1" id="toc-audit-risk-model-1" class="nav-link" data-scroll-target="#audit-risk-model-1"><span class="toc-section-number">4.6.1</span>  Audit Risk Model</a></li>
  <li><a href="#benchmark-analysis" id="toc-benchmark-analysis" class="nav-link" data-scroll-target="#benchmark-analysis"><span class="toc-section-number">4.6.2</span>  Benchmark Analysis</a></li>
  <li><a href="#predictive-modeling" id="toc-predictive-modeling" class="nav-link" data-scroll-target="#predictive-modeling"><span class="toc-section-number">4.6.3</span>  Predictive Modeling</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="toc-section-number">4.7</span>  Exercises</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/koenderks/sasr/edit/master/chap-planning.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/koenderks/sasr/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="chap-planning" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Planning</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<div class="callout-note callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>You are reading the work-in-progress first edition of Statistical Auditing with R. This chapter is currently a dumping ground of ideas, and it is incomplete.</p>
</div>
</div>
</div>
<p>One of the key considerations in audit sampling is determining the appropriate sample size to reduce the sampling risk to an appropriately low level, while minimizing audit effort. To quantify the sampling risk, it is necessary to specify the statistical model that connects the data to the population misstatement, referred to as the likelihood. This chapter will delve into three standard likelihoods commonly employed in audit sampling: the hypergeometric likelihood, the binomial likelihood, and the Poisson likelihood.</p>
<p>Note that planning is a game of optimization that could be avoided. If you are using the Bayesian approach to audit sampling, it is not required to plan a specific sample size in advance <span class="citation" data-cites="Derks2022">(<a href="references.html#ref-Derks2022" role="doc-biblioref">Derks et al., 2022b</a>)</span>. That is because in Bayesian inference, the posterior distribution after seeing each item is used as the prior distribution for the next item. That means that you can simply start sampling and monitor the evidence in the data over time. However, to get an idea of how many samples are required to reduce the sampling risk to an level, planning a sample using a Bayesian approach can still be good practice.</p>
<section id="required-information" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="required-information"><span class="header-section-number">4.1</span> Required Information</h2>
<p>First, planning a minimum sample requires knowledge of the conditions that lead to acceptance or rejection of the population (i.e., the sampling objectives). Typically, sampling objectives can be classified into one or both of the following:</p>
<ul>
<li><strong>Hypothesis testing</strong>: The goal of the sample is to obtain evidence for or against the claim that the misstatement in the population is lower than a given value (i.e., the performance materiality).</li>
<li><strong>Estimation</strong>: The goal of the sample is to obtain an accurate estimate of the misstatement in the population with a certain precision.</li>
</ul>
<p>Second, it is advised to specify the expected (or tolerable) misstatements in the sample. The expected misstatements are the misstatements that you allow in the sample, while still retaining the desired amount of assurance about the population. It is strongly recommended to set the value for the expected misstatements in the sample conservatively to minimize the chance of the observed misstatements in the sample exceeding the expected misstatements, which would imply that insufficient work has been done in the end to reduce the sampling risk to an appropriately low level.</p>
<p>Finally, next to determining the sampling objective(s) and the expected misstatements, it is important to determine the statistical distribution linking the sample outcomes to the population misstatement. This distribution is called the likelihood (i.e., <code>poisson</code>, <code>binomial</code>, or <code>hypergeometric</code>). All three aforementioned likelihoods are commonly used in an audit sampling context, however, <code>poisson</code> is the default likelihood in <strong>jfa</strong> because it is the most conservative of the three. In the subsections below, we elaborate on the three standard likelihoods for audit sampling and demonstrate how they can be used to obtain a minimum sample size.</p>
<p>In <strong>jfa</strong>, determining an appropriate sample size is achieved via the <code>planning()</code> function.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/book_puzzle.png" class="img-fluid figure-img" style="width:75.0%"></p>
<p></p><figcaption class="figure-caption">When the sampling objectives, the expected misstatements and the likelihood are set, there exists only one sample size that minimizes the amount of audit effort. Image available under a <a href="https://creativecommons.org/licenses/by-nc/4.0/legalcode">CC-BY-NC 4.0</a> license.</figcaption><p></p>
</figure>
</div>
</section>
<section id="the-hypergeometric-likelihood" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="the-hypergeometric-likelihood"><span class="header-section-number">4.2</span> The Hypergeometric Likelihood</h2>
<p>The hypergeometric distribution is a discrete probability distribution that is commonly used to model the number of events occurring in a fixed number of trials when the population size is known. It assumes that samples are drawn from the population without replacement, and is therefore the likelihood that most closely resembles the audit practice. For our purpose, we can use the hypergeometric distribution as a likelihood to model the number of misstatements that are expected to be found in the sample.</p>
<p>The probability mass function (PMF) of the hypergeometric distribution is given by:</p>
<p><span class="math display">\[\begin{equation}
  p(X = k) = \frac{\binom{K}{k} \binom{N-K}{n-k}}{\binom{N}{n}},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(k\)</span> is the number of misstatements in the sample, <span class="math inline">\(n\)</span> is the sample size, <span class="math inline">\(N\)</span> is the population size and <span class="math inline">\(K\)</span> is the total number of misstatements assumed in the population. The assumed misstatements <span class="math inline">\(K\)</span> is a whole number, that is, a linear extrapolation of the maximum tolerable misstatement rate (i.e., the performance materiality) <span class="math inline">\(\theta_{max}\)</span> to the total population of size <span class="math inline">\(N\)</span>:</p>
<p><span class="math display">\[\begin{equation}
  K = \lceil \theta_{max} N \rceil.
\end{equation}\]</span></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math inline">\(\lceil...\rceil\)</span> is the ceiling function, which means that <span class="math inline">\(\lceil1.2\rceil = 2\)</span>.</p>
</div>
</div>
<p>Letâ€™s consider how to use the hypergeometric likelihood to calculate the minimum sample size needed to reduce the sampling risk to an appropriately low level.</p>
<section id="classical-planning" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="classical-planning"><span class="header-section-number">4.2.1</span> Classical planning</h3>
<p>In classical planning using the hypergeometric likelihood, the following statistical model is specified:</p>
<p><span class="math display">\[\begin{equation}
  k \sim \text{Hypergeometric}(n, N, K)
\end{equation}\]</span></p>
<p>Given the performance materiality <span class="math inline">\(\theta_{max}\)</span>, we can compute <span class="math inline">\(K\)</span> and solve for the minimum sample size <span class="math inline">\(n\)</span> needed to reduce the sampling risk to an appropriately low level. This sample size is also dependent on the number of misstatements that the auditor expects, or tolerates, in the sample.</p>
<section id="no-expected-misstatements" class="level4" data-number="4.2.1.1">
<h4 data-number="4.2.1.1" class="anchored" data-anchor-id="no-expected-misstatements"><span class="header-section-number">4.2.1.1</span> No Expected Misstatements</h4>
<p>If the auditor does not expect any misstatements in the sample, they can set <span class="math inline">\(k = 0\)</span>, which consequently determines how the sample size can be calculated. For example, if we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span> in a population of <span class="math inline">\(N = 1000\)</span> items, then <span class="math inline">\(K = \lceil 0.03 \cdot 1000 \rceil = 30\)</span> and the minimum sample size under the assumption of no expected misstatements in the sample is <span class="math inline">\(n = 94\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-2_b74adb5e6f5031eb3febc7648f32cce6">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">1000</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 94 </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 95 iterations via method 'hypergeometric'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The sample size of 94 can be confirmed by checking that 94 is the minimum integer that results in less than 5 percent probability of finding 0 misstatements, given the assumption that the population misstatement is truly 3 percent. The <code>dhyper()</code> function calculates the probability of observing <span class="math inline">\(k\)</span> missatements in a sample of <span class="math inline">\(n\)</span> items given the assumed hypergeometric distribution with <span class="math inline">\(N\)</span> items and <span class="math inline">\(K\)</span> assumed misstatements in the population. By calculating this probability for <span class="math inline">\(n = 93\)</span>, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-3_5b70189faf7c9aac8ec678bdd1285712">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fl">0.03</span> <span class="sc">*</span> <span class="dv">1000</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dhyper</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">m =</span> K, <span class="at">n =</span> <span class="dv">1000</span> <span class="sc">-</span> K, <span class="at">k =</span> <span class="dv">93</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, for <span class="math inline">\(n = 94\)</span> the relevant probability is lower than the sampling risk <span class="math inline">\(\alpha\)</span> and thus the sample size is considered to be sufficient.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-4_57153241ff3c0a0137014697f17312c6">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dhyper</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">m =</span> K, <span class="at">n =</span> <span class="dv">1000</span> <span class="sc">-</span> K, <span class="at">k =</span> <span class="dv">94</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can make this sample size visually intuitive by showing the hypergeometric(<span class="math inline">\(k\)</span> | 94, 1000, 30) distribution and highlighting the probability for <span class="math inline">\(k = 0\)</span>. This probability is lower than the required sampling risk <span class="math inline">\(\alpha = 0.05\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-5_1739594eecc919df05553e4c55c4a2f1">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Additional arguments to <code>planning()</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>planning()</code> function has two additional arguments that are not shown in the call above: <code>by</code> and <code>max</code>. The argument <code>by</code> sets the increment between possible sample sizes for consideration. For example, <code>by = 5</code> considers only samples of size 10, 20, 30, etc:</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-6_a7c7092a34aced0860e86a0a77c7fffc">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">1000</span>, <span class="at">by =</span> <span class="dv">10</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 100 </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 11 iterations via method 'hypergeometric'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The argument <code>max</code> sets the sample size at which the algorithm terminates. This can be used to avoid too many iterations of the algorithm at very low values of the performance materiality. For instance, <code>max = 50</code> throws an error if more than 100 samples are required.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-7_8dc86801a6e346c93426bf2892e5ffd2">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">1000</span>, <span class="at">max =</span> <span class="dv">50</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in planning(materiality = 0.03, expected = 0, conf.level = 0.95, : the sample size is larger than 'max'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="expected-misstatements" class="level4" data-number="4.2.1.2">
<h4 data-number="4.2.1.2" class="anchored" data-anchor-id="expected-misstatements"><span class="header-section-number">4.2.1.2</span> Expected Misstatements</h4>
<p>If the auditor expects misstatements in the sample, they can set <span class="math inline">\(k\)</span> to any integer value, which consequently determines how the sample size can be calculated. As another example, if we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span> in a population of <span class="math inline">\(N = 1000\)</span> items, then the required sample size under the assumption of one expected misstatement in the sample is <span class="math inline">\(n = 147\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-8_4c8cd4984c9c20d8ff8bdea103eb3753">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">1000</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 147 </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 146 iterations via method 'hypergeometric'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once again, the sample size of 147 can be confirmed by checking that 147 is the minimum integer that results in less than 5 percent probability of finding 0 or 1 misstatements, given the assumption that that the population misstatement is truly 3 percent. By calculating this probability for <span class="math inline">\(n = 146\)</span>, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-9_2fa777d4ebb845c8e4f57c5f99f031e7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dhyper</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">m =</span> K, <span class="at">n =</span> <span class="dv">1000</span> <span class="sc">-</span> K, <span class="at">k =</span> <span class="dv">146</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, for <span class="math inline">\(n = 147\)</span> the relevant probability is lower than the sampling risk <span class="math inline">\(\alpha\)</span> and thus the sample size is considered to be sufficient.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-10_26f91ab6c49f0b32ee9d2cc13e35916b">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dhyper</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">m =</span> K, <span class="at">n =</span> <span class="dv">1000</span> <span class="sc">-</span> K, <span class="at">k =</span> <span class="dv">147</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Like before, we can make this sample size visually intuitive by showing the hypergeometric(<span class="math inline">\(k\)</span> | 147, 1000, 30) distribution and highlighting the probabilities for <span class="math inline">\(k = 0\)</span> and <span class="math inline">\(k = 1\)</span>. The sum of these probabilities is lower than the required sampling risk <span class="math inline">\(\alpha = 0.05\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-11_86638876684d81216d1e2fdb276c024d">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="bayesian-planning" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="bayesian-planning"><span class="header-section-number">4.2.2</span> Bayesian Planning</h3>
<p>Performing Bayesian planning with the hypergeometric likelihood <span class="citation" data-cites="Dyer1993">(<a href="references.html#ref-Dyer1993" role="doc-biblioref">Dyer &amp; Pierce, 1993</a>)</span> requires that you specify a prior distribution for the total misstatements <span class="math inline">\(K\)</span>. Practically, this means that you should provide an input for the <code>prior</code> argument in the <code>planning()</code> function.</p>
<p>Setting <code>prior = TRUE</code> performs Bayesian planning using a default prior conjugate to the specified <code>likelihood</code> (i.e., a beta-binomial prior). Because this is a Bayesian analysis, the following statistical model is specified:</p>
<p><span class="math display">\[\begin{align}
  k &amp;\sim \text{Hypergeometric}(n, N, K) \\
  K &amp;\sim \text{Beta-binomial}(N, \alpha, \beta)
\end{align}\]</span></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The beta-binomial prior distribution is the conjugate prior for to the hypergeometric likelihood (see this <a href="https://en.wikipedia.org/wiki/Conjugate_prior#Table_of_conjugate_distributions">list</a> of conjugate priors), which means that the posterior distribution of <span class="math inline">\(K\)</span> can be determined analytically. For example, if the prior distribution for <span class="math inline">\(K\)</span> is:</p>
<p><span class="math display">\[\begin{equation}
  K \sim \text{Beta-binomial}(N, \alpha, \beta) \,\,\,\,\,\,\,\,\,\, K = 0, \ldots, N
\end{equation}\]</span></p>
<p>and the auditor has observed a sample of <span class="math inline">\(n\)</span> items containing <span class="math inline">\(k\)</span> misstatements, then the posterior distribution for <span class="math inline">\(K\)</span> is:</p>
<p><span class="math display">\[\begin{equation}
  K \sim \text{Beta-binomial}(N - n, \alpha + k, \beta + k - n) \,\,\,\,\,\,\,\,\,\, K = k, k + 1, \ldots, N - n + k.
\end{equation}\]</span></p>
</div>
</div>
<section id="no-expected-misstatements-1" class="level4" data-number="4.2.2.1">
<h4 data-number="4.2.2.1" class="anchored" data-anchor-id="no-expected-misstatements-1"><span class="header-section-number">4.2.2.1</span> No Expected Misstatements</h4>
<p>Planning for no expected misstatements in the sample can be done by setting the value for the <code>expected</code> argument to zero. If we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.1\)</span> in a population of <span class="math inline">\(N = 20\)</span> items, then the required sample size under the assumption of zero expected misstatements in the sample is <span class="math inline">\(n = 15\)</span>. The command below uses a default beta-binomial(<span class="math inline">\(N\)</span>, 1, 1) prior distribution to plan this sample, since <code>planning()</code> is given the hypergeometric likelihood.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-12_8ad20daa70f9e8fa6dc50d1f8a881168">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.1</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">20</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>summary()</code> function can be used to obatain relevant information about the planning.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-13_c740733efd056aa210701a66f08b652c">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Bayesian Audit Sample Planning Summary</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Options:</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Confidence level:              0.95 </span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Population size:               20 </span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Materiality:                   0.1 </span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Hypotheses:                    Hâ‚€: Î˜ &gt; 0.1 vs. Hâ‚: Î˜ &lt; 0.1 </span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected:                      0 </span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Likelihood:                    hypergeometric </span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Prior distribution:            beta-binomial(N = 20, Î± = 1, Î² = 1) </span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Results:</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Minimum sample size:           15 </span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Tolerable errors:              0 </span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Posterior distribution:        beta-binomial(N = 5, Î± = 1, Î² = 16) </span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected most likely error:    0 </span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected upper bound:          0.05 </span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected precision:            0.05 </span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected BFâ‚â‚€:                 190</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can inspect how the prior distribution compares to the expected posterior distribution by using the <code>plot()</code> function. The expected posterior distribution is the posterior distribution that would occur if you actually observed the planned sample containing the expected misstatements. Note that the posterior distribution is only defined in the range [<span class="math inline">\(k\)</span>; <span class="math inline">\(N - n + k\)</span>], since a part of the population has already been seen.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-14_2d24811babed13d5c274a7a0db30bbb4">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="expected-misstatements-1" class="level4" data-number="4.2.2.2">
<h4 data-number="4.2.2.2" class="anchored" data-anchor-id="expected-misstatements-1"><span class="header-section-number">4.2.2.2</span> Expected Misstatements</h4>
<p>Planning for expected misstatements in the sample can be done by setting the value for the <code>expected</code> argument to a different value than zero. For example, the command below calculates the minimum sample size to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.1\)</span> in a population of <span class="math inline">\(N = 50\)</span> items, given one expected misstatement in the sample. This sample size is <span class="math inline">\(n = 32\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-15_214d7d3fa6bfd41db3a35cdb934c767e">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.1</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">50</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 32 </span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 31 iterations via method 'hypergeometric' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Like before, you can inspect how the prior distribution compares to the expected posterior distribution by using the <code>plot()</code> function.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-16_30924709f6b5a37b43753c46814bd07a">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="the-binomial-likelihood" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="the-binomial-likelihood"><span class="header-section-number">4.3</span> The Binomial Likelihood</h2>
<p>The binomial distribution is a discrete probability distribution that is commonly used to model the number of events occurring in a fixed number of trials. It is similar to the hypergeometric distribution, however, it assumes that samples are drawn from the population with replacement. For our purpose, we can use the binomial distribution as a likelihood to model the number of misstatements that are expected to be found in the sample.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In audit sampling, the binomial likelihood is often used to approximate the hypergeometric likelihood since it is easier to work with (i.e., it only has two parameters: <span class="math inline">\(\theta\)</span> and <span class="math inline">\(n\)</span>, while the hypergeometric has three: <span class="math inline">\(n\)</span>, <span class="math inline">\(N\)</span>, and <span class="math inline">\(K\)</span>). However, the binomial likelihood is more conservative than the hypergeometric likelihood, meaning that resulting sample sizes will be higher.</p>
</div>
</div>
<p>The probability mass function (PMF) of the binomial distribution is given by:</p>
<p><span class="math display">\[\begin{equation}
  p(k; n, \theta) = \binom{n}{k} \theta^{k} (1-\theta)^{n - k},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(k\)</span> is the number of misstatements in the sample, <span class="math inline">\(n\)</span> is the sample size and <span class="math inline">\(\theta\)</span> is the probability of misstatement in the population. Letâ€™s consider how to use the binomial likelihood to calculate the minimum sample size needed to reduce the sampling risk to an appropriately low level.</p>
<section id="classical-planning-1" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="classical-planning-1"><span class="header-section-number">4.3.1</span> Classical Planning</h3>
<p>In classical planning using the binomial likelihood, the following statistical model is specified:</p>
<p><span class="math display">\[\begin{equation}
  k \sim \text{Binomial}(n, \theta_{max})
\end{equation}\]</span></p>
<section id="no-expected-misstatements-2" class="level4" data-number="4.3.1.1">
<h4 data-number="4.3.1.1" class="anchored" data-anchor-id="no-expected-misstatements-2"><span class="header-section-number">4.3.1.1</span> No Expected Misstatements</h4>
<p>If the auditor does not expect any misstatements in the sample, they can set <span class="math inline">\(k = 0\)</span>, which consequently determines how the sample size can be calculated. Given a performance materiality <span class="math inline">\(\theta_{max}\)</span>, we can solve for the minimum sample size <span class="math inline">\(n\)</span> needed to reduce the sampling risk to an appropriately low level. A useful trick to utilize is that, if we do not expect any misstatements in the sample, the formula for the minimum required sample size reduces to:</p>
<p><span class="math display">\[\begin{equation}
  n = \lceil\frac{\ln(\alpha)}{\ln(1 - \theta_{max})}\rceil.
\end{equation}\]</span></p>
<p>For example, if we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha=0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span>, then the required sample size under the assumption of zero expected misstatements in the sample is <span class="math inline">\(n = 99\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-17_40957d1c8559efc4f10e24da21452452">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ceiling</span>(<span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.95</span>) <span class="sc">/</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.03</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 99</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In <strong>jfa</strong>, this sample size can be replicated using the following code:</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-18_e6d681d1a2ea411e004d5bc012a8b540">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 99 </span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 100 iterations via method 'binomial'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The sample size of 99 can be confirmed by checking that 99 is the minimum integer that results in less than 5 percent probability of finding 0 misstatements, given the assumption that the population misstatement is truly 3 percent. The <code>dbinom()</code> function calculates the probability of observing <span class="math inline">\(k\)</span> missatements in a sample of <span class="math inline">\(n\)</span> items given an assumed misstatement probability <span class="math inline">\(\theta_{max}\)</span>. By calculating this probability for <span class="math inline">\(n = 98\)</span>, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-19_31124ccb9cb3a191b5aeeeb40b9e9e4f">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">98</span>, <span class="at">prob =</span> <span class="fl">0.03</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, for <span class="math inline">\(n = 99\)</span> the relevant probability is lower than the sampling risk <span class="math inline">\(\alpha\)</span> and thus the sample size is considered to be sufficient.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-20_5ef5aeef1351d458053b6f33a401c6e9">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">99</span>, <span class="at">prob =</span> <span class="fl">0.03</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can make this sample size visually intuitive by showing the binomial(<span class="math inline">\(k\)</span> | 99, 0.03) distribution and highlighting the probability for <span class="math inline">\(k = 0\)</span>. This probability is lower than the required sampling risk <span class="math inline">\(\alpha = 0.05\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-21_3f88dc6eed92ea5abd2b63dccc3849a5">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="expected-misstatementss" class="level4" data-number="4.3.1.2">
<h4 data-number="4.3.1.2" class="anchored" data-anchor-id="expected-misstatementss"><span class="header-section-number">4.3.1.2</span> Expected Misstatementss</h4>
<p>However, if the number of expected misstatements in the sample is non-zero, it becomes more difficult to solve the formula for <span class="math inline">\(n\)</span>. Hence, they will need to set <span class="math inline">\(k\)</span> to a different integer value, which consequently determines how the sample size is calculated. Here, we can iteratively try every value of <span class="math inline">\(n\)</span> and return the smallest integer that satisfies the sampling objectives.</p>
<p>In <strong>jfa</strong>, this can be done by adjusting the <code>expected</code> argument in the <code>planning()</code> function. For example, if we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span>, then the required sample size under the assumption of one expected misstatement in the sample is <span class="math inline">\(n = 157\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-22_f45a15f9f75ac78c479446e495554911">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once again, the sample size of 157 can be confirmed by checking that 157 is the minimum integer that results in less than 5 percent probability of finding 0 or 1 misstatements, given the assumption that the population misstatement is truly 3 percent. By calculating this probability for <span class="math inline">\(n = 156\)</span>, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-23_9933081e413d0a1ee221eef7945d542a">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dbinom</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">156</span>, <span class="at">prob =</span> <span class="fl">0.03</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, for <span class="math inline">\(n = 157\)</span> the relevant probability is lower than the sampling risk <span class="math inline">\(\alpha\)</span> and thus the sample size is considered to be sufficient.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-24_445399d487c686254cece757ccdda746">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dbinom</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">157</span>, <span class="at">prob =</span> <span class="fl">0.03</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Like before, we can make this sample size visually intuitive by showing the binomial(<span class="math inline">\(k\)</span> | 157, 0.03) distribution and highlighting the probabilities for <span class="math inline">\(k = 0\)</span> and <span class="math inline">\(k = 1\)</span>. The sum of these probabilities is lower than the required sampling risk <span class="math inline">\(\alpha = 0.05\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-25_b7b84f85fab0aa27cc6c74167d9fbe1b">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="expected-misstatement-rate" class="level4" data-number="4.3.1.3">
<h4 data-number="4.3.1.3" class="anchored" data-anchor-id="expected-misstatement-rate"><span class="header-section-number">4.3.1.3</span> Expected Misstatement Rate</h4>
<p>When the expected misstatement rate in the sample <span class="math inline">\(\theta_{exp}\)</span> is assessed, the value for <span class="math inline">\(k\)</span> can be determined as <span class="math inline">\(k = n\theta_{exp}\)</span>, which consequently determines how the sample size can be calculated.</p>
<p>To account for the fact that <span class="math inline">\(k\)</span> can have non-integer values in this case, we can use a well-known similarity between the binomial distribution and the beta distribution to plan the sample size. The upper bound for any binomial(<span class="math inline">\(k\)</span>; <span class="math inline">\(n\)</span>, <span class="math inline">\(\theta\)</span>) distributed variable can also be obtained via percentiles of the beta(<span class="math inline">\(1 + k\)</span>, <span class="math inline">\(n - k\)</span>) distribution.</p>
<p>For example, the upper bound for a sample of <span class="math inline">\(n = 10\)</span> items containing <span class="math inline">\(k = 2\)</span> misstatements, when calculated via the traditional <code>binom.test()</code> is:</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-26_0a58788e02ffa8c5dd790d011f5362f0">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ub_binom <span class="ot">&lt;-</span> <span class="fu">binom.test</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">p =</span> <span class="fl">0.03</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">alternative =</span> <span class="st">"less"</span>)<span class="sc">$</span>conf.int[<span class="dv">2</span>]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>ub_binom</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.5069013</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When calculated via the beta relationship, the upper bound is:</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-27_7cb4b8aadad09e2391e892b5d8f33989">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ub_beta <span class="ot">&lt;-</span> <span class="fu">qbeta</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">shape1 =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span>, <span class="at">shape2 =</span> <span class="dv">10</span> <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>ub_beta</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.5069013</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It can be validated that the two approaches result in the same upper bound via:</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-28_7c69aa5dccb3ea3b9d720d80c97d6f6f">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ub_binom <span class="sc">==</span> ub_beta</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This relationship between the binomial likelihood and the beta distribution is deliberately <strong>not</strong> used in <strong>jfa</strong>. That is because, in the case of the binomial distribution, the auditing standards round the tolerable misstatements upwards to a whole number. For example, if we try to call the <code>planning()</code> function with the argument <code>expected = 1.5</code>, <strong>jfa</strong> will internally convert this to <code>expected = 2</code> and base the sample size on this in order to stay compliant with <span class="citation" data-cites="AICPA-A">American Institute of Certified Public Accountants (AICPA) (<a href="references.html#ref-AICPA-A" role="doc-biblioref">2016</a>)</span>. The resulting sample size is <span class="math inline">\(n = 208\)</span> in this case.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-29_c370ce22ecceb28995207f53c3547b28">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="fl">1.5</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Using 'expected = 2' since 'expected' must be a single integer &gt;= 0</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 208 </span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 206 iterations via method 'binomial'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="bayesian-planning-1" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="bayesian-planning-1"><span class="header-section-number">4.3.2</span> Bayesian Planning</h3>
<p>Performing Bayesian planning using the binomial likelihood requires that you specify a prior distribution for the parameter <span class="math inline">\(\theta\)</span>. Practically, this means that you should provide an input for the <code>prior</code> argument in the <code>planning()</code> function.</p>
<p>Setting <code>prior = TRUE</code> performs Bayesian planning using a default prior conjugate to the specified <code>likelihood</code> (i.e., a beta prior). Because this is a Bayesian analysis, the following statistical model is specified:</p>
<p><span class="math display">\[\begin{align}
  k &amp;\sim \text{Binomial}(n, \theta) \\
  \theta &amp;\sim \text{Beta}(\alpha, \beta)
\end{align}\]</span></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The beta prior distribution is the conjugate prior for the binomial likelihood (see this <a href="https://en.wikipedia.org/wiki/Conjugate_prior#Table_of_conjugate_distributions">list</a> of conjugate priors), which means that the posterior distribution of <span class="math inline">\(\theta\)</span> can be determined analytically. For example, if the prior distribution for <span class="math inline">\(\theta\)</span> is:</p>
<p><span class="math display">\[\begin{equation}
  \theta \sim \text{Beta}(\alpha, \beta) \,\,\,\,\,\,\,\,\,\, \theta \in [0, 1]
\end{equation}\]</span></p>
<p>and the auditor has observed a sample of <span class="math inline">\(n\)</span> items containing <span class="math inline">\(k\)</span> misstatements, then the posterior distribution for <span class="math inline">\(\theta\)</span> is:</p>
<p><span class="math display">\[\begin{equation}
  \theta \sim \text{Beta}(\alpha + k, \beta + n - k) \,\,\,\,\,\,\,\,\,\, \theta \in [0, 1].
\end{equation}\]</span></p>
</div>
</div>
<p>For example, the command below uses a default beta(<span class="math inline">\(\alpha=1\)</span>, <span class="math inline">\(\beta=1\)</span>) prior distribution to plan the sample, since <code>planning()</code> is given the binomial likelihood. If we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha=0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span>, then the required sample size under the assumption of zero expected misstatements in the sample is <span class="math inline">\(n = 98\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-30_251436b6e6190133ec28b6adadda53f4">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>summary()</code> function can be used to obatain relevant information about the planning.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-31_109a8c04459bc029f8834af90c25aee2">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Bayesian Audit Sample Planning Summary</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Options:</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Confidence level:              0.95 </span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Materiality:                   0.03 </span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Hypotheses:                    Hâ‚€: Î˜ &gt; 0.03 vs. Hâ‚: Î˜ &lt; 0.03 </span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected:                      0 </span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Likelihood:                    binomial </span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Prior distribution:            beta(Î± = 1, Î² = 1) </span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Results:</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Minimum sample size:           98 </span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Tolerable errors:              0 </span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Posterior distribution:        beta(Î± = 1, Î² = 99) </span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected most likely error:    0 </span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected upper bound:          0.029807 </span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected precision:            0.029807 </span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected BFâ‚â‚€:                 627.22</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can inspect how the prior distribution compares to the expected posterior distribution by using the <code>plot()</code> function. The expected posterior distribution is the posterior distribution that would occur if you actually observed the planned sample containing the expected misstatements.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-32_c0ecf1287ca8163b48c5ed62d109b062">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>The input for the <code>prior</code> argument can also be an object created by the <code>auditPrior</code> function. If <code>planning()</code> receives a prior for which there is no conjugate likelihood available, it will numerically derive the posterior distribution. For example, the command below uses a Normal(0, 0.05) prior distribution to plan the sample using the binomial likelihood. Because this is a Bayesian analysis, the following statistical model is specified:</p>
<p><span class="math display">\[\begin{align}
  k &amp;\sim \text{Binomial}(n, \theta) \\
  \theta &amp;\sim \text{Normal}(\mu = 0, \sigma = 0.05)
\end{align}\]</span></p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-33_e350bb8b5ca3711fa6ff08c02b64e095">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"normal"</span>, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">beta =</span> <span class="fl">0.05</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>, <span class="at">prior =</span> prior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>summary()</code> function can be used to obatain relevant information about the planning.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-34_c13757241263fc12670a9bc6045c2766">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Bayesian Audit Sample Planning Summary</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Options:</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Confidence level:              0.95 </span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Materiality:                   0.03 </span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Hypotheses:                    Hâ‚€: Î˜ &gt; 0.03 vs. Hâ‚: Î˜ &lt; 0.03 </span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected:                      0 </span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Likelihood:                    poisson </span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Prior distribution:            normal(Î¼ = 0, Ïƒ = 0.05)T[0,1] </span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Results:</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Minimum sample size:           91 </span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Tolerable errors:              0 </span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Posterior distribution:        Nonparametric </span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected most likely error:    0 </span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected upper bound:          0.029 </span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected precision:            0.029 </span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected BFâ‚â‚€:                 26.749</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting sample size under this prior is <span class="math inline">\(n = 90\)</span>, a reduction of 8 samples when compared to the default beta(1, 1) prior distribution.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-35_0f19344aa8db26f6bc68da78165c5725">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="the-poisson-likelihood" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="the-poisson-likelihood"><span class="header-section-number">4.4</span> The Poisson Likelihood</h2>
<p>The Poisson distribution is a discrete probability distribution that is commonly used to model the number of events occurring in a fixed time or space. We can use the Poisson distribution as a likelihood to model the number of misstatements that are expected to be found in the sample.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In audit sampling, the Poisson likelihood is often used to approximate the binomial likelihood since it is easier to work with (i.e., it only has one parameter: <span class="math inline">\(\lambda\)</span>, while the binomial has two parameters: <span class="math inline">\(\theta\)</span> and <span class="math inline">\(n\)</span>). However, the Poisson likelihood is more conservative than the binomial likelihood, meaning that resulting sample sizes will be higher.</p>
</div>
</div>
<p>The probability mass function (PMF) of the Poisson distribution is given by:</p>
<p><span class="math display">\[\begin{equation}
  p(k; \lambda) = \frac{\lambda^k e^{-\lambda}}{k!},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(k\)</span> is the number of misstatements in the sample, and <span class="math inline">\(\lambda\)</span> is the average number of misstatements expected in the sample. The average number of misstatements is related to the misstatement rate in the population, denoted by <span class="math inline">\(\theta\)</span>, and the sample size, <span class="math inline">\(n\)</span>, by the following equation:</p>
<p><span class="math display">\[\begin{equation}
  \lambda = n \theta.
\end{equation}\]</span></p>
<p>Letâ€™s consider how to use the Poisson likelihood to calculate the minimum sample size needed to reduce the sampling risk to an appropriately low level.</p>
<section id="classical-planning-2" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="classical-planning-2"><span class="header-section-number">4.4.1</span> Classical planning</h3>
<p>In classical planning using the Poisson likelihood, the following statistical model is specified:</p>
<p><span class="math display">\[\begin{equation}
  k \sim \text{Poisson}(n \theta_{max})
\end{equation}\]</span></p>
<section id="no-expected-misstatements-3" class="level4" data-number="4.4.1.1">
<h4 data-number="4.4.1.1" class="anchored" data-anchor-id="no-expected-misstatements-3"><span class="header-section-number">4.4.1.1</span> No Expected Misstatements</h4>
<p>Given the performance materiality <span class="math inline">\(\theta_{max}\)</span> and the Poisson likelihood, we can solve for the minimum sample size <span class="math inline">\(n\)</span> needed to reduce the sampling risk to an appropriately low level. A useful trick to utilize is that, if we do not expect any misstatements in the sample, the formula for the required sample size reduces to:</p>
<p><span class="math display">\[\begin{equation}
  n = \lceil-\frac{\ln(\alpha)}{\theta_{max}}\rceil.
\end{equation}\]</span></p>
<p>For example, if we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span>, then the required sample size under the assumption of zero expected misstatements in the sample is <span class="math inline">\(n = 100\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-36_8be6efd682efccb6fdc76fb561ccb46c">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ceiling</span>(<span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.95</span>) <span class="sc">/</span> <span class="fl">0.03</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In <strong>jfa</strong>, this sample size can be replicated using the following code:</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-37_8fd9099026d59703723a27674a2f1d5b">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The sample size of 100 can be confirmed by checking that 100 is the minimum integer that results in less than 5 percent probability of finding 0 misstatements, given the assumption that the population misstatement is truly 3 percent. The <code>dpois()</code> function calculates the probability of observing <span class="math inline">\(k\)</span> missatements in a sample of <span class="math inline">\(n\)</span> items given an assumed misstatement probability <span class="math inline">\(\theta_{max}\)</span>. By calculating this probability for <span class="math inline">\(n = 99\)</span>, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-38_8ace8cd32d5a1fdc3cd7eb95881fd040">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">lambda =</span> <span class="dv">99</span> <span class="sc">*</span> <span class="fl">0.03</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, for <span class="math inline">\(n = 100\)</span> the relevant probability is lower than the sampling risk <span class="math inline">\(\alpha\)</span> and thus the sample size is considered to be sufficient.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-39_62448815e469685117e9696da2fb399a">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">lambda =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fl">0.03</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can make this visually intuitive by showing the Poisson(<span class="math inline">\(k\)</span> | 100 <span class="math inline">\(\times\)</span> 0.03) distribution and highlighting the probability for <span class="math inline">\(k = 0\)</span>. This probability is lower than the required sampling risk <span class="math inline">\(\alpha = 0.05\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-40_65ee8dbb66dd77d143f4593161069849">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="expected-misstatements-2" class="level4" data-number="4.4.1.2">
<h4 data-number="4.4.1.2" class="anchored" data-anchor-id="expected-misstatements-2"><span class="header-section-number">4.4.1.2</span> Expected Misstatements</h4>
<p>However, if the number of expected misstatements in the sample is non-zero, it becomes more difficult to solve the formula for <span class="math inline">\(n\)</span> algebraically. Hence, they will need to set <span class="math inline">\(k\)</span> to a different integer value. Next, we can iteratively try every value of <span class="math inline">\(n\)</span> and return the smallest integer that satisfies the sampling objectives.</p>
<p>For example, if we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span>, then the required sample size under the assumption of one expected misstatement in the sample is <span class="math inline">\(n = 159\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-41_e747ee55af83ae8600c9d54d8be70c07">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once again, the sample size of 159 can be confirmed by checking that 159 is the minimum integer that results in less than 5 percent probability of finding 0 or 1 misstatements, given the assumption that the population misstatement is truly 3 percent. By calculating this probability for <span class="math inline">\(n = 158\)</span>, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-42_3649f50c628d489ebdd48d69a2a6268e">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">lambda =</span> <span class="dv">158</span> <span class="sc">*</span> <span class="fl">0.03</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, for <span class="math inline">\(n = 159\)</span> the relevant probability is lower than the sampling risk <span class="math inline">\(\alpha\)</span> and thus the sample size is considered to be sufficient.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-43_e25ef575fce0a9461515f9b25e1519d5">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">lambda =</span> <span class="dv">159</span> <span class="sc">*</span> <span class="fl">0.03</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Like before, we can make this visually intuitive by showing the Poisson(<span class="math inline">\(k\)</span> | 159 <span class="math inline">\(\times\)</span> 0.03) distribution and highlighting the probabilities for <span class="math inline">\(k = 0\)</span> and <span class="math inline">\(k = 1\)</span>. The sum of these probabilities is lower than the required sampling risk <span class="math inline">\(\alpha = 0.05\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-44_4ba74a82467a7fcbda4d63fb2dbcd062">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="expected-misstatement-rate-1" class="level4" data-number="4.4.1.3">
<h4 data-number="4.4.1.3" class="anchored" data-anchor-id="expected-misstatement-rate-1"><span class="header-section-number">4.4.1.3</span> Expected Misstatement Rate</h4>
<p>When the expected misstatements in the sample <span class="math inline">\(\theta_{exp}\)</span> is assessed, the value for <span class="math inline">\(k\)</span> can be determined as <span class="math inline">\(k = n\theta_{exp}\)</span>, which consequently determines how the sample size can be calculated.</p>
<p>To account for the fact that <span class="math inline">\(k\)</span> can have non-integer values in this case, we use a well-known similarity between the Poisson distribution and the gamma distribution to plan the sample size. The upper bound for any Poisson(<span class="math inline">\(k\)</span>; <span class="math inline">\(n \theta\)</span>) distributed variable can also be obtained via percentiles of the gamma(<span class="math inline">\(1 + k\)</span>, <span class="math inline">\(n\)</span>) distribution.</p>
<p>For example, the upper bound for a sample of <span class="math inline">\(n = 10\)</span> items containing <span class="math inline">\(k = 2\)</span> misstatements, when calculated via the traditional <code>poisson.test()</code> is:</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-45_819abc9cec560a89d14d6a7bff17a1ce">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>ub_pois <span class="ot">&lt;-</span> <span class="fu">poisson.test</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">T =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="fl">0.03</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">alternative =</span> <span class="st">"less"</span>)<span class="sc">$</span>conf.int[<span class="dv">2</span>]</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>ub_pois</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.6295794</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When calculated via the relationship with the gamma distribution, the upper bound is:</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-46_e6103b1ef8abbf34f12ea7e4f48ae302">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>ub_gamma <span class="ot">&lt;-</span> <span class="fu">qgamma</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">shape =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span>, <span class="at">rate =</span> <span class="dv">10</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>ub_gamma</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.6295794</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It can be validated that the two approaches result in the same upper bound via:</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-47_a18c1227c0889443cfe96e8120448e3b">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>ub_pois <span class="sc">==</span> ub_gamma</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This relationship between the Poisson likelihood and the gamma distribution is used under the hood in <strong>jfa</strong>. For example, if we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha = 0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span>, then the required sample size under the assumption of 1.5 expected misstatements in the sample is <span class="math inline">\(n = 185\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-48_507f32dcc80b2776b39fe5b4c6cb1a20">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="fl">1.5</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 185 </span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 184 iterations via method 'poisson'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The sample size of 185 can be confirmed by checking that 185 is the minimum integer that results in less than 5 percent probability of finding a misstatement rate in the population equal to, or higher than, 3 percent. By calculating this probability for <span class="math inline">\(n = 184\)</span>, we can show that this sample size is insufficient as the relevant upper bound is higher than the performance materiality <span class="math inline">\(\theta_{max}\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-49_5183bb0e3dcc47874297d11cf77f9c1e">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qgamma</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">shape =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fl">1.5</span>, <span class="at">rate =</span> <span class="dv">184</span>) <span class="sc">&lt;</span> <span class="fl">0.03</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, for <span class="math inline">\(n = 185\)</span> the relevant upper bound is lower than the performance materiality <span class="math inline">\(\theta_{max}\)</span> and thus the sample size is sufficient.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-50_b3dbc54bb33163c7d6dd586dc0b25f75">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qgamma</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">shape =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fl">1.5</span>, <span class="at">rate =</span> <span class="dv">185</span>) <span class="sc">&lt;</span> <span class="fl">0.03</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="bayesian-planning-2" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="bayesian-planning-2"><span class="header-section-number">4.4.2</span> Bayesian Planning</h3>
<p>Performing Bayesian planning with the Poisson likelihood requires that you specify a prior distribution for the parameter <span class="math inline">\(\theta\)</span>. Practically, this means that you should provide an input for the <code>prior</code> argument in the <code>planning()</code> function.</p>
<p>Setting <code>prior = TRUE</code> performs Bayesian planning using a default prior conjugate to the specified <code>likelihood</code> (i.e., a gamma prior). Because this is a Bayesian analysis, the following statistical model is specified:</p>
<p><span class="math display">\[\begin{align}
  k &amp;\sim \text{Poisson}(n\theta) \\
  \theta &amp;\sim \text{Gamma}(\alpha, \beta)
\end{align}\]</span></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The gamma prior distribution is the conjugate prior for the Poisson likelihood (see this <a href="https://en.wikipedia.org/wiki/Conjugate_prior#Table_of_conjugate_distributions">list</a> of conjugate priors), which means that the posterior distribution of <span class="math inline">\(\theta\)</span> can be determined analytically. For example, if the prior distribution for <span class="math inline">\(\theta\)</span> is:</p>
<p><span class="math display">\[\begin{equation}
  \theta \sim \text{Gamma}(\alpha, \beta) \,\,\,\,\,\,\,\,\,\, \theta \in [0, \infty]
\end{equation}\]</span></p>
<p>and the auditor has observed a sample of <span class="math inline">\(n\)</span> items containing <span class="math inline">\(k\)</span> misstatements, then the posterior distribution for <span class="math inline">\(\theta\)</span> is:</p>
<p><span class="math display">\[\begin{equation}
  \theta \sim \text{Gamma}(\alpha + k, \beta + n) \,\,\,\,\,\,\,\,\,\, \theta \in [0, \infty].
\end{equation}\]</span></p>
</div>
</div>
<p>For example, the command below uses a default gamma(<span class="math inline">\(\alpha=1\)</span>, <span class="math inline">\(\beta=1\)</span>) prior distribution to plan the sample, since <code>planning()</code> is given the Poisson likelihood. If we want to achieve an assurance level of 95 percent (<span class="math inline">\(\alpha=0.05\)</span>) for a performance materiality of <span class="math inline">\(\theta_{max} = 0.03\)</span>, then the required sample size under the assumption of zero expected misstatements in the sample is <span class="math inline">\(n = 99\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-51_ee580b74bb523858104c29c1c45255f4">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>summary()</code> function can be used to obatain relevant information about the planning.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-52_41973d3dc119b48a80ae9bc4a5139d1d">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Bayesian Audit Sample Planning Summary</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Options:</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Confidence level:              0.95 </span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Materiality:                   0.03 </span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Hypotheses:                    Hâ‚€: Î˜ &gt; 0.03 vs. Hâ‚: Î˜ &lt; 0.03 </span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected:                      0 </span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Likelihood:                    poisson </span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Prior distribution:            gamma(Î± = 1, Î² = 1) </span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Results:</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Minimum sample size:           99 </span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Tolerable errors:              0 </span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Posterior distribution:        gamma(Î± = 1, Î² = 100) </span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected most likely error:    0 </span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected upper bound:          0.029957 </span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected precision:            0.029957 </span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected BFâ‚â‚€:                 626.69</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can inspect how the prior distribution compares to the expected posterior distribution by using the <code>plot()</code> function. The expected posterior distribution is the posterior distribution that would occur if you actually observed the planned sample containing the expected misstatements.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-53_7df9000322dee833d23d8a4eaf19d921">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>The input for the <code>prior</code> argument can also be an object created by the <code>auditPrior</code> function. If <code>planning()</code> receives a prior for which there is no conjugate likelihood available, it will numerically derive the posterior distribution. For example, the command below uses a Normal(0, 0.05) prior distribution to plan the sample using the Poisson likelihood. Concretely, this means that the following statistical model is specified:</p>
<p><span class="math display">\[\begin{align}
  k &amp;\sim \text{Poisson}(n\theta) \\
  \theta &amp;\sim \text{Normal}(\mu = 0, \sigma = 0.05)
\end{align}\]</span></p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-54_297058dcc63ffcd0ba2253513828b59f">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"normal"</span>, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">beta =</span> <span class="fl">0.05</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>, <span class="at">prior =</span> prior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>summary()</code> function can be used to obatain relevant information about the planning.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-55_9c698c4bbfc21a2417d77753b9ab6bf2">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Bayesian Audit Sample Planning Summary</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Options:</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Confidence level:              0.95 </span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Materiality:                   0.03 </span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Hypotheses:                    Hâ‚€: Î˜ &gt; 0.03 vs. Hâ‚: Î˜ &lt; 0.03 </span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected:                      0 </span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Likelihood:                    poisson </span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Prior distribution:            normal(Î¼ = 0, Ïƒ = 0.05)T[0,1] </span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Results:</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Minimum sample size:           91 </span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Tolerable errors:              0 </span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Posterior distribution:        Nonparametric </span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected most likely error:    0 </span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected upper bound:          0.029 </span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected precision:            0.029 </span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Expected BFâ‚â‚€:                 26.063</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting sample size under this prior is <span class="math inline">\(n = 91\)</span>, a reduction of 8 samples when compared to the default gamma(1, 1) prior.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-56_e72073bb4e66d20cad360c5302f5e7fa">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="prior-distributions" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="prior-distributions"><span class="header-section-number">4.5</span> Prior Distributions</h2>
<p>The <code>auditPrior()</code> function is used to specify a prior distribution for audit sampling. Below is an enumeration of the several ways that a prior distribution can be constructed using this function.</p>
<section id="default-prior" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="default-prior"><span class="header-section-number">4.5.1</span> Default Prior</h3>
<p>The default prior distributions are created using <code>method = 'default'</code>. <strong>jfa</strong>â€™s default priors satisfy two criteria: 1) they contain relatively little information about the population misstatement and 2) they are proper (i.e., they integrate to 1). The default priors in <strong>jfa</strong> are:</p>
<ul>
<li><code>likelihood = 'poisson'</code>: gamma(<span class="math inline">\(\alpha\)</span> = 1, <span class="math inline">\(\beta\)</span> = 1)</li>
<li><code>likelihood = 'binomial'</code>: beta(<span class="math inline">\(\alpha\)</span> = 1, <span class="math inline">\(\beta\)</span> = 1)</li>
<li><code>likelihood = 'hypergeometric'</code>: beta-binomial(N, <span class="math inline">\(\alpha\)</span> = 1, <span class="math inline">\(\beta\)</span> = 1)</li>
<li><code>likelihood = 'normal'</code>: normal(<span class="math inline">\(\mu\)</span> = 0, <span class="math inline">\(\sigma\)</span> = 1000)</li>
<li><code>likelihood = 'uniform'</code>: uniform(min = 0, max = 1)</li>
<li><code>likelihood = 'cauchy'</code>: Cauchy(<span class="math inline">\(x_0\)</span> = 0, <span class="math inline">\(\gamma\)</span> = 1000)</li>
<li><code>likelihood = 't'</code>: Student-t(df = 1)</li>
<li><code>likelihood = 'chisq'</code>: chi-squared(df = 1)</li>
<li><code>likelihood = 'exponential'</code>: exponential(<span class="math inline">\(\lambda\)</span> = 1)</li>
</ul>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-57_8a52f7671e5d1615e05ccdf4f9cf07f4">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"default"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(prior)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Prior Distribution Summary</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Options:</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Likelihood:                    binomial </span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Specifics:                     default prior </span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Results:</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Functional form:               beta(Î± = 1, Î² = 1) </span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Mode:                          NaN </span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Mean:                          0.5 </span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Median:                        0.5 </span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Variance:                      0.083333 </span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Skewness:                      0 </span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Information entropy (nat):     0 </span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   95 percent upper bound:        0.95 </span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Precision:                     NaN</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All prior distributions can be visually inspected via the <code>plot()</code> function.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-58_263dff0557541862a1e7b32bd036aac6">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Furthermore, the <code>predict()</code> function produces the predictions of the prior distribution on the data level for a sample of <code>n</code> items. For example, the command below requests the prediction of the default beta(1, 1) prior for a hypothetical sample of 6 items.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-59_7c20a22a465a88418e10e20cf6992526">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(prior, <span class="at">n =</span> <span class="dv">6</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       x=0       x=1       x=2       x=3       x=4       x=5       x=6 </span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The predictions of the prior distribution can be visualized using the <code>plot()</code> function.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-60_e97bb2802789b7a045fc2756fa320055">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predict</span>(prior, <span class="at">n =</span> <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="parametric-prior" class="level3" data-number="4.5.2">
<h3 data-number="4.5.2" class="anchored" data-anchor-id="parametric-prior"><span class="header-section-number">4.5.2</span> Parametric Prior</h3>
<p>You can manually specify the parameters of the prior distribution with <code>method = 'param'</code> and the <code>alpha</code> and <code>beta</code> arguments, which correspond to the first and (optionally) second parameter of the prior as described above. For example, the commands below create a beta(2, 10) prior distribution, a normal(0.025, 0.05) prior distribution and a Student-t(0.01) prior distribution.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-61_b19819ef00a1e685dadc763a2b896127">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">alpha =</span> <span class="dv">2</span>, <span class="at">beta =</span> <span class="dv">10</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; functional form: beta(Î± = 2, Î² = 10) </span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parameters obtained via method 'param'</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"normal"</span>, <span class="at">alpha =</span> <span class="fl">0.025</span>, <span class="at">beta =</span> <span class="fl">0.05</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; functional form: normal(Î¼ = 0.025, Ïƒ = 0.05)T[0,1] </span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parameters obtained via method 'param'</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"t"</span>, <span class="at">alpha =</span> <span class="fl">0.01</span>)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; functional form: Student-t(df = 0.01)T[0,1] </span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parameters obtained via method 'param'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="improper-prior" class="level3" data-number="4.5.3">
<h3 data-number="4.5.3" class="anchored" data-anchor-id="improper-prior"><span class="header-section-number">4.5.3</span> Improper Prior</h3>
<p>You can construct an improper prior distribution with classical properties using <code>method = 'strict'</code>. The posterior distribution of from this prior yields the same results as the classical methodology with respect to sample sizes and upper limits, but is only proper once a single non-misstated unit is present in the sample <span class="citation" data-cites="Derks2022b">(<a href="references.html#ref-Derks2022b" role="doc-biblioref">Derks et al., 2022a</a>)</span>. For example, the command below creates an improper beta(1, 0) prior distribution.</p>
<div class="callout-note callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This method requires the <code>poisson</code>, <code>binomial</code> or <code>hypergeometric</code> likelihood.</p>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-62_82d627042f511fc54fa2516b21a594f1">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"strict"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; functional form: beta(Î± = 1, Î² = 0) </span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parameters obtained via method 'strict'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="impartial-prior" class="level3" data-number="4.5.4">
<h3 data-number="4.5.4" class="anchored" data-anchor-id="impartial-prior"><span class="header-section-number">4.5.4</span> Impartial Prior</h3>
<p>You can incorporate the assumption that tolerable misstatement is equally likely as intolerable misstatement <span class="citation" data-cites="Derks2022b">(<a href="references.html#ref-Derks2022b" role="doc-biblioref">Derks et al., 2022a</a>)</span> using <code>method = 'impartial'</code>. For example, the command below creates an impartial beta prior distribution for a performance materiality of 5 percent.</p>
<div class="callout-note callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This method requires that you specify a value for the <code>materiality</code>.</p>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-63_4e36c25d9c54235980bb2e0697508ae9">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"impartial"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; functional form: beta(Î± = 1, Î² = 13.513) </span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parameters obtained via method 'impartial'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="probability-of-tolerable-misstatement" class="level3" data-number="4.5.5">
<h3 data-number="4.5.5" class="anchored" data-anchor-id="probability-of-tolerable-misstatement"><span class="header-section-number">4.5.5</span> Probability of Tolerable Misstatement</h3>
<p>You can manually assign prior probabilities to the hypothesis of tolerable misstatement and the hypotheses of intolerable misstatement <span class="citation" data-cites="Derks2021">(<a href="references.html#ref-Derks2021" role="doc-biblioref">Derks et al., 2021</a>)</span> with <code>method = 'hyp'</code> in combination with <code>p.hmin</code>. For example, the command below incorporates the information that the hypothesis of tolerable misstatement has a probability of 60 percent into a beta prior distribution.</p>
<div class="callout-note callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This method requires that you specify a value for the <code>materiality</code>.</p>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-64_f87b3db06049de261d39a40cd3aff20a">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"hyp"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">p.hmin =</span> <span class="fl">0.6</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; functional form: beta(Î± = 1, Î² = 17.864) </span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parameters obtained via method 'hyp'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="audit-risk-model" class="level3" data-number="4.5.6">
<h3 data-number="4.5.6" class="anchored" data-anchor-id="audit-risk-model"><span class="header-section-number">4.5.6</span> Audit Risk Model</h3>
<p>You can translate risk assessments from the Audit Risk Model (inherent risk and internal control risk) into a prior distribution <span class="citation" data-cites="Derks2021">(<a href="references.html#ref-Derks2021" role="doc-biblioref">Derks et al., 2021</a>)</span> using <code>method = 'arm'</code> in combination with the <code>ir</code> and <code>cr</code> arguments. For example, the command below incorporates the information that the inherent risk is equal to 90 percent and internal control risk is equal to 60 percent into a beta prior distribution.</p>
<div class="callout-note callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This method requires the <code>poisson</code>, <code>binomial</code> or <code>hypergeometric</code> likelihood.</p>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-65_264339c91f9f5ea7372e118a4be67ebb">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"arm"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">ir =</span> <span class="fl">0.9</span>, <span class="at">cr =</span> <span class="fl">0.6</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; functional form: beta(Î± = 1, Î² = 12) </span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parameters obtained via method 'arm'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="bayesian-risk-assessment-model" class="level3" data-number="4.5.7">
<h3 data-number="4.5.7" class="anchored" data-anchor-id="bayesian-risk-assessment-model"><span class="header-section-number">4.5.7</span> Bayesian Risk Assessment Model</h3>
<p>You can incorporate information about the mode and the upper bound of the prior distribution using <code>method = 'bram'</code>. For example, the code below incorporates the information that the mode of the prior distribution is 1 percent and the upper bound is 60 percent into a beta prior distribution.</p>
<div class="callout-note callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This method requires the <code>poisson</code>, <code>binomial</code> or <code>hypergeometric</code> likelihood.</p>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-66_3066685d42b96ddaaace4e4d855e0cc4">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"bram"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">expected =</span> <span class="fl">0.01</span>, <span class="at">ub =</span> <span class="fl">0.6</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; functional form: beta(Î± = 1.023, Î² = 3.317) </span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parameters obtained via method 'bram'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="earlier-sample" class="level3" data-number="4.5.8">
<h3 data-number="4.5.8" class="anchored" data-anchor-id="earlier-sample"><span class="header-section-number">4.5.8</span> Earlier Sample</h3>
<p>You can incorporate information from an earlier sample into the prior distribution <span class="citation" data-cites="Derks2021">(<a href="references.html#ref-Derks2021" role="doc-biblioref">Derks et al., 2021</a>)</span> using <code>method = 'sample'</code> in combination with <code>x</code> and <code>n</code>. For example, the command below incorporates the information from an earlier sample of 30 items in which 0 misstatements were found into a beta prior distribution.</p>
<div class="callout-note callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This method requires the <code>poisson</code>, <code>binomial</code> or <code>hypergeometric</code> likelihood.</p>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-67_b4cd9cfd4c4356eeadd97cb67e0b07a3">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"sample"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">n =</span> <span class="dv">30</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; functional form: beta(Î± = 1, Î² = 30) </span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parameters obtained via method 'sample'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="weighted-earlier-sample" class="level3" data-number="4.5.9">
<h3 data-number="4.5.9" class="anchored" data-anchor-id="weighted-earlier-sample"><span class="header-section-number">4.5.9</span> Weighted Earlier Sample</h3>
<p>You can incorporate information from last years results, weighted by a factor <span class="citation" data-cites="Derks2021">(<a href="references.html#ref-Derks2021" role="doc-biblioref">Derks et al., 2021</a>)</span>, into the prior distribution using <code>method = 'factor'</code> in combination with <code>x</code> and <code>n</code>. For example, the command below incorporates the information from a last years results (a sample of 58 items in which 0 misstatements were found), weighted by a factor 0.7, into a beta prior distribution.</p>
<div class="callout-note callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This method requires the <code>poisson</code>, <code>binomial</code> or <code>hypergeometric</code> likelihood.</p>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-68_bc8f48bc040dc27eee3fbc0afd9d68a8">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"factor"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">n =</span> <span class="dv">58</span>, <span class="at">factor =</span> <span class="fl">0.7</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; functional form: beta(Î± = 1, Î² = 40.6) </span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parameters obtained via method 'factor'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="nonparametric-prior" class="level3" data-number="4.5.10">
<h3 data-number="4.5.10" class="anchored" data-anchor-id="nonparametric-prior"><span class="header-section-number">4.5.10</span> Nonparametric Prior</h3>
<p>You can base the prior on samples of the prior distribution using <code>method = 'nonparam'</code> in combination with <code>samples</code>. For example, the command below creates a prior on 1000 samples of a beta(1, 10) distribution.</p>
<div class="callout-note callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The <code>likelihood</code> argument is not required and will be ignored in this method.</p>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-69_8681296dbb9493972bd2b46825eb6a1b">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"nonparam"</span>, <span class="at">samples =</span> stats<span class="sc">::</span><span class="fu">rbeta</span>(<span class="dv">1000</span>, <span class="dv">1</span>, <span class="dv">10</span>))</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Prior Distribution for Audit Sampling</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; functional form: Nonparametric </span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parameters obtained via method 'nonparam'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="practical-examples" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="practical-examples"><span class="header-section-number">4.6</span> Practical Examples</h2>
<p>This section contains practical examples of how to conduct the planning of statistical audit samples and demonstrates how to set up a prior distribution based on various types of relevant audit information.</p>
<section id="audit-risk-model-1" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="audit-risk-model-1"><span class="header-section-number">4.6.1</span> Audit Risk Model</h3>
<p>In our first example, an auditor is performing tests of details on a population of the auditee. For instance, letâ€™s say an auditor is performing an audit on a companyâ€™s accounts payable transactions. The company has a total of <span class="math inline">\(N\)</span> = 1000 accounts payable transactions for the year. Rather than testing all 1000 transactions, the auditor can choose to test a sample of the transactions. The performance materiality for the payable transactions account is set to <span class="math inline">\(\theta_{max}\)</span> = 3 percent, and the audit risk is set to <span class="math inline">\(\alpha = 0.05\)</span>, or 5 percent. Based on the results of last years audit, where the most likely estimate of the misstatement was 1 percent, the auditor wants to tolerate 1 percent misstatements in the sample before giving an unqualified opinion on the population.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-70_45e4462ab178524fc0a765e68824b456">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>ar          <span class="ot">&lt;-</span> <span class="fl">0.05</span> <span class="co"># Audit risk</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>materiality <span class="ot">&lt;-</span> <span class="fl">0.03</span> <span class="co"># Performance materiality</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>expected    <span class="ot">&lt;-</span> <span class="fl">0.01</span> <span class="co"># Tolerable deviation rate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before tests of details, the auditor has assessed risk of material misstatement via the audit risk model. In this example, the auditor has assessed the effectiveness of the companyâ€™s internal controls, such as its segregation of duties and its risk management processes, and has determined that they are sufficient to prevent or detect material misstatements. Because the internal control systems were effective, the auditor assesses the control risk as medium. The auditorâ€™s firm defines the risk categories low, medium, and high respectively as 50 percent, 60 percent, and 100 percent. According to the Audit Risk Model, the detection risk can be calculated as a function of the audit risk, the inherent risk and the control risk.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-71_dd09e491b122555f58e3dae69db7554f">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>ir <span class="ot">&lt;-</span> <span class="dv">1</span>              <span class="co"># Inherent risk</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>cr <span class="ot">&lt;-</span> <span class="fl">0.6</span>            <span class="co"># Control risk</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>dr <span class="ot">&lt;-</span> ar <span class="sc">/</span> (ir <span class="sc">*</span> cr) <span class="co"># Detection risk</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>dr</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.08333333</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By using the detection risk of 8.33 percent as the sampling risk for this population, the auditor can plan for a sample while taking into account the risk-reducing information. The required minimum sample size is 174 in this case.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-72_019056425024a52d90f17d2e98a5326f">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> expected, <span class="at">conf.level =</span> <span class="dv">1</span> <span class="sc">-</span> dr)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 174 </span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 175 iterations via method 'poisson'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The example above is a frequentist one. However, the auditor is free to apply a Bayesian philosophy in planning the sample. For example, the risk assessments from the ARM can be incorporated into a prior distribution. This can be done using <code>method = "arm"</code> in the <code>auditPrior()</code> function, which takes the values of the inherent risk probability <code>ir</code> and the control risk probability <code>cr</code>. Hence, the prior distribution in this example can be constructed using the following command:</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-73_70a1191a7c84905632b5a58a676266eb">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"arm"</span>, <span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> expected, <span class="at">ir =</span> ir, <span class="at">cr =</span> cr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>summary()</code> function can be used to obtain relevant information about the prior distribution.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-74_78deec354fe2a1c147aab10c16d9c759">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(prior)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Prior Distribution Summary</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Options:</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Likelihood:                    poisson </span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Specifics:                     ir = 1; cr = 0.6; dr = 0.0833333 </span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Results:</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Functional form:               gamma(Î± = 1.46, Î² = 46) </span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Mode:                          0.01 </span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Mean:                          0.031739 </span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Median:                        0.024859 </span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Variance:                      0.00069 </span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Skewness:                      1.6552 </span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Information entropy (nat):     -2.4894 </span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   95 percent upper bound:        0.08343 </span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Precision:                     0.07343</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Furthermore, the prior distribution can be visualized with a call to the <code>plot()</code> function.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-75_a6c766d3ebaae83d3de0f2d0fa8af053">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>By using the prior distribution to incorporate the assessments of the inherent risk and the control risk, the auditor can plan a sample while taking into account the risk-reducing information. The required minimum sample size is also 174 in this case.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-76_89b1b7b2f73d6906d989ff1c7d60edb5">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> expected, <span class="at">conf.level =</span> <span class="dv">1</span> <span class="sc">-</span> ar, <span class="at">prior =</span> prior)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 174 </span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 175 iterations via method 'poisson' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="benchmark-analysis" class="level3" data-number="4.6.2">
<h3 data-number="4.6.2" class="anchored" data-anchor-id="benchmark-analysis"><span class="header-section-number">4.6.2</span> Benchmark Analysis</h3>
<p>The auditor may incorporate information obtained through analytical procedures <span class="citation" data-cites="Derks2021">(<a href="references.html#ref-Derks2021" role="doc-biblioref">Derks et al., 2021</a>)</span>, such as a benchmark analysis, into the prior distribution for <span class="math inline">\(\theta\)</span>. While we have previously discussed methods for constructing a prior distribution based on existing knowledge, there is no set procedure for incorporating information obtained through analytical procedures, as these procedures can vary significantly depending on the type of information being incorporated into the prior distribution. Therefore, it is important to thoroughly substantiate the data and assumptions used in this approach and to carefully consider how these assumptions are incorporated into the prior distribution.</p>
<p>One way to construct a prior distribution on the basis of data is through the use of regression models, such as benchmarking the relationship between sales and costs of sales within the auditeeâ€™s specific industry sector. The <strong>jfa</strong> package includes a data set <code>benchmark</code> that can be used for this example.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-77_6ad64ddc213ff0a5054e9bc58df66bc7">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(benchmark)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(benchmark)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       sales costofsales</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 186273256   140755372</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 336491541   248675452</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 222693077   164299866</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 364905221   285768790</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 382140185   280187371</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 113666950   101552955</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The auditeeâ€™s the sum of the sales is $298,112,312 and the sum of the booked costs of sales is $223,994,405, respectively. This is indicated by a blue dot in the figure below, which visualizes the industry sales versus the cost of sales.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-78_2888d046d6255c4c71f6ac55baa5a1b1">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>C_real <span class="ot">&lt;-</span> <span class="dv">223994405</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-79_e69134c81e0d6a2a78695626f4ec9838">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The relationship between the sales <span class="math inline">\(S\)</span> and the cost of sales <span class="math inline">\(C\)</span> can be modelled by a linear equation:</p>
<p><span class="math display">\[\begin{equation}
  C = \beta_0 + \beta_1 \cdot S + \epsilon.
\end{equation}\]</span></p>
<p>In practice, this relationship is often more complex than is presented above, and the auditor must carefully construct and evaluate the applied regression model. However, for ease of understanding we will continue our example with this toy model. The auditor can estimate the regression model using the following command:</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-80_b5fea4249633573fb93d0a732b095c36">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(costofsales <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> sales, <span class="at">data =</span> benchmark)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lm(formula = costofsales ~ 1 + sales, data = benchmark)</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Residuals:</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       Min        1Q    Median        3Q       Max </span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -25736696  -7052141   -226945   6857840  25498106 </span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept) 2.413e+05  3.455e+06    0.07    0.944    </span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sales       7.366e-01  1.310e-02   56.21   &lt;2e-16 ***</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Residual standard error: 11150000 on 98 degrees of freedom</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Multiple R-squared:  0.9699, Adjusted R-squared:  0.9696 </span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; F-statistic:  3160 on 1 and 98 DF,  p-value: &lt; 2.2e-16</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The predicted cost of sales for the auditee, based on the industry benchmark, can be computed as follows:</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-81_3b631808f25c9367ea96b44534422b00">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>C_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">sales =</span> <span class="dv">298112312</span>), <span class="at">interval =</span> <span class="st">"prediction"</span>, <span class="at">level =</span> <span class="fl">0.90</span>)[<span class="dv">1</span>]</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>C_pred</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 219817866</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The fitted regression line and the predicted cost of sales (red dot) are visualized in the figure below:</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-82_9b286f909c5f54b3ca002c790ddbcc99">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The prior distribution can be justified by the data and the auditeeâ€™s numerical prediction of the cost of sales. In this analytical procedure, the prior distribution on <span class="math inline">\(\theta\)</span> can utilize the relative error distribution from the linear regression. This relative error distribution, which is a Normal(<span class="math inline">\(\mu\)</span>, <span class="math inline">\(\sigma\)</span>) distribution, captures the uncertainty of the prediction of the cost of sales through the use of linear regression, scaled to be a percentage of the total cost of sales. The mean <span class="math inline">\(\mu\)</span> of the prior distribution is determined by the relative deviation of the auditeeâ€™s booked cost of sales when compared to the predicted cost of sales according to the benchmark data <span class="math inline">\(\frac{C - \hat{C}}{C}\)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-83_6a84c834f36bc6db2eee2af5b32fbbfc">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> (C_real <span class="sc">-</span> C_pred) <span class="sc">/</span> C_real</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>mu</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.01864573</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The standard deviation of the prior distribution is expressed through the standard deviation of the distribution of <span class="math inline">\(\epsilon\)</span>:</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-84_c791b6920bffa7dd391e89989f1d029f">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>stdev <span class="ot">&lt;-</span> <span class="fu">sd</span>(fit<span class="sc">$</span>residuals) <span class="sc">/</span> C_real</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>stdev</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.04951199</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The Normal(0.019, 0.05) prior distribution can be constructed through a call to <code>auditPrior()</code>, where the likelihood of the prior is specified as <code>normal</code>. We call the function with <code>method = "param"</code> to manually specify the parameters of the prior distribution.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-85_3c298087543b6abbd38430f728462d59">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"normal"</span>, <span class="at">alpha =</span> mu, <span class="at">beta =</span> stdev)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(prior)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Prior Distribution Summary</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Options:</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Likelihood:                    normal </span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Specifics:                     Î± = 0.0186457; Î² = 0.049512 </span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Results:</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Functional form:               normal(Î¼ = 0.019, Ïƒ = 0.05)T[0,1] </span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Mode:                          0.018646 </span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Mean:                          0.047096 </span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Median:                        0.041335 </span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Variance:                      0.0011116 </span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Skewness:                      NA </span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Information entropy (nat):     -2.1306 </span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   95 percent upper bound:        0.11012 </span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Precision:                     0.091473</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The specified prior distribution can be visualized using the <code>plot()</code> function.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-86_77a9fdf1bbc1e443587c5a1f59a18c58">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>The performance materiality for this example is set to <span class="math inline">\(\theta_{max}\)</span> = 5 percent, and the audit risk is set to <span class="math inline">\(\alpha = 0.05\)</span>, or 5 percent. By using this prior distribution, the required minimum sample size is 50.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-87_549a19298d44f44dfa3c8b23e01e034c">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">prior =</span> prior)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 50 </span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 51 iterations via method 'binomial' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can inspect how the prior distribution compares to the expected posterior distribution by using the <code>plot()</code> function.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-88_8bd76c2e3bb4a8665474971e35d4f977">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>By using a frequentist approach, the required minimum sample size is 50. Thus, by performing the analytical procedure and incorporating this information into the prior distribution, the auditor has achieved a reduction in sample size of 9 items.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-89_ba57592c04af25ba919117c6e40b5fc9">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 59 </span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 60 iterations via method 'binomial'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="predictive-modeling" class="level3" data-number="4.6.3">
<h3 data-number="4.6.3" class="anchored" data-anchor-id="predictive-modeling"><span class="header-section-number">4.6.3</span> Predictive Modeling</h3>
<p>As a final example, we consider an example wehre the auditor incorporates information about the probability of misstatement obtained through a predictive analysis into the prior distribution for <span class="math inline">\(\theta\)</span>. In this example, the auditor is conducting an audit on a long-term client that they have been working with for fifteen years. Hence, the auditor has access to a historycal data set called <code>history</code>, which contains the samples from all of the previous audits that have been conducted on this auditee over the past fifteen years.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-90_b8d464deebaf4bb8ca2bb4b1b43ed6a3">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>history <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://github.com/koenderks/sasr/raw/master/data/ch3_history.csv"</span>, <span class="at">colClasses =</span> <span class="fu">c</span>(<span class="st">"factor"</span>, <span class="st">"numeric"</span>, <span class="st">"numeric"</span>))</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(history)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   k  ftes days</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0  2.09 1.83</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 0 17.51 5.02</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 0 17.29 8.47</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 0 23.88 8.31</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 0 15.31 8.25</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 0 18.28 4.47</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It should be noted that for all historical sample items, there are three known characteristics: whether they contained a misstatement (designated as <code>k</code>), the number of full-time equivalent employees (FTEs) who had access to that item within the internal computer systems of the auditee (designated as <code>ftes</code>), and the number of days that the item was outstanding (designated as <code>days</code>). Additionally, the <code>ftes</code> and <code>days</code> characteristics are also known for all items in the current yearâ€™s population. Of course, it is unknown if any misstatements exist within the population of the current year.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-91_560aefcc6cf685531de11b2671808c7a">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>population <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://github.com/koenderks/sasr/raw/master/data/ch3_population.csv"</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(population)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      ID bookValue ftes days</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 82884    242.61   14    4</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 25064    642.99   11    4</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 81235    628.53    8    3</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 71769    431.87   11    3</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 55080    620.88   12    3</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 93224    501.76   12    5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The objective of this analytical procedure is to forecast potential misstatements within the population of the current year. In order for the information obtained through this procedure to serve as prior knowledge in a Bayesian analysis, the procedure must yield a distribution of the probability of misstatement. Therefore, the auditor employs a machine learning technique known as Random Forest <span class="citation" data-cites="Hastie2009">(<a href="references.html#ref-Hastie2009" role="doc-biblioref">Hastie et al., 2009</a>)</span> to learn the relationship between misstatements, the number of full-time equivalent employees, and the number of outstanding days in the historical data set.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-92_c1f01a8877fb86e612ac0f2cec63f607">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> randomForest<span class="sc">::</span><span class="fu">randomForest</span>(<span class="at">formula =</span> k <span class="sc">~</span> ftes <span class="sc">+</span> days, <span class="at">data =</span> history)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The auditor specifically uses the random forest technique due to its ability to provide a distribution of the misstatement probabilities. The probabilistic predictions for the unseen misstatements in the <code>population</code> data can be obtained by calling the <code>predict()</code> function with the argument <code>type = "prob"</code>.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-93_a0c5f6502ed4e8d53a6d5576fda46026">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> fit, <span class="at">newdata =</span> population, <span class="at">type =</span> <span class="st">"prob"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These predictions come in a probabilistic format, which means that for each item in the population of the current year there is a predicted probability that that item is misstated. These probabilities are stored in the second column of the <code>predictions</code> data frame.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-94_6feb90a152d47191b618c5e8c3e7cae9">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predictions)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       0     1</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0.974 0.026</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 0.966 0.034</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 0.992 0.008</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 0.928 0.072</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 0.776 0.224</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 0.982 0.018</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The prior distribution for <span class="math inline">\(\theta\)</span> will be based on the distribution of probabilities that each item in the population is misstated. In contrast to the previous example, this distribution is not a parametric distribution, which means we are unable to utilize any parametric priors from <strong>jfa</strong>. However, by providing samples of the prior distribution, <strong>jfa</strong> is able to construct a nonparametric prior distribution internally via the density of the samples.</p>
<p>The nonparametric prior distribution can be constructed through a call to <code>auditPrior()</code>, where the method to construct of the prior is specified as <code>nonparam</code>. The samples of the prior distribution can be provided through the <code>samples</code> argument. We use the second column of the the <code>predictions</code> object for this.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-95_2795aae6811b02bb2cce642fbb18cbeb">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"nonparam"</span>, <span class="at">samples =</span> predictions[, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The nonparametric prior distribution can be visualized using the <code>plot()</code> function.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-96_a48725bd4c871995cf5a8afd99f67691">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>The performance materiality for this example is set to <span class="math inline">\(\theta_{max}\)</span> = 1 percent, and the audit risk is set to <span class="math inline">\(\alpha = 0.05\)</span>, or 5 percent. The minimum sample size can be calculated with the command below and is 108.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-97_11d418300688e457c427523c2acde025">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.01</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">prior =</span> prior)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 108 </span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 109 iterations via method 'binomial' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can inspect how the prior distribution compares to the expected posterior distribution by using the <code>plot()</code> function.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-98_0ea48a4a0574ac43d8136f48c7f96650">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-98-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>By using a frequentist approach, the required minimum sample size is 299. Thus, by performing the analytical procedure and incorporating this information into the prior distribution, the auditor has achieved a reduction in sample size of 299 - 108 = 191 items.</p>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-99_d40d23885fdadc635a47afca26a128d7">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.01</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 299 </span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 300 iterations via method 'binomial'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="exercises" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="exercises"><span class="header-section-number">4.7</span> Exercises</h2>
<ol type="1">
<li>Use the classical approach with the hypergeometric likelihood to compute the minimum required sample size for a population of <span class="math inline">\(N = 100\)</span> when applying a performance materiality of 3 percent and a sampling risk of 5 percent. Tolerate no misstatements in the sample.</li>
</ol>
<details>
<summary>
Click to reveal answer
</summary>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-100_c5ed6a49ed2617b3b32e72f3985aa24d">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">100</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 63 </span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 64 iterations via method 'hypergeometric'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="2" type="1">
<li>Recompute the previous sample size with the Bayesian approach using a default prior.</li>
</ol>
<details>
<summary>
Click to reveal answer
</summary>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-101_dc5565cbd223389957eb3ee785bf5e95">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">100</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 63 </span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 64 iterations via method 'hypergeometric' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="3" type="1">
<li>Use the classical approach with the binomial likelihood to compute the minimum required sample size for a performance materiality of 4.4 percent and a sampling risk of 5 percent. Tolerate one misstatement in the sample.</li>
</ol>
<details>
<summary>
Click to reveal answer
</summary>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-102_4c6998abea23abc771c75f5f2d32df76">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.044</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">expected =</span> <span class="dv">1</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 106 </span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 105 iterations via method 'binomial'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="4" type="1">
<li>Recompute the previous sample size with the Bayesian approach using a default prior.</li>
</ol>
<details>
<summary>
Click to reveal answer
</summary>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-103_915394dc2d4c26dcb769a10e06ea202c">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.044</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 105 </span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 104 iterations via method 'binomial' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="5" type="1">
<li>Use the classical approach with the Poisson likelihood to compute the minimum required sample size for a performance materiality of 2 percent and a sampling risk of 5 percent. Use an expected misstatement rate of 0.5 percent.</li>
</ol>
<details>
<summary>
Click to reveal answer
</summary>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-104_393d9985e2de3fec7eb060bd58b45a59">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.02</span>, <span class="at">expected =</span> <span class="fl">0.005</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 262 </span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 263 iterations via method 'poisson'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="6" type="1">
<li>Recompute the previous sample size with the Bayesian approach using a default prior.</li>
</ol>
<details>
<summary>
Click to reveal answer
</summary>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-105_90659edafa261b808fa80e1f4343e65c">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.02</span>, <span class="at">expected =</span> <span class="fl">0.005</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 261 </span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 262 iterations via method 'poisson' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="7" type="1">
<li>Compute the sampling risk according to the Audit Risk Model for an audit risk percentage of 5 percent, an inherent risk percentage of 50 percent and an internal control risk percentage of 80$. Next, use the classical approach with the binomial likelihood to compute the minimum sample size for a performance materiality of 5 percent and the new sampling risk. Tolerate no misstatements in the sample.</li>
</ol>
<details>
<summary>
Click to reveal answer
</summary>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-106_9bc35e2f739935614e4d712c7a2c54e8">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>dr <span class="ot">&lt;-</span> <span class="fl">0.05</span> <span class="sc">/</span> (<span class="fl">0.5</span> <span class="sc">*</span> <span class="fl">0.8</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">conf.level =</span> <span class="dv">1</span> <span class="sc">-</span> dr)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Classical Audit Sample Planning</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 42 </span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 43 iterations via method 'poisson'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="8" type="1">
<li>Construct a prior distribution on the basis of the information in exercise 7. Use this prior distribution to recompute the previous sample size with the Bayesian approach.</li>
</ol>
<details>
<summary>
Click to reveal answer
</summary>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-107_77bc6326274f933b08b656222a873c8a">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"arm"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">ir =</span> <span class="fl">0.5</span>, <span class="at">cr =</span> <span class="fl">0.8</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">prior =</span> prior)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Bayesian Audit Sample Planning</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; minimum sample size = 41 </span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sample size obtained in 42 iterations via method 'binomial' + 'prior'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-107-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</details>
<ol start="9" type="1">
<li>Construct a prior distribution on the basis of the assumption that tolerable misstatement is equally likely as intolerable misstatement before seeing the sample data. Use the binomial likelihood and assume a performance materiality of 2.5 percent.</li>
</ol>
<details>
<summary>
Click to reveal answer
</summary>
<div class="cell" data-layout-align="center" data-hash="chap-planning_cache/html/unnamed-chunk-108_a49ee263c6c6aec42a76243a31dc32ab">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"impartial"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chap-planning_files/figure-html/unnamed-chunk-108-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</details>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="doc-bibliography" style="display: none">
<div id="ref-AICPA-A" class="csl-entry" role="doc-biblioentry">
American Institute of Certified Public Accountants (AICPA). (2016). Appendix <span>A</span>: Attributes statistical sampling tables. In <em>Audit guide: Audit sampling</em>. <a href="https://doi.org/10.1002/9781119448617.app1">https://doi.org/10.1002/9781119448617.app1</a>
</div>
<div id="ref-Derks2021" class="csl-entry" role="doc-biblioentry">
Derks, K., Swart, J. de, Batenburg, P. van, Wagenmakers, E.-J., &amp; Wetzels, R. (2021). Priors in a <span>B</span>ayesian audit: How integration of existing information into the prior distribution can improve audit transparency and efficiency. <em>International Journal of Auditing</em>, <em>25</em>(3), 621â€“636. <a href="https://doi.org/10.1111/ijau.12240">https://doi.org/10.1111/ijau.12240</a>
</div>
<div id="ref-Derks2022b" class="csl-entry" role="doc-biblioentry">
Derks, K., Swart, J. de, Wagenmakers, E., &amp; Wetzels, R. (2022a). An impartial <span>B</span>ayesian hypothesis test for audit sampling. <em>PsyArXiv</em>. <a href="https://doi.org/10.31234/osf.io/8nf3e">https://doi.org/10.31234/osf.io/8nf3e</a>
</div>
<div id="ref-Derks2022" class="csl-entry" role="doc-biblioentry">
Derks, K., Swart, J. de, Wagenmakers, E., &amp; Wetzels, R. (2022b). The <span>B</span>ayesian approach to audit evidence: Quantifying statistical evidence using the <span>B</span>ayes factor. <em>PsyArXiv</em>. <a href="https://doi.org/10.31234/osf.io/kzqp5">https://doi.org/10.31234/osf.io/kzqp5</a>
</div>
<div id="ref-Dyer1993" class="csl-entry" role="doc-biblioentry">
Dyer, D., &amp; Pierce, R. L. (1993). On the choice of the prior distribution in hypergeometric sampling. <em>Communications in Statistics - Theory and Methods</em>, <em>22</em>(8), 2125â€“2146. <a href="https://doi.org/10.1080/03610929308831139">https://doi.org/10.1080/03610929308831139</a>
</div>
<div id="ref-Hastie2009" class="csl-entry" role="doc-biblioentry">
Hastie, T., Tibshirani, R., &amp; Friedman, J. H. (2009). <em>The elements of statistical learning: Data mining, inference, and prediction</em> (Vol. 2). Springer.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chap-inference.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Statistical Inference</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chap-selection.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Selection</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb105" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, cache = FALSE}</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"utils.R"</span>, <span class="at">local =</span> <span class="cn">TRUE</span>)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>::: {.callout-note appearance="simple"}</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>You are reading the work-in-progress first edition of Statistical Auditing with R. This chapter is currently a dumping ground of ideas, and it is incomplete.</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="fu"># Planning {#chap-planning}</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>One of the key considerations in audit sampling is determining the appropriate sample size to reduce the sampling risk to an appropriately low level, while minimizing audit effort. To quantify the sampling risk, it is necessary to specify the statistical model that connects the data to the population misstatement, referred to as the likelihood. This chapter will delve into three standard likelihoods commonly employed in audit sampling: the hypergeometric likelihood, the binomial likelihood, and the Poisson likelihood.</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>Note that planning is a game of optimization that could be avoided. If you are using the Bayesian approach to audit sampling, it is not required to plan a specific sample size in advance <span class="co">[</span><span class="ot">@Derks2022</span><span class="co">]</span>. That is because in Bayesian inference, the posterior distribution after seeing each item is used as the prior distribution for the next item. That means that you can simply start sampling and monitor the evidence in the data over time. However, to get an idea of how many samples are required to reduce the sampling risk to an level, planning a sample using a Bayesian approach can still be good practice.</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## Required Information</span></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>First, planning a minimum sample requires knowledge of the conditions that lead  to acceptance or rejection of the population (i.e., the sampling objectives). Typically, sampling objectives can be classified into one or both of the following:</span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Hypothesis testing**: The goal of the sample is to obtain evidence for or against the claim that the misstatement in the population is lower than a given value (i.e., the performance materiality).</span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Estimation**: The goal of the sample is to obtain an accurate estimate of the misstatement in the population with a certain precision.</span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>Second, it is advised to specify the expected (or tolerable) misstatements in the sample. The expected misstatements are the misstatements that you allow in the sample, while still retaining the desired amount of assurance about the  population. It is strongly recommended to set the value for the expected misstatements in the sample conservatively to minimize the chance of the observed misstatements in the sample exceeding the expected misstatements, which would imply that insufficient work has been done in the end to reduce the sampling risk to an appropriately low level.</span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>Finally, next to determining the sampling objective(s) and the expected misstatements, it is important to determine the statistical distribution linking the sample outcomes to the population misstatement. This distribution is called the likelihood (i.e., <span class="in">`poisson`</span>, <span class="in">`binomial`</span>, or <span class="in">`hypergeometric`</span>). All three aforementioned likelihoods are commonly used in an audit sampling context, however, <span class="in">`poisson`</span> is the default likelihood in **jfa** because it is the most conservative of the three. In the subsections below, we elaborate on the three standard likelihoods for audit sampling and demonstrate how they can be used to obtain a minimum sample size.</span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a>In **jfa**, determining an appropriate sample size is achieved via the <span class="in">`planning()`</span> function.</span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">When the sampling objectives, the expected misstatements and the likelihood are set, there exists only one sample size that minimizes the amount of audit effort. Image available under a [CC-BY-NC 4.0](https://creativecommons.org/licenses/by-nc/4.0/legalcode) license.</span><span class="co">](img/book_puzzle.png)</span>{fig-align="center" width=75%}</span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Hypergeometric Likelihood</span></span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a>The hypergeometric distribution is a discrete probability distribution that is commonly used to model the number of events occurring in a fixed number of trials when the population size is known. It assumes that samples are drawn from the population without replacement, and is therefore the likelihood that most closely resembles the audit practice. For our purpose, we can use the hypergeometric distribution as a likelihood to model the number of misstatements that are expected to be found in the sample.</span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-34"><a href="#cb105-34" aria-hidden="true" tabindex="-1"></a>The probability mass function (PMF) of the hypergeometric distribution is given by:</span>
<span id="cb105-35"><a href="#cb105-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-36"><a href="#cb105-36" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-37"><a href="#cb105-37" aria-hidden="true" tabindex="-1"></a>  p(X = k) = \frac{\binom{K}{k} \binom{N-K}{n-k}}{\binom{N}{n}},</span>
<span id="cb105-38"><a href="#cb105-38" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-39"><a href="#cb105-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-40"><a href="#cb105-40" aria-hidden="true" tabindex="-1"></a>where $k$ is the number of misstatements in the sample, $n$ is the sample size, $N$ is the population size and $K$ is the total number of misstatements assumed in the population. The assumed misstatements $K$ is a whole number, that is, a linear extrapolation of the maximum tolerable misstatement rate (i.e., the performance materiality) $\theta_{max}$ to the total population of size $N$:</span>
<span id="cb105-41"><a href="#cb105-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-42"><a href="#cb105-42" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-43"><a href="#cb105-43" aria-hidden="true" tabindex="-1"></a>  K = \lceil \theta_{max} N \rceil.</span>
<span id="cb105-44"><a href="#cb105-44" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-45"><a href="#cb105-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-46"><a href="#cb105-46" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb105-47"><a href="#cb105-47" aria-hidden="true" tabindex="-1"></a>$\lceil...\rceil$ is the ceiling function, which means that $\lceil1.2\rceil = 2$.</span>
<span id="cb105-48"><a href="#cb105-48" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-49"><a href="#cb105-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-50"><a href="#cb105-50" aria-hidden="true" tabindex="-1"></a>Let's consider how to use the hypergeometric likelihood to calculate the minimum sample size needed to reduce the sampling risk to an appropriately low level.</span>
<span id="cb105-51"><a href="#cb105-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-52"><a href="#cb105-52" aria-hidden="true" tabindex="-1"></a><span class="fu">### Classical planning</span></span>
<span id="cb105-53"><a href="#cb105-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-54"><a href="#cb105-54" aria-hidden="true" tabindex="-1"></a>In classical planning using the hypergeometric likelihood, the following statistical model is specified:</span>
<span id="cb105-55"><a href="#cb105-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-56"><a href="#cb105-56" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-57"><a href="#cb105-57" aria-hidden="true" tabindex="-1"></a>  k \sim \text{Hypergeometric}(n, N, K)</span>
<span id="cb105-58"><a href="#cb105-58" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-59"><a href="#cb105-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-60"><a href="#cb105-60" aria-hidden="true" tabindex="-1"></a>Given the performance materiality $\theta_{max}$, we can compute $K$ and solve for the minimum sample size $n$ needed to reduce the sampling risk to an appropriately low level. This sample size is also dependent on the number of misstatements that the auditor expects, or tolerates, in the sample.</span>
<span id="cb105-61"><a href="#cb105-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-62"><a href="#cb105-62" aria-hidden="true" tabindex="-1"></a><span class="fu">#### No Expected Misstatements</span></span>
<span id="cb105-63"><a href="#cb105-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-64"><a href="#cb105-64" aria-hidden="true" tabindex="-1"></a>If the auditor does not expect any misstatements in the sample, they can set $k = 0$, which consequently determines how the sample size can be calculated. For example, if we want to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.03$ in a population of $N = 1000$ items, then $K = \lceil 0.03 \cdot 1000 \rceil = 30$ and the minimum sample size under the assumption of no expected misstatements in the sample is $n = 94$.</span>
<span id="cb105-65"><a href="#cb105-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-68"><a href="#cb105-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-69"><a href="#cb105-69" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">1000</span>)</span>
<span id="cb105-70"><a href="#cb105-70" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb105-71"><a href="#cb105-71" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-72"><a href="#cb105-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-73"><a href="#cb105-73" aria-hidden="true" tabindex="-1"></a>The sample size of 94 can be confirmed by checking that 94 is the minimum integer that results in less than 5 percent probability of finding 0 misstatements, given the assumption that the population misstatement is truly 3 percent. The <span class="in">`dhyper()`</span> function calculates the probability of observing $k$ missatements in a sample of $n$ items given the assumed hypergeometric distribution with $N$ items and $K$ assumed misstatements in the population. By calculating this probability for $n = 93$, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk $\alpha$.</span>
<span id="cb105-74"><a href="#cb105-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-77"><a href="#cb105-77" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-78"><a href="#cb105-78" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fl">0.03</span> <span class="sc">*</span> <span class="dv">1000</span>)</span>
<span id="cb105-79"><a href="#cb105-79" aria-hidden="true" tabindex="-1"></a><span class="fu">dhyper</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">m =</span> K, <span class="at">n =</span> <span class="dv">1000</span> <span class="sc">-</span> K, <span class="at">k =</span> <span class="dv">93</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb105-80"><a href="#cb105-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-81"><a href="#cb105-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-82"><a href="#cb105-82" aria-hidden="true" tabindex="-1"></a>However, for $n = 94$ the relevant probability is lower than the sampling risk $\alpha$ and thus the sample size is considered to be sufficient.</span>
<span id="cb105-83"><a href="#cb105-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-86"><a href="#cb105-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-87"><a href="#cb105-87" aria-hidden="true" tabindex="-1"></a><span class="fu">dhyper</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">m =</span> K, <span class="at">n =</span> <span class="dv">1000</span> <span class="sc">-</span> K, <span class="at">k =</span> <span class="dv">94</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb105-88"><a href="#cb105-88" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-89"><a href="#cb105-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-90"><a href="#cb105-90" aria-hidden="true" tabindex="-1"></a>We can make this sample size visually intuitive by showing the hypergeometric($k$ | 94, 1000, 30) distribution and highlighting the probability for $k = 0$. This probability is lower than the required sampling risk $\alpha = 0.05$.</span>
<span id="cb105-91"><a href="#cb105-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-94"><a href="#cb105-94" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-95"><a href="#cb105-95" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb105-96"><a href="#cb105-96" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-97"><a href="#cb105-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-98"><a href="#cb105-98" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb105-99"><a href="#cb105-99" aria-hidden="true" tabindex="-1"></a><span class="fu">## Additional arguments to `planning()`</span></span>
<span id="cb105-100"><a href="#cb105-100" aria-hidden="true" tabindex="-1"></a>The <span class="in">`planning()`</span> function has two additional arguments that are not shown in the call above: <span class="in">`by`</span> and <span class="in">`max`</span>. The argument <span class="in">`by`</span> sets the increment between possible sample sizes for consideration. For example, <span class="in">`by = 5`</span> considers only samples of size 10, 20, 30, etc:</span>
<span id="cb105-101"><a href="#cb105-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-104"><a href="#cb105-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-105"><a href="#cb105-105" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">1000</span>, <span class="at">by =</span> <span class="dv">10</span>)</span>
<span id="cb105-106"><a href="#cb105-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-107"><a href="#cb105-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-108"><a href="#cb105-108" aria-hidden="true" tabindex="-1"></a>The argument <span class="in">`max`</span> sets the sample size at which the algorithm terminates. This can be used to avoid too many iterations of the algorithm at very low values of the performance materiality. For instance, <span class="in">`max = 50`</span> throws an error if more than 100 samples are required.</span>
<span id="cb105-109"><a href="#cb105-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-110"><a href="#cb105-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r error=TRUE}</span></span>
<span id="cb105-111"><a href="#cb105-111" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">1000</span>, <span class="at">max =</span> <span class="dv">50</span>)</span>
<span id="cb105-112"><a href="#cb105-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-113"><a href="#cb105-113" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-114"><a href="#cb105-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-115"><a href="#cb105-115" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Expected Misstatements</span></span>
<span id="cb105-116"><a href="#cb105-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-117"><a href="#cb105-117" aria-hidden="true" tabindex="-1"></a>If the auditor expects misstatements in the sample, they can set $k$ to any integer value, which consequently determines how the sample size can be calculated. As another example, if we want to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.03$ in a population of $N = 1000$ items, then the required sample size under the assumption of one expected misstatement in the sample is $n = 147$.</span>
<span id="cb105-118"><a href="#cb105-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-121"><a href="#cb105-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-122"><a href="#cb105-122" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">1000</span>)</span>
<span id="cb105-123"><a href="#cb105-123" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb105-124"><a href="#cb105-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-125"><a href="#cb105-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-126"><a href="#cb105-126" aria-hidden="true" tabindex="-1"></a>Once again, the sample size of 147 can be confirmed by checking that 147 is the minimum integer that results in less than 5 percent probability of finding 0 or 1 misstatements, given the assumption that that the population misstatement is truly 3 percent. By calculating this probability for $n = 146$, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk $\alpha$.</span>
<span id="cb105-127"><a href="#cb105-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-130"><a href="#cb105-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-131"><a href="#cb105-131" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dhyper</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">m =</span> K, <span class="at">n =</span> <span class="dv">1000</span> <span class="sc">-</span> K, <span class="at">k =</span> <span class="dv">146</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb105-132"><a href="#cb105-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-133"><a href="#cb105-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-134"><a href="#cb105-134" aria-hidden="true" tabindex="-1"></a>However, for $n = 147$ the relevant probability is lower than the sampling risk $\alpha$ and thus the sample size is considered to be sufficient.</span>
<span id="cb105-135"><a href="#cb105-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-138"><a href="#cb105-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-139"><a href="#cb105-139" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dhyper</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">m =</span> K, <span class="at">n =</span> <span class="dv">1000</span> <span class="sc">-</span> K, <span class="at">k =</span> <span class="dv">147</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb105-140"><a href="#cb105-140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-141"><a href="#cb105-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-142"><a href="#cb105-142" aria-hidden="true" tabindex="-1"></a>Like before, we can make this sample size visually intuitive by showing the hypergeometric($k$ | 147, 1000, 30) distribution and highlighting the probabilities for $k = 0$ and $k = 1$. The sum of these probabilities is lower than the required sampling risk $\alpha = 0.05$.</span>
<span id="cb105-143"><a href="#cb105-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-146"><a href="#cb105-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-147"><a href="#cb105-147" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb105-148"><a href="#cb105-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-149"><a href="#cb105-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-150"><a href="#cb105-150" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayesian Planning</span></span>
<span id="cb105-151"><a href="#cb105-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-152"><a href="#cb105-152" aria-hidden="true" tabindex="-1"></a>Performing Bayesian planning with the hypergeometric likelihood <span class="co">[</span><span class="ot">@Dyer1993</span><span class="co">]</span> requires that you specify a prior distribution for the total misstatements $K$. Practically, this means that you should provide an input for the <span class="in">`prior`</span> argument in the <span class="in">`planning()`</span> function.</span>
<span id="cb105-153"><a href="#cb105-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-154"><a href="#cb105-154" aria-hidden="true" tabindex="-1"></a>Setting <span class="in">`prior = TRUE`</span> performs Bayesian planning using a default prior conjugate to the specified <span class="in">`likelihood`</span> (i.e., a beta-binomial prior). Because this is a Bayesian analysis, the following statistical model is specified:</span>
<span id="cb105-155"><a href="#cb105-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-156"><a href="#cb105-156" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb105-157"><a href="#cb105-157" aria-hidden="true" tabindex="-1"></a>  k &amp;\sim \text{Hypergeometric}(n, N, K) <span class="sc">\\</span></span>
<span id="cb105-158"><a href="#cb105-158" aria-hidden="true" tabindex="-1"></a>  K &amp;\sim \text{Beta-binomial}(N, \alpha, \beta)</span>
<span id="cb105-159"><a href="#cb105-159" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb105-160"><a href="#cb105-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-161"><a href="#cb105-161" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb105-162"><a href="#cb105-162" aria-hidden="true" tabindex="-1"></a>The beta-binomial prior distribution is the conjugate prior for to the hypergeometric likelihood (see this <span class="co">[</span><span class="ot">list</span><span class="co">](https://en.wikipedia.org/wiki/Conjugate_prior#Table_of_conjugate_distributions)</span> of conjugate priors), which means that the posterior distribution of $K$ can be determined analytically. For example, if the prior distribution for $K$ is:</span>
<span id="cb105-163"><a href="#cb105-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-164"><a href="#cb105-164" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-165"><a href="#cb105-165" aria-hidden="true" tabindex="-1"></a>  K \sim \text{Beta-binomial}(N, \alpha, \beta) \,\,\,\,\,\,\,\,\,\, K = 0, \ldots, N</span>
<span id="cb105-166"><a href="#cb105-166" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-167"><a href="#cb105-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-168"><a href="#cb105-168" aria-hidden="true" tabindex="-1"></a>and the auditor has observed a sample of $n$ items containing $k$ misstatements, then the posterior distribution for $K$ is:</span>
<span id="cb105-169"><a href="#cb105-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-170"><a href="#cb105-170" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-171"><a href="#cb105-171" aria-hidden="true" tabindex="-1"></a>  K \sim \text{Beta-binomial}(N - n, \alpha + k, \beta + k - n) \,\,\,\,\,\,\,\,\,\, K = k, k + 1, \ldots, N - n + k.</span>
<span id="cb105-172"><a href="#cb105-172" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-173"><a href="#cb105-173" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-174"><a href="#cb105-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-175"><a href="#cb105-175" aria-hidden="true" tabindex="-1"></a><span class="fu">#### No Expected Misstatements</span></span>
<span id="cb105-176"><a href="#cb105-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-177"><a href="#cb105-177" aria-hidden="true" tabindex="-1"></a>Planning for no expected misstatements in the sample can be done by setting the value for the <span class="in">`expected`</span> argument to zero. If we want to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.1$ in a population of $N = 20$ items, then the required sample size under the assumption of zero expected misstatements in the sample is $n = 15$. The command below uses a default beta-binomial($N$, 1, 1) prior distribution to plan this sample, since <span class="in">`planning()`</span> is given the hypergeometric likelihood.</span>
<span id="cb105-178"><a href="#cb105-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-181"><a href="#cb105-181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-182"><a href="#cb105-182" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.1</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">20</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb105-183"><a href="#cb105-183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-184"><a href="#cb105-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-185"><a href="#cb105-185" aria-hidden="true" tabindex="-1"></a>The <span class="in">`summary()`</span> function can be used to obatain relevant information about the planning.</span>
<span id="cb105-186"><a href="#cb105-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-189"><a href="#cb105-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-190"><a href="#cb105-190" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span>
<span id="cb105-191"><a href="#cb105-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-192"><a href="#cb105-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-193"><a href="#cb105-193" aria-hidden="true" tabindex="-1"></a>You can inspect how the prior distribution compares to the expected posterior distribution by using the <span class="in">`plot()`</span> function. The expected posterior distribution is the posterior distribution that would occur if you actually observed the planned sample containing the expected misstatements. Note that the posterior distribution is only defined in the range <span class="co">[</span><span class="ot">$k$; $N - n + k$</span><span class="co">]</span>, since a part of the population has already been seen.</span>
<span id="cb105-194"><a href="#cb105-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-197"><a href="#cb105-197" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-198"><a href="#cb105-198" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb105-199"><a href="#cb105-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-200"><a href="#cb105-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-201"><a href="#cb105-201" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Expected Misstatements</span></span>
<span id="cb105-202"><a href="#cb105-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-203"><a href="#cb105-203" aria-hidden="true" tabindex="-1"></a>Planning for expected misstatements in the sample can be done by setting the value for the <span class="in">`expected`</span> argument to a different value than zero. For example, the command below calculates the minimum sample size to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.1$ in a population of $N = 50$ items, given one expected misstatement in the sample. This sample size is $n = 32$.</span>
<span id="cb105-204"><a href="#cb105-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-207"><a href="#cb105-207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-208"><a href="#cb105-208" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.1</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">50</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb105-209"><a href="#cb105-209" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb105-210"><a href="#cb105-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-211"><a href="#cb105-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-212"><a href="#cb105-212" aria-hidden="true" tabindex="-1"></a>Like before, you can inspect how the prior distribution compares to the expected posterior distribution by using the <span class="in">`plot()`</span> function.</span>
<span id="cb105-213"><a href="#cb105-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-216"><a href="#cb105-216" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-217"><a href="#cb105-217" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb105-218"><a href="#cb105-218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-219"><a href="#cb105-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-220"><a href="#cb105-220" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Binomial Likelihood</span></span>
<span id="cb105-221"><a href="#cb105-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-222"><a href="#cb105-222" aria-hidden="true" tabindex="-1"></a>The binomial distribution is a discrete probability distribution that is commonly used to model the number of events occurring in a fixed number of trials. It is similar to the hypergeometric distribution, however, it assumes that samples are drawn from the population with replacement. For our purpose, we can use the binomial distribution as a likelihood to model the number of misstatements that are expected to be found in the sample. </span>
<span id="cb105-223"><a href="#cb105-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-224"><a href="#cb105-224" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb105-225"><a href="#cb105-225" aria-hidden="true" tabindex="-1"></a>In audit sampling, the binomial likelihood is often used to approximate the hypergeometric likelihood since it is easier to work with (i.e., it only has two parameters: $\theta$ and $n$, while the hypergeometric has three: $n$, $N$, and $K$). However, the binomial likelihood is more conservative than the hypergeometric likelihood, meaning that resulting sample sizes will be higher.</span>
<span id="cb105-226"><a href="#cb105-226" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-227"><a href="#cb105-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-228"><a href="#cb105-228" aria-hidden="true" tabindex="-1"></a>The probability mass function (PMF) of the binomial distribution is given by:</span>
<span id="cb105-229"><a href="#cb105-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-230"><a href="#cb105-230" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-231"><a href="#cb105-231" aria-hidden="true" tabindex="-1"></a>  p(k; n, \theta) = \binom{n}{k} \theta^{k} (1-\theta)^{n - k},</span>
<span id="cb105-232"><a href="#cb105-232" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-233"><a href="#cb105-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-234"><a href="#cb105-234" aria-hidden="true" tabindex="-1"></a>where $k$ is the number of misstatements in the sample, $n$ is the sample size and $\theta$ is the probability of misstatement in the population. Let's consider how to use the binomial likelihood to calculate the minimum sample size needed to reduce the sampling risk to an appropriately low level.</span>
<span id="cb105-235"><a href="#cb105-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-236"><a href="#cb105-236" aria-hidden="true" tabindex="-1"></a><span class="fu">### Classical Planning</span></span>
<span id="cb105-237"><a href="#cb105-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-238"><a href="#cb105-238" aria-hidden="true" tabindex="-1"></a>In classical planning using the binomial likelihood, the following statistical model is specified:</span>
<span id="cb105-239"><a href="#cb105-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-240"><a href="#cb105-240" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-241"><a href="#cb105-241" aria-hidden="true" tabindex="-1"></a>  k \sim \text{Binomial}(n, \theta_{max})</span>
<span id="cb105-242"><a href="#cb105-242" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-243"><a href="#cb105-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-244"><a href="#cb105-244" aria-hidden="true" tabindex="-1"></a><span class="fu">#### No Expected Misstatements</span></span>
<span id="cb105-245"><a href="#cb105-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-246"><a href="#cb105-246" aria-hidden="true" tabindex="-1"></a>If the auditor does not expect any misstatements in the sample, they can set $k = 0$, which consequently determines how the sample size can be calculated. Given a performance materiality $\theta_{max}$, we can solve for the minimum sample size $n$ needed to reduce the sampling risk to an appropriately low level. A useful trick to utilize is that, if we do not expect any misstatements in the sample, the formula for the minimum required sample size reduces to:</span>
<span id="cb105-247"><a href="#cb105-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-248"><a href="#cb105-248" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-249"><a href="#cb105-249" aria-hidden="true" tabindex="-1"></a>  n = \lceil\frac{\ln(\alpha)}{\ln(1 - \theta_{max})}\rceil.</span>
<span id="cb105-250"><a href="#cb105-250" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-251"><a href="#cb105-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-252"><a href="#cb105-252" aria-hidden="true" tabindex="-1"></a>For example, if we want to achieve an assurance level of 95 percent ($\alpha=0.05$) for a performance materiality of $\theta_{max} = 0.03$, then the required sample size under the assumption of zero expected misstatements in the sample is $n = 99$.</span>
<span id="cb105-253"><a href="#cb105-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-256"><a href="#cb105-256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-257"><a href="#cb105-257" aria-hidden="true" tabindex="-1"></a><span class="fu">ceiling</span>(<span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.95</span>) <span class="sc">/</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.03</span>))</span>
<span id="cb105-258"><a href="#cb105-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-259"><a href="#cb105-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-260"><a href="#cb105-260" aria-hidden="true" tabindex="-1"></a>In **jfa**, this sample size can be replicated using the following code:</span>
<span id="cb105-261"><a href="#cb105-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-264"><a href="#cb105-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-265"><a href="#cb105-265" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb105-266"><a href="#cb105-266" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb105-267"><a href="#cb105-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-268"><a href="#cb105-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-269"><a href="#cb105-269" aria-hidden="true" tabindex="-1"></a>The sample size of 99 can be confirmed by checking that 99 is the minimum integer that results in less than 5 percent probability of finding 0 misstatements, given the assumption that the population misstatement is truly 3 percent. The <span class="in">`dbinom()`</span> function calculates the probability of observing $k$ missatements in a sample of $n$ items given an assumed misstatement probability $\theta_{max}$. By calculating this probability for $n = 98$, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk $\alpha$.</span>
<span id="cb105-270"><a href="#cb105-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-273"><a href="#cb105-273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-274"><a href="#cb105-274" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">98</span>, <span class="at">prob =</span> <span class="fl">0.03</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb105-275"><a href="#cb105-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-276"><a href="#cb105-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-277"><a href="#cb105-277" aria-hidden="true" tabindex="-1"></a>However, for $n = 99$ the relevant probability is lower than the sampling risk $\alpha$ and thus the sample size is considered to be sufficient.</span>
<span id="cb105-278"><a href="#cb105-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-281"><a href="#cb105-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-282"><a href="#cb105-282" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">99</span>, <span class="at">prob =</span> <span class="fl">0.03</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb105-283"><a href="#cb105-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-284"><a href="#cb105-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-285"><a href="#cb105-285" aria-hidden="true" tabindex="-1"></a>We can make this sample size visually intuitive by showing the binomial($k$ | 99, 0.03) distribution and highlighting the probability for $k = 0$. This probability is lower than the required sampling risk $\alpha = 0.05$.</span>
<span id="cb105-286"><a href="#cb105-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-289"><a href="#cb105-289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-290"><a href="#cb105-290" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb105-291"><a href="#cb105-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-292"><a href="#cb105-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-293"><a href="#cb105-293" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Expected Misstatementss</span></span>
<span id="cb105-294"><a href="#cb105-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-295"><a href="#cb105-295" aria-hidden="true" tabindex="-1"></a>However, if the number of expected misstatements in the sample is non-zero, it becomes more difficult to solve the formula for $n$. Hence, they will need to set $k$ to a different integer value, which consequently determines how the sample size is calculated. Here, we can iteratively try every value of $n$ and return the smallest integer that satisfies the sampling objectives.</span>
<span id="cb105-296"><a href="#cb105-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-297"><a href="#cb105-297" aria-hidden="true" tabindex="-1"></a>In **jfa**, this can be done by adjusting the <span class="in">`expected`</span> argument in the <span class="in">`planning()`</span> function. For example, if we want to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.03$, then the required sample size under the assumption of one expected misstatement in the sample is $n = 157$.</span>
<span id="cb105-298"><a href="#cb105-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-301"><a href="#cb105-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-302"><a href="#cb105-302" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb105-303"><a href="#cb105-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-304"><a href="#cb105-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-305"><a href="#cb105-305" aria-hidden="true" tabindex="-1"></a>Once again, the sample size of 157 can be confirmed by checking that 157 is the minimum integer that results in less than 5 percent probability of finding 0 or 1 misstatements, given the assumption that the population misstatement is truly 3 percent. By calculating this probability for $n = 156$, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk $\alpha$.</span>
<span id="cb105-306"><a href="#cb105-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-309"><a href="#cb105-309" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-310"><a href="#cb105-310" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dbinom</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">156</span>, <span class="at">prob =</span> <span class="fl">0.03</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb105-311"><a href="#cb105-311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-312"><a href="#cb105-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-313"><a href="#cb105-313" aria-hidden="true" tabindex="-1"></a>However, for $n = 157$ the relevant probability is lower than the sampling risk $\alpha$ and thus the sample size is considered to be sufficient.</span>
<span id="cb105-314"><a href="#cb105-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-317"><a href="#cb105-317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-318"><a href="#cb105-318" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dbinom</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">157</span>, <span class="at">prob =</span> <span class="fl">0.03</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb105-319"><a href="#cb105-319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-320"><a href="#cb105-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-321"><a href="#cb105-321" aria-hidden="true" tabindex="-1"></a>Like before, we can make this sample size visually intuitive by showing the binomial($k$ | 157, 0.03) distribution and highlighting the probabilities for $k = 0$ and $k = 1$. The sum of these probabilities is lower than the required sampling risk $\alpha = 0.05$.</span>
<span id="cb105-322"><a href="#cb105-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-325"><a href="#cb105-325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-326"><a href="#cb105-326" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb105-327"><a href="#cb105-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-328"><a href="#cb105-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-329"><a href="#cb105-329" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Expected Misstatement Rate</span></span>
<span id="cb105-330"><a href="#cb105-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-331"><a href="#cb105-331" aria-hidden="true" tabindex="-1"></a>When the expected misstatement rate in the sample $\theta_{exp}$ is assessed, the value for $k$ can be determined as $k = n\theta_{exp}$, which consequently determines how the sample size can be calculated.</span>
<span id="cb105-332"><a href="#cb105-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-333"><a href="#cb105-333" aria-hidden="true" tabindex="-1"></a>To account for the fact that $k$ can have non-integer values in this case, we can use a well-known similarity between the binomial distribution and the beta distribution to plan the sample size. The upper bound for any binomial($k$; $n$, $\theta$) distributed variable can also be obtained via percentiles of the beta($1 + k$, $n - k$) distribution. </span>
<span id="cb105-334"><a href="#cb105-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-335"><a href="#cb105-335" aria-hidden="true" tabindex="-1"></a>For example, the upper bound for a sample of $n = 10$ items containing $k = 2$ misstatements, when calculated via the traditional <span class="in">`binom.test()`</span> is:</span>
<span id="cb105-336"><a href="#cb105-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-339"><a href="#cb105-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-340"><a href="#cb105-340" aria-hidden="true" tabindex="-1"></a>ub_binom <span class="ot">&lt;-</span> <span class="fu">binom.test</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">p =</span> <span class="fl">0.03</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">alternative =</span> <span class="st">"less"</span>)<span class="sc">$</span>conf.int[<span class="dv">2</span>]</span>
<span id="cb105-341"><a href="#cb105-341" aria-hidden="true" tabindex="-1"></a>ub_binom</span>
<span id="cb105-342"><a href="#cb105-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-343"><a href="#cb105-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-344"><a href="#cb105-344" aria-hidden="true" tabindex="-1"></a>When calculated via the beta relationship, the upper bound is:</span>
<span id="cb105-345"><a href="#cb105-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-348"><a href="#cb105-348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-349"><a href="#cb105-349" aria-hidden="true" tabindex="-1"></a>ub_beta <span class="ot">&lt;-</span> <span class="fu">qbeta</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">shape1 =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span>, <span class="at">shape2 =</span> <span class="dv">10</span> <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb105-350"><a href="#cb105-350" aria-hidden="true" tabindex="-1"></a>ub_beta</span>
<span id="cb105-351"><a href="#cb105-351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-352"><a href="#cb105-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-353"><a href="#cb105-353" aria-hidden="true" tabindex="-1"></a>It can be validated that the two approaches result in the same upper bound via:</span>
<span id="cb105-354"><a href="#cb105-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-357"><a href="#cb105-357" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-358"><a href="#cb105-358" aria-hidden="true" tabindex="-1"></a>ub_binom <span class="sc">==</span> ub_beta</span>
<span id="cb105-359"><a href="#cb105-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-360"><a href="#cb105-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-361"><a href="#cb105-361" aria-hidden="true" tabindex="-1"></a>This relationship between the binomial likelihood and the beta distribution is deliberately **not** used in **jfa**. That is because, in the case of the binomial distribution, the auditing standards round the tolerable misstatements upwards to a whole number. For example, if we try to call the `planning()` function with the argument `expected = 1.5`, **jfa** will internally convert this to <span class="in">`expected = 2`</span> and base the sample size on this in order to stay compliant with @AICPA-A. The resulting sample size is $n = 208$ in this case.</span>
<span id="cb105-362"><a href="#cb105-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-365"><a href="#cb105-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-366"><a href="#cb105-366" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="fl">1.5</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb105-367"><a href="#cb105-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-368"><a href="#cb105-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-369"><a href="#cb105-369" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayesian Planning</span></span>
<span id="cb105-370"><a href="#cb105-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-371"><a href="#cb105-371" aria-hidden="true" tabindex="-1"></a>Performing Bayesian planning using the binomial likelihood requires that you specify a prior distribution for the parameter $\theta$. Practically, this means that you should provide an input for the <span class="in">`prior`</span> argument in the <span class="in">`planning()`</span> function.</span>
<span id="cb105-372"><a href="#cb105-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-373"><a href="#cb105-373" aria-hidden="true" tabindex="-1"></a>Setting <span class="in">`prior = TRUE`</span> performs Bayesian planning using a default prior conjugate to the specified <span class="in">`likelihood`</span> (i.e., a beta prior). Because this is a Bayesian analysis, the following statistical model is specified:</span>
<span id="cb105-374"><a href="#cb105-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-375"><a href="#cb105-375" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb105-376"><a href="#cb105-376" aria-hidden="true" tabindex="-1"></a>  k &amp;\sim \text{Binomial}(n, \theta) <span class="sc">\\</span></span>
<span id="cb105-377"><a href="#cb105-377" aria-hidden="true" tabindex="-1"></a>  \theta &amp;\sim \text{Beta}(\alpha, \beta)</span>
<span id="cb105-378"><a href="#cb105-378" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb105-379"><a href="#cb105-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-380"><a href="#cb105-380" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb105-381"><a href="#cb105-381" aria-hidden="true" tabindex="-1"></a>The beta prior distribution is the conjugate prior for the binomial likelihood (see this <span class="co">[</span><span class="ot">list</span><span class="co">](https://en.wikipedia.org/wiki/Conjugate_prior#Table_of_conjugate_distributions)</span> of conjugate priors), which means that the posterior distribution of $\theta$ can be determined analytically. For example, if the prior distribution for $\theta$ is:</span>
<span id="cb105-382"><a href="#cb105-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-383"><a href="#cb105-383" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-384"><a href="#cb105-384" aria-hidden="true" tabindex="-1"></a>  \theta \sim \text{Beta}(\alpha, \beta) \,\,\,\,\,\,\,\,\,\, \theta \in <span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span></span>
<span id="cb105-385"><a href="#cb105-385" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-386"><a href="#cb105-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-387"><a href="#cb105-387" aria-hidden="true" tabindex="-1"></a>and the auditor has observed a sample of $n$ items containing $k$ misstatements, then the posterior distribution for $\theta$ is:</span>
<span id="cb105-388"><a href="#cb105-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-389"><a href="#cb105-389" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-390"><a href="#cb105-390" aria-hidden="true" tabindex="-1"></a>  \theta \sim \text{Beta}(\alpha + k, \beta + n - k) \,\,\,\,\,\,\,\,\,\, \theta \in <span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span>.</span>
<span id="cb105-391"><a href="#cb105-391" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-392"><a href="#cb105-392" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-393"><a href="#cb105-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-394"><a href="#cb105-394" aria-hidden="true" tabindex="-1"></a>For example, the command below uses a default beta($\alpha=1$, $\beta=1$) prior distribution to plan the sample, since <span class="in">`planning()`</span> is given the binomial likelihood. If we want to achieve an assurance level of 95 percent ($\alpha=0.05$) for a performance materiality of $\theta_{max} = 0.03$, then the required sample size under the assumption of zero expected misstatements in the sample is $n = 98$.</span>
<span id="cb105-395"><a href="#cb105-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-398"><a href="#cb105-398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-399"><a href="#cb105-399" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb105-400"><a href="#cb105-400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-401"><a href="#cb105-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-402"><a href="#cb105-402" aria-hidden="true" tabindex="-1"></a>The <span class="in">`summary()`</span> function can be used to obatain relevant information about the planning.</span>
<span id="cb105-403"><a href="#cb105-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-406"><a href="#cb105-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-407"><a href="#cb105-407" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span>
<span id="cb105-408"><a href="#cb105-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-409"><a href="#cb105-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-410"><a href="#cb105-410" aria-hidden="true" tabindex="-1"></a>You can inspect how the prior distribution compares to the expected posterior distribution by using the <span class="in">`plot()`</span> function. The expected posterior distribution is the posterior distribution that would occur if you actually observed the planned sample containing the expected misstatements.</span>
<span id="cb105-411"><a href="#cb105-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-414"><a href="#cb105-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-415"><a href="#cb105-415" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb105-416"><a href="#cb105-416" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-417"><a href="#cb105-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-418"><a href="#cb105-418" aria-hidden="true" tabindex="-1"></a>The input for the <span class="in">`prior`</span> argument can also be an object created by the <span class="in">`auditPrior`</span> function. If <span class="in">`planning()`</span> receives a prior for which there is no conjugate likelihood available, it will numerically derive the posterior distribution. For example, the command below uses a Normal(0, 0.05) prior distribution to plan the sample using the binomial likelihood. Because this is a Bayesian analysis, the following statistical model is specified:</span>
<span id="cb105-419"><a href="#cb105-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-420"><a href="#cb105-420" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb105-421"><a href="#cb105-421" aria-hidden="true" tabindex="-1"></a>  k &amp;\sim \text{Binomial}(n, \theta) <span class="sc">\\</span></span>
<span id="cb105-422"><a href="#cb105-422" aria-hidden="true" tabindex="-1"></a>  \theta &amp;\sim \text{Normal}(\mu = 0, \sigma = 0.05)</span>
<span id="cb105-423"><a href="#cb105-423" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb105-424"><a href="#cb105-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-427"><a href="#cb105-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-428"><a href="#cb105-428" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"normal"</span>, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">beta =</span> <span class="fl">0.05</span>)</span>
<span id="cb105-429"><a href="#cb105-429" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>, <span class="at">prior =</span> prior)</span>
<span id="cb105-430"><a href="#cb105-430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-431"><a href="#cb105-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-432"><a href="#cb105-432" aria-hidden="true" tabindex="-1"></a>The <span class="in">`summary()`</span> function can be used to obatain relevant information about the planning.</span>
<span id="cb105-433"><a href="#cb105-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-436"><a href="#cb105-436" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-437"><a href="#cb105-437" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span>
<span id="cb105-438"><a href="#cb105-438" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-439"><a href="#cb105-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-440"><a href="#cb105-440" aria-hidden="true" tabindex="-1"></a>The resulting sample size under this prior is $n = 90$, a reduction of 8 samples when compared to the default beta(1, 1) prior distribution.</span>
<span id="cb105-441"><a href="#cb105-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-444"><a href="#cb105-444" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-445"><a href="#cb105-445" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb105-446"><a href="#cb105-446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-447"><a href="#cb105-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-448"><a href="#cb105-448" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Poisson Likelihood</span></span>
<span id="cb105-449"><a href="#cb105-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-450"><a href="#cb105-450" aria-hidden="true" tabindex="-1"></a>The Poisson distribution is a discrete probability distribution that is commonly used to model the number of events occurring in a fixed time or space. We can use the Poisson distribution as a likelihood to model the number of misstatements that are expected to be found in the sample.</span>
<span id="cb105-451"><a href="#cb105-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-452"><a href="#cb105-452" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb105-453"><a href="#cb105-453" aria-hidden="true" tabindex="-1"></a>In audit sampling, the Poisson likelihood is often used to approximate the binomial likelihood since it is easier to work with (i.e., it only has one parameter: $\lambda$, while the binomial has two parameters: $\theta$ and $n$). However, the Poisson likelihood is more conservative than the binomial likelihood, meaning that resulting sample sizes will be higher.</span>
<span id="cb105-454"><a href="#cb105-454" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-455"><a href="#cb105-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-456"><a href="#cb105-456" aria-hidden="true" tabindex="-1"></a>The probability mass function (PMF) of the Poisson distribution is given by:</span>
<span id="cb105-457"><a href="#cb105-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-458"><a href="#cb105-458" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-459"><a href="#cb105-459" aria-hidden="true" tabindex="-1"></a>  p(k; \lambda) = \frac{\lambda^k e^{-\lambda}}{k!},</span>
<span id="cb105-460"><a href="#cb105-460" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-461"><a href="#cb105-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-462"><a href="#cb105-462" aria-hidden="true" tabindex="-1"></a>where $k$ is the number of misstatements in the sample, and $\lambda$ is the average number of misstatements expected in the sample. The average number of misstatements is related to the misstatement rate in the population, denoted by $\theta$, and the sample size, $n$, by the following equation:</span>
<span id="cb105-463"><a href="#cb105-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-464"><a href="#cb105-464" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-465"><a href="#cb105-465" aria-hidden="true" tabindex="-1"></a>  \lambda = n \theta.</span>
<span id="cb105-466"><a href="#cb105-466" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-467"><a href="#cb105-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-468"><a href="#cb105-468" aria-hidden="true" tabindex="-1"></a>Let's consider how to use the Poisson likelihood to calculate the minimum sample size needed to reduce the sampling risk to an appropriately low level.</span>
<span id="cb105-469"><a href="#cb105-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-470"><a href="#cb105-470" aria-hidden="true" tabindex="-1"></a><span class="fu">### Classical planning</span></span>
<span id="cb105-471"><a href="#cb105-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-472"><a href="#cb105-472" aria-hidden="true" tabindex="-1"></a>In classical planning using the Poisson likelihood, the following statistical model is specified:</span>
<span id="cb105-473"><a href="#cb105-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-474"><a href="#cb105-474" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-475"><a href="#cb105-475" aria-hidden="true" tabindex="-1"></a>  k \sim \text{Poisson}(n \theta_{max})</span>
<span id="cb105-476"><a href="#cb105-476" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-477"><a href="#cb105-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-478"><a href="#cb105-478" aria-hidden="true" tabindex="-1"></a><span class="fu">#### No Expected Misstatements</span></span>
<span id="cb105-479"><a href="#cb105-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-480"><a href="#cb105-480" aria-hidden="true" tabindex="-1"></a>Given the performance materiality $\theta_{max}$ and the Poisson likelihood, we can solve for the minimum sample size $n$ needed to reduce the sampling risk to an appropriately low level. A useful trick to utilize is that, if we do not expect any misstatements in the sample, the formula for the required sample size reduces to:</span>
<span id="cb105-481"><a href="#cb105-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-482"><a href="#cb105-482" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-483"><a href="#cb105-483" aria-hidden="true" tabindex="-1"></a>  n = \lceil-\frac{\ln(\alpha)}{\theta_{max}}\rceil.</span>
<span id="cb105-484"><a href="#cb105-484" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-485"><a href="#cb105-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-486"><a href="#cb105-486" aria-hidden="true" tabindex="-1"></a>For example, if we want to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.03$, then the required sample size under the assumption of zero expected misstatements in the sample is $n = 100$.</span>
<span id="cb105-487"><a href="#cb105-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-490"><a href="#cb105-490" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-491"><a href="#cb105-491" aria-hidden="true" tabindex="-1"></a><span class="fu">ceiling</span>(<span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.95</span>) <span class="sc">/</span> <span class="fl">0.03</span>)</span>
<span id="cb105-492"><a href="#cb105-492" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-493"><a href="#cb105-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-494"><a href="#cb105-494" aria-hidden="true" tabindex="-1"></a>In **jfa**, this sample size can be replicated using the following code:</span>
<span id="cb105-495"><a href="#cb105-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-498"><a href="#cb105-498" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-499"><a href="#cb105-499" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>)</span>
<span id="cb105-500"><a href="#cb105-500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-501"><a href="#cb105-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-502"><a href="#cb105-502" aria-hidden="true" tabindex="-1"></a>The sample size of 100 can be confirmed by checking that 100 is the minimum integer that results in less than 5 percent probability of finding 0 misstatements, given the assumption that the population misstatement is truly 3 percent. The <span class="in">`dpois()`</span> function calculates the probability of observing $k$ missatements in a sample of $n$ items given an assumed misstatement probability $\theta_{max}$. By calculating this probability for $n = 99$, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk $\alpha$.</span>
<span id="cb105-503"><a href="#cb105-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-506"><a href="#cb105-506" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-507"><a href="#cb105-507" aria-hidden="true" tabindex="-1"></a><span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">lambda =</span> <span class="dv">99</span> <span class="sc">*</span> <span class="fl">0.03</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb105-508"><a href="#cb105-508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-509"><a href="#cb105-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-510"><a href="#cb105-510" aria-hidden="true" tabindex="-1"></a>However, for $n = 100$ the relevant probability is lower than the sampling risk $\alpha$ and thus the sample size is considered to be sufficient.</span>
<span id="cb105-511"><a href="#cb105-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-514"><a href="#cb105-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-515"><a href="#cb105-515" aria-hidden="true" tabindex="-1"></a><span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">lambda =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fl">0.03</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb105-516"><a href="#cb105-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-517"><a href="#cb105-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-518"><a href="#cb105-518" aria-hidden="true" tabindex="-1"></a>We can make this visually intuitive by showing the Poisson($k$ | 100 $\times$ 0.03) distribution and highlighting the probability for $k = 0$. This probability is lower than the required sampling risk $\alpha = 0.05$.</span>
<span id="cb105-519"><a href="#cb105-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-522"><a href="#cb105-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-523"><a href="#cb105-523" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb105-524"><a href="#cb105-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-525"><a href="#cb105-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-526"><a href="#cb105-526" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Expected Misstatements</span></span>
<span id="cb105-527"><a href="#cb105-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-528"><a href="#cb105-528" aria-hidden="true" tabindex="-1"></a>However, if the number of expected misstatements in the sample is non-zero, it becomes more difficult to solve the formula for $n$ algebraically. Hence, they will need to set $k$ to a different integer value. Next, we can iteratively try every value of $n$ and return the smallest integer that satisfies the sampling objectives.</span>
<span id="cb105-529"><a href="#cb105-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-530"><a href="#cb105-530" aria-hidden="true" tabindex="-1"></a>For example, if we want to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.03$, then the required sample size under the assumption of one expected misstatement in the sample is $n = 159$.</span>
<span id="cb105-531"><a href="#cb105-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-534"><a href="#cb105-534" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-535"><a href="#cb105-535" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>)</span>
<span id="cb105-536"><a href="#cb105-536" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-537"><a href="#cb105-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-538"><a href="#cb105-538" aria-hidden="true" tabindex="-1"></a>Once again, the sample size of 159 can be confirmed by checking that 159 is the minimum integer that results in less than 5 percent probability of finding 0 or 1 misstatements, given the assumption that the population misstatement is truly 3 percent. By calculating this probability for $n = 158$, we can show that this sample size is insufficient as the relevant probability is higher than the sampling risk $\alpha$.</span>
<span id="cb105-539"><a href="#cb105-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-542"><a href="#cb105-542" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-543"><a href="#cb105-543" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">lambda =</span> <span class="dv">158</span> <span class="sc">*</span> <span class="fl">0.03</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb105-544"><a href="#cb105-544" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-545"><a href="#cb105-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-546"><a href="#cb105-546" aria-hidden="true" tabindex="-1"></a>However, for $n = 159$ the relevant probability is lower than the sampling risk $\alpha$ and thus the sample size is considered to be sufficient.</span>
<span id="cb105-547"><a href="#cb105-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-550"><a href="#cb105-550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-551"><a href="#cb105-551" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">lambda =</span> <span class="dv">159</span> <span class="sc">*</span> <span class="fl">0.03</span>)) <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb105-552"><a href="#cb105-552" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-553"><a href="#cb105-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-554"><a href="#cb105-554" aria-hidden="true" tabindex="-1"></a>Like before, we can make this visually intuitive by showing the Poisson($k$ | 159 $\times$ 0.03) distribution and highlighting the probabilities for $k = 0$ and $k = 1$. The sum of these probabilities is lower than the required sampling risk $\alpha = 0.05$.</span>
<span id="cb105-555"><a href="#cb105-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-556"><a href="#cb105-556" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE}</span></span>
<span id="cb105-557"><a href="#cb105-557" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb105-558"><a href="#cb105-558" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-559"><a href="#cb105-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-560"><a href="#cb105-560" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Expected Misstatement Rate</span></span>
<span id="cb105-561"><a href="#cb105-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-562"><a href="#cb105-562" aria-hidden="true" tabindex="-1"></a>When the expected misstatements in the sample $\theta_{exp}$ is assessed, the value for $k$ can be determined as $k = n\theta_{exp}$, which consequently determines how the sample size can be calculated.</span>
<span id="cb105-563"><a href="#cb105-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-564"><a href="#cb105-564" aria-hidden="true" tabindex="-1"></a>To account for the fact that $k$ can have non-integer values in this case, we use a well-known similarity between the Poisson distribution and the gamma distribution to plan the sample size. The upper bound for any Poisson($k$; $n \theta$) distributed variable can also be obtained via percentiles of the gamma($1 + k$, $n$) distribution. </span>
<span id="cb105-565"><a href="#cb105-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-566"><a href="#cb105-566" aria-hidden="true" tabindex="-1"></a>For example, the upper bound for a sample of $n = 10$ items containing $k = 2$</span>
<span id="cb105-567"><a href="#cb105-567" aria-hidden="true" tabindex="-1"></a>misstatements, when calculated via the traditional <span class="in">`poisson.test()`</span> is:</span>
<span id="cb105-568"><a href="#cb105-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-571"><a href="#cb105-571" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-572"><a href="#cb105-572" aria-hidden="true" tabindex="-1"></a>ub_pois <span class="ot">&lt;-</span> <span class="fu">poisson.test</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">T =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="fl">0.03</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">alternative =</span> <span class="st">"less"</span>)<span class="sc">$</span>conf.int[<span class="dv">2</span>]</span>
<span id="cb105-573"><a href="#cb105-573" aria-hidden="true" tabindex="-1"></a>ub_pois</span>
<span id="cb105-574"><a href="#cb105-574" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-575"><a href="#cb105-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-576"><a href="#cb105-576" aria-hidden="true" tabindex="-1"></a>When calculated via the relationship with the gamma distribution, the upper bound is:</span>
<span id="cb105-577"><a href="#cb105-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-580"><a href="#cb105-580" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-581"><a href="#cb105-581" aria-hidden="true" tabindex="-1"></a>ub_gamma <span class="ot">&lt;-</span> <span class="fu">qgamma</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">shape =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span>, <span class="at">rate =</span> <span class="dv">10</span>)</span>
<span id="cb105-582"><a href="#cb105-582" aria-hidden="true" tabindex="-1"></a>ub_gamma</span>
<span id="cb105-583"><a href="#cb105-583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-584"><a href="#cb105-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-585"><a href="#cb105-585" aria-hidden="true" tabindex="-1"></a>It can be validated that the two approaches result in the same upper bound via:</span>
<span id="cb105-586"><a href="#cb105-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-589"><a href="#cb105-589" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-590"><a href="#cb105-590" aria-hidden="true" tabindex="-1"></a>ub_pois <span class="sc">==</span> ub_gamma</span>
<span id="cb105-591"><a href="#cb105-591" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-592"><a href="#cb105-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-593"><a href="#cb105-593" aria-hidden="true" tabindex="-1"></a>This relationship between the Poisson likelihood and the gamma distribution is used under the hood in **jfa**. For example, if we want to achieve an assurance level of 95 percent ($\alpha = 0.05$) for a performance materiality of $\theta_{max} = 0.03$, then the required sample size under the assumption of 1.5 expected misstatements in the sample is $n = 185$.</span>
<span id="cb105-594"><a href="#cb105-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-597"><a href="#cb105-597" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-598"><a href="#cb105-598" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="fl">1.5</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>)</span>
<span id="cb105-599"><a href="#cb105-599" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-600"><a href="#cb105-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-601"><a href="#cb105-601" aria-hidden="true" tabindex="-1"></a>The sample size of 185 can be confirmed by checking that 185 is the minimum integer that results in less than 5 percent probability of finding a misstatement rate in the population equal to, or higher than, 3 percent. By calculating this probability for $n = 184$, we can show that this sample size is insufficient as the relevant upper bound is higher than the performance materiality $\theta_{max}$.</span>
<span id="cb105-602"><a href="#cb105-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-605"><a href="#cb105-605" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-606"><a href="#cb105-606" aria-hidden="true" tabindex="-1"></a><span class="fu">qgamma</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">shape =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fl">1.5</span>, <span class="at">rate =</span> <span class="dv">184</span>) <span class="sc">&lt;</span> <span class="fl">0.03</span></span>
<span id="cb105-607"><a href="#cb105-607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-608"><a href="#cb105-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-609"><a href="#cb105-609" aria-hidden="true" tabindex="-1"></a>However, for $n = 185$ the relevant upper bound is lower than the performance materiality $\theta_{max}$ and thus the sample size is sufficient.</span>
<span id="cb105-610"><a href="#cb105-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-613"><a href="#cb105-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-614"><a href="#cb105-614" aria-hidden="true" tabindex="-1"></a><span class="fu">qgamma</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">shape =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fl">1.5</span>, <span class="at">rate =</span> <span class="dv">185</span>) <span class="sc">&lt;</span> <span class="fl">0.03</span></span>
<span id="cb105-615"><a href="#cb105-615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-616"><a href="#cb105-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-617"><a href="#cb105-617" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayesian Planning</span></span>
<span id="cb105-618"><a href="#cb105-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-619"><a href="#cb105-619" aria-hidden="true" tabindex="-1"></a>Performing Bayesian planning with the Poisson likelihood requires that you specify a prior distribution for the parameter $\theta$. Practically, this means that you should provide an input for the <span class="in">`prior`</span> argument in the <span class="in">`planning()`</span> function.</span>
<span id="cb105-620"><a href="#cb105-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-621"><a href="#cb105-621" aria-hidden="true" tabindex="-1"></a>Setting <span class="in">`prior = TRUE`</span> performs Bayesian planning using a default prior conjugate to the specified <span class="in">`likelihood`</span> (i.e., a gamma prior). Because this is a Bayesian analysis, the following statistical model is specified:</span>
<span id="cb105-622"><a href="#cb105-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-623"><a href="#cb105-623" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb105-624"><a href="#cb105-624" aria-hidden="true" tabindex="-1"></a>  k &amp;\sim \text{Poisson}(n\theta) <span class="sc">\\</span></span>
<span id="cb105-625"><a href="#cb105-625" aria-hidden="true" tabindex="-1"></a>  \theta &amp;\sim \text{Gamma}(\alpha, \beta)</span>
<span id="cb105-626"><a href="#cb105-626" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb105-627"><a href="#cb105-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-628"><a href="#cb105-628" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb105-629"><a href="#cb105-629" aria-hidden="true" tabindex="-1"></a>The gamma prior distribution is the conjugate prior for the Poisson likelihood (see this <span class="co">[</span><span class="ot">list</span><span class="co">](https://en.wikipedia.org/wiki/Conjugate_prior#Table_of_conjugate_distributions)</span> of conjugate priors), which means that the posterior distribution of $\theta$ can be determined analytically. For example, if the prior distribution for $\theta$ is:</span>
<span id="cb105-630"><a href="#cb105-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-631"><a href="#cb105-631" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-632"><a href="#cb105-632" aria-hidden="true" tabindex="-1"></a>  \theta \sim \text{Gamma}(\alpha, \beta) \,\,\,\,\,\,\,\,\,\, \theta \in <span class="co">[</span><span class="ot">0, \infty</span><span class="co">]</span></span>
<span id="cb105-633"><a href="#cb105-633" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-634"><a href="#cb105-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-635"><a href="#cb105-635" aria-hidden="true" tabindex="-1"></a>and the auditor has observed a sample of $n$ items containing $k$ misstatements, then the posterior distribution for $\theta$ is:</span>
<span id="cb105-636"><a href="#cb105-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-637"><a href="#cb105-637" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-638"><a href="#cb105-638" aria-hidden="true" tabindex="-1"></a>  \theta \sim \text{Gamma}(\alpha + k, \beta + n) \,\,\,\,\,\,\,\,\,\, \theta \in <span class="co">[</span><span class="ot">0, \infty</span><span class="co">]</span>.</span>
<span id="cb105-639"><a href="#cb105-639" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-640"><a href="#cb105-640" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-641"><a href="#cb105-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-642"><a href="#cb105-642" aria-hidden="true" tabindex="-1"></a>For example, the command below uses a default gamma($\alpha=1$, $\beta=1$) prior distribution to plan the sample, since <span class="in">`planning()`</span> is given the Poisson likelihood. If we want to achieve an assurance level of 95 percent ($\alpha=0.05$) for a performance materiality of $\theta_{max} = 0.03$, then the required sample size under the assumption of zero expected misstatements in the sample is $n = 99$.</span>
<span id="cb105-643"><a href="#cb105-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-646"><a href="#cb105-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-647"><a href="#cb105-647" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb105-648"><a href="#cb105-648" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-649"><a href="#cb105-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-650"><a href="#cb105-650" aria-hidden="true" tabindex="-1"></a>The <span class="in">`summary()`</span> function can be used to obatain relevant information about the planning.</span>
<span id="cb105-651"><a href="#cb105-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-654"><a href="#cb105-654" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-655"><a href="#cb105-655" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span>
<span id="cb105-656"><a href="#cb105-656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-657"><a href="#cb105-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-658"><a href="#cb105-658" aria-hidden="true" tabindex="-1"></a>You can inspect how the prior distribution compares to the expected posterior distribution by using the <span class="in">`plot()`</span> function. The expected posterior distribution is the posterior distribution that would occur if you actually observed the planned sample containing the expected misstatements.</span>
<span id="cb105-659"><a href="#cb105-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-662"><a href="#cb105-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-663"><a href="#cb105-663" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb105-664"><a href="#cb105-664" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-665"><a href="#cb105-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-666"><a href="#cb105-666" aria-hidden="true" tabindex="-1"></a>The input for the <span class="in">`prior`</span> argument can also be an object created by the <span class="in">`auditPrior`</span> function. If <span class="in">`planning()`</span> receives a prior for which there is no conjugate likelihood available, it will numerically derive the posterior distribution. For example, the command below uses a Normal(0, 0.05) prior distribution to plan the sample using the Poisson likelihood. Concretely, this means that the following statistical model is specified:</span>
<span id="cb105-667"><a href="#cb105-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-668"><a href="#cb105-668" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb105-669"><a href="#cb105-669" aria-hidden="true" tabindex="-1"></a>  k &amp;\sim \text{Poisson}(n\theta) <span class="sc">\\</span></span>
<span id="cb105-670"><a href="#cb105-670" aria-hidden="true" tabindex="-1"></a>  \theta &amp;\sim \text{Normal}(\mu = 0, \sigma = 0.05)</span>
<span id="cb105-671"><a href="#cb105-671" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb105-672"><a href="#cb105-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-675"><a href="#cb105-675" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-676"><a href="#cb105-676" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"normal"</span>, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">beta =</span> <span class="fl">0.05</span>)</span>
<span id="cb105-677"><a href="#cb105-677" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> <span class="dv">0</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"poisson"</span>, <span class="at">prior =</span> prior)</span>
<span id="cb105-678"><a href="#cb105-678" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-679"><a href="#cb105-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-680"><a href="#cb105-680" aria-hidden="true" tabindex="-1"></a>The <span class="in">`summary()`</span> function can be used to obatain relevant information about the planning.</span>
<span id="cb105-681"><a href="#cb105-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-684"><a href="#cb105-684" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-685"><a href="#cb105-685" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span>
<span id="cb105-686"><a href="#cb105-686" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-687"><a href="#cb105-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-688"><a href="#cb105-688" aria-hidden="true" tabindex="-1"></a>The resulting sample size under this prior is $n = 91$, a reduction of 8 samples when compared to the default gamma(1, 1) prior.</span>
<span id="cb105-689"><a href="#cb105-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-692"><a href="#cb105-692" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-693"><a href="#cb105-693" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb105-694"><a href="#cb105-694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-695"><a href="#cb105-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-696"><a href="#cb105-696" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prior Distributions</span></span>
<span id="cb105-697"><a href="#cb105-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-698"><a href="#cb105-698" aria-hidden="true" tabindex="-1"></a>The <span class="in">`auditPrior()`</span> function is used to specify a prior distribution for audit sampling. Below is an enumeration of the several ways that a prior distribution can be constructed using this function.</span>
<span id="cb105-699"><a href="#cb105-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-700"><a href="#cb105-700" aria-hidden="true" tabindex="-1"></a><span class="fu">### Default Prior</span></span>
<span id="cb105-701"><a href="#cb105-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-702"><a href="#cb105-702" aria-hidden="true" tabindex="-1"></a>The default prior distributions are created using <span class="in">`method = 'default'`</span>. **jfa**'s default priors satisfy two criteria: 1) they contain relatively little information about the population misstatement and 2) they are proper (i.e., they integrate to 1). The default priors in **jfa** are:</span>
<span id="cb105-703"><a href="#cb105-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-704"><a href="#cb105-704" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'poisson'`</span>: gamma($\alpha$ = 1, $\beta$ = 1)</span>
<span id="cb105-705"><a href="#cb105-705" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'binomial'`</span>: beta($\alpha$ = 1, $\beta$ = 1)</span>
<span id="cb105-706"><a href="#cb105-706" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'hypergeometric'`</span>: beta-binomial(N, $\alpha$ = 1, $\beta$ = 1)</span>
<span id="cb105-707"><a href="#cb105-707" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'normal'`</span>: normal($\mu$ = 0, $\sigma$ = 1000)</span>
<span id="cb105-708"><a href="#cb105-708" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'uniform'`</span>: uniform(min = 0, max = 1) </span>
<span id="cb105-709"><a href="#cb105-709" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'cauchy'`</span>: Cauchy($x_0$ = 0, $\gamma$ = 1000)</span>
<span id="cb105-710"><a href="#cb105-710" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 't'`</span>: Student-t(df = 1)</span>
<span id="cb105-711"><a href="#cb105-711" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'chisq'`</span>: chi-squared(df = 1)</span>
<span id="cb105-712"><a href="#cb105-712" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`likelihood = 'exponential'`</span>: exponential($\lambda$ = 1)</span>
<span id="cb105-713"><a href="#cb105-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-716"><a href="#cb105-716" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-717"><a href="#cb105-717" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"default"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb105-718"><a href="#cb105-718" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(prior)</span>
<span id="cb105-719"><a href="#cb105-719" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-720"><a href="#cb105-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-721"><a href="#cb105-721" aria-hidden="true" tabindex="-1"></a>All prior distributions can be visually inspected via the <span class="in">`plot()`</span> function.</span>
<span id="cb105-722"><a href="#cb105-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-725"><a href="#cb105-725" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-726"><a href="#cb105-726" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span>
<span id="cb105-727"><a href="#cb105-727" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-728"><a href="#cb105-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-729"><a href="#cb105-729" aria-hidden="true" tabindex="-1"></a>Furthermore, the <span class="in">`predict()`</span> function produces the predictions of the prior distribution on the data level for a sample of <span class="in">`n`</span> items. For example, the command below requests the prediction of the default beta(1, 1) prior for a hypothetical sample of 6 items.</span>
<span id="cb105-730"><a href="#cb105-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-733"><a href="#cb105-733" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-734"><a href="#cb105-734" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(prior, <span class="at">n =</span> <span class="dv">6</span>)</span>
<span id="cb105-735"><a href="#cb105-735" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-736"><a href="#cb105-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-737"><a href="#cb105-737" aria-hidden="true" tabindex="-1"></a>The predictions of the prior distribution can be visualized using the <span class="in">`plot()`</span> function.</span>
<span id="cb105-738"><a href="#cb105-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-741"><a href="#cb105-741" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-742"><a href="#cb105-742" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predict</span>(prior, <span class="at">n =</span> <span class="dv">10</span>))</span>
<span id="cb105-743"><a href="#cb105-743" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-744"><a href="#cb105-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-745"><a href="#cb105-745" aria-hidden="true" tabindex="-1"></a><span class="fu">### Parametric Prior</span></span>
<span id="cb105-746"><a href="#cb105-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-747"><a href="#cb105-747" aria-hidden="true" tabindex="-1"></a>You can manually specify the parameters of the prior distribution with <span class="in">`method = 'param'`</span> and the <span class="in">`alpha`</span> and <span class="in">`beta`</span> arguments, which correspond to the first and (optionally) second parameter of the prior as described above. For example, the commands below create a beta(2, 10) prior distribution, a normal(0.025, 0.05) prior distribution and a Student-t(0.01) prior distribution.</span>
<span id="cb105-748"><a href="#cb105-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-751"><a href="#cb105-751" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-752"><a href="#cb105-752" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">alpha =</span> <span class="dv">2</span>, <span class="at">beta =</span> <span class="dv">10</span>)</span>
<span id="cb105-753"><a href="#cb105-753" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"normal"</span>, <span class="at">alpha =</span> <span class="fl">0.025</span>, <span class="at">beta =</span> <span class="fl">0.05</span>)</span>
<span id="cb105-754"><a href="#cb105-754" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"t"</span>, <span class="at">alpha =</span> <span class="fl">0.01</span>)</span>
<span id="cb105-755"><a href="#cb105-755" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-756"><a href="#cb105-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-757"><a href="#cb105-757" aria-hidden="true" tabindex="-1"></a><span class="fu">### Improper Prior</span></span>
<span id="cb105-758"><a href="#cb105-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-759"><a href="#cb105-759" aria-hidden="true" tabindex="-1"></a>You can construct an improper prior distribution with classical properties using <span class="in">`method = 'strict'`</span>. The posterior distribution of from this prior yields the same results as the classical methodology with respect to sample sizes and upper limits, but is only proper once a single non-misstated unit is present in the  sample <span class="co">[</span><span class="ot">@Derks2022b</span><span class="co">]</span>. For example, the command below creates an improper beta(1, 0) prior distribution.</span>
<span id="cb105-760"><a href="#cb105-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-761"><a href="#cb105-761" aria-hidden="true" tabindex="-1"></a>::: {.callout-note appearance="simple"}</span>
<span id="cb105-762"><a href="#cb105-762" aria-hidden="true" tabindex="-1"></a>This method requires the <span class="in">`poisson`</span>, <span class="in">`binomial`</span> or <span class="in">`hypergeometric`</span> likelihood.</span>
<span id="cb105-763"><a href="#cb105-763" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-764"><a href="#cb105-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-767"><a href="#cb105-767" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-768"><a href="#cb105-768" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"strict"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb105-769"><a href="#cb105-769" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-770"><a href="#cb105-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-771"><a href="#cb105-771" aria-hidden="true" tabindex="-1"></a><span class="fu">### Impartial Prior</span></span>
<span id="cb105-772"><a href="#cb105-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-773"><a href="#cb105-773" aria-hidden="true" tabindex="-1"></a>You can incorporate the assumption that tolerable misstatement is equally likely as intolerable misstatement <span class="co">[</span><span class="ot">@Derks2022b</span><span class="co">]</span> using <span class="in">`method = 'impartial'`</span>. For example, the command below creates an impartial beta prior distribution for a performance materiality of 5 percent.</span>
<span id="cb105-774"><a href="#cb105-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-775"><a href="#cb105-775" aria-hidden="true" tabindex="-1"></a>::: {.callout-note appearance="simple"}</span>
<span id="cb105-776"><a href="#cb105-776" aria-hidden="true" tabindex="-1"></a>This method requires that you specify a value for the <span class="in">`materiality`</span>.</span>
<span id="cb105-777"><a href="#cb105-777" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-778"><a href="#cb105-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-781"><a href="#cb105-781" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-782"><a href="#cb105-782" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"impartial"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>)</span>
<span id="cb105-783"><a href="#cb105-783" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-784"><a href="#cb105-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-785"><a href="#cb105-785" aria-hidden="true" tabindex="-1"></a><span class="fu">### Probability of Tolerable Misstatement</span></span>
<span id="cb105-786"><a href="#cb105-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-787"><a href="#cb105-787" aria-hidden="true" tabindex="-1"></a>You can manually assign prior probabilities to the hypothesis of tolerable  misstatement and the hypotheses of intolerable misstatement <span class="co">[</span><span class="ot">@Derks2021</span><span class="co">]</span> with <span class="in">`method = 'hyp'`</span> in combination with <span class="in">`p.hmin`</span>. For example, the command below incorporates the information that the hypothesis of tolerable misstatement  has a probability of 60 percent into a beta prior distribution.</span>
<span id="cb105-788"><a href="#cb105-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-789"><a href="#cb105-789" aria-hidden="true" tabindex="-1"></a>::: {.callout-note appearance="simple"}</span>
<span id="cb105-790"><a href="#cb105-790" aria-hidden="true" tabindex="-1"></a>This method requires that you specify a value for the <span class="in">`materiality`</span>.</span>
<span id="cb105-791"><a href="#cb105-791" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-792"><a href="#cb105-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-795"><a href="#cb105-795" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-796"><a href="#cb105-796" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"hyp"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">p.hmin =</span> <span class="fl">0.6</span>)</span>
<span id="cb105-797"><a href="#cb105-797" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-798"><a href="#cb105-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-799"><a href="#cb105-799" aria-hidden="true" tabindex="-1"></a><span class="fu">### Audit Risk Model</span></span>
<span id="cb105-800"><a href="#cb105-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-801"><a href="#cb105-801" aria-hidden="true" tabindex="-1"></a>You can translate risk assessments from the Audit Risk Model (inherent risk and internal control risk) into a prior distribution <span class="co">[</span><span class="ot">@Derks2021</span><span class="co">]</span> using <span class="in">`method = 'arm'`</span> in combination with the <span class="in">`ir`</span> and <span class="in">`cr`</span> arguments. For example, the command below incorporates the information that the inherent risk is equal to 90 percent and internal control risk is equal to 60 percent into a beta prior distribution.</span>
<span id="cb105-802"><a href="#cb105-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-803"><a href="#cb105-803" aria-hidden="true" tabindex="-1"></a>::: {.callout-note appearance="simple"}</span>
<span id="cb105-804"><a href="#cb105-804" aria-hidden="true" tabindex="-1"></a>This method requires the <span class="in">`poisson`</span>, <span class="in">`binomial`</span> or <span class="in">`hypergeometric`</span> likelihood.</span>
<span id="cb105-805"><a href="#cb105-805" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-806"><a href="#cb105-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-809"><a href="#cb105-809" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-810"><a href="#cb105-810" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"arm"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">ir =</span> <span class="fl">0.9</span>, <span class="at">cr =</span> <span class="fl">0.6</span>)</span>
<span id="cb105-811"><a href="#cb105-811" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-812"><a href="#cb105-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-813"><a href="#cb105-813" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayesian Risk Assessment Model</span></span>
<span id="cb105-814"><a href="#cb105-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-815"><a href="#cb105-815" aria-hidden="true" tabindex="-1"></a>You can incorporate information about the mode and the upper bound of the prior distribution using <span class="in">`method = 'bram'`</span>. For example, the code below incorporates the information that the mode of the prior distribution is 1 percent and the upper bound is 60 percent into a beta prior distribution.</span>
<span id="cb105-816"><a href="#cb105-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-817"><a href="#cb105-817" aria-hidden="true" tabindex="-1"></a>::: {.callout-note appearance="simple"}</span>
<span id="cb105-818"><a href="#cb105-818" aria-hidden="true" tabindex="-1"></a>This method requires the <span class="in">`poisson`</span>, <span class="in">`binomial`</span> or <span class="in">`hypergeometric`</span> likelihood.</span>
<span id="cb105-819"><a href="#cb105-819" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-820"><a href="#cb105-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-823"><a href="#cb105-823" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-824"><a href="#cb105-824" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"bram"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">expected =</span> <span class="fl">0.01</span>, <span class="at">ub =</span> <span class="fl">0.6</span>)</span>
<span id="cb105-825"><a href="#cb105-825" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-826"><a href="#cb105-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-827"><a href="#cb105-827" aria-hidden="true" tabindex="-1"></a><span class="fu">### Earlier Sample</span></span>
<span id="cb105-828"><a href="#cb105-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-829"><a href="#cb105-829" aria-hidden="true" tabindex="-1"></a>You can incorporate information from an earlier sample into the prior distribution <span class="co">[</span><span class="ot">@Derks2021</span><span class="co">]</span> using <span class="in">`method = 'sample'`</span> in combination with <span class="in">`x`</span> and <span class="in">`n`</span>. For example, the command below incorporates the information from an earlier sample of 30 items in which 0 misstatements were found into a beta prior distribution.</span>
<span id="cb105-830"><a href="#cb105-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-831"><a href="#cb105-831" aria-hidden="true" tabindex="-1"></a>::: {.callout-note appearance="simple"}</span>
<span id="cb105-832"><a href="#cb105-832" aria-hidden="true" tabindex="-1"></a>This method requires the <span class="in">`poisson`</span>, <span class="in">`binomial`</span> or <span class="in">`hypergeometric`</span> likelihood.</span>
<span id="cb105-833"><a href="#cb105-833" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-834"><a href="#cb105-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-837"><a href="#cb105-837" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-838"><a href="#cb105-838" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"sample"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">n =</span> <span class="dv">30</span>)</span>
<span id="cb105-839"><a href="#cb105-839" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-840"><a href="#cb105-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-841"><a href="#cb105-841" aria-hidden="true" tabindex="-1"></a><span class="fu">### Weighted Earlier Sample</span></span>
<span id="cb105-842"><a href="#cb105-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-843"><a href="#cb105-843" aria-hidden="true" tabindex="-1"></a>You can incorporate information from last years results, weighted by a factor <span class="co">[</span><span class="ot">@Derks2021</span><span class="co">]</span>, into the prior distribution using <span class="in">`method = 'factor'`</span> in combination with <span class="in">`x`</span> and <span class="in">`n`</span>. For example, the command below incorporates the information from a last years results (a sample of 58 items in which 0 misstatements were found), weighted by a factor 0.7, into a beta prior distribution.</span>
<span id="cb105-844"><a href="#cb105-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-845"><a href="#cb105-845" aria-hidden="true" tabindex="-1"></a>::: {.callout-note appearance="simple"}</span>
<span id="cb105-846"><a href="#cb105-846" aria-hidden="true" tabindex="-1"></a>This method requires the <span class="in">`poisson`</span>, <span class="in">`binomial`</span> or <span class="in">`hypergeometric`</span> likelihood.</span>
<span id="cb105-847"><a href="#cb105-847" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-848"><a href="#cb105-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-851"><a href="#cb105-851" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-852"><a href="#cb105-852" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"factor"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">n =</span> <span class="dv">58</span>, <span class="at">factor =</span> <span class="fl">0.7</span>)</span>
<span id="cb105-853"><a href="#cb105-853" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-854"><a href="#cb105-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-855"><a href="#cb105-855" aria-hidden="true" tabindex="-1"></a><span class="fu">### Nonparametric Prior</span></span>
<span id="cb105-856"><a href="#cb105-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-857"><a href="#cb105-857" aria-hidden="true" tabindex="-1"></a>You can base the prior on samples of the prior distribution using  <span class="in">`method = 'nonparam'`</span> in combination with <span class="in">`samples`</span>. For example, the command below creates a prior on 1000 samples of a beta(1, 10) distribution.</span>
<span id="cb105-858"><a href="#cb105-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-859"><a href="#cb105-859" aria-hidden="true" tabindex="-1"></a>::: {.callout-note appearance="simple"}</span>
<span id="cb105-860"><a href="#cb105-860" aria-hidden="true" tabindex="-1"></a>The <span class="in">`likelihood`</span> argument is not required and will be ignored in this method.</span>
<span id="cb105-861"><a href="#cb105-861" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb105-862"><a href="#cb105-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-865"><a href="#cb105-865" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-866"><a href="#cb105-866" aria-hidden="true" tabindex="-1"></a><span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"nonparam"</span>, <span class="at">samples =</span> stats<span class="sc">::</span><span class="fu">rbeta</span>(<span class="dv">1000</span>, <span class="dv">1</span>, <span class="dv">10</span>))</span>
<span id="cb105-867"><a href="#cb105-867" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-868"><a href="#cb105-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-869"><a href="#cb105-869" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practical Examples</span></span>
<span id="cb105-870"><a href="#cb105-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-871"><a href="#cb105-871" aria-hidden="true" tabindex="-1"></a>This section contains practical examples of how to conduct the planning of statistical audit samples and demonstrates how to set up a prior distribution based on various types of relevant audit information.</span>
<span id="cb105-872"><a href="#cb105-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-873"><a href="#cb105-873" aria-hidden="true" tabindex="-1"></a><span class="fu">### Audit Risk Model</span></span>
<span id="cb105-874"><a href="#cb105-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-875"><a href="#cb105-875" aria-hidden="true" tabindex="-1"></a>In our first example, an auditor is performing tests of details on a population of the auditee. For instance, let's say an auditor is performing an audit on a company's accounts payable transactions. The company has a total of $N$ = 1000 accounts payable transactions for the year. Rather than testing all 1000 transactions, the auditor can choose to test a sample of the transactions. The performance materiality for the payable transactions account is set to $\theta_{max}$ = 3 percent, and the audit risk is set to $\alpha = 0.05$, or 5 percent. Based on the results of last years audit, where the most likely estimate of the misstatement was 1 percent, the auditor wants to tolerate 1 percent misstatements in the sample before giving an unqualified opinion on the population.</span>
<span id="cb105-876"><a href="#cb105-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-879"><a href="#cb105-879" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-880"><a href="#cb105-880" aria-hidden="true" tabindex="-1"></a>ar          <span class="ot">&lt;-</span> <span class="fl">0.05</span> <span class="co"># Audit risk</span></span>
<span id="cb105-881"><a href="#cb105-881" aria-hidden="true" tabindex="-1"></a>materiality <span class="ot">&lt;-</span> <span class="fl">0.03</span> <span class="co"># Performance materiality</span></span>
<span id="cb105-882"><a href="#cb105-882" aria-hidden="true" tabindex="-1"></a>expected    <span class="ot">&lt;-</span> <span class="fl">0.01</span> <span class="co"># Tolerable deviation rate</span></span>
<span id="cb105-883"><a href="#cb105-883" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-884"><a href="#cb105-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-885"><a href="#cb105-885" aria-hidden="true" tabindex="-1"></a>Before tests of details, the auditor has assessed risk of material misstatement via the audit risk model. In this example, the auditor has assessed the effectiveness of the company's internal controls, such as its segregation of duties and its risk management processes, and has determined that they are sufficient to prevent or detect material misstatements. Because the internal control systems were effective, the auditor assesses the control risk as medium. The auditor's firm defines the risk categories low, medium, and high respectively as 50 percent, 60 percent, and 100 percent. According to the Audit Risk Model, the detection risk can be calculated as a function of the audit risk, the inherent risk and the control risk.</span>
<span id="cb105-886"><a href="#cb105-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-889"><a href="#cb105-889" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-890"><a href="#cb105-890" aria-hidden="true" tabindex="-1"></a>ir <span class="ot">&lt;-</span> <span class="dv">1</span>              <span class="co"># Inherent risk</span></span>
<span id="cb105-891"><a href="#cb105-891" aria-hidden="true" tabindex="-1"></a>cr <span class="ot">&lt;-</span> <span class="fl">0.6</span>            <span class="co"># Control risk</span></span>
<span id="cb105-892"><a href="#cb105-892" aria-hidden="true" tabindex="-1"></a>dr <span class="ot">&lt;-</span> ar <span class="sc">/</span> (ir <span class="sc">*</span> cr) <span class="co"># Detection risk</span></span>
<span id="cb105-893"><a href="#cb105-893" aria-hidden="true" tabindex="-1"></a>dr</span>
<span id="cb105-894"><a href="#cb105-894" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-895"><a href="#cb105-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-896"><a href="#cb105-896" aria-hidden="true" tabindex="-1"></a>By using the detection risk of 8.33 percent as the sampling risk for this population, the auditor can plan for a sample while taking into account the risk-reducing information. The required minimum sample size is 174 in this case.</span>
<span id="cb105-897"><a href="#cb105-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-900"><a href="#cb105-900" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-901"><a href="#cb105-901" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> expected, <span class="at">conf.level =</span> <span class="dv">1</span> <span class="sc">-</span> dr)</span>
<span id="cb105-902"><a href="#cb105-902" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-903"><a href="#cb105-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-904"><a href="#cb105-904" aria-hidden="true" tabindex="-1"></a>The example above is a frequentist one. However, the auditor is free to apply a Bayesian philosophy in planning the sample. For example, the risk assessments from the ARM can be incorporated into a prior distribution. This can be done using <span class="in">`method = "arm"`</span> in the <span class="in">`auditPrior()`</span> function, which takes the values of the inherent risk probability <span class="in">`ir`</span> and the control risk probability <span class="in">`cr`</span>. Hence, the prior distribution in this example can be constructed using the following command:</span>
<span id="cb105-905"><a href="#cb105-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-908"><a href="#cb105-908" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-909"><a href="#cb105-909" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"arm"</span>, <span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> expected, <span class="at">ir =</span> ir, <span class="at">cr =</span> cr)</span>
<span id="cb105-910"><a href="#cb105-910" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-911"><a href="#cb105-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-912"><a href="#cb105-912" aria-hidden="true" tabindex="-1"></a>The <span class="in">`summary()`</span> function can be used to obtain relevant information about the prior distribution.</span>
<span id="cb105-913"><a href="#cb105-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-916"><a href="#cb105-916" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-917"><a href="#cb105-917" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(prior)</span>
<span id="cb105-918"><a href="#cb105-918" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-919"><a href="#cb105-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-920"><a href="#cb105-920" aria-hidden="true" tabindex="-1"></a>Furthermore, the prior distribution can be visualized with a call to the <span class="in">`plot()`</span> function.</span>
<span id="cb105-921"><a href="#cb105-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-924"><a href="#cb105-924" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-925"><a href="#cb105-925" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span>
<span id="cb105-926"><a href="#cb105-926" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-927"><a href="#cb105-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-928"><a href="#cb105-928" aria-hidden="true" tabindex="-1"></a>By using the prior distribution to incorporate the assessments of the inherent risk and the control risk, the auditor can plan a sample while taking into account the risk-reducing information. The required minimum sample size is also 174 in this case.</span>
<span id="cb105-929"><a href="#cb105-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-932"><a href="#cb105-932" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-933"><a href="#cb105-933" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">expected =</span> expected, <span class="at">conf.level =</span> <span class="dv">1</span> <span class="sc">-</span> ar, <span class="at">prior =</span> prior)</span>
<span id="cb105-934"><a href="#cb105-934" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-935"><a href="#cb105-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-936"><a href="#cb105-936" aria-hidden="true" tabindex="-1"></a><span class="fu">### Benchmark Analysis</span></span>
<span id="cb105-937"><a href="#cb105-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-938"><a href="#cb105-938" aria-hidden="true" tabindex="-1"></a>The auditor may incorporate information obtained through analytical procedures <span class="co">[</span><span class="ot">@Derks2021</span><span class="co">]</span>, such as a benchmark analysis, into the prior distribution for $\theta$. While we have previously discussed methods for constructing a prior distribution based on existing knowledge, there is no set procedure for incorporating information obtained through analytical procedures, as these procedures can vary significantly depending on the type of information being incorporated into the prior distribution. Therefore, it is important to thoroughly substantiate the data and assumptions used in this approach and to carefully consider how these assumptions are incorporated into the prior distribution.</span>
<span id="cb105-939"><a href="#cb105-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-940"><a href="#cb105-940" aria-hidden="true" tabindex="-1"></a>One way to construct a prior distribution on the basis of data is through the use of regression models, such as benchmarking the relationship between sales and costs of sales within the auditee's specific industry sector. The **jfa** package includes a data set <span class="in">`benchmark`</span> that can be used for this example.</span>
<span id="cb105-941"><a href="#cb105-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-944"><a href="#cb105-944" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-945"><a href="#cb105-945" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(benchmark)</span>
<span id="cb105-946"><a href="#cb105-946" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(benchmark)</span>
<span id="cb105-947"><a href="#cb105-947" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-948"><a href="#cb105-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-949"><a href="#cb105-949" aria-hidden="true" tabindex="-1"></a>The auditee's the sum of the sales is $298,112,312 and the sum of the booked costs of sales is $223,994,405, respectively. This is indicated by a blue dot in the figure below, which visualizes the industry sales versus the cost of sales.</span>
<span id="cb105-950"><a href="#cb105-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-953"><a href="#cb105-953" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-954"><a href="#cb105-954" aria-hidden="true" tabindex="-1"></a>C_real <span class="ot">&lt;-</span> <span class="dv">223994405</span></span>
<span id="cb105-955"><a href="#cb105-955" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-956"><a href="#cb105-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-957"><a href="#cb105-957" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, fig.width = 7, fig.height = 6, fig.align = "center"}</span></span>
<span id="cb105-958"><a href="#cb105-958" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">pretty</span>(<span class="fu">c</span>(benchmark<span class="sc">$</span>sales, benchmark<span class="sc">$</span>costofsales))</span>
<span id="cb105-959"><a href="#cb105-959" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"$"</span>, <span class="fu">format</span>(breaks <span class="sc">/</span> <span class="dv">1000000</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>), <span class="st">"M"</span>)</span>
<span id="cb105-960"><a href="#cb105-960" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> benchmark, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> sales, <span class="at">y =</span> costofsales)) <span class="sc">+</span></span>
<span id="cb105-961"><a href="#cb105-961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"darkgray"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb105-962"><a href="#cb105-962" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">298112312</span>, <span class="at">y =</span> C_real), <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb105-963"><a href="#cb105-963" aria-hidden="true" tabindex="-1"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">fill =</span> <span class="st">"dodgerblue"</span>, <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb105-964"><a href="#cb105-964" aria-hidden="true" tabindex="-1"></a>             <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb105-965"><a href="#cb105-965" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Sales"</span>, <span class="at">breaks =</span> breaks,</span>
<span id="cb105-966"><a href="#cb105-966" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">range</span>(breaks), <span class="at">labels =</span> labels) <span class="sc">+</span></span>
<span id="cb105-967"><a href="#cb105-967" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Cost of sales"</span>, <span class="at">breaks =</span> breaks,</span>
<span id="cb105-968"><a href="#cb105-968" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">range</span>(breaks), <span class="at">labels =</span> labels) <span class="sc">+</span></span>
<span id="cb105-969"><a href="#cb105-969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xend =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="fu">min</span>(breaks), <span class="at">yend =</span> <span class="fu">max</span>(breaks)) <span class="sc">+</span></span>
<span id="cb105-970"><a href="#cb105-970" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="fu">min</span>(breaks), <span class="at">xend =</span> <span class="fu">max</span>(breaks), <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">yend =</span> <span class="sc">-</span><span class="cn">Inf</span>)</span>
<span id="cb105-971"><a href="#cb105-971" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> jfa<span class="sc">:::</span><span class="fu">.theme_jfa</span>(p)</span>
<span id="cb105-972"><a href="#cb105-972" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb105-973"><a href="#cb105-973" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-974"><a href="#cb105-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-975"><a href="#cb105-975" aria-hidden="true" tabindex="-1"></a>The relationship between the sales $S$ and the cost of sales $C$ can be modelled by a linear equation:</span>
<span id="cb105-976"><a href="#cb105-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-977"><a href="#cb105-977" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb105-978"><a href="#cb105-978" aria-hidden="true" tabindex="-1"></a>  C = \beta_0 + \beta_1 \cdot S + \epsilon.</span>
<span id="cb105-979"><a href="#cb105-979" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb105-980"><a href="#cb105-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-981"><a href="#cb105-981" aria-hidden="true" tabindex="-1"></a>In practice, this relationship is often more complex than is presented above, and the auditor must carefully construct and evaluate the applied regression model. However, for ease of understanding we will continue our example with this toy model. The auditor can estimate the regression model using the following command:</span>
<span id="cb105-982"><a href="#cb105-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-985"><a href="#cb105-985" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-986"><a href="#cb105-986" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(costofsales <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> sales, <span class="at">data =</span> benchmark)</span>
<span id="cb105-987"><a href="#cb105-987" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb105-988"><a href="#cb105-988" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-989"><a href="#cb105-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-990"><a href="#cb105-990" aria-hidden="true" tabindex="-1"></a>The predicted cost of sales for the auditee, based on the industry benchmark, can be computed as follows:</span>
<span id="cb105-991"><a href="#cb105-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-994"><a href="#cb105-994" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-995"><a href="#cb105-995" aria-hidden="true" tabindex="-1"></a>C_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">sales =</span> <span class="dv">298112312</span>), <span class="at">interval =</span> <span class="st">"prediction"</span>, <span class="at">level =</span> <span class="fl">0.90</span>)[<span class="dv">1</span>]</span>
<span id="cb105-996"><a href="#cb105-996" aria-hidden="true" tabindex="-1"></a>C_pred</span>
<span id="cb105-997"><a href="#cb105-997" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-998"><a href="#cb105-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-999"><a href="#cb105-999" aria-hidden="true" tabindex="-1"></a>The fitted regression line and the predicted cost of sales (red dot) are visualized in the figure below:</span>
<span id="cb105-1000"><a href="#cb105-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1001"><a href="#cb105-1001" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, fig.width = 7, fig.height = 6, fig.align = "center"}</span></span>
<span id="cb105-1002"><a href="#cb105-1002" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">pretty</span>(<span class="fu">c</span>(benchmark<span class="sc">$</span>sales, benchmark<span class="sc">$</span>costofsales))</span>
<span id="cb105-1003"><a href="#cb105-1003" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"$"</span>, <span class="fu">format</span>(breaks <span class="sc">/</span> <span class="dv">1000000</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>), <span class="st">"M"</span>)</span>
<span id="cb105-1004"><a href="#cb105-1004" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> benchmark, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> sales, <span class="at">y =</span> costofsales)) <span class="sc">+</span></span>
<span id="cb105-1005"><a href="#cb105-1005" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">"smooth"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb105-1006"><a href="#cb105-1006" aria-hidden="true" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb105-1007"><a href="#cb105-1007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"darkgray"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb105-1008"><a href="#cb105-1008" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">298112312</span>, <span class="at">y =</span> C_real), <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb105-1009"><a href="#cb105-1009" aria-hidden="true" tabindex="-1"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">fill =</span> <span class="st">"dodgerblue"</span>, <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb105-1010"><a href="#cb105-1010" aria-hidden="true" tabindex="-1"></a>             <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb105-1011"><a href="#cb105-1011" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">298112312</span>, <span class="at">y =</span> C_pred), <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb105-1012"><a href="#cb105-1012" aria-hidden="true" tabindex="-1"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">fill =</span> <span class="st">"firebrick"</span>, <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb105-1013"><a href="#cb105-1013" aria-hidden="true" tabindex="-1"></a>             <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb105-1014"><a href="#cb105-1014" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Sales"</span>, <span class="at">breaks =</span> breaks,</span>
<span id="cb105-1015"><a href="#cb105-1015" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">range</span>(breaks), <span class="at">labels =</span> labels) <span class="sc">+</span></span>
<span id="cb105-1016"><a href="#cb105-1016" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Cost of sales"</span>, <span class="at">breaks =</span> breaks,</span>
<span id="cb105-1017"><a href="#cb105-1017" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">range</span>(breaks), <span class="at">labels =</span> labels) <span class="sc">+</span></span>
<span id="cb105-1018"><a href="#cb105-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xend =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="fu">min</span>(breaks), <span class="at">yend =</span> <span class="fu">max</span>(breaks)) <span class="sc">+</span></span>
<span id="cb105-1019"><a href="#cb105-1019" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="fu">min</span>(breaks), <span class="at">xend =</span> <span class="fu">max</span>(breaks), <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">yend =</span> <span class="sc">-</span><span class="cn">Inf</span>)</span>
<span id="cb105-1020"><a href="#cb105-1020" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> jfa<span class="sc">:::</span><span class="fu">.theme_jfa</span>(p)</span>
<span id="cb105-1021"><a href="#cb105-1021" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb105-1022"><a href="#cb105-1022" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1023"><a href="#cb105-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1024"><a href="#cb105-1024" aria-hidden="true" tabindex="-1"></a>The prior distribution can be justified by the data and the auditee's numerical prediction of the cost of sales. In this analytical procedure, the prior distribution on $\theta$ can utilize the relative error distribution from the linear regression. This relative error distribution, which is a Normal($\mu$, $\sigma$) distribution, captures the uncertainty of the prediction of the cost of sales through the use of linear regression, scaled to be a percentage of the total cost of sales. The mean $\mu$ of the prior distribution is determined by the relative deviation of the auditee's booked cost of sales when compared to the predicted cost of sales according to the benchmark data $\frac{C - \hat{C}}{C}$.</span>
<span id="cb105-1025"><a href="#cb105-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1028"><a href="#cb105-1028" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1029"><a href="#cb105-1029" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> (C_real <span class="sc">-</span> C_pred) <span class="sc">/</span> C_real</span>
<span id="cb105-1030"><a href="#cb105-1030" aria-hidden="true" tabindex="-1"></a>mu</span>
<span id="cb105-1031"><a href="#cb105-1031" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1032"><a href="#cb105-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1033"><a href="#cb105-1033" aria-hidden="true" tabindex="-1"></a>The standard deviation of the prior distribution is expressed through the standard deviation of the distribution of $\epsilon$:</span>
<span id="cb105-1034"><a href="#cb105-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1037"><a href="#cb105-1037" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1038"><a href="#cb105-1038" aria-hidden="true" tabindex="-1"></a>stdev <span class="ot">&lt;-</span> <span class="fu">sd</span>(fit<span class="sc">$</span>residuals) <span class="sc">/</span> C_real</span>
<span id="cb105-1039"><a href="#cb105-1039" aria-hidden="true" tabindex="-1"></a>stdev</span>
<span id="cb105-1040"><a href="#cb105-1040" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1041"><a href="#cb105-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1042"><a href="#cb105-1042" aria-hidden="true" tabindex="-1"></a>The Normal(0.019, 0.05) prior distribution can be constructed through a call to <span class="in">`auditPrior()`</span>, where the likelihood of the prior is specified as <span class="in">`normal`</span>. We call the function with <span class="in">`method = "param"`</span> to manually specify the parameters of the prior distribution.</span>
<span id="cb105-1043"><a href="#cb105-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1046"><a href="#cb105-1046" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1047"><a href="#cb105-1047" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"param"</span>, <span class="at">likelihood =</span> <span class="st">"normal"</span>, <span class="at">alpha =</span> mu, <span class="at">beta =</span> stdev)</span>
<span id="cb105-1048"><a href="#cb105-1048" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(prior)</span>
<span id="cb105-1049"><a href="#cb105-1049" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1050"><a href="#cb105-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1051"><a href="#cb105-1051" aria-hidden="true" tabindex="-1"></a>The specified prior distribution can be visualized using the <span class="in">`plot()`</span> function.</span>
<span id="cb105-1052"><a href="#cb105-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1055"><a href="#cb105-1055" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1056"><a href="#cb105-1056" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span>
<span id="cb105-1057"><a href="#cb105-1057" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1058"><a href="#cb105-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1059"><a href="#cb105-1059" aria-hidden="true" tabindex="-1"></a>The performance materiality for this example is set to $\theta_{max}$ = 5 percent, and the audit risk is set to $\alpha = 0.05$, or 5 percent. By using this prior distribution, the required minimum sample size is 50.</span>
<span id="cb105-1060"><a href="#cb105-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1063"><a href="#cb105-1063" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1064"><a href="#cb105-1064" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">prior =</span> prior)</span>
<span id="cb105-1065"><a href="#cb105-1065" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb105-1066"><a href="#cb105-1066" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1067"><a href="#cb105-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1068"><a href="#cb105-1068" aria-hidden="true" tabindex="-1"></a>You can inspect how the prior distribution compares to the expected posterior distribution by using the <span class="in">`plot()`</span> function.</span>
<span id="cb105-1069"><a href="#cb105-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1072"><a href="#cb105-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1073"><a href="#cb105-1073" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb105-1074"><a href="#cb105-1074" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1075"><a href="#cb105-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1076"><a href="#cb105-1076" aria-hidden="true" tabindex="-1"></a>By using a frequentist approach, the required minimum sample size is 50. Thus, by performing the analytical procedure and incorporating this information into the prior distribution, the auditor has achieved a reduction in sample size of 9 items.</span>
<span id="cb105-1077"><a href="#cb105-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1080"><a href="#cb105-1080" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1081"><a href="#cb105-1081" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb105-1082"><a href="#cb105-1082" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb105-1083"><a href="#cb105-1083" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1084"><a href="#cb105-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1085"><a href="#cb105-1085" aria-hidden="true" tabindex="-1"></a><span class="fu">### Predictive Modeling</span></span>
<span id="cb105-1086"><a href="#cb105-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1087"><a href="#cb105-1087" aria-hidden="true" tabindex="-1"></a>As a final example, we consider an example wehre the auditor incorporates information about the probability of misstatement obtained through a predictive analysis into the prior distribution for $\theta$. In this example, the auditor is conducting an audit on a long-term client that they have been working with for fifteen years. Hence, the auditor has access to a historycal data set called <span class="in">`history`</span>, which contains the samples from all of the previous audits that have been conducted on this auditee over the past fifteen years.</span>
<span id="cb105-1088"><a href="#cb105-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1091"><a href="#cb105-1091" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1092"><a href="#cb105-1092" aria-hidden="true" tabindex="-1"></a>history <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://github.com/koenderks/sasr/raw/master/data/ch3_history.csv"</span>, <span class="at">colClasses =</span> <span class="fu">c</span>(<span class="st">"factor"</span>, <span class="st">"numeric"</span>, <span class="st">"numeric"</span>))</span>
<span id="cb105-1093"><a href="#cb105-1093" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(history)</span>
<span id="cb105-1094"><a href="#cb105-1094" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1095"><a href="#cb105-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1096"><a href="#cb105-1096" aria-hidden="true" tabindex="-1"></a>It should be noted that for all historical sample items, there are three known characteristics: whether they contained a misstatement (designated as <span class="in">`k`</span>), the number of full-time equivalent employees (FTEs) who had access to that item within the internal computer systems of the auditee (designated as <span class="in">`ftes`</span>), and the number of days that the item was outstanding (designated as <span class="in">`days`</span>). Additionally, the <span class="in">`ftes`</span> and <span class="in">`days`</span> characteristics are also known for all items in the current year's population. Of course, it is unknown if any misstatements exist within the population of the current year.</span>
<span id="cb105-1097"><a href="#cb105-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1100"><a href="#cb105-1100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1101"><a href="#cb105-1101" aria-hidden="true" tabindex="-1"></a>population <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://github.com/koenderks/sasr/raw/master/data/ch3_population.csv"</span>)</span>
<span id="cb105-1102"><a href="#cb105-1102" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(population)</span>
<span id="cb105-1103"><a href="#cb105-1103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1104"><a href="#cb105-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1105"><a href="#cb105-1105" aria-hidden="true" tabindex="-1"></a>The objective of this analytical procedure is to forecast potential misstatements within the population of the current year. In order for the information obtained through this procedure to serve as prior knowledge in a Bayesian analysis, the procedure must yield a distribution of the probability of misstatement. Therefore, the auditor employs a machine learning technique known as Random Forest <span class="co">[</span><span class="ot">@Hastie2009</span><span class="co">]</span> to learn the relationship between misstatements, the number of full-time equivalent employees, and the number of outstanding days in the historical data set.</span>
<span id="cb105-1106"><a href="#cb105-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1109"><a href="#cb105-1109" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1110"><a href="#cb105-1110" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb105-1111"><a href="#cb105-1111" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> randomForest<span class="sc">::</span><span class="fu">randomForest</span>(<span class="at">formula =</span> k <span class="sc">~</span> ftes <span class="sc">+</span> days, <span class="at">data =</span> history)</span>
<span id="cb105-1112"><a href="#cb105-1112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1113"><a href="#cb105-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1114"><a href="#cb105-1114" aria-hidden="true" tabindex="-1"></a>The auditor specifically uses the random forest technique due to its ability to provide a distribution of the misstatement probabilities. The probabilistic predictions for the unseen misstatements in the <span class="in">`population`</span> data can be obtained by calling the <span class="in">`predict()`</span> function with the argument <span class="in">`type = "prob"`</span>.</span>
<span id="cb105-1115"><a href="#cb105-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1118"><a href="#cb105-1118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1119"><a href="#cb105-1119" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> fit, <span class="at">newdata =</span> population, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb105-1120"><a href="#cb105-1120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1121"><a href="#cb105-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1122"><a href="#cb105-1122" aria-hidden="true" tabindex="-1"></a>These predictions come in a probabilistic format, which means that for each item in the population of the current year there is a predicted probability that that item is misstated. These probabilities are stored in the second column of the <span class="in">`predictions`</span> data frame.</span>
<span id="cb105-1123"><a href="#cb105-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1126"><a href="#cb105-1126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1127"><a href="#cb105-1127" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predictions)</span>
<span id="cb105-1128"><a href="#cb105-1128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1129"><a href="#cb105-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1130"><a href="#cb105-1130" aria-hidden="true" tabindex="-1"></a>The prior distribution for $\theta$ will be based on the distribution of probabilities that each item in the population is misstated. In contrast to the previous example, this distribution is not a parametric distribution, which means we are unable to utilize any parametric priors from **jfa**. However, by providing samples of the prior distribution, **jfa** is able to construct a nonparametric prior distribution internally via the density of the samples.</span>
<span id="cb105-1131"><a href="#cb105-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1132"><a href="#cb105-1132" aria-hidden="true" tabindex="-1"></a>The nonparametric prior distribution can be constructed through a call to <span class="in">`auditPrior()`</span>, where the method to construct of the prior is specified as <span class="in">`nonparam`</span>. The samples of the prior distribution can be provided through the <span class="in">`samples`</span> argument. We use the second column of the the <span class="in">`predictions`</span> object for this.</span>
<span id="cb105-1133"><a href="#cb105-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1136"><a href="#cb105-1136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1137"><a href="#cb105-1137" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"nonparam"</span>, <span class="at">samples =</span> predictions[, <span class="dv">2</span>])</span>
<span id="cb105-1138"><a href="#cb105-1138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1139"><a href="#cb105-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1140"><a href="#cb105-1140" aria-hidden="true" tabindex="-1"></a>The nonparametric prior distribution can be visualized using the <span class="in">`plot()`</span> function.</span>
<span id="cb105-1141"><a href="#cb105-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1144"><a href="#cb105-1144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1145"><a href="#cb105-1145" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span>
<span id="cb105-1146"><a href="#cb105-1146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1147"><a href="#cb105-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1148"><a href="#cb105-1148" aria-hidden="true" tabindex="-1"></a>The performance materiality for this example is set to $\theta_{max}$ = 1 percent, and the audit risk is set to $\alpha = 0.05$, or 5 percent. The minimum sample size can be calculated with the command below and is 108.</span>
<span id="cb105-1149"><a href="#cb105-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1152"><a href="#cb105-1152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1153"><a href="#cb105-1153" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.01</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">prior =</span> prior)</span>
<span id="cb105-1154"><a href="#cb105-1154" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb105-1155"><a href="#cb105-1155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1156"><a href="#cb105-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1157"><a href="#cb105-1157" aria-hidden="true" tabindex="-1"></a>You can inspect how the prior distribution compares to the expected posterior distribution by using the <span class="in">`plot()`</span> function.</span>
<span id="cb105-1158"><a href="#cb105-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1161"><a href="#cb105-1161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1162"><a href="#cb105-1162" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plan)</span>
<span id="cb105-1163"><a href="#cb105-1163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1164"><a href="#cb105-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1165"><a href="#cb105-1165" aria-hidden="true" tabindex="-1"></a>By using a frequentist approach, the required minimum sample size is 299. Thus, by performing the analytical procedure and incorporating this information into the prior distribution, the auditor has achieved a reduction in sample size of 299 - 108 = 191 items.</span>
<span id="cb105-1166"><a href="#cb105-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1169"><a href="#cb105-1169" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1170"><a href="#cb105-1170" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.01</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>)</span>
<span id="cb105-1171"><a href="#cb105-1171" aria-hidden="true" tabindex="-1"></a>plan</span>
<span id="cb105-1172"><a href="#cb105-1172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1173"><a href="#cb105-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1174"><a href="#cb105-1174" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb105-1175"><a href="#cb105-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1176"><a href="#cb105-1176" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Use the classical approach with the hypergeometric likelihood to compute the minimum required sample size for a population of $N = 100$ when applying a performance materiality of 3 percent and a sampling risk of 5 percent. Tolerate no misstatements in the sample.</span>
<span id="cb105-1177"><a href="#cb105-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1178"><a href="#cb105-1178" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb105-1179"><a href="#cb105-1179" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb105-1182"><a href="#cb105-1182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1183"><a href="#cb105-1183" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">100</span>)</span>
<span id="cb105-1184"><a href="#cb105-1184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1185"><a href="#cb105-1185" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb105-1186"><a href="#cb105-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1187"><a href="#cb105-1187" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Recompute the previous sample size with the Bayesian approach using a default prior.</span>
<span id="cb105-1188"><a href="#cb105-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1189"><a href="#cb105-1189" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb105-1190"><a href="#cb105-1190" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb105-1193"><a href="#cb105-1193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1194"><a href="#cb105-1194" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.03</span>, <span class="at">likelihood =</span> <span class="st">"hypergeometric"</span>, <span class="at">N.units =</span> <span class="dv">100</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb105-1195"><a href="#cb105-1195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1196"><a href="#cb105-1196" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb105-1197"><a href="#cb105-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1198"><a href="#cb105-1198" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Use the classical approach with the binomial likelihood to compute the minimum required sample size for a performance materiality of 4.4 percent and a sampling risk of 5 percent. Tolerate one misstatement in the sample.</span>
<span id="cb105-1199"><a href="#cb105-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1200"><a href="#cb105-1200" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb105-1201"><a href="#cb105-1201" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb105-1204"><a href="#cb105-1204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1205"><a href="#cb105-1205" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.044</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">expected =</span> <span class="dv">1</span>)</span>
<span id="cb105-1206"><a href="#cb105-1206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1207"><a href="#cb105-1207" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb105-1208"><a href="#cb105-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1209"><a href="#cb105-1209" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Recompute the previous sample size with the Bayesian approach using a default prior.</span>
<span id="cb105-1210"><a href="#cb105-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1211"><a href="#cb105-1211" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb105-1212"><a href="#cb105-1212" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb105-1215"><a href="#cb105-1215" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1216"><a href="#cb105-1216" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.044</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">expected =</span> <span class="dv">1</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb105-1217"><a href="#cb105-1217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1218"><a href="#cb105-1218" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb105-1219"><a href="#cb105-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1220"><a href="#cb105-1220" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Use the classical approach with the Poisson likelihood to compute the minimum required sample size for a performance materiality of 2 percent and a sampling risk of 5 percent. Use an expected misstatement rate of 0.5 percent.</span>
<span id="cb105-1221"><a href="#cb105-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1222"><a href="#cb105-1222" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb105-1223"><a href="#cb105-1223" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb105-1226"><a href="#cb105-1226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1227"><a href="#cb105-1227" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.02</span>, <span class="at">expected =</span> <span class="fl">0.005</span>)</span>
<span id="cb105-1228"><a href="#cb105-1228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1229"><a href="#cb105-1229" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb105-1230"><a href="#cb105-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1231"><a href="#cb105-1231" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Recompute the previous sample size with the Bayesian approach using a default prior.</span>
<span id="cb105-1232"><a href="#cb105-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1233"><a href="#cb105-1233" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb105-1234"><a href="#cb105-1234" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb105-1237"><a href="#cb105-1237" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1238"><a href="#cb105-1238" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.02</span>, <span class="at">expected =</span> <span class="fl">0.005</span>, <span class="at">prior =</span> <span class="cn">TRUE</span>)</span>
<span id="cb105-1239"><a href="#cb105-1239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1240"><a href="#cb105-1240" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb105-1241"><a href="#cb105-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1242"><a href="#cb105-1242" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Compute the sampling risk according to the Audit Risk Model for an audit risk percentage of 5 percent, an inherent risk percentage of 50 percent and an internal control risk percentage of 80$. Next, use the classical approach with the binomial likelihood to compute the minimum sample size for a performance materiality of 5 percent and the new sampling risk. Tolerate no misstatements in the sample.</span>
<span id="cb105-1243"><a href="#cb105-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1244"><a href="#cb105-1244" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb105-1245"><a href="#cb105-1245" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb105-1248"><a href="#cb105-1248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1249"><a href="#cb105-1249" aria-hidden="true" tabindex="-1"></a>dr <span class="ot">&lt;-</span> <span class="fl">0.05</span> <span class="sc">/</span> (<span class="fl">0.5</span> <span class="sc">*</span> <span class="fl">0.8</span>)</span>
<span id="cb105-1250"><a href="#cb105-1250" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">conf.level =</span> <span class="dv">1</span> <span class="sc">-</span> dr)</span>
<span id="cb105-1251"><a href="#cb105-1251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1252"><a href="#cb105-1252" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb105-1253"><a href="#cb105-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1254"><a href="#cb105-1254" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>Construct a prior distribution on the basis of the information in exercise 7. Use this prior distribution to recompute the previous sample size with the Bayesian approach.</span>
<span id="cb105-1255"><a href="#cb105-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1256"><a href="#cb105-1256" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb105-1257"><a href="#cb105-1257" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb105-1260"><a href="#cb105-1260" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1261"><a href="#cb105-1261" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"arm"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">ir =</span> <span class="fl">0.5</span>, <span class="at">cr =</span> <span class="fl">0.8</span>)</span>
<span id="cb105-1262"><a href="#cb105-1262" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span>
<span id="cb105-1263"><a href="#cb105-1263" aria-hidden="true" tabindex="-1"></a><span class="fu">planning</span>(<span class="at">materiality =</span> <span class="fl">0.05</span>, <span class="at">prior =</span> prior)</span>
<span id="cb105-1264"><a href="#cb105-1264" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1265"><a href="#cb105-1265" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb105-1266"><a href="#cb105-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1267"><a href="#cb105-1267" aria-hidden="true" tabindex="-1"></a><span class="ss">9. </span>Construct a prior distribution on the basis of the assumption that tolerable misstatement is equally likely as intolerable misstatement before seeing the sample data. Use the binomial likelihood and assume a performance materiality of 2.5 percent.</span>
<span id="cb105-1268"><a href="#cb105-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-1269"><a href="#cb105-1269" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details&gt;</span></span>
<span id="cb105-1270"><a href="#cb105-1270" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;summary&gt;</span>Click to reveal answer<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb105-1273"><a href="#cb105-1273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb105-1274"><a href="#cb105-1274" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">auditPrior</span>(<span class="at">method =</span> <span class="st">"impartial"</span>, <span class="at">likelihood =</span> <span class="st">"binomial"</span>, <span class="at">materiality =</span> <span class="fl">0.05</span>)</span>
<span id="cb105-1275"><a href="#cb105-1275" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prior)</span>
<span id="cb105-1276"><a href="#cb105-1276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb105-1277"><a href="#cb105-1277" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>